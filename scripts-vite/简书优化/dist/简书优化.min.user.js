// ==UserScript==
// @name         简书优化
// @namespace    https://github.com/WhiteSevs/TamperMonkeyScript
// @version      2024.11.11
// @author       WhiteSevs
// @description  支持手机端和PC端、屏蔽广告、优化浏览体验、重定向链接、全文居中、自动展开全文、允许复制文字、劫持唤醒/跳转App、自定义屏蔽元素等
// @license      GPL-3.0-only
// @icon         data:image/png;base64,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
// @supportURL   https://github.com/WhiteSevs/TamperMonkeyScript/issues
// @match        *://*.jianshu.com/*
// @match        *://*.jianshu.io/*
// @require      https://update.greasyfork.org/scripts/494167/1413255/CoverUMD.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/utils@2.5.1/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/domutils@1.4.0/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/pops@1.8.9/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/qmsg@1.2.7/dist/index.umd.js
// @connect      *
// @grant        GM_deleteValue
// @grant        GM_getResourceText
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-start
// ==/UserScript==

(function (v, F, $, U) {
	'use strict';

	var N=typeof GM_deleteValue<"u"?GM_deleteValue:void 0,P=typeof GM_getResourceText<"u"?GM_getResourceText:void 0,w=typeof GM_getValue<"u"?GM_getValue:void 0,E=typeof GM_info<"u"?GM_info:void 0,W=typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0,R=typeof GM_setValue<"u"?GM_setValue:void 0,q=typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0,z=typeof GM_xmlhttpRequest<"u"?GM_xmlhttpRequest:void 0,_=typeof unsafeWindow<"u"?unsafeWindow:void 0,K=window;const x={addBlockCSS(...e){let t=[];if(e.length!==0&&!(e.length===1&&typeof e[0]=="string"&&e[0].trim()===""))return e.forEach(n=>{Array.isArray(n)?t=t.concat(n):t.push(n);}),T(`${t.join(`,
`)}{display: none !important;}`)},setGMResourceCSS(e){let t=typeof P=="function"?P(e.keyName):"";typeof t=="string"&&t?T(t):x.loadStyleLink(e.url);},async loadStyleLink(e){let t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,Y.ready(()=>{document.head.appendChild(t);});},async loadScript(e){let t=document.createElement("script");return t.src=e,new Promise(n=>{t.onload=()=>{n(null);},(document.head||document.documentElement).appendChild(t);})},fixUrl(e){return e=e.trim(),e.match(/^http(s|):\/\//i)||(e.startsWith("/")||(e+="/"),e=window.location.origin+e),e},fixHttps(e){if(e.startsWith("https://")||!e.startsWith("http://"))return e;let t=new URL(e);return t.protocol="https:",t.toString()}},Z="简书优化",h=$.noConflict(),Y=F.noConflict(),l=new h.Log(E,_.console||K.console);var L;const I=((L=E==null?void 0:E.script)==null?void 0:L.name)||Z,B=!1;l.config({debug:B,logMaxCount:1e3,autoClearConsole:!0,tag:!0});v.config(Object.defineProperties({html:!0,autoClose:!0,showClose:!1},{position:{get(){return i.getValue("qmsg-config-position","bottom")}},maxNums:{get(){return i.getValue("qmsg-config-maxnums",5)}},showReverse:{get(){return i.getValue("qmsg-config-showreverse",!0)}},zIndex:{get(){let e=$.getMaxZIndex(),t=U.config.InstanceUtils.getPopsMaxZIndex().zIndex;return $.getMaxValue(e,t)+100}}}));const k=new h.GM_Menu({GM_getValue:w,GM_setValue:R,GM_registerMenuCommand:W,GM_unregisterMenuCommand:q}),O=new h.Httpx(z);O.interceptors.response.use(void 0,e=>(l.error("拦截器-请求错误",e),e.type==="onabort"?v.warning("请求取消"):e.type==="onerror"?v.error("请求异常"):e.type==="ontimeout"?v.error("请求超时"):v.error("其它错误"),e));O.config({logDetails:B});_.Object.defineProperty,_.Function.prototype.apply,_.Function.prototype.call,_.Element.prototype.appendChild,_.setTimeout;const T=h.addStyle.bind(h);document.querySelector.bind(document);document.querySelectorAll.bind(document);const S="GM_Panel",Q="data-init",V="data-key",A="data-default-value",X="data-init-more-value",y="data-storage-api",m=function(e,t,n,a,r,o){let s={text:e,type:"switch",description:r,attributes:{},props:{},getValue(){return !!this.props[y].get(t,n)},callback(u,f){let d=!!f;l.success(`${d?"开启":"关闭"} ${e}`),this.props[y].set(t,d);},afterAddToUListCallBack:o};return Reflect.set(s.attributes,V,t),Reflect.set(s.attributes,A,n),Reflect.set(s.props,y,{get(u,f){return i.getValue(u,f)},set(u,f){i.setValue(u,f);}}),s},ee={id:"jianshu-panel-config-pc",title:"桌面端",forms:[{text:"",type:"forms",forms:[{text:"功能",type:"deepMenu",forms:[{text:"",type:"forms",forms:[m("全文居中","JianShuArticleCenter",!0),m("自动展开全文","JianShuAutoExpandFullText",!0),m("重定向链接","JianShuAutoJumpRedirect_PC",!0,void 0,"自动跳转简书拦截的Url链接")]}]},{text:"屏蔽",type:"deepMenu",forms:[{text:"",type:"forms",forms:[m("【屏蔽】底部推荐阅读","JianShuShieldRecommendedReading",!1),m("【屏蔽】评论区","JianShuShieldUserComments",!1),m("【屏蔽】相关文章","JianShuShieldRelatedArticles",!1),m("【屏蔽】客户端弹窗","jianshu-shieldClientDialog",!0,void 0,"弹出的【扫码安装简书客户端 畅享全文阅读体验】"),m("【屏蔽】顶部导航栏","jianshu-shieldTopNav",!1),m("【屏蔽】底部工具栏","jianshu-shieldBottomToolbar",!1,void 0,"屏蔽掉底部悬浮的评论输入框、评论、点赞...")]}]},{text:"劫持/拦截",type:"deepMenu",forms:[{text:"",type:"forms",forms:[m("拦截-剪贴板","JianShuRemoveClipboardHijacking",!0,void 0,"去除禁止复制")]}]}]}]},te={id:"jianshu-panel-config-mobile",title:"移动端",forms:[{text:"",type:"forms",forms:[{text:"功能",type:"deepMenu",forms:[{text:"",type:"forms",forms:[m("自动展开全文","JianShuAutoExpandFullText_Mobile",!0),m("重定向链接","JianShuAutoJumpRedirect_Mobile",!0,void 0,"自动跳转简书拦截的Url链接")]}]},{text:"屏蔽",type:"deepMenu",forms:[{text:"",type:"forms",forms:[m("【屏蔽】底部推荐阅读","JianShuremoveFooterRecommendRead",!1),m("【屏蔽】评论区","JianShuShieldUserCommentsMobile",!1)]}]},{text:"劫持/拦截",type:"deepMenu",forms:[{text:"",type:"forms",forms:[m("拦截-剪贴板","JianShuRemoveClipboardHijacking_Mobile",!0,void 0,"去除禁止复制"),m("劫持-唤醒/跳转App","JianShuHijackSchemeScriptLabel_Mobile",!0,void 0,"去除简书唤醒调用App")]}]}]}]},j=function(e,t,n,a,r,o){let s=[];typeof a=="function"?s=a():s=a;let u={text:e,type:"select",description:o,attributes:{},props:{},getValue(){return this.props[y].get(t,n)},callback(f,d,p){let c=d;l.info(`选择：${p}`),this.props[y].set(t,c),typeof r=="function"&&r(f,c,p);},data:s};return Reflect.set(u.attributes,V,t),Reflect.set(u.attributes,A,n),Reflect.set(u.props,y,{get(f,d){return i.getValue(f,d)},set(f,d){i.setValue(f,d);}}),u},ne={id:"jianshu-panel-common",title:"通用",forms:[{text:"Toast配置",type:"forms",forms:[j("Toast位置","qmsg-config-position","bottom",[{value:"topleft",text:"左上角"},{value:"top",text:"顶部"},{value:"topright",text:"右上角"},{value:"left",text:"左边"},{value:"center",text:"中间"},{value:"right",text:"右边"},{value:"bottomleft",text:"左下角"},{value:"bottom",text:"底部"},{value:"bottomright",text:"右下角"}],(e,t,n)=>{l.info("设置当前Qmsg弹出位置"+n);},"Toast显示在页面九宫格的位置"),j("最多显示的数量","qmsg-config-maxnums",3,[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"},{value:5,text:"5"}],void 0,"限制Toast显示的数量"),m("逆序弹出","qmsg-config-showreverse",!1,void 0,"修改Toast弹出的顺序")]}]},D={setting:{get width(){return window.innerWidth<550?"88vw":"550px"},get height(){return window.innerHeight<450?"70vh":"450px"}},settingBig:{get width(){return window.innerWidth<800?"92vw":"800px"},get height(){return window.innerHeight<600?"80vh":"600px"}},info:{get width(){return "350px"},get height(){return "250px"}}},i={$data:{__data:null,__oneSuccessExecMenu:null,__onceExec:null,__listenData:null,get data(){return i.$data.__data==null&&(i.$data.__data=new h.Dictionary),i.$data.__data},get oneSuccessExecMenu(){return i.$data.__oneSuccessExecMenu==null&&(i.$data.__oneSuccessExecMenu=new h.Dictionary),i.$data.__oneSuccessExecMenu},get onceExec(){return i.$data.__onceExec==null&&(i.$data.__onceExec=new h.Dictionary),i.$data.__onceExec},get scriptName(){return I},key:S,attributeKeyName:V,attributeDefaultValueName:A},$listener:{get listenData(){return i.$data.__listenData==null&&(i.$data.__listenData=new h.Dictionary),i.$data.__listenData}},init(){this.initPanelDefaultValue(),this.initExtensionsMenu();},isTopWindow(){return _.top===_.self},initExtensionsMenu(){this.isTopWindow()&&k.add([{key:"show_pops_panel_setting",text:"⚙ 设置",autoReload:!1,isStoreValue:!1,showText(e){return e},callback:()=>{this.showPanel();}}]);},initPanelDefaultValue(){let e=this;function t(r){if(!r.attributes)return;let o={},s=r.attributes[V];s!=null&&(o[s]=r.attributes[A]);let u=r.attributes[Q];if(typeof u=="function"){let p=u();if(typeof p=="boolean"&&!p)return}let f=r.attributes[X];f&&typeof f=="object"&&Object.assign(o,f);let d=Object.keys(o);if(!d.length){l.warn(["请先配置键",r]);return}d.forEach(p=>{let c=o[p];e.$data.data.has(p)&&l.warn("请检查该key(已存在): "+p),e.$data.data.set(p,c);});}function n(r){for(let o=0;o<r.length;o++){let s=r[o];t(s);let u=s.forms;u&&Array.isArray(u)&&n(u);}}let a=this.getPanelContentConfig();for(let r=0;r<a.length;r++){let o=a[r];if(!o.forms)continue;let s=o.forms;s&&Array.isArray(s)&&n(s);}},setValue(e,t){let n=w(S,{}),a=n[e];n[e]=t,R(S,n),this.$listener.listenData.has(e)&&this.$listener.listenData.get(e).callback(e,a,t);},getValue(e,t){let a=w(S,{})[e];return a??(this.$data.data.has(e)?this.$data.data.get(e):t)},deleteValue(e){let t=w(S,{}),n=t[e];Reflect.deleteProperty(t,e),R(S,t),this.$listener.listenData.has(e)&&this.$listener.listenData.get(e).callback(e,n,void 0);},addValueChangeListener(e,t){let n=Math.random();return this.$listener.listenData.set(e,{id:n,key:e,callback:t}),n},removeValueChangeListener(e){let t=null;for(const[n,a]of this.$listener.listenData.entries())if(a.id===e){t=n;break}typeof t=="string"?this.$listener.listenData.delete(t):console.warn("没有找到对应的监听器");},triggerMenuValueChange(e,t,n){if(this.$listener.listenData.has(e)){let a=this.$listener.listenData.get(e);if(typeof a.callback=="function"){let r=this.getValue(e),o=r,s=r;typeof t<"u"&&arguments.length>1&&(o=t),typeof n<"u"&&arguments.length>2&&(s=n),a.callback(e,s,o);}}},hasKey(e){let t=w(S,{});return e in t},execMenu(e,t,n=!1){if(!(typeof e=="string"||typeof e=="object"&&Array.isArray(e)))throw new TypeError("key 必须是字符串或者字符串数组");let a=[];typeof e=="object"&&Array.isArray(e)?a=[...e]:a.push(e);let r;for(let o=0;o<a.length;o++){const s=a[o];if(!this.$data.data.has(s)){l.warn(`${e} 键不存在`);return}let u=i.getValue(s);if(n&&(u=!u),!u)break;r=u;}r&&t(r);},execMenuOnce(e,t,n,a){if(typeof e!="string")throw new TypeError("key 必须是字符串");if(!this.$data.data.has(e)){l.warn(`${e} 键不存在`);return}if(this.$data.oneSuccessExecMenu.has(e))return;this.$data.oneSuccessExecMenu.set(e,1);let r=()=>{let d=i.getValue(e);return typeof n=="function"?n(e,d):d},o=[],s=d=>{let p=r(),c=[];if(d instanceof HTMLStyleElement?c=[d]:Array.isArray(d)&&(c=[...d.filter(g=>g!=null&&g instanceof HTMLStyleElement)]),p)o=o.concat(c);else for(let g=0;g<c.length;g++)c[g].remove(),c.splice(g,1),g--;},u=d=>{let p=[];if(d){let c=t(d,s);c instanceof HTMLStyleElement?p=[c]:Array.isArray(c)&&(p=[...c.filter(g=>g!=null&&g instanceof HTMLStyleElement)]);}for(let c=0;c<o.length;c++)o[c].remove(),o.splice(c,1),c--;o=[...p];};this.addValueChangeListener(e,(d,p,c)=>{let g=c;typeof a=="function"&&(g=a(d,c,p)),u(g);});let f=r();f&&u(f);},execInheritMenuOnce(e,t,n,a){let r=this;const o=(s,u)=>{let f=r.getValue(s),d=r.getValue(u);if(typeof a=="function"){let p=a(f,d);if(p!==void 0)return p}return f};this.execMenuOnce(e,n,()=>o(e,t),()=>o(e,t)),this.execMenuOnce(t,()=>{},()=>!1,()=>(this.triggerMenuValueChange(e),!1));},onceExec(e,t){if(typeof e!="string")throw new TypeError("key 必须是字符串");this.$data.onceExec.has(e)||(t(),this.$data.onceExec.set(e,1));},showPanel(){U.panel({title:{text:`${I}-设置`,position:"center",html:!1,style:""},content:this.getPanelContentConfig(),mask:{enable:!0,clickEvent:{toClose:!0,toHide:!1}},width:D.setting.width,height:D.setting.height,drag:!0,only:!0});},getPanelContentConfig(){return [ne,ee,te]}},ie=`.download-app-guidance,\r
.call-app-btn,\r
.collapse-tips,\r
.note-graceful-button,\r
.app-open,\r
.header-wrap,\r
.recommend-wrap.recommend-ad,\r
.call-app-Ad-bottom,\r
#recommended-notes p.top-title span.more,\r
#homepage .modal,\r
button.index_call-app-btn,\r
span.note__flow__download,\r
.download-guide,\r
#footer,\r
.comment-open-app-btn-wrap,\r
.nav.navbar-nav + div,\r
.self-flow-ad,\r
#free-reward-panel,\r
div[id*='AdFive'],\r
#index-aside-download-qrbox,\r
.baidu-app-download-2eIkf_1,\r
/* 底部的"小礼物走一走，来简书关注我"、赞赏支持和更多精彩内容，就在简书APP */\r
div[role="main"] > div > section:first-child > div:nth-last-child(2),\r
/* 它的内部是script标签，可能影响部分评论之间的高度问题 */\r
div.adad_container ,\r
/* 顶部导航栏的【下载App】 */\r
#__next nav a[href*="navbar-app"] {\r
	display: none !important;\r
}\r
body.reader-day-mode.normal-size {\r
	overflow: auto !important;\r
}\r
.collapse-free-content {\r
	height: auto !important;\r
}\r
.copyright {\r
	color: #000 !important;\r
}\r
#note-show .content .show-content-free .collapse-free-content:after {\r
	background-image: none !important;\r
}\r
footer > div > div {\r
	justify-content: center;\r
}\r
/* 修复底部最后编辑于：。。。在某些套壳浏览器上的错位问题 */\r
#note-show .content .show-content-free .note-meta-time {\r
	margin-top: 0px !important;\r
}\r
`,oe={isGoWild(){return window.location.pathname==="/go-wild"}},G=function(e=""){h.waitNodeList(e).then(t=>{t.forEach(n=>n.remove());});},C={init(){this.addCSS(),i.execMenu("JianShuAutoJumpRedirect_PC",()=>{this.jumpRedirect();}),i.execMenu("JianShuRemoveClipboardHijacking",()=>{this.removeClipboardHijacking();}),i.execMenu("JianShuAutoExpandFullText",()=>{this.autoExpandFullText();}),i.execMenu("JianShuArticleCenter",()=>this.articleCenter()),i.execMenu("JianShuShieldRelatedArticles",()=>this.shieldRelatedArticles()),i.execMenu("jianshu-shieldClientDialog",()=>{this.shieldClientDialog();}),i.execMenuOnce("JianShuShieldUserComments",()=>this.shieldUserComments()),i.execMenuOnce("JianShuShieldRecommendedReading",()=>this.shieldRecommendedReading()),i.execMenuOnce("jianshu-shieldTopNav",()=>this.shieldTopNav()),i.execMenuOnce("jianshu-shieldBottomToolbar",()=>this.shieldBottomToolbar());},addCSS(){return l.info("添加屏蔽CSS"),T(ie)},articleCenter(){l.info("全文居中");let e=[];return e.push(x.addBlockCSS("div[role=main] aside","div._3Pnjry"),T(`
			div[role=main] aside,
			div._3Pnjry{
				display: none !important;
			}
			div._gp-ck{
				width: 100% !important;
			}`)),G("div[role=main] aside"),G("div._3Pnjry"),h.waitNodeList("div._gp-ck").then(t=>{t.forEach(n=>{n.style.width="100%";});}),e},removeClipboardHijacking(){l.info("去除剪贴板劫持");const e=t=>{t.stopPropagation();};window.addEventListener("copy",e,!0),document.addEventListener("copy",e,!0);},autoExpandFullText(){h.waitNode('div#homepage div[class*="dialog-"]').then(e=>{e.style.visibility="hidden",l.info("自动展开全文"),h.mutationObserver(e,{callback:t=>{t.length!=0&&t.forEach(n=>{var a;n.target.style.display!="none"&&(l.success("自动展开全文-自动点击"),(a=document.querySelector('div#homepage div[class*="dialog-"] .cancel'))==null||a.click());});},config:{childList:!1,attributes:!0,characterData:!0,subtree:!0}});});},jumpRedirect(){if(oe.isGoWild()){l.success("去除简书拦截其它网址的url并自动跳转"),window.stop();let e=window.location.href.replace(window.location.origin+"/","");e=decodeURIComponent(e);let t=e.replace(/^go-wild\?ac=2&url=/gi,"").replace(/^https:\/\/link.zhihu.com\/\?target\=/gi,"");window.location.href=t;}},shieldRelatedArticles(){return l.info("屏蔽相关文章"),x.addBlockCSS('div[role="main"] > div > section:nth-child(2)')},shieldClientDialog(){l.info("【屏蔽】客户端弹窗"),x.addBlockCSS('div:has(>div[class*="-mask"]:not([class*="-mask-hidden"]) + div[tabindex="-1"][role="dialog"])'),h.waitNode('div[class*="-mask"]:not([class*="-mask-hidden"]) + div[tabindex="-1"][role="dialog"]').then(e=>{l.success("弹窗出现"),h.waitPropertyByInterval(e,()=>{var n,a,r,o;let t=h.getReactObj(e);return (o=(r=(a=(n=t==null?void 0:t.reactInternalInstance)==null?void 0:n.return)==null?void 0:a.return)==null?void 0:r.memoizedProps)==null?void 0:o.onClose},250,1e4).then(()=>{h.getReactObj(e).reactInternalInstance.return.return.memoizedProps.onClose(new Event("click")),l.success("调用函数关闭弹窗");});});},shieldUserComments(){return l.info("屏蔽评论区"),x.addBlockCSS("div#note-page-comment")},shieldRecommendedReading(){return l.info("屏蔽底部推荐阅读"),x.addBlockCSS('div[role="main"] > div > section:last-child')},shieldTopNav(){return l.info("【屏蔽】顶部导航栏"),x.addBlockCSS("header")},shieldBottomToolbar(){return l.info("【屏蔽】底部工具栏"),x.addBlockCSS("footer")}},J={init(){this.addCSS(),i.execMenu("JianShuAutoJumpRedirect_Mobile",()=>{C.jumpRedirect();}),i.execMenu("JianShuHijackSchemeScriptLabel_Mobile",()=>{this.handlePrototype();}),i.execMenu("JianShuRemoveClipboardHijacking_Mobile",()=>{C.removeClipboardHijacking();}),i.execMenu("JianShuAutoExpandFullText_Mobile",()=>{C.autoExpandFullText();}),i.execMenuOnce("JianShuremoveFooterRecommendRead",()=>this.removeFooterRecommendRead()),i.execMenu("JianShuShieldUserCommentsMobile",()=>this.shieldUserComments());},addCSS(){C.addCSS();},removeFooterRecommendRead(){return l.info("屏蔽底部推荐阅读"),x.addBlockCSS("#recommended-notes")},handlePrototype(){l.info("处理原型添加script标签");let e=Node.prototype.appendChild;_.Node.prototype.appendChild=function(t){let n=["img"];return t.src&&!t.src.includes("jianshu.io")&&!n.includes(t.localName)?(l.success(["禁止添加的元素",t]),null):e.call(this,t)};},shieldUserComments(){return l.info("屏蔽评论区"),x.addBlockCSS("#comment-main")}};i.init();let H=h.isPhone(),b="change_env_set",M=w(b);k.add({key:b,text:`⚙ 自动: ${H?"移动端":"PC端"}`,autoReload:!1,isStoreValue:!1,showText(e){return M==null?e:e+` 手动: ${M==1?"移动端":M==2?"PC端":"未知"}`},callback:()=>{let e=[0,1,2],t=window.prompt(`请输入当前脚本环境判定

自动判断: 0
移动端: 1
PC端: 2`,"0");if(!t)return;let n=parseInt(t);if(isNaN(n)){v.error("输入的不是规范的数字");return}if(!e.includes(n)){v.error("输入的值必须是0或1或2");return}n==0?N(b):R(b,n);}});M!=null?(l.info(`手动判定为${M===1?"移动端":"PC端"}`),M==1?J.init():M==2?C.init():(v.error("意外，手动判定的值不在范围内"),N(b))):H?(l.info("自动判定为移动端"),J.init()):(l.info("自动判定为PC端"),C.init());

})(Qmsg, DOMUtils, Utils, pops);