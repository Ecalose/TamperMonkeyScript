// ==UserScript==
// @name         简书优化
// @namespace    https://github.com/WhiteSevs/TamperMonkeyScript
// @version      2025.7.12
// @author       WhiteSevs
// @description  支持手机端和PC端、屏蔽广告、优化浏览体验、重定向链接、全文居中、自动展开全文、允许复制文字、劫持唤醒/跳转App、自定义屏蔽元素等
// @license      GPL-3.0-only
// @icon         data:image/png;base64,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
// @supportURL   https://github.com/WhiteSevs/TamperMonkeyScript/issues
// @match        *://*.jianshu.com/*
// @match        *://*.jianshu.io/*
// @require      https://fastly.jsdelivr.net/gh/WhiteSevs/TamperMonkeyScript@86be74b83fca4fa47521cded28377b35e1d7d2ac/lib/CoverUMD/index.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/utils@2.7.0/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/domutils@1.5.11/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/pops@2.1.13/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/qmsg@1.3.8/dist/index.umd.js
// @connect      *
// @grant        GM_deleteValue
// @grant        GM_getResourceText
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-start
// ==/UserScript==

(function (y, Y, M, G) {
	'use strict';

	const le=`.download-app-guidance,\r
.call-app-btn,\r
.collapse-tips,\r
.note-graceful-button,\r
.app-open,\r
.header-wrap,\r
.recommend-wrap.recommend-ad,\r
.call-app-Ad-bottom,\r
#recommended-notes p.top-title span.more,\r
#homepage .modal,\r
button.index_call-app-btn,\r
span.note__flow__download,\r
.download-guide,\r
#footer,\r
.comment-open-app-btn-wrap,\r
.nav.navbar-nav + div,\r
.self-flow-ad,\r
#free-reward-panel,\r
div[id*='AdFive'],\r
#index-aside-download-qrbox,\r
.baidu-app-download-2eIkf_1,\r
/* 底部的"小礼物走一走，来简书关注我"、赞赏支持和更多精彩内容，就在简书APP */\r
div[role="main"] > div > section:first-child > div:nth-last-child(2),\r
/* 它的内部是script标签，可能影响部分评论之间的高度问题 */\r
div.adad_container ,\r
/* 顶部导航栏的【下载App】 */\r
#__next nav a[href*="navbar-app"] {\r
	display: none !important;\r
}\r
body.reader-day-mode.normal-size {\r
	overflow: auto !important;\r
}\r
.collapse-free-content {\r
	height: auto !important;\r
}\r
.copyright {\r
	color: #000 !important;\r
}\r
#note-show .content .show-content-free .collapse-free-content:after {\r
	background-image: none !important;\r
}\r
footer > div > div {\r
	justify-content: center;\r
}\r
/* 修复底部最后编辑于：。。。在某些套壳浏览器上的错位问题 */\r
#note-show .content .show-content-free .note-meta-time {\r
	margin-top: 0px !important;\r
}\r
`;var j=typeof GM_deleteValue<"u"?GM_deleteValue:void 0,q=typeof GM_getResourceText<"u"?GM_getResourceText:void 0,O=typeof GM_getValue<"u"?GM_getValue:void 0,R=typeof GM_info<"u"?GM_info:void 0,se=typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0,B=typeof GM_setValue<"u"?GM_setValue:void 0,ue=typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0,ce=typeof GM_xmlhttpRequest<"u"?GM_xmlhttpRequest:void 0,x=typeof unsafeWindow<"u"?unsafeWindow:void 0,de=window;const Q="GM_Panel",pe="data-init",T="data-key",P="data-default-value",fe="data-init-more-value",L="data-storage-api",H={setting:{get width(){return window.innerWidth<550?"88vw":window.innerWidth<700?"550px":"700px"},get height(){return window.innerHeight<450?"70vh":window.innerHeight<550?"450px":"550px"}}};class he{storageKey;listenerData;constructor(t){if(typeof t=="string"){let n=t.trim();if(n=="")throw new Error("key参数不能为空字符串");this.storageKey=n;}else throw new Error("key参数类型错误，必须是字符串");this.listenerData=new M.Dictionary;}getLocalValue(){let t=O(this.storageKey);return t==null&&(t={},this.setLocalValue(t)),t}setLocalValue(t){B(this.storageKey,t);}set(t,n){let a=this.get(t),o=this.getLocalValue();Reflect.set(o,t,n),this.setLocalValue(o),this.triggerValueChangeListener(t,a,n);}get(t,n){let a=this.getLocalValue();return Reflect.get(a,t)??n}getAll(){return this.getLocalValue()}delete(t){let n=this.get(t),a=this.getLocalValue();Reflect.deleteProperty(a,t),this.setLocalValue(a),this.triggerValueChangeListener(t,n,void 0);}has(t){let n=this.getLocalValue();return Reflect.has(n,t)}keys(){let t=this.getLocalValue();return Reflect.ownKeys(t)}values(){let t=this.getLocalValue();return Reflect.ownKeys(t).map(n=>Reflect.get(t,n))}clear(){j(this.storageKey);}addValueChangeListener(t,n){let a=Math.random(),o=this.listenerData.get(t)||[];return o.push({id:a,key:t,callback:n}),this.listenerData.set(t,o),a}removeValueChangeListener(t){let n=false;for(const[a,o]of this.listenerData.entries()){for(let i=0;i<o.length;i++){const r=o[i];(typeof t=="string"&&r.key===t||typeof t=="number"&&r.id===t)&&(o.splice(i,1),i--,n=true);}this.listenerData.set(a,o);}return n}triggerValueChangeListener(t,n,a){if(!this.listenerData.has(t))return;let o=this.listenerData.get(t);for(let i=0;i<o.length;i++){const r=o[i];if(typeof r.callback=="function"){let c=this.get(t),s,d;typeof n<"u"&&arguments.length>=2?d=n:d=c,typeof a<"u"&&arguments.length>2?s=a:s=c,r.callback(t,d,s);}}}}const v=new he(Q),$={$data:{__contentConfig:null,get contentConfig(){return this.__contentConfig==null&&(this.__contentConfig=new p.Dictionary),this.__contentConfig}},addContentConfig(e){Array.isArray(e)||(e=[e]);let t=this.$data.contentConfig.keys().length;this.$data.contentConfig.set(t,e);},getAllContentConfig(){return this.$data.contentConfig.values().flat()},getConfig(e=0){return this.$data.contentConfig.get(e)??[]},getDefaultBottomContentConfig(){return [{id:"script-version",title:`版本：${R?.script?.version||"未知"}`,isBottom:true,forms:[],clickFirstCallback(e,t,n){let a=R?.script?.supportURL||R?.script?.namespace;return typeof a=="string"&&p.isNotNull(a)&&window.open(a,"_blank"),false}}]}},ge={$data:{__menuOption:[{key:"show_pops_panel_setting",text:"⚙ 设置",autoReload:false,isStoreValue:false,showText(e){return e},callback:()=>{u.showPanel($.getConfig(0));}}],get menuOption(){return this.__menuOption}},init(){this.initExtensionsMenu();},initExtensionsMenu(){u.isTopWindow()&&te.add(this.$data.menuOption);},addMenuOption(e){Array.isArray(e)||(e=[e]),this.$data.menuOption.push(...e);},updateMenuOption(e){Array.isArray(e)||(e=[e]),e.forEach(t=>{let n=this.$data.menuOption.findIndex(a=>a.key===t.key);n!==-1&&(this.$data.menuOption[n]=t);});},getMenuOption(e=0){return this.$data.menuOption[e]},deleteMenuOption(e=0){this.$data.menuOption.splice(e,1);}},u={$data:{__configDefaultValueData:null,__onceExecMenuData:null,__onceExecData:null,__panelConfig:{},$panel:null,get configDefaultValueData(){return this.__configDefaultValueData==null&&(this.__configDefaultValueData=new p.Dictionary),this.__configDefaultValueData},get onceExecMenuData(){return this.__onceExecMenuData==null&&(this.__onceExecMenuData=new p.Dictionary),this.__onceExecMenuData},get onceExecData(){return this.__onceExecData==null&&(this.__onceExecData=new p.Dictionary),this.__onceExecData},get scriptName(){return K},get panelConfig(){return this.__panelConfig},set panelConfig(e){this.__panelConfig=e;},key:Q,attributeKeyName:T,attributeDefaultValueName:P},init(){this.initContentDefaultValue(),ge.init();},isTopWindow(){return x.top===x.self},initContentDefaultValue(){const e=a=>{if(!a.attributes||a.type==="button"||a.type==="forms"||a.type==="deepMenu")return;let o={},i=a.attributes[T];i!=null&&(o[i]=a.attributes[P]);let r=a.attributes[pe];if(typeof r=="function"){let d=r();if(typeof d=="boolean"&&!d)return}let c=a.attributes[fe];c&&typeof c=="object"&&Object.assign(o,c);let s=Object.keys(o);if(!s.length){l.warn(["请先配置键",a]);return}s.forEach(d=>{let _=o[d];this.setDefaultValue(d,_);});},t=a=>{for(let o=0;o<a.length;o++){let i=a[o];e(i);let r=i.forms;r&&Array.isArray(r)&&t(r);}},n=[...$.getAllContentConfig()];for(let a=0;a<n.length;a++){let o=n[a];if(!o.forms)continue;const i=o.forms;i&&Array.isArray(i)&&t(i);}},setDefaultValue(e,t){this.$data.configDefaultValueData.has(e)&&l.warn("请检查该key(已存在): "+e),this.$data.configDefaultValueData.set(e,t);},setValue(e,t){v.set(e,t);},getValue(e,t){let n=v.get(e);return n??(this.$data.configDefaultValueData.has(e)?this.$data.configDefaultValueData.get(e):t)},deleteValue(e){v.delete(e);},hasKey(e){return v.has(e)},addValueChangeListener(e,t){return v.addValueChangeListener(e,(a,o,i)=>{t(e,i,o);})},removeValueChangeListener(e){v.removeValueChangeListener(e);},triggerMenuValueChange(e,t,n){v.triggerValueChangeListener(e,n,t);},deleteExecMenuOnce(e){return this.$data.onceExecMenuData.delete(e),v.removeValueChangeListener(e)},deleteOnceExec(e){this.$data.onceExecData.delete(e);},exec(e,t,n,a=true){const o=this;let i;typeof e=="string"||Array.isArray(e)?i=()=>e:i=e;let r=false,c=i(),s=[];Array.isArray(c)?(r=true,s=c):s.push(c);let d=s.find(f=>!this.$data.configDefaultValueData.has(f));if(d){l.warn(`${d} 键不存在`);return}let _=JSON.stringify(s);if(a){if(this.$data.onceExecMenuData.has(_))return;this.$data.onceExecMenuData.set(_,1);}let C=[],U=[],J=(f,g)=>{let V=[];Array.isArray(g)||(g=[g]),g.forEach(b=>{if(b!=null&&b instanceof HTMLStyleElement){V.push(b);return}}),C=C.concat(V);},ie=f=>this.getValue(f),N=()=>{for(let f=0;f<C.length;f++)C[f].remove(),C.splice(f,1),f--;},re=()=>{let f=false;return typeof n=="function"?f=n(s):f=s.every(g=>ie(g)),f},F=f=>{let g=re(),V=[];if(g){let b=s.map(S=>this.getValue(S)),k=t({value:r?b:b[0],addStyleElement:(...S)=>J(true,...S)});Array.isArray(k)||(k=[k]),k.forEach(S=>{if(S!=null&&S instanceof HTMLStyleElement){V.push(S);return}});}N(),C=[...V];};return a&&s.forEach(f=>{let g=this.addValueChangeListener(f,(V,b,k)=>{F();});U.push(g);}),F(),{clear(){this.clearStoreStyleElements(),this.removeValueChangeListener(),a&&o.$data.onceExecMenuData.delete(_);},clearStoreStyleElements:()=>N(),removeValueChangeListener:()=>{U.forEach(f=>{this.removeValueChangeListener(f);});}}},execMenu(e,t,n=false){return this.exec(e,a=>t(a),a=>a.every(i=>{let r=!!this.getValue(i);return n&&(r=!r),r}),false)},execMenuOnce(e,t){return this.exec(e,t,n=>n.every(o=>!!this.getValue(o)),true)},onceExec(e,t){if(typeof e!="string")throw new TypeError("key 必须是字符串");this.$data.onceExecData.has(e)||(t(),this.$data.onceExecData.set(e,1));},showPanel(e,t=`${K}-设置`,n=false){let a=e.some(i=>!(typeof i.isBottom=="function"?i.isBottom():!!i.isBottom)&&i.id!=="script-version");!n&&a&&e.push(...$.getDefaultBottomContentConfig());let o=X.panel({title:{text:t,position:"center",html:false,style:""},content:e,btn:{close:{enable:true,callback:(i,r)=>{i.close(),this.$data.$panel=null;}}},mask:{enable:true,clickEvent:{toClose:true,toHide:false},clickCallBack:(i,r)=>{i(),this.$data.$panel=null;}},width:H.setting.width,height:H.setting.height,drag:true,only:true,...this.$data.panelConfig});this.$data.$panel=o;}},m={waitRemove(...e){e.forEach(t=>{typeof t=="string"&&p.waitNodeList(t).then(n=>{n.forEach(a=>a.remove());});});},addBlockCSS(...e){let t=[];if(e.length!==0&&!(e.length===1&&typeof e[0]=="string"&&e[0].trim()===""))return e.forEach(n=>{Array.isArray(n)?t=t.concat(n):t.push(n);}),I(`${t.join(`,
`)}{display: none !important;}`)},setGMResourceCSS(e){let t=typeof q=="function"?q(e.keyName):null;typeof t=="string"&&t?I(t):m.loadStyleLink(e.url);},async loadStyleLink(e){let t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,Y.ready(()=>{document.head.appendChild(t);});},async loadScript(e){let t=document.createElement("script");return t.src=e,new Promise(n=>{t.onload=()=>{n(null);},(document.head||document.documentElement).appendChild(t);})},fixUrl(e){return e=e.trim(),e.match(/^http(s|):\/\//i)||(e.startsWith("/")||(e+="/"),e=window.location.origin+e),e},fixHttps(e){if(e.startsWith("https://")||!e.startsWith("http://"))return e;let t=new URL(e);return t.protocol="https:",t.toString()},lockScroll(...e){let t=document.createElement("style");t.innerHTML=`
			.pops-overflow-hidden-important {
				overflow: hidden !important;
			}
		`;let n=[document.documentElement,document.body].concat(...e||[]);return n.forEach(a=>{a.classList.add("pops-overflow-hidden-important");}),(document.head||document.documentElement).appendChild(t),{recovery(){n.forEach(a=>{a.classList.remove("pops-overflow-hidden-important");}),t.remove();}}},async getClipboardText(){function e(a){navigator.clipboard.readText().then(o=>{a(o);}).catch(o=>{l.error("读取剪贴板内容失败👉",o),a("");});}function t(a){navigator.permissions.query({name:"clipboard-read"}).then(o=>{e(a);}).catch(o=>{l.error("申请剪贴板权限失败，尝试直接读取👉",o.message??o.name??o.stack),e(a);});}function n(){return !(typeof navigator?.clipboard?.readText!="function"||typeof navigator?.permissions?.query!="function")}return new Promise(a=>{if(!n()){a("");return}document.hasFocus()?t(a):window.addEventListener("focus",()=>{t(a);},{once:true});})},escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/©/g,"&copy;").replace(/®/g,"&reg;").replace(/™/g,"&trade;").replace(/→/g,"&rarr;").replace(/←/g,"&larr;").replace(/↑/g,"&uarr;").replace(/↓/g,"&darr;").replace(/—/g,"&mdash;").replace(/–/g,"&ndash;").replace(/…/g,"&hellip;").replace(/ /g,"&nbsp;").replace(/\r\n/g,"<br>").replace(/\r/g,"<br>").replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")}},A={qmsg_config_position:{key:"qmsg-config-position",defaultValue:"bottom"},qmsg_config_maxnums:{key:"qmsg-config-maxnums",defaultValue:3},qmsg_config_showreverse:{key:"qmsg-config-showreverse",defaultValue:false}},p=M.noConflict();Y.noConflict();const X=G,l=new p.Log(R,x.console||de.console);let K=R?.script?.name||void 0;G.config.Utils.AnyTouch();const ee=false;l.config({debug:ee,logMaxCount:1e3,autoClearConsole:true,tag:true});y.config(Object.defineProperties({html:true,autoClose:true,showClose:false},{position:{get(){return u.getValue(A.qmsg_config_position.key,A.qmsg_config_position.defaultValue)}},maxNums:{get(){return u.getValue(A.qmsg_config_maxnums.key,A.qmsg_config_maxnums.defaultValue)}},showReverse:{get(){return u.getValue(A.qmsg_config_showreverse.key,A.qmsg_config_showreverse.defaultValue)}},zIndex:{get(){let e=M.getMaxZIndex(),t=G.config.InstanceUtils.getPopsMaxZIndex().zIndex;return M.getMaxValue(e,t)+100}}}));X.GlobalConfig.setGlobalConfig({zIndex:()=>{let e=M.getMaxZIndex(void 0,void 0,n=>{if(n?.classList?.contains("qmsg-shadow-container")||n?.closest("qmsg")&&n.getRootNode()instanceof ShadowRoot)return  false}),t=G.config.InstanceUtils.getPopsMaxZIndex().zIndex;return M.getMaxValue(e,t)+100},mask:{enable:true,clickEvent:{toClose:false,toHide:false}}});const te=new p.GM_Menu({GM_getValue:O,GM_setValue:B,GM_registerMenuCommand:se,GM_unregisterMenuCommand:ue}),ne=new p.Httpx({xmlHttpRequest:ce,logDetails:ee});ne.interceptors.request.use(e=>e);ne.interceptors.response.use(void 0,e=>(l.error("拦截器-请求错误",e),e.type==="onabort"?y.warning("请求取消",{consoleLogContent:true}):e.type==="onerror"?y.error("请求异常",{consoleLogContent:true}):e.type==="ontimeout"?y.error("请求超时",{consoleLogContent:true}):y.error("其它错误",{consoleLogContent:true}),e));x.Object.defineProperty,x.Function.prototype.apply,x.Function.prototype.call,x.Element.prototype.appendChild,x.setTimeout;const I=p.addStyle.bind(p);document.querySelector.bind(document);document.querySelectorAll.bind(document);new p.GM_Cookie;const me={isGoWild(){return window.location.pathname==="/go-wild"}},W=function(e=""){p.waitNodeList(e).then(t=>{t.forEach(n=>n.remove());});},E={init(){this.addCSS(),u.execMenu("JianShuAutoJumpRedirect_PC",()=>{this.jumpRedirect();}),u.execMenu("JianShuRemoveClipboardHijacking",()=>{this.removeClipboardHijacking();}),u.execMenu("JianShuAutoExpandFullText",()=>{this.autoExpandFullText();}),u.execMenu("JianShuArticleCenter",()=>this.articleCenter()),u.execMenu("JianShuShieldRelatedArticles",()=>this.blockRelatedArticles()),u.execMenu("jianshu-shieldClientDialog",()=>{this.blockClientDialog();}),u.execMenuOnce("JianShuShieldUserComments",()=>this.blockUserComments()),u.execMenuOnce("JianShuShieldRecommendedReading",()=>this.blockRecommendedReading()),u.execMenuOnce("jianshu-shieldTopNav",()=>this.blockTopNav()),u.execMenuOnce("jianshu-shieldBottomToolbar",()=>this.blockBottomToolbar());},addCSS(){return l.info("添加屏蔽CSS"),I(le)},articleCenter(){l.info("全文居中");let e=[];return e.push(m.addBlockCSS("div[role=main] aside","div._3Pnjry"),I(`
			div[role=main] aside,
			div._3Pnjry{
				display: none !important;
			}
			div._gp-ck{
				width: 100% !important;
			}`)),W("div[role=main] aside"),W("div._3Pnjry"),p.waitNodeList("div._gp-ck").then(t=>{t.forEach(n=>{n.style.width="100%";});}),e},removeClipboardHijacking(){l.info("去除剪贴板劫持");const e=t=>{t.stopPropagation();};window.addEventListener("copy",e,true),document.addEventListener("copy",e,true);},autoExpandFullText(){p.waitNode('div#homepage div[class*="dialog-"]').then(e=>{e.style.visibility="hidden",l.info("自动展开全文"),p.mutationObserver(e,{callback:t=>{t.length!=0&&t.forEach(n=>{n.target.style.display!="none"&&(l.success("自动展开全文-自动点击"),document.querySelector('div#homepage div[class*="dialog-"] .cancel')?.click());});},config:{childList:false,attributes:true,characterData:true,subtree:true}});});},jumpRedirect(){if(me.isGoWild()){l.success("去除简书拦截其它网址的url并自动跳转"),window.stop();let e=window.location.href.replace(window.location.origin+"/","");e=decodeURIComponent(e);let t=e.replace(/^go-wild\?ac=2&url=/gi,"").replace(/^https:\/\/link.zhihu.com\/\?target\=/gi,"");window.location.href=t;}},blockRelatedArticles(){return l.info("屏蔽相关文章"),m.addBlockCSS('div[role="main"] > div > section:nth-child(2)')},blockClientDialog(){l.info("【屏蔽】客户端弹窗"),m.addBlockCSS('div:has(>div[class*="-mask"]:not([class*="-mask-hidden"]) + div[tabindex="-1"][role="dialog"])'),p.waitNode('div[class*="-mask"]:not([class*="-mask-hidden"]) + div[tabindex="-1"][role="dialog"]').then(e=>{l.success("弹窗出现"),p.waitPropertyByInterval(e,()=>p.getReactObj(e)?.reactInternalInstance?.return?.return?.memoizedProps?.onClose,250,1e4).then(()=>{p.getReactObj(e).reactInternalInstance.return.return.memoizedProps.onClose(new Event("click")),l.success("调用函数关闭弹窗");});});},blockUserComments(){return l.info("屏蔽评论区"),m.addBlockCSS("div#note-page-comment")},blockRecommendedReading(){return l.info("屏蔽底部推荐阅读"),m.addBlockCSS('div[role="main"] > div > section:last-child')},blockTopNav(){return l.info("【屏蔽】顶部导航栏"),m.addBlockCSS("header")},blockBottomToolbar(){return l.info("【屏蔽】底部工具栏"),m.addBlockCSS("footer")}},z={init(){this.addCSS(),u.execMenu("JianShuAutoJumpRedirect_Mobile",()=>{E.jumpRedirect();}),u.execMenu("JianShuHijackSchemeScriptLabel_Mobile",()=>{this.handlePrototype();}),u.execMenu("JianShuRemoveClipboardHijacking_Mobile",()=>{E.removeClipboardHijacking();}),u.execMenu("JianShuAutoExpandFullText_Mobile",()=>{E.autoExpandFullText();}),u.execMenuOnce("JianShuremoveFooterRecommendRead",()=>this.blockeFooterRecommendRead()),u.execMenu("JianShuShieldUserCommentsMobile",()=>this.blockUserComments());},addCSS(){E.addCSS();},blockeFooterRecommendRead(){return l.info("屏蔽底部推荐阅读"),m.addBlockCSS("#recommended-notes")},handlePrototype(){l.info("处理原型添加script标签");let e=Node.prototype.appendChild;x.Node.prototype.appendChild=function(t){let n=["img"];return t.src&&!t.src.includes("jianshu.io")&&!n.includes(t.localName)?(l.success(["禁止添加的元素",t]),null):e.call(this,t)};},blockUserComments(){return l.info("屏蔽评论区"),m.addBlockCSS("#comment-main")}},ae={$data:{__storeApiFn:null,get storeApiValue(){return this.__storeApiFn||(this.__storeApiFn=new M.Dictionary),this.__storeApiFn}},getStorageApi(e){if(this.hasStorageApi(e))return this.$data.storeApiValue.get(e)},hasStorageApi(e){return this.$data.storeApiValue.has(e)},setStorageApi(e,t){this.$data.storeApiValue.set(e,t);},initComponentsStorageApi(e,t,n){let a;this.hasStorageApi(e)?a=this.getStorageApi(e):a=n,this.setComponentsStorageApiProperty(t,a);},setComponentsStorageApiProperty(e,t){Reflect.set(e.props,L,t);}},h=function(e,t,n,a,o,i){let r={text:e,type:"switch",description:o,attributes:{},props:{},getValue(){return !!this.props[L].get(t,n)},callback(c,s){let d=!!s;l.success(`${d?"开启":"关闭"} ${e}`),this.props[L].set(t,d);},afterAddToUListCallBack:i};return Reflect.set(r.attributes,T,t),Reflect.set(r.attributes,P,n),ae.initComponentsStorageApi("switch",r,{get(c,s){return u.getValue(c,s)},set(c,s){u.setValue(c,s);}}),r},_e={id:"jianshu-panel-config-mobile",title:"移动端",forms:[{text:"",type:"forms",forms:[{text:"功能",type:"deepMenu",forms:[{text:"",type:"forms",forms:[h("自动展开全文","JianShuAutoExpandFullText_Mobile",true),h("重定向链接","JianShuAutoJumpRedirect_Mobile",true,void 0,"自动跳转简书拦截的Url链接")]}]},{text:"屏蔽",type:"deepMenu",forms:[{text:"",type:"forms",forms:[h("【屏蔽】底部推荐阅读","JianShuremoveFooterRecommendRead",false),h("【屏蔽】评论区","JianShuShieldUserCommentsMobile",false)]}]},{text:"劫持/拦截",type:"deepMenu",forms:[{text:"",type:"forms",forms:[h("拦截-剪贴板","JianShuRemoveClipboardHijacking_Mobile",true,void 0,"去除禁止复制"),h("劫持-唤醒/跳转App","JianShuHijackSchemeScriptLabel_Mobile",true,void 0,"去除简书唤醒调用App")]}]}]}]},Z=function(e,t,n,a,o,i){let r=[];typeof a=="function"?r=a():r=a;let c={text:e,type:"select",description:i,attributes:{},props:{},getValue(){return this.props[L].get(t,n)},callback(s,d,_){let C=d;if(l.info(`选择：${_}`),typeof o=="function"&&o(s,C,_))return;this.props[L].set(t,C);},data:r};return Reflect.set(c.attributes,T,t),Reflect.set(c.attributes,P,n),ae.initComponentsStorageApi("select",c,{get(s,d){return u.getValue(s,d)},set(s,d){u.setValue(s,d);}}),c},Ce={id:"jianshu-panel-common",title:"通用",forms:[{text:"Toast配置",type:"forms",forms:[Z("Toast位置","qmsg-config-position","bottom",[{value:"topleft",text:"左上角"},{value:"top",text:"顶部"},{value:"topright",text:"右上角"},{value:"left",text:"左边"},{value:"center",text:"中间"},{value:"right",text:"右边"},{value:"bottomleft",text:"左下角"},{value:"bottom",text:"底部"},{value:"bottomright",text:"右下角"}],(e,t,n)=>{l.info("设置当前Qmsg弹出位置"+n);},"Toast显示在页面九宫格的位置"),Z("最多显示的数量","qmsg-config-maxnums",3,[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"},{value:5,text:"5"}],void 0,"限制Toast显示的数量"),h("逆序弹出","qmsg-config-showreverse",false,void 0,"修改Toast弹出的顺序")]}]},xe={id:"jianshu-panel-config-pc",title:"桌面端",forms:[{text:"",type:"forms",forms:[{text:"功能",type:"deepMenu",forms:[{text:"",type:"forms",forms:[h("全文居中","JianShuArticleCenter",true),h("自动展开全文","JianShuAutoExpandFullText",true),h("重定向链接","JianShuAutoJumpRedirect_PC",true,void 0,"自动跳转简书拦截的Url链接")]}]},{text:"屏蔽",type:"deepMenu",forms:[{text:"",type:"forms",forms:[h("【屏蔽】底部推荐阅读","JianShuShieldRecommendedReading",false),h("【屏蔽】评论区","JianShuShieldUserComments",false),h("【屏蔽】相关文章","JianShuShieldRelatedArticles",false),h("【屏蔽】客户端弹窗","jianshu-shieldClientDialog",true,void 0,"弹出的【扫码安装简书客户端 畅享全文阅读体验】"),h("【屏蔽】顶部导航栏","jianshu-shieldTopNav",false),h("【屏蔽】底部工具栏","jianshu-shieldBottomToolbar",false,void 0,"屏蔽掉底部悬浮的评论输入框、评论、点赞...")]}]},{text:"劫持/拦截",type:"deepMenu",forms:[{text:"",type:"forms",forms:[h("拦截-剪贴板","JianShuRemoveClipboardHijacking",true,void 0,"去除禁止复制")]}]}]}]};$.addContentConfig([Ce,xe,_e]);u.init();let oe=p.isPhone(),D="change_env_set",w=O(D);te.add({key:D,text:`⚙ 自动: ${oe?"移动端":"PC端"}`,autoReload:false,isStoreValue:false,showText(e){return w==null?e:e+` 手动: ${w==1?"移动端":w==2?"PC端":"未知"}`},callback:()=>{let e=[0,1,2],t=window.prompt(`请输入当前脚本环境判定

自动判断: 0
移动端: 1
PC端: 2`,"0");if(!t)return;let n=parseInt(t);if(isNaN(n)){y.error("输入的不是规范的数字");return}if(!e.includes(n)){y.error("输入的值必须是0或1或2");return}n==0?j(D):B(D,n);}});w!=null?(l.info(`手动判定为${w===1?"移动端":"PC端"}`),w==1?z.init():w==2?E.init():(y.error("意外，手动判定的值不在范围内"),j(D))):oe?(l.info("自动判定为移动端"),z.init()):(l.info("自动判定为PC端"),E.init());

})(Qmsg, DOMUtils, Utils, pops);