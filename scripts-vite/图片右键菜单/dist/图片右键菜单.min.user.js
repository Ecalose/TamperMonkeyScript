// ==UserScript==
// @name         图片右键菜单
// @namespace    https://github.com/WhiteSevs/TamperMonkeyScript
// @version      2025.9.11
// @author       WhiteSevs
// @description  在浏览器预览图片页面添加全局右键菜单，右键直接复制该图片的Uri编码，支持自动判断图片类型，包括：jpg、jpeg、png、gif、webp、ico，支持手动判断图片类型，包括：jpg、jpeg、png、gif。
// @license      GPL-3.0-only
// @icon         data:image/png;base64,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
// @supportURL   https://github.com/WhiteSevs/TamperMonkeyScript/issues
// @match        *://*/*
// @require      https://fastly.jsdelivr.net/gh/WhiteSevs/TamperMonkeyScript@86be74b83fca4fa47521cded28377b35e1d7d2ac/lib/CoverUMD/index.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/utils@2.7.8/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/domutils@1.6.6/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/pops@2.4.5/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/qmsg@1.4.0/dist/index.umd.js
// @grant        GM_deleteValue
// @grant        GM_getResourceText
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-start
// ==/UserScript==

(function (x, A, G, Q) {
	'use strict';

	var me=typeof GM_deleteValue<"u"?GM_deleteValue:void 0,ie=typeof GM_getResourceText<"u"?GM_getResourceText:void 0,ue=typeof GM_getValue<"u"?GM_getValue:void 0,K=typeof GM_info<"u"?GM_info:void 0,ye=typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0,ce=typeof GM_setValue<"u"?GM_setValue:void 0,Ce=typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0,xe=typeof GM_xmlhttpRequest<"u"?GM_xmlhttpRequest:void 0,S=typeof unsafeWindow<"u"?unsafeWindow:void 0,_e=window;const de="GM_Panel",we="data-init",j="data-key",z="data-default-value",ve="data-init-more-value",N="data-storage-api",W={get width(){return globalThis.innerWidth},get height(){return globalThis.innerHeight}},X={setting:{get width(){return W.width<550?"88vw":W.width<700?"550px":"700px"},get height(){return W.height<450?"70vh":W.height<550?"450px":"550px"}},settingMiddle:{get width(){return W.width<350?"88vw":"350px"}}};class be{storageKey;listenerData;constructor(t){if(typeof t=="string"){let a=t.trim();if(a=="")throw new Error("key参数不能为空字符串");this.storageKey=a;}else throw new Error("key参数类型错误，必须是字符串");this.listenerData=new G.Dictionary;}getLocalValue(){let t=ue(this.storageKey);return t==null&&(t={},this.setLocalValue(t)),t}setLocalValue(t){ce(this.storageKey,t);}set(t,a){let n=this.get(t),i=this.getLocalValue();Reflect.set(i,t,a),this.setLocalValue(i),this.triggerValueChangeListener(t,n,a);}get(t,a){let n=this.getLocalValue();return Reflect.get(n,t)??a}getAll(){return this.getLocalValue()}delete(t){let a=this.get(t),n=this.getLocalValue();Reflect.deleteProperty(n,t),this.setLocalValue(n),this.triggerValueChangeListener(t,a,void 0);}has(t){let a=this.getLocalValue();return Reflect.has(a,t)}keys(){let t=this.getLocalValue();return Reflect.ownKeys(t)}values(){let t=this.getLocalValue();return Reflect.ownKeys(t).map(a=>Reflect.get(t,a))}clear(){me(this.storageKey);}addValueChangeListener(t,a){let n=Math.random(),i=this.listenerData.get(t)||[];return i.push({id:n,key:t,callback:a}),this.listenerData.set(t,i),n}removeValueChangeListener(t){let a=false;for(const[n,i]of this.listenerData.entries()){for(let r=0;r<i.length;r++){const l=i[r];(typeof t=="string"&&l.key===t||typeof t=="number"&&l.id===t)&&(i.splice(r,1),r--,a=true);}this.listenerData.set(n,i);}return a}triggerValueChangeListener(t,a,n){if(!this.listenerData.has(t))return;let i=this.listenerData.get(t);for(let r=0;r<i.length;r++){const l=i[r];if(typeof l.callback=="function"){let u=this.get(t),o,f;typeof a<"u"&&arguments.length>=2?f=a:f=u,typeof n<"u"&&arguments.length>2?o=n:o=u,l.callback(t,f,o);}}}}const R=new be(de),Z={$data:{__contentConfig:null,get contentConfig(){return this.__contentConfig==null&&(this.__contentConfig=new s.Dictionary),this.__contentConfig}},addContentConfig(e){Array.isArray(e)||(e=[e]);let t=this.$data.contentConfig.keys().length;this.$data.contentConfig.set(t,e);},getAllContentConfig(){return this.$data.contentConfig.values().flat()},getConfig(e=0){return this.$data.contentConfig.get(e)??[]},getDefaultBottomContentConfig(){return [{id:"script-version",title:`版本：${K?.script?.version||"未知"}`,isBottom:true,forms:[],clickFirstCallback(e,t,a){let n=K?.script?.supportURL||K?.script?.namespace;return typeof n=="string"&&s.isNotNull(n)&&window.open(n,"_blank"),false}}]}},Ve={$data:{__menuOption:[{key:"show_pops_panel_setting",text:"⚙ 设置",autoReload:false,isStoreValue:false,showText(e){return e},callback:()=>{E.showPanel(Z.getConfig(0));}}],get menuOption(){return this.__menuOption}},init(){this.initExtensionsMenu();},initExtensionsMenu(){E.isTopWindow()&&Me.add(this.$data.menuOption);},addMenuOption(e){Array.isArray(e)||(e=[e]),this.$data.menuOption.push(...e);},updateMenuOption(e){Array.isArray(e)||(e=[e]),e.forEach(t=>{let a=this.$data.menuOption.findIndex(n=>n.key===t.key);a!==-1&&(this.$data.menuOption[a]=t);});},getMenuOption(e=0){return this.$data.menuOption[e]},deleteMenuOption(e=0){this.$data.menuOption.splice(e,1);}},fe={waitRemove(...e){e.forEach(t=>{typeof t=="string"&&s.waitNodeList(t).then(a=>{a.forEach(n=>n.remove());});});},createBlockCSSNode(...e){let t=[];if(e.length!==0&&!(e.length===1&&typeof e[0]=="string"&&e[0].trim()===""))return e.forEach(a=>{Array.isArray(a)?t=t.concat(a):t.push(a);}),A.createElement("style",{type:"text/css",innerHTML:`${t.join(`,
`)}{display: none !important;}`})},addBlockCSS(...e){let t=[];if(e.length!==0&&!(e.length===1&&typeof e[0]=="string"&&e[0].trim()===""))return e.forEach(a=>{Array.isArray(a)?t=t.concat(a):t.push(a);}),oe(`${t.join(`,
`)}{display: none !important;}`)},setGMResourceCSS(e){let t=typeof ie=="function"?ie(e.keyName):null;typeof t=="string"&&t?oe(t):fe.loadStyleLink(e.url);},async loadStyleLink(e){let t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,A.ready(()=>{document.head.appendChild(t);});},async loadScript(e){let t=document.createElement("script");return t.src=e,new Promise(a=>{t.onload=()=>{a(null);},(document.head||document.documentElement).appendChild(t);})},fixUrl(e){return e=e.trim(),e.match(/^http(s|):\/\//i)?e:e.startsWith("//")?(e.startsWith("///")||(e=window.location.protocol+e),e):(e.startsWith("/")||(e+="/"),e=window.location.origin+e,e)},fixHttps(e){if(e.startsWith("https://")||!e.startsWith("http://"))return e;let t=new URL(e);return t.protocol="https:",t.toString()},lockScroll(...e){let t=document.createElement("style");t.innerHTML=`
			.pops-overflow-hidden-important {
				overflow: hidden !important;
			}
		`;let a=[document.documentElement,document.body].concat(...e||[]);return a.forEach(n=>{n.classList.add("pops-overflow-hidden-important");}),(document.head||document.documentElement).appendChild(t),{recovery(){a.forEach(n=>{n.classList.remove("pops-overflow-hidden-important");}),t.remove();}}},async getClipboardText(){function e(n){navigator.clipboard.readText().then(i=>{n(i);}).catch(i=>{_.error("读取剪贴板内容失败👉",i),n("");});}function t(n){navigator.permissions.query({name:"clipboard-read"}).then(i=>{e(n);}).catch(i=>{_.error("申请剪贴板权限失败，尝试直接读取👉",i.message??i.name??i.stack),e(n);});}function a(){return !(typeof navigator?.clipboard?.readText!="function"||typeof navigator?.permissions?.query!="function")}return new Promise(n=>{if(!a()){n("");return}document.hasFocus()?t(n):window.addEventListener("focus",()=>{t(n);},{once:true});})},escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/©/g,"&copy;").replace(/®/g,"&reg;").replace(/™/g,"&trade;").replace(/→/g,"&rarr;").replace(/←/g,"&larr;").replace(/↑/g,"&uarr;").replace(/↓/g,"&darr;").replace(/—/g,"&mdash;").replace(/–/g,"&ndash;").replace(/…/g,"&hellip;").replace(/ /g,"&nbsp;").replace(/\r\n/g,"<br>").replace(/\r/g,"<br>").replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")},interval(e,t,a=5e3){let n,i=a-t,r=t,l=async u=>{let o=await e(u);if(typeof o=="boolean"&&!o||u){s.workerClearTimeout(n);return}if(r+=t,r>i){l(true);return}n=s.workerSetTimeout(()=>{l(false);},t);};l(false);},findParentNode(e,t,a){if(a){let n=A.closest(e,a);if(n)return n.querySelector(t)}else return A.matches(e,t)?e:A.closest(e,t)}},E={$data:{__contentConfigInitDefaultValue:null,__onceExecMenuData:null,__urlChangeReloadMenuExecOnce:null,__onceExecData:null,__panelConfig:{},$panel:null,panelContent:[],get contentConfigInitDefaultValue(){return this.__contentConfigInitDefaultValue==null&&(this.__contentConfigInitDefaultValue=new s.Dictionary),this.__contentConfigInitDefaultValue},contentConfigInitDisabledKeys:[],get onceExecMenuData(){return this.__onceExecMenuData==null&&(this.__onceExecMenuData=new s.Dictionary),this.__onceExecMenuData},get urlChangeReloadMenuExecOnce(){return this.__urlChangeReloadMenuExecOnce==null&&(this.__urlChangeReloadMenuExecOnce=new s.Dictionary),this.__urlChangeReloadMenuExecOnce},get onceExecData(){return this.__onceExecData==null&&(this.__onceExecData=new s.Dictionary),this.__onceExecData},get scriptName(){return re},get panelConfig(){return this.__panelConfig},set panelConfig(e){this.__panelConfig=e;},key:de,attributeKeyName:j,attributeDefaultValueName:z},init(){this.initContentDefaultValue(),Ve.init();},isTopWindow(){return S.top===S.self},initContentDefaultValue(){const e=n=>{if(!n.attributes||n.type==="button"||n.type==="forms"||n.type==="deepMenu")return;let i=n.attributes[we];if(typeof i=="function"){let o=i();if(typeof o=="boolean"&&!o)return}let r=new Map,l=n.attributes[j];if(l!=null){const o=n.attributes[z];r.set(l,o);}let u=n.attributes[ve];if(typeof u=="object"&&u&&Object.keys(u).forEach(o=>{r.set(o,u[o]);}),!r.size){_.warn(["请先配置键",n]);return}if(n.type==="switch"){let o=typeof n.disabled=="function"?n.disabled():n.disabled;typeof o=="boolean"&&o&&this.$data.contentConfigInitDisabledKeys.push(...r.keys());}for(const[o,f]of r.entries())this.setDefaultValue(o,f);},t=n=>{for(let i=0;i<n.length;i++){let r=n[i];e(r);let l=r.forms;l&&Array.isArray(l)&&t(l);}},a=[...Z.getAllContentConfig()];for(let n=0;n<a.length;n++){let i=a[n];if(!i.forms)continue;const r=i.forms;r&&Array.isArray(r)&&t(r);}this.$data.contentConfigInitDisabledKeys=[...new Set(this.$data.contentConfigInitDisabledKeys)];},setDefaultValue(e,t){this.$data.contentConfigInitDefaultValue.has(e)&&_.warn("请检查该key(已存在): "+e),this.$data.contentConfigInitDefaultValue.set(e,t);},setValue(e,t){R.set(e,t);},getValue(e,t){let a=R.get(e);return a??(this.$data.contentConfigInitDefaultValue.has(e)?this.$data.contentConfigInitDefaultValue.get(e):t)},deleteValue(e){R.delete(e);},hasKey(e){return R.has(e)},addValueChangeListener(e,t){return R.addValueChangeListener(e,(n,i,r)=>{t(e,r,i);})},removeValueChangeListener(e){R.removeValueChangeListener(e);},triggerMenuValueChange(e,t,a){R.triggerValueChangeListener(e,a,t);},exec(e,t,a,n=true){const i=this;let r;typeof e=="string"||Array.isArray(e)?r=()=>e:r=e;let l=false,u=r(),o=[];Array.isArray(u)?(l=true,o=u):o.push(u);let f=o.find(d=>!this.$data.contentConfigInitDefaultValue.has(d));if(f){_.warn(`${f} 键不存在`);return}let c=JSON.stringify(o);if(n&&this.$data.onceExecMenuData.has(c))return this.$data.onceExecMenuData.get(c);let g=[],h=[],D=(d,y)=>{let v=[];Array.isArray(y)||(y=[y]),y.forEach(V=>{if(V!=null&&V instanceof HTMLStyleElement){v.push(V);return}}),g=g.concat(v);},T=d=>this.getValue(d),U=()=>{for(let d=0;d<g.length;d++)g[d].remove(),g.splice(d,1),d--;},J=()=>{let d=false;return typeof a=="function"?d=a(o):d=o.every(y=>T(y)),d},P=d=>{let y=J(),v=[];if(y){let V=o.map(p=>this.getValue(p)),m=t({value:l?V:V[0],addStyleElement:(...p)=>D(true,...p)});Array.isArray(m)||(m=[m]),m.forEach(p=>{if(p!=null&&p instanceof HTMLStyleElement){v.push(p);return}});}U(),g=[...v];};n&&o.forEach(d=>{let y=this.addValueChangeListener(d,(v,V,m)=>{P();});h.push(y);}),P();let b={reload(){P();},clear(){this.clearStoreStyleElements(),this.removeValueChangeListener(),n&&i.$data.onceExecMenuData.delete(c);},clearStoreStyleElements:()=>U(),removeValueChangeListener:()=>{h.forEach(d=>{this.removeValueChangeListener(d);});}};return this.$data.onceExecMenuData.set(c,b),b},execMenu(e,t,a=false,n=false){return this.exec(e,i=>t(i),i=>i.every(l=>{let u=!!this.getValue(l);return E.$data.contentConfigInitDisabledKeys.includes(l)&&(u=false,_.warn(`.execMenu${n?"Once":""} ${l} 被禁用`)),a&&(u=!u),u}),n)},execMenuOnce(e,t,a=false,n=false){const i=this.execMenu(e,t,a,true);if(n&&i){const r=()=>{i.reload();};this.removeUrlChangeWithExecMenuOnceListener(e),this.addUrlChangeWithExecMenuOnceListener(e,r);const l=i.clear;i.clear=()=>{l(),this.removeUrlChangeWithExecMenuOnceListener(e);};}return i},deleteExecMenuOnce(e){return e=this.transformKey(e),this.$data.onceExecMenuData.delete(e),this.$data.urlChangeReloadMenuExecOnce.delete(e),R.removeValueChangeListener(e)},onceExec(e,t){if(e=this.transformKey(e),typeof e!="string")throw new TypeError("key 必须是字符串");this.$data.onceExecData.has(e)||(t(),this.$data.onceExecData.set(e,1));},deleteOnceExec(e){e=this.transformKey(e),this.$data.onceExecData.delete(e);},addUrlChangeWithExecMenuOnceListener(e,t){e=this.transformKey(e),this.$data.urlChangeReloadMenuExecOnce.set(e,t);},removeUrlChangeWithExecMenuOnceListener(e){e=this.transformKey(e),this.$data.urlChangeReloadMenuExecOnce.delete(e);},triggerUrlChangeWithExecMenuOnceEvent(e){this.$data.urlChangeReloadMenuExecOnce.forEach((t,a)=>{t(e);});},showPanel(e,t=`${re}-设置`,a=false,n=false){this.$data.$panel=null,this.$data.panelContent=[];let i=e.findIndex(l=>(typeof l.isBottom=="function"?l.isBottom():!!l.isBottom)&&l.id==="script-version")!==-1;!a&&!i&&e.push(...Z.getDefaultBottomContentConfig());let r=M.panel({title:{text:t,position:"center",html:false,style:""},content:e,btn:{close:{enable:true,callback:(l,u)=>{l.close(),this.$data.$panel=null;}}},mask:{enable:true,clickEvent:{toClose:true,toHide:false},clickCallBack:(l,u)=>{l(),this.$data.$panel=null;}},width:X.setting.width,height:X.setting.height,drag:true,only:true,...this.$data.panelConfig});this.$data.$panel=r,this.$data.panelContent=e,n||this.registerConfigSearch({$panel:r,content:e});},registerConfigSearch(e){const{$panel:t,content:a}=e;let n=async(c,g)=>{if(c==null)return;let h=await g(c);return h&&typeof h.isFind=="boolean"&&h.isFind?h.data:await n(h.data,g)},i=(c,g)=>{const h=new IntersectionObserver(D=>{D.forEach(T=>{T.isIntersecting&&(g?.(),h.disconnect());});},{root:null,threshold:1});h.observe(c),c.scrollIntoView({behavior:"smooth",block:"center"});},r=c=>{const g="pops-flashing";I.animationend(c,()=>{c.classList.remove(g);}),c.classList.add(g);},l=(c,g)=>{s.preventEvent(c);let h=M.alert({title:{text:"搜索配置",position:"center"},content:{text:`
						<div class="search-wrapper">
							<input class="search-config-text" name="search-config" type="text" placeholder="请输入需要搜素的配置名称">
						</div>
						<div class="search-result-wrapper"></div>
					`,html:true},btn:{ok:{enable:false}},mask:{clickEvent:{toClose:true}},width:X.settingMiddle.width,height:"auto",drag:true,style:`
					${M.config.cssText.panelCSS}

					.search-wrapper{
						border-bottom: 1px solid rgb(235, 238, 245, 1);
					}
					.pops-content:has(.search-result-wrapper:empty) .search-wrapper{
						border-bottom: 0;
					}
					.search-config-text{
						width: 100%;
						border: 0;
						height: 32px;
						padding: 0px 10px;
						outline: none;
					}
					.search-result-wrapper{
						max-height: 400px;
						overflow: auto;
					}
					.search-result-item{
						cursor: pointer;
						padding: 5px 10px;
						display: flex;
						flex-direction: column;
					}
					.search-result-item:hover{
						background-color: #D8F1FD;
					}
					.search-result-item-path{
						display: flex;
    					align-items: center;
					}
					.search-result-item-description{
						font-size: 0.8em;
						color: #6c6c6c;
					}
					${e.searchDialogStyle??""}
				`});h.$shadowRoot.querySelector(".search-wrapper");let D=h.$shadowRoot.querySelector(".search-config-text"),T=h.$shadowRoot.querySelector(".search-result-wrapper");D.focus();let U=()=>{I.empty(T);},J=b=>{const d=s.queryProperty(b,v=>v?.next?{isFind:false,data:v.next}:{isFind:true,data:v});let y=I.createElement("div",{className:"search-result-item",innerHTML:`
							<div class="search-result-item-path">${d.matchedData?.path}</div>
							<div class="search-result-item-description">${d.matchedData?.description??""}</div>
						`});return I.on(y,"click",v=>{let m=t.$shadowRoot.querySelectorAll("aside.pops-panel-aside .pops-panel-aside-top-container li")[b.index];if(!m){x.error(`左侧项下标${b.index}不存在`);return}m.scrollIntoView({behavior:"smooth",block:"center"}),m.click(),n(b.next,async p=>{if(p?.next){let w=await s.waitNode(()=>Array.from(t.$shadowRoot.querySelectorAll(".pops-panel-deepMenu-nav-item")).find(C=>{const $=Reflect.get(C,"__formConfig__");return typeof $=="object"&&$!=null&&$.text===p.name}),2500);if(w)w.click();else return x.error("未找到对应的二级菜单"),{isFind:true,data:p};return {isFind:false,data:p.next}}else {let w=await s.waitNode(()=>Array.from(t.$shadowRoot.querySelectorAll("li:not(.pops-panel-deepMenu-nav-item)")).find(C=>Reflect.get(C,"__formConfig__")===p.matchedData?.formConfig),2500);if(w){i(w);let C=w.closest(".pops-panel-forms-fold[data-fold-enable]");C&&(C.querySelector(".pops-panel-forms-fold-container").click(),await s.sleep(500)),i(w,()=>{r(w);});}else x.error("未找到对应的菜单项");return {isFind:true,data:p}}});}),y},P=b=>{const d=new RegExp(b,"i"),y=[],v=(m,p)=>{for(let w=0;w<m.length;w++){const C=m[w];let $=C.forms;if($&&Array.isArray($)){const B=s.deepClone(p);if(C.type==="deepMenu"){const H=s.queryProperty(B,O=>O?.next?{isFind:false,data:O.next}:{isFind:true,data:O});H.next={name:C.text};}v($,B);}else {let B=Reflect.get(C,"text"),H=Reflect.get(C,"description");const O=[B,H];let te=O.findIndex(F=>{if(typeof F=="string")return F.match(d)});if(te!==-1){const F=s.deepClone(p),ne=s.queryProperty(F,L=>L?.next?{isFind:false,data:L.next}:{isFind:true,data:L});ne.next={name:B,matchedData:{path:"",formConfig:C,matchedText:O[te],description:H}};const ae=[];s.queryProperty(F,L=>{const Y=L?.name;return typeof Y=="string"&&Y.trim()!==""&&ae.push(Y),L?.next?{isFind:false,data:L.next}:{isFind:true,data:L}});const he=ae.join(fe.escapeHtml(" - "));ne.next.matchedData.path=he,y.push(F);}}}};for(let m=0;m<a.length;m++){const p=a[m];if(!p.forms||p.isBottom&&p.id==="script-version")continue;const w=p.forms;if(w&&Array.isArray(w)){let C=p.title;typeof C=="function"&&(C=C()),v(w,{index:m,name:C});}}let V=document.createDocumentFragment();for(const m of y){let p=J(m);V.appendChild(p);}U(),T.append(V);};I.on(D,"input",s.debounce(b=>{s.preventEvent(b);let d=I.val(D).trim();if(d===""){U();return}P(d);},200));},u=null,o=false,f;I.on(t.$shadowRoot,"dblclick","aside.pops-panel-aside .pops-panel-aside-item:not(#script-version)",l),I.on(t.$shadowRoot,"touchend","aside.pops-panel-aside .pops-panel-aside-item:not(#script-version)",(c,g)=>{clearTimeout(f),f=void 0,o&&u===g?(o=false,u=null,l(c)):(f=setTimeout(()=>{o=false;},200),o=true,u=g);},{capture:true}),t.$shadowRoot.appendChild(I.createElement("style",{type:"text/css",textContent:`
					.pops-flashing{
						animation: double-blink 1.5s ease-in-out;
					}
					@keyframes double-blink {
						 0% {
							background-color: initial;
						}
						25% {
							background-color: yellow;
						}
						50% {
							background-color: initial;
						}
						75% {
							background-color: yellow;
						}
						100% {
							background-color: initial;
						}
					}
				`}));},transformKey(e){if(Array.isArray(e)){const t=e.sort();return JSON.stringify(t)}else return e}},q={qmsg_config_position:{key:"qmsg-config-position",defaultValue:"bottom"},qmsg_config_maxnums:{key:"qmsg-config-maxnums",defaultValue:3},qmsg_config_showreverse:{key:"qmsg-config-showreverse",defaultValue:false}},s=G.noConflict(),I=A.noConflict(),M=Q,_=new s.Log(K,S.console||_e.console);let re=K?.script?.name||void 0;Q.config.Utils.AnyTouch();const pe=false;_.config({debug:pe,logMaxCount:1e3,autoClearConsole:true,tag:true});x.config({isHTML:true,autoClose:true,showClose:false,consoleLogContent(e){const t=e.getSetting().type;if(t==="loading")return  false;const a=e.getSetting().content;return t==="warning"?_.warn(a):t==="error"?_.error(a):_.info(a),true},get position(){return E.getValue(q.qmsg_config_position.key,q.qmsg_config_position.defaultValue)},get maxNums(){return E.getValue(q.qmsg_config_maxnums.key,q.qmsg_config_maxnums.defaultValue)},get showReverse(){return E.getValue(q.qmsg_config_showreverse.key,q.qmsg_config_showreverse.defaultValue)},get zIndex(){let e=G.getMaxZIndex(),t=Q.config.InstanceUtils.getPopsMaxZIndex().zIndex;return G.getMaxValue(e,t)+100}});M.GlobalConfig.setGlobalConfig({zIndex:()=>{let e=G.getMaxZIndex(void 0,void 0,a=>{if(a?.classList?.contains("qmsg-shadow-container")||a?.closest("qmsg")&&a.getRootNode()instanceof ShadowRoot)return  false}),t=Q.config.InstanceUtils.getPopsMaxZIndex().zIndex;return G.getMaxValue(e,t)+100},mask:{enable:true,clickEvent:{toClose:false,toHide:false}},drag:true});const Me=new s.GM_Menu({GM_getValue:ue,GM_setValue:ce,GM_registerMenuCommand:ye,GM_unregisterMenuCommand:Ce}),ee=new s.Httpx({xmlHttpRequest:xe,logDetails:pe});ee.interceptors.request.use(e=>e);ee.interceptors.response.use(void 0,e=>(_.error("拦截器-请求错误",e),e.type==="onabort"?x.warning("请求取消",{consoleLogContent:true}):e.type==="onerror"?x.error("请求异常",{consoleLogContent:true}):e.type==="ontimeout"?x.error("请求超时",{consoleLogContent:true}):x.error("其它错误",{consoleLogContent:true}),e));S.Object.defineProperty,S.Function.prototype.apply,S.Function.prototype.call,S.Element.prototype.appendChild,S.setTimeout;const oe=s.addStyle.bind(s);A.selector.bind(A);A.selectorAll.bind(A);new s.GM_Cookie;const k={default:{getBase64Image(e,t="image/png"){var a=document.createElement("canvas");a.width=e.width,a.height=e.height;var n=a.getContext("2d");n.drawImage(e,0,0,e.width,e.height);var i=a.toDataURL("image/png");return i}},gif:{getImageFileFromUrl(e,t,a){fetch(e).then(n=>n.blob()).then(n=>{let i=new File([n],t,{type:"image/gif"});a(i);});},chooseStaticImg(e){let t=null;return new Promise((a,n)=>{this.getImageFileFromUrl(e,"图片.gif",i=>{let r=new FileReader;r.onloadend=()=>{t=r.result,a(t);},r.readAsDataURL(i);});})}},async networkQueryContentType(e){let t=await ee.head(e,{fetch:true});if(t.status&&t.data.responseFetchHeaders.has("Content-Type"))return t.data.responseFetchHeaders.get("Content-Type")}},le=[{rule:".png",type:"image/png"},{rule:".jpg",type:"image/jpg"},{rule:".jpeg",type:"image/jpeg"},{rule:".webp",type:"image/webp"},{rule:".ico",type:"image/ico"},{rule:".gif",type:"image/gif"}],Ee={init(){let e=document.body.querySelectorAll("img");if(e.length!==1){_.error("页面中的<img>元素数量不为1");return}_.info("注入全局右键-图片");let t=e[0],a=t.src;M.rightClickMenu({target:S,data:[{icon:M.config.iconSVG.documentCopy,iconIsLoading:false,text:"自动判断",async callback(){let n=null;if(a.startsWith("http")||a.startsWith("file:")){let i=-1;i=le.findIndex(r=>a.endsWith(r.rule)),i!==-1&&(n=le[i].type),!n&&a.startsWith("http")&&(x.info("通过网络请求判断类型"),n=await k.networkQueryContentType(a),_.info("请求获取的Content-Type："+n),n&&x.success("图片类型："+n));}n?n.endsWith("gif")?k.gif.chooseStaticImg(a).then(i=>{s.setClip(i),x.success("复制成功！");}):(s.setClip(k.default.getBase64Image(t,n)),x.success("复制成功！")):x.error("未知的图片类型");}},{icon:M.config.iconSVG.chromeFilled,iconIsLoading:false,text:"其它类型",callback(n){return  false},item:[{icon:M.config.iconSVG.documentCopy,iconIsLoading:false,text:"jpg",callback(){s.setClip(k.default.getBase64Image(t,"image/jpg")),x.success("复制成功！");}},{icon:M.config.iconSVG.documentCopy,iconIsLoading:false,text:"jpeg",callback(){s.setClip(k.default.getBase64Image(t,"image/jpeg")),x.success("复制成功！");}},{icon:M.config.iconSVG.documentCopy,iconIsLoading:false,text:"png",callback(){s.setClip(k.default.getBase64Image(t,"image/png")),x.success("复制成功！");}},{icon:M.config.iconSVG.documentCopy,iconIsLoading:false,text:"gif",callback(){k.gif.chooseStaticImg(a).then(n=>{s.setClip(n),x.success("复制成功！");});}}]}]});}},ge={$data:{__storeApiFn:null,get storeApiValue(){return this.__storeApiFn||(this.__storeApiFn=new G.Dictionary),this.__storeApiFn}},getStorageApi(e){if(this.hasStorageApi(e))return this.$data.storeApiValue.get(e)},hasStorageApi(e){return this.$data.storeApiValue.has(e)},setStorageApi(e,t){this.$data.storeApiValue.set(e,t);},initComponentsStorageApi(e,t,a){let n;this.hasStorageApi(e)?n=this.getStorageApi(e):n=a,this.setComponentsStorageApiProperty(t,n);},setComponentsStorageApiProperty(e,t){Reflect.set(e.props,N,t);}},Ae=function(e,t,a,n,i,r,l,u){let o={text:e,type:"switch",description:i,disabled:l,attributes:{},props:{},getValue(){return this.props[N].get(t,a)},callback(f,c){let g=!!c;_.success(`${g?"开启":"关闭"} ${e}`),this.props[N].set(t,g);},afterAddToUListCallBack:r};return Reflect.set(o.attributes,j,t),Reflect.set(o.attributes,z,a),ge.initComponentsStorageApi("switch",o,{get(f,c){return E.getValue(f,c)},set(f,c){E.setValue(f,c);}}),o},se=function(e,t,a,n,i,r,l){let u=[];typeof n=="function"?u=n():u=n;let o={text:e,type:"select",description:r,attributes:{},props:{},getValue(){return this.props[N].get(t,a)},callback(f,c,g){let h=c;if(_.info(`选择：${g}`),typeof i=="function"&&i(f,h,g))return;this.props[N].set(t,h);},data:u};return Reflect.set(o.attributes,j,t),Reflect.set(o.attributes,z,a),ge.initComponentsStorageApi("select",o,{get(f,c){return E.getValue(f,c)},set(f,c){E.setValue(f,c);}}),o},$e={id:"component-common",title:"通用",forms:[{text:"Toast配置",type:"forms",forms:[se("Toast位置","qmsg-config-position","bottom",[{value:"topleft",text:"左上角"},{value:"top",text:"顶部"},{value:"topright",text:"右上角"},{value:"left",text:"左边"},{value:"center",text:"中间"},{value:"right",text:"右边"},{value:"bottomleft",text:"左下角"},{value:"bottom",text:"底部"},{value:"bottomright",text:"右下角"}],(e,t,a)=>{_.info("设置当前Qmsg弹出位置"+a);},"Toast显示在页面九宫格的位置"),se("最多显示的数量","qmsg-config-maxnums",3,[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"},{value:5,text:"5"}],void 0,"限制Toast显示的数量"),Ae("逆序弹出","qmsg-config-showreverse",false,void 0,"修改Toast弹出的顺序")]}]};Z.addContentConfig([$e]),document.documentElement.hasAttribute("style")&&document.body.hasAttribute("style")&&document.body.children.length&&document.querySelector('meta[name="viewport"]')&&(E.init(),Ee.init());

})(Qmsg, DOMUtils, Utils, pops);