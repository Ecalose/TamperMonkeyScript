// ==UserScript==
// @name         图片右键菜单
// @namespace    https://github.com/WhiteSevs/TamperMonkeyScript
// @version      2025.7.10
// @author       WhiteSevs
// @description  在浏览器预览图片页面添加全局右键菜单，右键直接复制该图片的Uri编码，支持自动判断图片类型，包括：jpg、jpeg、png、gif、webp、ico，支持手动判断图片类型，包括：jpg、jpeg、png、gif。
// @license      GPL-3.0-only
// @icon         data:image/png;base64,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
// @supportURL   https://github.com/WhiteSevs/TamperMonkeyScript/issues
// @match        *://*/*
// @require      https://fastly.jsdelivr.net/gh/WhiteSevs/TamperMonkeyScript@86be74b83fca4fa47521cded28377b35e1d7d2ac/lib/CoverUMD/index.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/utils@2.7.0/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/domutils@1.5.11/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/pops@2.1.10/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/qmsg@1.3.8/dist/index.umd.js
// @grant        GM_deleteValue
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-start
// ==/UserScript==

(function (f, Q, w, S) {
	'use strict';

	var Y=typeof GM_deleteValue<"u"?GM_deleteValue:void 0,j=typeof GM_getValue<"u"?GM_getValue:void 0,B=typeof GM_info<"u"?GM_info:void 0,J=typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0,K=typeof GM_setValue<"u"?GM_setValue:void 0,X=typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0,ee=typeof GM_xmlhttpRequest<"u"?GM_xmlhttpRequest:void 0,V=typeof unsafeWindow<"u"?unsafeWindow:void 0,te=window;const W="GM_Panel",ne="data-init",I="data-key",L="data-default-value",ae="data-init-more-value",E="data-storage-api",F={setting:{get width(){return window.innerWidth<550?"88vw":window.innerWidth<700?"550px":"700px"},get height(){return window.innerHeight<450?"70vh":window.innerHeight<550?"450px":"550px"}}};class ie{storageKey;listenerData;constructor(t){if(typeof t=="string"){let a=t.trim();if(a=="")throw new Error("key参数不能为空字符串");this.storageKey=a;}else throw new Error("key参数类型错误，必须是字符串");this.listenerData=new w.Dictionary;}getLocalValue(){let t=j(this.storageKey);return t==null&&(t={},this.setLocalValue(t)),t}setLocalValue(t){K(this.storageKey,t);}set(t,a){let n=this.get(t),i=this.getLocalValue();Reflect.set(i,t,a),this.setLocalValue(i),this.triggerValueChangeListener(t,n,a);}get(t,a){let n=this.getLocalValue();return Reflect.get(n,t)??a}getAll(){return this.getLocalValue()}delete(t){let a=this.get(t),n=this.getLocalValue();Reflect.deleteProperty(n,t),this.setLocalValue(n),this.triggerValueChangeListener(t,a,void 0);}has(t){let a=this.getLocalValue();return Reflect.has(a,t)}keys(){let t=this.getLocalValue();return Reflect.ownKeys(t)}values(){let t=this.getLocalValue();return Reflect.ownKeys(t).map(a=>Reflect.get(t,a))}clear(){Y(this.storageKey);}addValueChangeListener(t,a){let n=Math.random(),i=this.listenerData.get(t)||[];return i.push({id:n,key:t,callback:a}),this.listenerData.set(t,i),n}removeValueChangeListener(t){let a=false;for(const[n,i]of this.listenerData.entries()){for(let l=0;l<i.length;l++){const o=i[l];(typeof t=="string"&&o.key===t||typeof t=="number"&&o.id===t)&&(i.splice(l,1),l--,a=true);}this.listenerData.set(n,i);}return a}triggerValueChangeListener(t,a,n){if(!this.listenerData.has(t))return;let i=this.listenerData.get(t);for(let l=0;l<i.length;l++){const o=i[l];if(typeof o.callback=="function"){let r=this.get(t),s,u;typeof a<"u"&&arguments.length>=2?u=a:u=r,typeof n<"u"&&arguments.length>2?s=n:s=r,o.callback(t,u,s);}}}}const C=new ie(W),T={$data:{__contentConfig:null,get contentConfig(){return this.__contentConfig==null&&(this.__contentConfig=new g.Dictionary),this.__contentConfig}},addContentConfig(e){Array.isArray(e)||(e=[e]);let t=this.$data.contentConfig.keys().length;this.$data.contentConfig.set(t,e);},getAllContentConfig(){return this.$data.contentConfig.values().flat()},getConfig(e=0){return this.$data.contentConfig.get(e)??[]}},le={$data:{__menuOption:[{key:"show_pops_panel_setting",text:"⚙ 设置",autoReload:false,isStoreValue:false,showText(e){return e},callback:()=>{h.showPanel(T.getConfig(0));}}],get menuOption(){return this.__menuOption}},init(){this.initExtensionsMenu();},initExtensionsMenu(){h.isTopWindow()&&oe.add(this.$data.menuOption);},addMenuOption(e){Array.isArray(e)||(e=[e]),this.$data.menuOption.push(...e);},updateMenuOption(e){Array.isArray(e)||(e=[e]),e.forEach(t=>{let a=this.$data.menuOption.findIndex(n=>n.key===t.key);a!==-1&&(this.$data.menuOption[a]=t);});},getMenuOption(e=0){return this.$data.menuOption[e]},deleteMenuOption(e=0){this.$data.menuOption.splice(e,1);}},h={$data:{__configDefaultValueData:null,__onceExecMenuData:null,__onceExecData:null,__panelConfig:{},$panel:null,get configDefaultValueData(){return this.__configDefaultValueData==null&&(this.__configDefaultValueData=new g.Dictionary),this.__configDefaultValueData},get onceExecMenuData(){return this.__onceExecMenuData==null&&(this.__onceExecMenuData=new g.Dictionary),this.__onceExecMenuData},get onceExecData(){return this.__onceExecData==null&&(this.__onceExecData=new g.Dictionary),this.__onceExecData},get scriptName(){return $},get panelConfig(){return this.__panelConfig},set panelConfig(e){this.__panelConfig=e;},key:W,attributeKeyName:I,attributeDefaultValueName:L},init(){this.initContentDefaultValue(),le.init();},isTopWindow(){return V.top===V.self},initContentDefaultValue(){const e=n=>{if(!n.attributes||n.type==="button"||n.type==="forms"||n.type==="deepMenu")return;let i={},l=n.attributes[I];l!=null&&(i[l]=n.attributes[L]);let o=n.attributes[ne];if(typeof o=="function"){let u=o();if(typeof u=="boolean"&&!u)return}let r=n.attributes[ae];r&&typeof r=="object"&&Object.assign(i,r);let s=Object.keys(i);if(!s.length){p.warn(["请先配置键",n]);return}s.forEach(u=>{let m=i[u];this.setDefaultValue(u,m);});},t=n=>{for(let i=0;i<n.length;i++){let l=n[i];e(l);let o=l.forms;o&&Array.isArray(o)&&t(o);}},a=[...T.getAllContentConfig()];for(let n=0;n<a.length;n++){let i=a[n];if(!i.forms)continue;const l=i.forms;l&&Array.isArray(l)&&t(l);}},setDefaultValue(e,t){this.$data.configDefaultValueData.has(e)&&p.warn("请检查该key(已存在): "+e),this.$data.configDefaultValueData.set(e,t);},setValue(e,t){C.set(e,t);},getValue(e,t){let a=C.get(e);return a??(this.$data.configDefaultValueData.has(e)?this.$data.configDefaultValueData.get(e):t)},deleteValue(e){C.delete(e);},hasKey(e){return C.has(e)},addValueChangeListener(e,t){return C.addValueChangeListener(e,(n,i,l)=>{t(e,l,i);})},removeValueChangeListener(e){C.removeValueChangeListener(e);},triggerMenuValueChange(e,t,a){C.triggerValueChangeListener(e,a,t);},deleteExecMenuOnce(e){return this.$data.onceExecMenuData.delete(e),C.removeValueChangeListener(e)},deleteOnceExec(e){this.$data.onceExecData.delete(e);},exec(e,t,a,n=true){const i=this;let l;typeof e=="string"||Array.isArray(e)?l=()=>e:l=e;let o=false,r=l(),s=[];Array.isArray(r)?(o=true,s=r):s.push(r);let u=s.find(c=>!this.$data.configDefaultValueData.has(c));if(u){p.warn(`${u} 键不存在`);return}let m=JSON.stringify(s);if(n){if(this.$data.onceExecMenuData.has(m))return;this.$data.onceExecMenuData.set(m,1);}let _=[],G=[],k=(c,d)=>{let D=[];Array.isArray(d)||(d=[d]),d.forEach(x=>{if(x!=null&&x instanceof HTMLStyleElement){D.push(x);return}}),_=_.concat(D);},Z=c=>this.getValue(c),O=()=>{for(let c=0;c<_.length;c++)_[c].remove(),_.splice(c,1),c--;},z=()=>{let c=false;return typeof a=="function"?c=a(s):c=s.every(d=>Z(d)),c},q=c=>{let d=z(),D=[];if(d){let x=s.map(v=>this.getValue(v)),b=t({value:o?x:x[0],addStyleElement:(...v)=>k(true,...v)});Array.isArray(b)||(b=[b]),b.forEach(v=>{if(v!=null&&v instanceof HTMLStyleElement){D.push(v);return}});}O(),_=[...D];};return n&&s.forEach(c=>{let d=this.addValueChangeListener(c,(D,x,b)=>{q();});G.push(d);}),q(),{clear(){this.clearStoreStyleElements(),this.removeValueChangeListener(),n&&i.$data.onceExecMenuData.delete(m);},clearStoreStyleElements:()=>O(),removeValueChangeListener:()=>{G.forEach(c=>{this.removeValueChangeListener(c);});}}},execMenu(e,t,a=false){return this.exec(e,n=>t(n),n=>n.every(l=>{let o=!!this.getValue(l);return a&&(o=!o),o}),false)},execMenuOnce(e,t){return this.exec(e,t,a=>a.every(i=>!!this.getValue(i)),true)},onceExec(e,t){if(typeof e!="string")throw new TypeError("key 必须是字符串");this.$data.onceExecData.has(e)||(t(),this.$data.onceExecData.set(e,1));},showPanel(e,t=`${$}-设置`){let a=y.panel({title:{text:`${$}-设置`,position:"center",html:false,style:""},content:e,btn:{close:{enable:true,callback:(n,i)=>{n.close(),this.$data.$panel=null;}}},mask:{enable:true,clickEvent:{toClose:true,toHide:false},clickCallBack:(n,i)=>{n(),this.$data.$panel=null;}},width:F.setting.width,height:F.setting.height,drag:true,only:true,...this.$data.panelConfig});this.$data.$panel=a;}},A={qmsg_config_position:{key:"qmsg-config-position",defaultValue:"bottom"},qmsg_config_maxnums:{key:"qmsg-config-maxnums",defaultValue:3},qmsg_config_showreverse:{key:"qmsg-config-showreverse",defaultValue:false}},g=w.noConflict();Q.noConflict();const y=S,p=new g.Log(B,V.console||te.console);let $=B?.script?.name||void 0;S.config.Utils.AnyTouch();const N=false;p.config({debug:N,logMaxCount:1e3,autoClearConsole:true,tag:true});f.config(Object.defineProperties({html:true,autoClose:true,showClose:false},{position:{get(){return h.getValue(A.qmsg_config_position.key,A.qmsg_config_position.defaultValue)}},maxNums:{get(){return h.getValue(A.qmsg_config_maxnums.key,A.qmsg_config_maxnums.defaultValue)}},showReverse:{get(){return h.getValue(A.qmsg_config_showreverse.key,A.qmsg_config_showreverse.defaultValue)}},zIndex:{get(){let e=w.getMaxZIndex(),t=S.config.InstanceUtils.getPopsMaxZIndex().zIndex;return w.getMaxValue(e,t)+100}}}));y.GlobalConfig.setGlobalConfig({zIndex:()=>{let e=w.getMaxZIndex(void 0,void 0,a=>{if(a?.classList?.contains("qmsg-shadow-container")||a?.closest("qmsg")&&a.getRootNode()instanceof ShadowRoot)return  false}),t=S.config.InstanceUtils.getPopsMaxZIndex().zIndex;return w.getMaxValue(e,t)+100},mask:{enable:true,clickEvent:{toClose:false,toHide:false}}});const oe=new g.GM_Menu({GM_getValue:j,GM_setValue:K,GM_registerMenuCommand:J,GM_unregisterMenuCommand:X}),R=new g.Httpx({xmlHttpRequest:ee,logDetails:N});R.interceptors.request.use(e=>e);R.interceptors.response.use(void 0,e=>(p.error("拦截器-请求错误",e),e.type==="onabort"?f.warning("请求取消",{consoleLogContent:true}):e.type==="onerror"?f.error("请求异常",{consoleLogContent:true}):e.type==="ontimeout"?f.error("请求超时",{consoleLogContent:true}):f.error("其它错误",{consoleLogContent:true}),e));V.Object.defineProperty,V.Function.prototype.apply,V.Function.prototype.call,V.Element.prototype.appendChild,V.setTimeout;g.addStyle.bind(g);document.querySelector.bind(document);document.querySelectorAll.bind(document);new g.GM_Cookie;const M={default:{getBase64Image(e,t="image/png"){var a=document.createElement("canvas");a.width=e.width,a.height=e.height;var n=a.getContext("2d");n.drawImage(e,0,0,e.width,e.height);var i=a.toDataURL("image/png");return i}},gif:{getImageFileFromUrl(e,t,a){fetch(e).then(n=>n.blob()).then(n=>{let i=new File([n],t,{type:"image/gif"});a(i);});},chooseStaticImg(e){let t=null;return new Promise((a,n)=>{this.getImageFileFromUrl(e,"图片.gif",i=>{let l=new FileReader;l.onloadend=()=>{t=l.result,a(t);},l.readAsDataURL(i);});})}},async networkQueryContentType(e){let t=await R.head(e,{fetch:true});if(t.status&&t.data.responseFetchHeaders.has("Content-Type"))return t.data.responseFetchHeaders.get("Content-Type")}},P=[{rule:".png",type:"image/png"},{rule:".jpg",type:"image/jpg"},{rule:".jpeg",type:"image/jpeg"},{rule:".webp",type:"image/webp"},{rule:".ico",type:"image/ico"},{rule:".gif",type:"image/gif"}],se={init(){let e=document.body.querySelectorAll("img");if(e.length!==1){p.error("页面中的<img>元素数量不为1");return}p.info("注入全局右键-图片");let t=e[0],a=t.src;y.rightClickMenu({target:V,data:[{icon:y.config.iconSVG.documentCopy,iconIsLoading:false,text:"自动判断",async callback(){let n=null;if(a.startsWith("http")||a.startsWith("file:")){let i=-1;i=P.findIndex(l=>a.endsWith(l.rule)),i!==-1&&(n=P[i].type),!n&&a.startsWith("http")&&(f.info("通过网络请求判断类型"),n=await M.networkQueryContentType(a),p.info("请求获取的Content-Type："+n),n&&f.success("图片类型："+n));}n?n.endsWith("gif")?M.gif.chooseStaticImg(a).then(i=>{g.setClip(i),f.success("复制成功！");}):(g.setClip(M.default.getBase64Image(t,n)),f.success("复制成功！")):f.error("未知的图片类型");}},{icon:y.config.iconSVG.chromeFilled,iconIsLoading:false,text:"其它类型",callback(n){return  false},item:[{icon:y.config.iconSVG.documentCopy,iconIsLoading:false,text:"jpg",callback(){g.setClip(M.default.getBase64Image(t,"image/jpg")),f.success("复制成功！");}},{icon:y.config.iconSVG.documentCopy,iconIsLoading:false,text:"jpeg",callback(){g.setClip(M.default.getBase64Image(t,"image/jpeg")),f.success("复制成功！");}},{icon:y.config.iconSVG.documentCopy,iconIsLoading:false,text:"png",callback(){g.setClip(M.default.getBase64Image(t,"image/png")),f.success("复制成功！");}},{icon:y.config.iconSVG.documentCopy,iconIsLoading:false,text:"gif",callback(){M.gif.chooseStaticImg(a).then(n=>{g.setClip(n),f.success("复制成功！");});}}]}]});}},H={$data:{__storeApiFn:null,get storeApiValue(){return this.__storeApiFn||(this.__storeApiFn=new w.Dictionary),this.__storeApiFn}},getStorageApi(e){if(this.hasStorageApi(e))return this.$data.storeApiValue.get(e)},hasStorageApi(e){return this.$data.storeApiValue.has(e)},setStorageApi(e,t){this.$data.storeApiValue.set(e,t);},initComponentsStorageApi(e,t,a){let n;this.hasStorageApi(e)?n=this.getStorageApi(e):n=a,this.setComponentsStorageApiProperty(t,n);},setComponentsStorageApiProperty(e,t){Reflect.set(e.props,E,t);}},re=function(e,t,a,n,i,l){let o={text:e,type:"switch",description:i,attributes:{},props:{},getValue(){return !!this.props[E].get(t,a)},callback(r,s){let u=!!s;p.success(`${u?"开启":"关闭"} ${e}`),this.props[E].set(t,u);},afterAddToUListCallBack:l};return Reflect.set(o.attributes,I,t),Reflect.set(o.attributes,L,a),H.initComponentsStorageApi("switch",o,{get(r,s){return h.getValue(r,s)},set(r,s){h.setValue(r,s);}}),o},U=function(e,t,a,n,i,l){let o=[];typeof n=="function"?o=n():o=n;let r={text:e,type:"select",description:l,attributes:{},props:{},getValue(){return this.props[E].get(t,a)},callback(s,u,m){let _=u;if(p.info(`选择：${m}`),typeof i=="function"&&i(s,_,m))return;this.props[E].set(t,_);},data:o};return Reflect.set(r.attributes,I,t),Reflect.set(r.attributes,L,a),H.initComponentsStorageApi("select",r,{get(s,u){return h.getValue(s,u)},set(s,u){h.setValue(s,u);}}),r},ue={id:"component-common",title:"通用",forms:[{text:"Toast配置",type:"forms",forms:[U("Toast位置","qmsg-config-position","bottom",[{value:"topleft",text:"左上角"},{value:"top",text:"顶部"},{value:"topright",text:"右上角"},{value:"left",text:"左边"},{value:"center",text:"中间"},{value:"right",text:"右边"},{value:"bottomleft",text:"左下角"},{value:"bottom",text:"底部"},{value:"bottomright",text:"右下角"}],(e,t,a)=>{p.info("设置当前Qmsg弹出位置"+a);},"Toast显示在页面九宫格的位置"),U("最多显示的数量","qmsg-config-maxnums",3,[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"},{value:5,text:"5"}],void 0,"限制Toast显示的数量"),re("逆序弹出","qmsg-config-showreverse",false,void 0,"修改Toast弹出的顺序")]}]};T.addContentConfig([ue]),document.documentElement.hasAttribute("style")&&document.body.hasAttribute("style")&&document.body.children.length&&document.querySelector('meta[name="viewport"]')&&(h.init(),se.init());

})(Qmsg, DOMUtils, Utils, pops);