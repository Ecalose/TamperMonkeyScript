// ==UserScript==
// @name         图片右键菜单
// @namespace    https://github.com/WhiteSevs/TamperMonkeyScript
// @version      2025.6.12
// @author       WhiteSevs
// @description  在浏览器预览图片页面添加全局右键菜单，右键直接复制该图片的Uri编码，支持自动判断图片类型，包括：jpg、jpeg、png、gif、webp、ico，支持手动判断图片类型，包括：jpg、jpeg、png、gif。
// @license      GPL-3.0-only
// @icon         data:image/png;base64,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
// @supportURL   https://github.com/WhiteSevs/TamperMonkeyScript/issues
// @match        *://*/*
// @require      https://fastly.jsdelivr.net/gh/WhiteSevs/TamperMonkeyScript@86be74b83fca4fa47521cded28377b35e1d7d2ac/lib/CoverUMD/index.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/utils@2.6.9/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/domutils@1.5.10/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/pops@2.1.1/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/qmsg@1.3.8/dist/index.umd.js
// @grant        GM_deleteValue
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-start
// ==/UserScript==

(function (f, ee, M, T) {
	'use strict';

	var J=Object.defineProperty;var X=(e,t,n)=>t in e?J(e,t,{enumerable:true,configurable:true,writable:true,value:n}):e[t]=n;var G=(e,t,n)=>X(e,typeof t!="symbol"?t+"":t,n);var te=typeof GM_deleteValue<"u"?GM_deleteValue:void 0,K=typeof GM_getValue<"u"?GM_getValue:void 0,A=typeof GM_info<"u"?GM_info:void 0,ne=typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0,W=typeof GM_setValue<"u"?GM_setValue:void 0,ae=typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0,ie=typeof GM_xmlhttpRequest<"u"?GM_xmlhttpRequest:void 0,y=typeof unsafeWindow<"u"?unsafeWindow:void 0,le=window;const H="GM_Panel",se="data-init",L="data-key",S="data-default-value",oe="data-init-more-value",I="data-storage-api",O={setting:{get width(){return window.innerWidth<550?"88vw":window.innerWidth<700?"550px":"700px"},get height(){return window.innerHeight<450?"70vh":window.innerHeight<550?"450px":"550px"}}};class re{constructor(t){G(this,"storageKey");G(this,"listenerData");if(typeof t=="string"){let n=t.trim();if(n=="")throw new Error("key参数不能为空字符串");this.storageKey=n;}else throw new Error("key参数类型错误，必须是字符串");this.listenerData=new M.Dictionary;}getLocalValue(){let t=K(this.storageKey);return t==null&&(t={},this.setLocalValue(t)),t}setLocalValue(t){W(this.storageKey,t);}set(t,n){let a=this.get(t),i=this.getLocalValue();Reflect.set(i,t,n),this.setLocalValue(i),this.triggerValueChangeListener(t,a,n);}get(t,n){let a=this.getLocalValue();return Reflect.get(a,t)??n}getAll(){return this.getLocalValue()}delete(t){let n=this.get(t),a=this.getLocalValue();Reflect.deleteProperty(a,t),this.setLocalValue(a),this.triggerValueChangeListener(t,n,void 0);}has(t){let n=this.getLocalValue();return Reflect.has(n,t)}keys(){let t=this.getLocalValue();return Reflect.ownKeys(t)}values(){let t=this.getLocalValue();return Reflect.ownKeys(t).map(n=>Reflect.get(t,n))}clear(){te(this.storageKey);}addValueChangeListener(t,n){let a=Math.random(),i=this.listenerData.get(t)||[];return i.push({id:a,key:t,callback:n}),this.listenerData.set(t,i),a}removeValueChangeListener(t){let n=false;for(const[a,i]of this.listenerData.entries()){for(let l=0;l<i.length;l++){const s=i[l];(typeof t=="string"&&s.key===t||typeof t=="number"&&s.id===t)&&(i.splice(l,1),l--,n=true);}this.listenerData.set(a,i);}return n}triggerValueChangeListener(t,n,a){if(!this.listenerData.has(t))return;let i=this.listenerData.get(t);for(let l=0;l<i.length;l++){const s=i[l];if(typeof s.callback=="function"){let u=this.get(t),o,r;typeof n<"u"&&arguments.length>=2?r=n:r=u,typeof a<"u"&&arguments.length>2?o=a:o=u,s.callback(t,r,o);}}}}const x=new re(H),$={$data:{__contentConfig:null,get contentConfig(){return this.__contentConfig==null&&(this.__contentConfig=new g.Dictionary),this.__contentConfig}},addContentConfig(e){Array.isArray(e)||(e=[e]);let t=this.$data.contentConfig.keys().length;this.$data.contentConfig.set(t,e);},getAllContentConfig(){return this.$data.contentConfig.values().flat()},getConfig(e=0){return this.$data.contentConfig.get(e)??[]}},ue={$data:{__menuOption:[{key:"show_pops_panel_setting",text:"⚙ 设置",autoReload:false,isStoreValue:false,showText(e){return e},callback:()=>{p.showPanel($.getConfig(0));}}],get menuOption(){return this.__menuOption}},init(){this.initExtensionsMenu();},initExtensionsMenu(){p.isTopWindow()&&ce.add(this.$data.menuOption);},addMenuOption(e){Array.isArray(e)||(e=[e]),this.$data.menuOption.push(...e);},updateMenuOption(e){Array.isArray(e)||(e=[e]),e.forEach(t=>{let n=this.$data.menuOption.findIndex(a=>a.key===t.key);n!==-1&&(this.$data.menuOption[n]=t);});},getMenuOption(e){return this.$data.menuOption[e]}},p={$data:{__configDefaultValueData:null,__onceExecMenuData:null,__onceExecData:null,__panelConfig:{},$panel:null,get configDefaultValueData(){return this.__configDefaultValueData==null&&(this.__configDefaultValueData=new g.Dictionary),this.__configDefaultValueData},get onceExecMenuData(){return this.__onceExecMenuData==null&&(this.__onceExecMenuData=new g.Dictionary),this.__onceExecMenuData},get onceExecData(){return this.__onceExecData==null&&(this.__onceExecData=new g.Dictionary),this.__onceExecData},get scriptName(){return R},get panelConfig(){return this.__panelConfig},set panelConfig(e){this.__panelConfig=e;},key:H,attributeKeyName:L,attributeDefaultValueName:S},init(){this.initContentDefaultValue(),ue.init();},isTopWindow(){return y.top===y.self},initContentDefaultValue(){const e=a=>{if(!a.attributes||a.type==="button"||a.type==="forms"||a.type==="deepMenu")return;let i={},l=a.attributes[L];l!=null&&(i[l]=a.attributes[S]);let s=a.attributes[se];if(typeof s=="function"){let r=s();if(typeof r=="boolean"&&!r)return}let u=a.attributes[oe];u&&typeof u=="object"&&Object.assign(i,u);let o=Object.keys(i);if(!o.length){h.warn(["请先配置键",a]);return}o.forEach(r=>{let V=i[r];this.setDefaultValue(r,V);});},t=a=>{for(let i=0;i<a.length;i++){let l=a[i];e(l);let s=l.forms;s&&Array.isArray(s)&&t(s);}},n=[...$.getAllContentConfig()];for(let a=0;a<n.length;a++){let i=n[a];if(!i.forms)continue;const l=i.forms;l&&Array.isArray(l)&&t(l);}},setDefaultValue(e,t){this.$data.configDefaultValueData.has(e)&&h.warn("请检查该key(已存在): "+e),this.$data.configDefaultValueData.set(e,t);},setValue(e,t){x.set(e,t);},getValue(e,t){let n=x.get(e);return n??(this.$data.configDefaultValueData.has(e)?this.$data.configDefaultValueData.get(e):t)},deleteValue(e){x.delete(e);},hasKey(e){return x.has(e)},addValueChangeListener(e,t){return x.addValueChangeListener(e,(a,i,l)=>{t(e,l,i);})},removeValueChangeListener(e){x.removeValueChangeListener(e);},triggerMenuValueChange(e,t,n){x.triggerValueChangeListener(e,n,t);},deleteExecMenuOnce(e){return this.$data.onceExecMenuData.delete(e),x.removeValueChangeListener(e)},deleteOnceExec(e){this.$data.onceExecData.delete(e);},exec(e,t,n,a=true){const i=this;let l;typeof e=="string"||Array.isArray(e)?l=()=>e:l=e;let s=false,u=l(),o=[];Array.isArray(u)?(s=true,o=u):o.push(u);let r=o.find(c=>!this.$data.configDefaultValueData.has(c));if(r){h.warn(`${r} 键不存在`);return}let V=JSON.stringify(o);if(a){if(this.$data.onceExecMenuData.has(V))return;this.$data.onceExecMenuData.set(V,1);}let m=[],k=[],z=(c,d)=>{let C=[];d instanceof HTMLStyleElement?C=[d]:Array.isArray(d)&&(C=[...d.filter(w=>w!=null&&w instanceof HTMLStyleElement)]),m=m.concat(C);},Q=c=>this.getValue(c),q=()=>{for(let c=0;c<m.length;c++)m[c].remove(),m.splice(c,1),c--;},Y=()=>{let c=false;return typeof n=="function"?c=n(o):c=o.every(d=>Q(d)),c},F=c=>{let d=Y(),C=[];if(d){let w=o.map(D=>this.getValue(D)),E=t({addStyleElement:(...D)=>z(true,...D),value:s?w:w[0]});E instanceof HTMLStyleElement?C.push(E):Array.isArray(E)&&C.push(...E.filter(D=>D!=null&&D instanceof HTMLStyleElement));}q(),m=[...C];};return a&&o.forEach(c=>{let d=this.addValueChangeListener(c,(C,w,E)=>{F();});k.push(d);}),F(),{clear(){this.clearStoreStyleElements(),this.removeValueChangeListener(),a&&i.$data.onceExecMenuData.delete(V);},clearStoreStyleElements:()=>q(),removeValueChangeListener:()=>{k.forEach(c=>{this.removeValueChangeListener(c);});}}},execMenu(e,t,n=false){return this.exec(e,a=>t(a),a=>a.every(l=>{let s=!!this.getValue(l);return n&&(s=!s),s}),false)},execMenuOnce(e,t){return this.exec(e,t,n=>n.every(i=>!!this.getValue(i)),true)},onceExec(e,t){if(typeof e!="string")throw new TypeError("key 必须是字符串");this.$data.onceExecData.has(e)||(t(),this.$data.onceExecData.set(e,1));},showPanel(e,t=`${R}-设置`){let n=_.panel({title:{text:`${R}-设置`,position:"center",html:false,style:""},content:e,btn:{close:{enable:true,callback:(a,i)=>{a.close(),this.$data.$panel=null;}}},mask:{enable:true,clickEvent:{toClose:true,toHide:false},clickCallBack:(a,i)=>{a(),this.$data.$panel=null;}},width:O.setting.width,height:O.setting.height,drag:true,only:true,...this.$data.panelConfig});this.$data.$panel=n;}},b={qmsg_config_position:{key:"qmsg-config-position",defaultValue:"bottom"},qmsg_config_maxnums:{key:"qmsg-config-maxnums",defaultValue:3},qmsg_config_showreverse:{key:"qmsg-config-showreverse",defaultValue:false}},g=M.noConflict();ee.noConflict();const _=T,h=new g.Log(A,y.console||le.console);var B;let R=((B=A==null?void 0:A.script)==null?void 0:B.name)||void 0;T.config.Utils.AnyTouch();const N=false;h.config({debug:N,logMaxCount:1e3,autoClearConsole:true,tag:true});f.config(Object.defineProperties({html:true,autoClose:true,showClose:false},{position:{get(){return p.getValue(b.qmsg_config_position.key,b.qmsg_config_position.defaultValue)}},maxNums:{get(){return p.getValue(b.qmsg_config_maxnums.key,b.qmsg_config_maxnums.defaultValue)}},showReverse:{get(){return p.getValue(b.qmsg_config_showreverse.key,b.qmsg_config_showreverse.defaultValue)}},zIndex:{get(){let e=M.getMaxZIndex(),t=T.config.InstanceUtils.getPopsMaxZIndex().zIndex;return M.getMaxValue(e,t)+100}}}));_.GlobalConfig.setGlobalConfig({zIndex:()=>{let e=M.getMaxZIndex(void 0,void 0,n=>{var a;if((a=n==null?void 0:n.classList)!=null&&a.contains("qmsg-shadow-container")||n!=null&&n.closest("qmsg")&&n.getRootNode()instanceof ShadowRoot)return  false}),t=T.config.InstanceUtils.getPopsMaxZIndex().zIndex;return M.getMaxValue(e,t)+100},mask:{enable:true,clickEvent:{toClose:false,toHide:false}}});const ce=new g.GM_Menu({GM_getValue:K,GM_setValue:W,GM_registerMenuCommand:ne,GM_unregisterMenuCommand:ae}),P=new g.Httpx({xmlHttpRequest:ie,logDetails:N});P.interceptors.request.use(e=>e);P.interceptors.response.use(void 0,e=>(h.error("拦截器-请求错误",e),e.type==="onabort"?f.warning("请求取消",{consoleLogContent:true}):e.type==="onerror"?f.error("请求异常",{consoleLogContent:true}):e.type==="ontimeout"?f.error("请求超时",{consoleLogContent:true}):f.error("其它错误",{consoleLogContent:true}),e));y.Object.defineProperty,y.Function.prototype.apply,y.Function.prototype.call,y.Element.prototype.appendChild,y.setTimeout;g.addStyle.bind(g);document.querySelector.bind(document);document.querySelectorAll.bind(document);new g.GM_Cookie;const v={default:{getBase64Image(e,t="image/png"){var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var a=n.getContext("2d");a.drawImage(e,0,0,e.width,e.height);var i=n.toDataURL("image/png");return i}},gif:{getImageFileFromUrl(e,t,n){fetch(e).then(a=>a.blob()).then(a=>{let i=new File([a],t,{type:"image/gif"});n(i);});},chooseStaticImg(e){let t=null;return new Promise((n,a)=>{this.getImageFileFromUrl(e,"图片.gif",i=>{let l=new FileReader;l.onloadend=()=>{t=l.result,n(t);},l.readAsDataURL(i);});})}},async networkQueryContentType(e){let t=await P.head(e,{fetch:true});if(t.status&&t.data.responseFetchHeaders.has("Content-Type"))return t.data.responseFetchHeaders.get("Content-Type")}},U=[{rule:".png",type:"image/png"},{rule:".jpg",type:"image/jpg"},{rule:".jpeg",type:"image/jpeg"},{rule:".webp",type:"image/webp"},{rule:".ico",type:"image/ico"},{rule:".gif",type:"image/gif"}],ge={init(){let e=document.body.querySelectorAll("img");if(e.length!==1){h.error("页面中的<img>元素数量不为1");return}h.info("注入全局右键-图片");let t=e[0],n=t.src;_.rightClickMenu({target:y,data:[{icon:_.config.iconSVG.documentCopy,iconIsLoading:false,text:"自动判断",async callback(){let a=null;if(n.startsWith("http")||n.startsWith("file:")){let i=-1;i=U.findIndex(l=>n.endsWith(l.rule)),i!==-1&&(a=U[i].type),!a&&n.startsWith("http")&&(f.info("通过网络请求判断类型"),a=await v.networkQueryContentType(n),h.info("请求获取的Content-Type："+a),a&&f.success("图片类型："+a));}a?a.endsWith("gif")?v.gif.chooseStaticImg(n).then(i=>{g.setClip(i),f.success("复制成功！");}):(g.setClip(v.default.getBase64Image(t,a)),f.success("复制成功！")):f.error("未知的图片类型");}},{icon:_.config.iconSVG.chromeFilled,iconIsLoading:false,text:"其它类型",callback(a){return  false},item:[{icon:_.config.iconSVG.documentCopy,iconIsLoading:false,text:"jpg",callback(){g.setClip(v.default.getBase64Image(t,"image/jpg")),f.success("复制成功！");}},{icon:_.config.iconSVG.documentCopy,iconIsLoading:false,text:"jpeg",callback(){g.setClip(v.default.getBase64Image(t,"image/jpeg")),f.success("复制成功！");}},{icon:_.config.iconSVG.documentCopy,iconIsLoading:false,text:"png",callback(){g.setClip(v.default.getBase64Image(t,"image/png")),f.success("复制成功！");}},{icon:_.config.iconSVG.documentCopy,iconIsLoading:false,text:"gif",callback(){v.gif.chooseStaticImg(n).then(a=>{g.setClip(a),f.success("复制成功！");});}}]}]});}},Z={$data:{__storeApiFn:null,get storeApiValue(){return this.__storeApiFn||(this.__storeApiFn=new M.Dictionary),this.__storeApiFn}},getStorageApi(e){if(this.hasStorageApi(e))return this.$data.storeApiValue.get(e)},hasStorageApi(e){return this.$data.storeApiValue.has(e)},setStorageApi(e,t){this.$data.storeApiValue.set(e,t);},setComponentsStorageApiProperty(e,t,n){let a;this.hasStorageApi(e)?a=this.getStorageApi(e):a=n,Reflect.set(t.props,I,a);}},fe=function(e,t,n,a,i,l){let s={text:e,type:"switch",description:i,attributes:{},props:{},getValue(){return !!this.props[I].get(t,n)},callback(u,o){let r=!!o;h.success(`${r?"开启":"关闭"} ${e}`),this.props[I].set(t,r);},afterAddToUListCallBack:l};return Reflect.set(s.attributes,L,t),Reflect.set(s.attributes,S,n),Z.setComponentsStorageApiProperty("switch",s,{get(u,o){return p.getValue(u,o)},set(u,o){p.setValue(u,o);}}),s},j=function(e,t,n,a,i,l){let s=[];typeof a=="function"?s=a():s=a;let u={text:e,type:"select",description:l,attributes:{},props:{},getValue(){return this.props[I].get(t,n)},callback(o,r,V){let m=r;h.info(`选择：${V}`),this.props[I].set(t,m),typeof i=="function"&&i(o,m,V);},data:s};return Reflect.set(u.attributes,L,t),Reflect.set(u.attributes,S,n),Z.setComponentsStorageApiProperty("select",u,{get(o,r){return p.getValue(o,r)},set(o,r){p.setValue(o,r);}}),u},de={id:"component-common",title:"通用",forms:[{text:"Toast配置",type:"forms",forms:[j("Toast位置","qmsg-config-position","bottom",[{value:"topleft",text:"左上角"},{value:"top",text:"顶部"},{value:"topright",text:"右上角"},{value:"left",text:"左边"},{value:"center",text:"中间"},{value:"right",text:"右边"},{value:"bottomleft",text:"左下角"},{value:"bottom",text:"底部"},{value:"bottomright",text:"右下角"}],(e,t,n)=>{h.info("设置当前Qmsg弹出位置"+n);},"Toast显示在页面九宫格的位置"),j("最多显示的数量","qmsg-config-maxnums",3,[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"},{value:5,text:"5"}],void 0,"限制Toast显示的数量"),fe("逆序弹出","qmsg-config-showreverse",false,void 0,"修改Toast弹出的顺序")]}]};$.addContentConfig([de]),document.documentElement.hasAttribute("style")&&document.body.hasAttribute("style")&&document.body.children.length&&document.querySelector('meta[name="viewport"]')&&(p.init(),ge.init());

})(Qmsg, DOMUtils, Utils, pops);