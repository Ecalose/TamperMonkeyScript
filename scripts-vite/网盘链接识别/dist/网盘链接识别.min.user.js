// ==UserScript==
// @name         网盘链接识别
// @namespace    https://greasyfork.org/zh-CN/scripts/445489
// @version      2024.10.3
// @author       WhiteSevs
// @description  识别网页中显示的网盘链接，目前包括百度网盘、蓝奏云、天翼云、中国移动云盘(原:和彩云)、阿里云、文叔叔、奶牛快传、123盘、腾讯微云、迅雷网盘、115网盘、夸克网盘、城通网盘(部分)、坚果云、UC网盘、BT磁力，支持蓝奏云、天翼云(需登录)、123盘、奶牛、UC网盘(需登录)、坚果云(需登录)和阿里云盘(需登录，且限制在网盘页面解析)直链获取下载，页面动态监控加载的链接，可自定义规则来识别小众网盘/网赚网盘或其它自定义的链接。
// @license      GPL-3.0-only
// @icon         data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAACsJJREFUeF7tXW+IHdUVP2c2u8kHIQYL0TRIaK1SgrFFaZsvVkpAo6YR1LJpa9jUd++83SUpSrUNBFRCrVgxNOv+mTOvJBBNmtpamoQG9UNBKLHFDzEtFttKBdOYQENE/Lb75vZd2cVNum/uvXNnZt/MnoGQD+/c8+d3fu+c+2f2PgR+ljQCuKSj5+CBCbDEScAEYAIscQSWePhcAZgASxyBJR4+VwAmQHEIjIyM3DAzM/M1pdSXEfEWALgVANbkaPE0ABwhomdz1GmtSgixHxF3Wg8wC55HxPeVUu8DgP7/jRUrVvxpbGzsY/PQbBK5VwCd9Ha7vVkptRkA9L8yHiKisAxDczaklL8GgAfLsImIryql3gSAqBPnh3nazI0AjUZjbRAEjwLAI3k6aKtLKbUjjuODtvI+cs1m894kSY776Mg49hwAxHkSIRcCSCl10nXy12YMLI9hrxDR/XkoMukQQrQQ8WGTXIGfn0PEZ6IoGvO14U0AKeUJALjH15Ecxr9ARHn2464uCSEOI+K2HHz2VXGUiAZ9lHgRQEp5BgBu9nEgr7FBEGyZmprSZCz8EUIMIuKRwg3ZGfiAiK63E/1/qcwEkFJ+BAArsxrOedzLRPSdnHWmqgvD8EBntj5Ups0UWxeI6NosvmQigBDibUTckMVgAWNKXwHMxSClfBwAtgPA+gLiclX5GhHd6TrImQBhGO5RSu11MHQREY8nSXICEf/R399/bnx8/KLD+CUl2plf3BgEwa1JktyOiN8HgKscAHCuhE4EaDabQ0mSHLBxSCml5weHlFKHWq3WBZsxLHM5AlLKLwLAQwCwCwBWWeLzKBHts5S1fx9ASnkdALxluZPXIiJh6wTLpSMwPDx8U7vd/iEADFtgdTZJko2tVuushawTAZ4EgCdMSpVSW+M4PmaS48/dEZBSWuWgMznfR0R6X8b4WLUA228/Ig5GUXTUaJUFMiMghNiEiK+bFCxbtuxLExMT/zLJ2RLAhnmTRDRiMsif+yMQhuFupdTTaZoQcZfNTqEVAYQQf0TEO1IMXurr69s4OTn5rn94rMEGAYul+Ekiutuky0iAoaGhqwcGBi4ZFD1FRLpK8FMSAkKIHyHiz9PM2bQBIwGklPcBwO9SDH0CAF8hovdKip3NAECj0VgdBMHf05aHSqntcRwfSm0VJjSllD8DgJ90k1NKTcVxbLM8MZnizx0RkFL+BgC6noAi4nNRFD3mSwB96NH1xKnMc3hHfGovbnEoZdweNraAMAxPKaW+0Q1NRFwfRdE7tUe7BwOUUuqTWL3j2u0xHhIZCSCl1K8gdT1pIiKjjh7ErhYujY6OXjM9Pf3ftGBM+TEmT0qpfAzUAukeDsI3P0yAHk6ujWtMABuUaizDBKhxcm1CYwLYoFRjGSZAjZNrExoTwAalGsswAWqcXJvQmAA2KNVYhglQ4+TahMYEsEGpxjK1IYCU8vcAcJvlW8dVTqn+C9+3iGhrHkHUggCmIPIAqhd1mA5qbHw2YWeysehnAWVetGADaMkyzn/Jc6V/dSDAeQBYXTLwvWLOeF5vcrQOBEg9bjYBUPXPTSXaFB8TwIRQj3/OBDC8cNLj+fN2r+oEOE1EX/VBwVTCfHRXYWzBBDDmx7gKMNyF92PfO/pMBPAFKO9Zsyupio7PNz9GAuiAuyzVcrmZo2iA6k4A3/xYEUAb0Xfjtdvt+xBxlVLqeF538jEB8nmrOmt+rAngWvps5ZkA+RDAFu8r5XqBAP9J2f8/R0SfzxrcQuMWgXClxueKVS8QQB8CfbuL48fyOjSZ078IBCg1vsoRYHYSs+BuYN4rgDRbc8CVabMIW5UkwLyZ7O2zAbxR1MWPZVeAeZVH3y5eeHyVJYCr41nlF4sAWf0tetyizwGKDnCx9wHKjs/VHhPgCsR6oS+7JtFHngnABPDhT/XG8hzg8pxxBeAKUL1vsY/HXAG4AvCNJ/M4wC2AW4BPQa3eWG4B3AK4BXAL6F65eCOoelXdyWNuAdwCuAVwC+AWMIcALwN5GejUQisvzHMAngPwHIDnADwH4DlAFw7wPkDlu3x6ADwHyDgHCMPwLqXUJgCYDoLgpampqb9VkSt1JUDW/FgtA6WUvwSAH1yR8Bc7vxSmf9i4Uk8dCeCTHyMBDL8a9j0iOlwlBtSNAL75sSGA/v1Z/TPmCz3/JqIvMAEWDwEppVd+bAhQq3VzDSuAV36YABXfCvYlNBOACbC01s2+35jF6/YLW/aNhysAVwCuAPMRqNpWMFcAx5rsC5ijucLFfePhFsAtgFsAt4AUDviWmMJroKMBjsfxNJABc2RYyeK++VmKc4CevrfPlT9MAEfEZn+cqrR7CR3dcxZnAjhD9unl16XdS5jBPachTAAnuD4Tnr0Bvefu7XMNhwngiljN5JkANUuoazhMAFfEaia/6ATo7+//3Pj4+MWa4VqZcAwEOE9E16UFY7MPkLZu1ro3ENFfK4NYjRwVQtyIiO92CwkR34yiaKMvAY4BwJZuSpRSD8Rx/Nsa4VqZUMIw3KaUSnsr+1dEtM2LAEKIvYi4J4VlB6Mo2lEZ1GrkqBBiEhGbKSE9Q0S7vQggpfwuALyUouRikiTrW63WhRph2/OhSCn1q/qnAeCqlOp8dxzHJ70IMDIycsPMzMw/05QopR6L4/i5nketRg5KKZ8EgCfSQlq+fPnKsbGxj70IoAdLKf8AAJtTmHYmjuNbaoRvT4cyPDx8U7vdPgUAq1Ja86tRFN1lCsS4CtAKwjDcqZTab1DWIiJhMsif+yMgpZwAgGGDpqeISFeJ1MeKADZtQFtRSm2N41ivGvgpCAGb0t8p2ucA4DYi+tDkhhUBZtvA8wDwiFEh4mAURUdNcvy5OwJCiE2I+LrFSKtvv9ZjTYBGo7E2CALdd9ZaODDZ19f3i8nJya6bFBY6WGQeAmEY7lZKPW0BivW334kAs1VAVwBdCWyeSwCg5w2HOvcIvGczgGUuR6DRaKxGRH0Hw0OIuMEGH0TcFUXRmI2sMwFmSXACAO6xNQAAnyilXuysIv4cBMFfoih6x2HskhIdHR29Znp6eo1Saj0iPgAA30qb6S8AzlEiGnQBzboFzFcqpTwDADe7GCpIVm+EHCGiZwvSn6pWCLEfEXcuhu0FbH5ARNe7+pKJALOV4CMAWOlqsCB56sx4w4J0L6h29o2iB8u0mWLrAhFdm8WXzATQxoQQb9v2pizOuYxRSu2I4/igy5isss1m894kSY5nHZ/zuNeI6M6sOr0IoI2GYbhHKbU3qwM5jnulcyx9f476uqoSQrQQ8eEybBlsvOz7G8veBNAONpvNoSRJfgoAaxYRlBeIqJR+3DmHP9w5h089Zi0Yh7N6NUZE+3zt5EKA2TmBfvNE92G9HVw6EYIg2DI1NaVXKIU/QohBRDxSuKGFDexLkuT5VqulSeD95EaAOU+klJ8SQSn1TUS8w9tDOwXepdDOzGdSYRgeUEoNuY7LKH8SEU/29fWdnJiY0LeC5fbkToD5ng0NDV09MDCgSfB1AFiHiOuUUusAINOMtUvUpa8A5pH9cQDYDgDrc8sIgH6vQk+uzyRJcqa/v/9U3kmf72uhBMgRFFZVEAJMgIKArYpaJkBVMlWQn0yAgoCtilomQFUyVZCfTICCgK2KWiZAVTJVkJ9MgIKArYra/wGYigzMiqJYZwAAAABJRU5ErkJggg==
// @supportURL   https://github.com/WhiteSevs/TamperMonkeyScript/issues
// @match        *://*/*
// @exclude      /^http(s|)://s1.hdslb.com/.*$/
// @exclude      /^http(s|)://www.bilibili.com/video.*$/
// @exclude      /^http(s|)://message.bilibili.com/.*$/
// @exclude      /^http(s|)://live.bilibili.com/.*$/
// @exclude      /^http(s|)://.*.mail.qq.com/.*$/
// @exclude      /^http(s|)://.*video.qq.com/.*$/
// @exclude      /^http(s|)://.*.vscode-cdn.net/.*$/
// @exclude      /^http(s|)://.*vscode.dev/.*$/
// @exclude      /^http(s|)://cloudgame.ds.163.com/.*$/
// @exclude      /^http(s|)://cloudgame.webapp.163.com/.*$/
// @exclude      /^http(s|)://cg.163.com/.*$/
// @exclude      /^http(s|)://.*.youtube.com/.*$/
// @require      https://update.greasyfork.org/scripts/494167/1413255/CoverUMD.js
// @require      https://update.greasyfork.org/scripts/456470/1413242/%E7%BD%91%E7%9B%98%E9%93%BE%E6%8E%A5%E8%AF%86%E5%88%AB-%E5%9B%BE%E6%A0%87%E5%BA%93.js
// @require      https://update.greasyfork.org/scripts/486152/1448081/Crypto-JS.js
// @require      https://update.greasyfork.org/scripts/465550/1448580/JS-%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6.js
// @require      https://fastly.jsdelivr.net/npm/qmsg@1.2.3/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/utils@2.3.3/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/domutils@1.3.3/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/pops@1.7.2/dist/index.umd.js
// @connect      *
// @connect      lanzoub.com
// @connect      lanzouc.com
// @connect      lanzoue.com
// @connect      lanzouf.com
// @connect      lanzoug.com
// @connect      lanzouh.com
// @connect      lanzoui.com
// @connect      lanzouj.com
// @connect      lanzouk.com
// @connect      lanzoul.com
// @connect      lanzoum.com
// @connect      lanzouo.com
// @connect      lanzoup.com
// @connect      lanzouq.com
// @connect      lanzous.com
// @connect      lanzout.com
// @connect      lanzouu.com
// @connect      lanzouv.com
// @connect      lanzouw.com
// @connect      lanzoux.com
// @connect      lanzouy.com
// @connect      lanosso.com
// @connect      lanzn.com
// @connect      lanzog.com
// @connect      lanpw.com
// @connect      lanpv.com
// @connect      lanzv.com
// @connect      wwentua.com
// @connect      ilanzou.com
// @connect      189.cn
// @connect      123pan.com
// @connect      123pan.cn
// @connect      wenshushu.cn
// @connect      jianguoyun.com
// @connect      cowtransfer.com
// @connect      cowcs.com
// @connect      aliyundrive.com
// @connect      baidu.com
// @connect      139.com
// @connect      weiyun.com
// @connect      xunlei.com
// @connect      115.com
// @connect      quark.cn
// @connect      jianguoyun.com
// @connect      uc.cn
// @connect      ctfile.com
// @connect      sharepoint.com
// @grant        GM_addStyle
// @grant        GM_deleteValue
// @grant        GM_download
// @grant        GM_getResourceText
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-end
// ==/UserScript==

(function (f, B, ye, Ie) {
	'use strict';

	var rt=Object.defineProperty;var ot=(e,a,n)=>a in e?rt(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n;var F=(e,a,n)=>ot(e,typeof a!="symbol"?a+"":a,n);var Ke=typeof GM_deleteValue<"u"?GM_deleteValue:void 0,Me=typeof GM_download<"u"?GM_download:void 0,Be=typeof GM_getResourceText<"u"?GM_getResourceText:void 0,O=typeof GM_getValue<"u"?GM_getValue:void 0,fe=typeof GM_info<"u"?GM_info:void 0,lt=typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0,z=typeof GM_setValue<"u"?GM_setValue:void 0,ct=typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0,dt=typeof GM_xmlhttpRequest<"u"?GM_xmlhttpRequest:void 0,Q=typeof unsafeWindow<"u"?unsafeWindow:void 0,ut=window;const ht={$data:{get enable(){return Y.getValue("httpx-use-cookie-enable")},get useDocumentCookie(){return Y.getValue("httpx-use-document-cookie")},cookieRule:[]},fixCookieSplit(e){return d.isNotNull(e)&&!e.trim().endsWith(";")&&(e+=";"),e},concatCookie(e,a){return d.isNull(e)?a:(e=e.trim(),a=a.trim(),e=this.fixCookieSplit(e),a.startsWith(";")&&(a=a.substring(1)),e.concat(a))},handle(e){if(e.fetch||!this.$data.enable)return;let a="",n=e.url;n.startsWith("//")&&(n=window.location.protocol+n);let t=new URL(n);this.$data.useDocumentCookie&&t.hostname.endsWith(window.location.hostname.split(".").slice(-2).join("."))&&(a=this.concatCookie(a,document.cookie.trim()));for(let i=0;i<this.$data.cookieRule.length;i++){let s=this.$data.cookieRule[i];if(t.hostname.match(s.hostname)){let r=Y.getValue(s.key);if(d.isNull(r))break;a=this.concatCookie(a,r);}}d.isNotNull(a)&&(e.headers&&e.headers.Cookie?e.headers.Cookie=this.concatCookie(e.headers.Cookie,a):e.headers.Cookie=a,h.info(["Httpx => 设置cookie:",e])),e.headers&&e.headers.Cookie!=null&&d.isNull(e.headers.Cookie)&&delete e.headers.Cookie;}};class Je{constructor(a){F(this,"storageKey");if(typeof a=="string"){let n=a.trim();if(n=="")throw new Error("key参数不能为空字符串");this.storageKey=n;}else throw new Error("key参数类型错误，必须是字符串");this.getLocalValue();}getLocalValue(){let a=O(this.storageKey);return a==null&&(a={},this.setLocalValue(a)),a}setLocalValue(a){z(this.storageKey,a);}set(a,n){let t=this.getLocalValue();Reflect.set(t,a,n),this.setLocalValue(t);}get(a,n){let t=this.getLocalValue();return Reflect.get(t,a)??n}getAll(){return this.getLocalValue()}delete(a){let n=this.getLocalValue();Reflect.deleteProperty(n,a),this.setLocalValue(n);}has(a){let n=this.getLocalValue();return Reflect.has(n,a)}keys(){let a=this.getLocalValue();return Reflect.ownKeys(a)}values(){let a=this.getLocalValue();return Reflect.ownKeys(a).map(n=>Reflect.get(a,n))}clear(){Ke(this.storageKey);}}const U={getDefaultLinkClickMode(){return {copy:{default:!1,enable:!0,text:"复制到剪贴板"},openBlank:{default:!1,enable:!0,text:"新窗口打开"},parseFile:{default:!1,enable:!1,text:"文件解析"},own:{default:!1,enable:!1,text:"自定义动作"}}},replaceParam(e,a={}){return typeof e!="string"||Object.keys(a).forEach(n=>{let t=a[n];if(d.isNotNull(t)){try{e=e.replaceAll(`{#encodeURI-${n}#}`,encodeURI(t));}catch{h.error(["encodeURI-替换的文本失败",[t]]);}try{e=e.replaceAll(`{#encodeURIComponent-${n}#}`,encodeURIComponent(t));}catch{h.error(["encodeURIComponent-替换的文本失败",[t]]);}try{e=e.replaceAll(`{#decodeURI-${n}#}`,decodeURI(t));}catch{h.error(["decodeURI-替换的文本失败",[t]]);}try{e=e.replaceAll(`{#decodeURIComponent-${n}#}`,decodeURIComponent(t));}catch{h.error(["encodeURIComponent-替换的文本失败",[t]]);}e=e.replaceAll(`{#${n}#}`,t);}}),e},replaceChinese(e){return e.replace(/[\u4e00-\u9fa5]/g,"")},getDecodeComponentUrl(e=window.location.href){try{e=decodeURIComponent(e);}catch{}return e}},j={$data:{STORAGE_KEY:"rule"},init(){this.initRule();},initRule(){this.getAllRule();},addRule(e){let a=this.getAllRule();a.push(e),we.set(this.$data.STORAGE_KEY,a);},getRule(e){return this.getAllRule().find(a=>a.uuid===e)},getRuleData(e){var a;return typeof e=="string"?(a=this.getRule(e))==null?void 0:a.data:e.data},getRuleDataValue(e,a,n){let t=this.getRuleData(e);return Reflect.get(t,a)??n},updateRule(e){let a=this.getAllRule();for(let n=0;n<a.length;n++)if(a[n].uuid===e.uuid){a[n]=e;break}we.set(this.$data.STORAGE_KEY,a);},updateRuleValue(e,a,n){let t=this.getAllRule();for(let i=0;i<t.length;i++){const s=t[i];if(s.uuid===e){Reflect.set(s,a,n);break}}we.set(this.$data.STORAGE_KEY,t);},deleteRule(e){let a=this.getAllRule(),n=!1,t=e;for(let i=0;i<a.length;i++)if(a[i].uuid===t){a.splice(i,1),n=!0;break}return we.set(this.$data.STORAGE_KEY,a),n},deleteAllRule(){we.delete(this.$data.STORAGE_KEY);},getAllRule(){return we.get(this.$data.STORAGE_KEY,[])},getUrlMatchedRule(e=window.location.href){return this.getAllRule().filter(n=>{let t=new RegExp(n.url,"ig");return !!e.match(t)})}},L={matchRange_text:{before:e=>`${e}-text-match-range-before`,after:e=>`${e}-text-match-range-after`},matchRange_html:{before:e=>`${e}-html-match-range-before`,after:e=>`${e}-html-match-range-after`},function:{enable:e=>`${e}-enable`,checkLinkValidity:e=>`${e}-check-link-valid`,linkClickMode:e=>`${e}-click-mode`},linkClickMode_openBlank:{openBlankWithCopyAccessCode:e=>`${e}-open-blank-with-copy-accesscode`},schemeUri:{enable:e=>`${e}-scheme-uri-enable`,isForwardLinearChain:e=>`${e}-scheme-uri-forward-linear-chain`,isForwardBlankLink:e=>`${e}-scheme-uri-forward-blank-link`,uri:e=>`${e}-scheme-uri-uri`}},Le={features:{customAccessCodeEnable:e=>`${e}-custom-accesscode-enable`,customAccessCode:e=>`${e}-custom-accesscode`}},b={$data:{isMatchedLink:!1,clipboardText:""},$match:{matchedInfo:new ye.Dictionary,blackMatchedInfo:new ye.Dictionary,tempMatchedInfo:new ye.Dictionary,matchedInfoRuleKey:new Set},$rule:{matchRule:{},ruleSetting:{},rule:[]},$extraRule:{shareCodeNotMatchRegexpList:[/(vipstyle|notexist|ajax|file|download|ptqrshow|xy-privacy|comp|web|undefined|1125|unproved|console|account|favicon|setc)/g],accessCodeNotMatchRegexpList:[/^(font)/gi],noAccessCodeRegExp:/( |提取码:|\n密码：{#accessCode#}|{#accessCode#}|{#encodeURI-accessCode#}|{#encodeURIComponent-accessCode#}|{#decodeURI-accessCode#}|{#encodeURIComponent-accessCode#}|\?pwd=|&pwd=)/gi},init(){this.initLinkDict();},initLinkDict(){Object.keys(this.$rule.matchRule).forEach(e=>{this.$match.matchedInfo.set(e,new d.Dictionary),this.$match.blackMatchedInfo.set(e,new d.Dictionary),this.$match.tempMatchedInfo.set(e,new d.Dictionary);});},handleLink(e,a,n){let t=this.handleShareCode(e,a,n);if(d.isNull(t))return;let i=this.handleAccessCode(e,a,n);return i=this.handleAccessCodeByUserRule(e,i,n),{shareCode:t,accessCode:i}},handleShareCode(e,a,n){var o;let t=b.$rule.matchRule[e][a],i=(o=n.match(t.shareCode))==null?void 0:o.filter(l=>d.isNotNull(l));if(d.isNull(i)){h.error(["匹配shareCode为空",{匹配的文本:n,规则:t,正在使用的规则:t.shareCode,网盘名称:e,网盘名称索引下标:a}]);return}let s=i[0];t.shareCodeNeedRemoveStr&&(s=s.replace(t.shareCodeNeedRemoveStr,""));let r=t.shareCodeNotMatch;if(r!=null&&s.match(r)){h.error(`不可能的shareCode => ${s}`);return}for(const l of b.$extraRule.shareCodeNotMatchRegexpList)if(s.match(l)){h.error(`不可能的shareCode => ${s}`);return}if(s=decodeURI(s),!(g.aboutShareCode.excludeIdenticalSharedCodes.value&&d.isSameChars(s,g.aboutShareCode.excludeIdenticalSharedCodesCoefficient.value))&&!(s.endsWith("http")||s.endsWith("https")))return s},handleAccessCode(e,a,n){var r;let t=this.$rule.matchRule[e][a],i="";if(!t.checkAccessCode)return "";let s=n.match(t.checkAccessCode);if(s){let l=(r=s[s.length-1].match(t.accessCode))==null?void 0:r.filter(c=>d.isNotNull(c));if(d.isNull(l))return "";l.length&&(i=l[0],i.startsWith("http")&&(i=""));}if(d.isNotNull(i)){for(const o of b.$extraRule.accessCodeNotMatchRegexpList)if(i.match(o)){i="";break}t.acceesCodeNotMatch&&i.match(t.acceesCodeNotMatch)&&(i="");}return i},handleAccessCodeByUserRule(e,a,n){let t=j.getUrlMatchedRule(),i=a;for(let s=0;s<t.length;s++){const r=t[s];let o=j.getRuleData(r),l=Reflect.get(o,Le.features.customAccessCode(e));if(Reflect.get(o,Le.features.customAccessCodeEnable(e))&&typeof l=="string"){i=l,h.success(`使用自定义网站规则中的提取码 ${e} ${i}`);break}}return i},handleLinkShow(e,a,n,t,i){let s=b.$rule.matchRule[e][a];if(s==null)throw f.error("BUG: 获取uiLink规则失败"),h.error(["BUG: 分析参数",e,a,n,t]),new TypeError("获取uiLink规则失败");let r=U.replaceParam(s.uiLinkShow,{shareCode:n});if(t&&t!=""?r=U.replaceParam(r,{accessCode:t}):r=r.replace(b.$extraRule.noAccessCodeRegExp,""),s.paramMatch){let o=b.$match.matchedInfo.get(e).get(n);if(i=i??(o==null?void 0:o.matchText),d.isNotNull(i)){let l=i.match(s.paramMatch),c={};if(l)for(let u=0;u<l.length;u++)c[`$${u}`]=l[u];r=U.replaceParam(r,c);}}return r},getLinkDickObj(e,a=0,n=!1,t){return {accessCode:e,netDiskIndex:a,isForceAccessCode:n,matchText:t}}},pt={tianYiYunLoginTip:{PC:{width:"30vw",height:"280px"},Mobile:{width:"80vw",height:"250px"}},jianGuoYunLoginTip:{PC:{width:"350px",height:"200px"},Mobile:{width:"350px",height:"200px"}},settingView:{PC:{width:"800px",height:"600px"},Mobile:{width:"92vw",height:"80vh"}},setDefaultValueView:{PC:{width:"350px",height:"200px"},Mobile:{width:"350px",height:"200px"}},mainView:{PC:{width:"500px",height:"100%"},Mobile:{width:"88vw",height:"50vh"}},mainViewSmallWindow:{PC:{get width(){return g.smallWindow["netdisk-ui-small-window-width"].value+"px"},height:"auto"},Mobile:{get width(){return g.smallWindow["netdisk-ui-small-window-width"].value+"px"},height:"auto"}},oneFileStaticView:{PC:{width:"550px",height:"350px"},Mobile:{width:"88vw",height:"300px"}},moreFileStaticView:{PC:{width:"700px",height:"600px"},Mobile:{width:"88vw",height:"500px"}},inputNewAccessCodeView:{PC:{width:"400px",height:"200px"},Mobile:{width:"88vw",height:"160px"}},historyMatchView:{PC:{width:"50vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},customRulesView:{PC:{width:"50vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},customRuleDebugView:{PC:{width:"55vw",height:"70vh"},Mobile:{width:"88vw",height:"70vh"}},matchPasteTextView:{PC:{width:"50vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},accessCodeRuleView:{PC:{width:"50vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},accessCodeRuleEditView:{PC:{width:"44vw",height:"50vh"},Mobile:{width:"70vw",height:"45vh"}},websiteRuleView:{PC:{width:"45vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},websiteEditRuleView:{PC:{width:"45vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}}},ft=function(e){window.location.hostname==="pan.baidu.com"&&window.location.pathname==="/share/init"&&window.location.search.startsWith("?surl=")&&(h.success(["自动填写链接",e]),d.waitNode("div.verify-form #accessCode").then(a=>{var n;if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),a.value=e.accessCode,d.dispatchEvent(a,"input"),(n=document.querySelector("div.verify-form #submitBtn"))==null||n.click();})),window.location.hostname==="pan.baidu.com"&&window.location.pathname==="/wap/init"&&window.location.search.startsWith("?surl=")&&(h.success(["自动填写链接",e]),d.waitNode("div.extractWrap div.extract-content div.extractInputWrap.extract input[type=text]").then(a=>{var n;if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),a.value=e.accessCode,d.dispatchEvent(a,"input"),(n=document.querySelector("div.extractWrap div.extract-content button.m-button"))==null||n.click();}));},mt=function(e){window.location.hostname.match(/lanzou[a-z]{1}.com/gi)&&(h.success(["自动填写链接",e]),d.waitNode("#pwd").then(a=>{var n,t;if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),a.value=e.accessCode,d.dispatchEvent(a,"input"),(n=document.querySelector("#passwddiv div.passwddiv-input > div")||a.nextElementSibling)==null||n.click(),(t=document.querySelector("#sub"))==null||t.click();}),d.waitNode("#f_pwd").then(a=>{d.mutationObserver(a,{config:{attributes:!0,attributeFilter:["style"]},callback:(n,t)=>{var s;let i=document.querySelector("#f_pwd #pwd");if(!d.isVisible(i)){h.error("输入框不可见，不输入密码");return}t.disconnect(),h.success("自动填入访问码并关闭观察者"),f.success("自动填入访问码"),i.value=e.accessCode,d.dispatchEvent(i,"input"),(s=document.querySelector("#f_pwd #sub"))==null||s.click();}});}));},gt=function(e){function a(n,t){let i=0,s=30,r=setInterval(()=>{if(i++,i>s){h.error("结束循环检查，退出。"),clearInterval(r);return}if(!d.isVisible(n)){h.warn(`第 ${i} 次：输入框不可见，不输入密码`);return}t(),clearInterval(r);},500);}window.location.hostname==="cloud.189.cn"&&(h.success(["自动填写链接",e]),d.waitNode("input#code_txt").then(n=>{a(n,()=>{f.success("自动填入访问码");let t=document.querySelector(".btn.btn-primary.visit");n.value=e.accessCode,n._value=e.accessCode,d.dispatchEvent(n,"input"),d.dispatchEvent(t,"click");});})),window.location.hostname==="h5.cloud.189.cn"&&(h.success(["自动填写链接",e]),d.waitNode("input.access-code-input").then(n=>{a(n,()=>{f.success("自动填入访问码"),n.value=e.accessCode,n._value=e.accessCode,d.dispatchEvent(n,"input"),d.dispatchEvent(document.querySelector("div.button"),"click");});}));},wt=function(e){window.location.hostname==="caiyun.139.com"&&(h.success(["自动填写链接",e]),d.waitNode("#token-input").then(a=>{if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),a.value=e.accessCode,d.dispatchEvent(a,"input"),document.querySelector("#homepage div.token div.token-form a").click();}),d.waitNode("#app div.token-form input[type=text]").then(a=>{if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),a.value=e.accessCode,d.dispatchEvent(a,"input"),document.querySelector("div.token-form a.btn-token").click();}));},xe={async waitReactPropsToSet(e,a,n){if(!Array.isArray(n)){this.waitReactPropsToSet(e,a,[n]);return}function t(){let i=null;return typeof e=="string"?i=document.querySelector(e):typeof e=="function"?i=e():e instanceof HTMLElement&&(i=e),i}typeof e=="string"&&!await d.waitNode(e,1e4)||n.forEach(i=>{typeof i.msg=="string"&&h.info(i.msg);function s(){let r=t();if(r==null)return !1;let o=d.getReactObj(r);if(o==null)return !1;let l=o[a];return l==null?!1:!!i.check(l)}d.waitPropertyByInterval(()=>t(),s,250,1e4).then(()=>{let r=t();if(r==null)return;let o=d.getReactObj(r);if(o==null)return;let l=o[a];l!=null&&i.set(l);});});}},kt=function(e){(window.location.hostname==="www.aliyundrive.com"||window.location.hostname==="www.alipan.com")&&(h.success(["自动填写链接",e]),d.waitNode("#root input.ant-input").then(a=>{if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),a.value=e.accessCode,xe.waitReactPropsToSet(a,"reactFiber",{check(n){var t;return typeof((t=n==null?void 0:n.memoizedProps)==null?void 0:t.onChange)=="function"},set(n){n.memoizedProps.onChange({currentTarget:a,target:a});}}),document.querySelector('#root button[type="submit"]').click();}),d.waitNode("#root input[name=pwd]").then(a=>{if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),a.value=e.accessCode,xe.waitReactPropsToSet(a,"reactFiber",{check(n){var t;return typeof((t=n==null?void 0:n.memoizedProps)==null?void 0:t.onChange)=="function"},set(n){n.memoizedProps.onChange({currentTarget:a,target:a});}}),document.querySelector('#root button[type="submit"]').click();}));},yt=function(e){window.location.hostname==="www.123pan.com"&&(h.success(["自动填写链接",e]),d.waitNode("#app .ca-fot input.ant-input[type=text]").then(a=>{if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),xe.waitReactPropsToSet(a,"reactProps",{check(t){return typeof(t==null?void 0:t.onChange)=="function"},set(t){t.onChange({target:{value:e.accessCode}});}});let n=a.nextSibling;n==null||n.click();}),d.waitNode("#app .appinput input.ant-input[type=text]").then(a=>{if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),xe.waitReactPropsToSet(a,"reactProps",{check(t){return typeof(t==null?void 0:t.onChange)=="function"},set(t){t.onChange({target:{value:e.accessCode}});}});let n=a.nextSibling;n==null||n.click();}));},xt=function(e){window.location.hostname==="share.weiyun.com"&&(h.success(["自动填写链接",e]),d.waitNode("#app input.input-txt").then(a=>{if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),a.value=e.accessCode,d.dispatchEvent(a,"input"),d.dispatchEvent(a,"change"),setTimeout(()=>{document.querySelector(".form-item button.btn-main").click();},500);}),d.waitNode(".input-wrap input.pw-input").then(a=>{if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),a.value=e.accessCode,d.dispatchEvent(a,"input"),d.dispatchEvent(a,"change"),setTimeout(()=>{document.querySelector(".pw-btn-wrap button.btn").click();},500);}));},Ct=function(e){window.location.hostname==="pan.xunlei.com"&&(h.success(["自动填写链接",e]),d.waitNode("#__layout div.pass-input-wrap input.td-input__inner").then(a=>{if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}h.error("输入框不可见，不输入密码"),a.value=e.accessCode,d.dispatchEvent(a,"input"),d.dispatchEvent(a,"change"),setTimeout(()=>{document.querySelector("#__layout div.pass-input-wrap button.td-button").click();},500);}),d.waitNode("#__layout div.pass-wrapper input.td-input__inner").then(a=>{if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}h.error("输入框不可见，不输入密码"),a.value=e.accessCode,d.dispatchEvent(a,"input"),d.dispatchEvent(a,"change"),setTimeout(()=>{document.querySelector("#__layout div.pass-wrapper button.td-button").click();},500);}));},vt=function(e){window.location.hostname==="pan.quark.cn"&&(h.success(["自动填写链接",e]),d.waitNode("#ice-container input.ant-input[class*=ShareReceive]").then(a=>{if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),xe.waitReactPropsToSet(a,"reactProps",{check(n){return (n==null?void 0:n.onChange)==="function"},set(n){n.onChange({target:{value:e.accessCode}});}}),xe.waitReactPropsToSet(a,"reactEventHandlers",{check(n){return (n==null?void 0:n.onChange)==="function"},set(n){n.onChange({target:{value:e.accessCode}});}});}));},bt=function(e){h.success(["自动填写链接",e]),d.waitNode("#passcode").then(a=>{if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),a.value=e.accessCode,d.dispatchEvent(a,"input"),document.querySelector("#main-content .form-group button.btn[type=button]").click();});},Rt=function(e){window.location.hostname==="115.com"&&(h.success(["自动填写链接",e]),d.waitNode("input.text").then(a=>{if(!d.isVisible(a)){h.error("输入框不可见，不输入密码");return}f.success("自动填入访问码"),a.value=e.accessCode,d.dispatchEvent(a,"input"),document.querySelector("#js-share_code div.form-decode div.submit a").click();}));},Ce={key:"tempNetDiskInfo",$data:{netDiskInfo:null,get enable(){return g.function.autoFillAccessCode.value}},init(){if(this.$data.netDiskInfo=this.getValue(),!!this.$data.netDiskInfo&&this.$data.enable&&!d.isNull(this.$data.netDiskInfo.accessCode)){if(this.$data.netDiskInfo.netDiskName==="baidu"&&this.$data.netDiskInfo.shareCode.startsWith("1")){if(!window.location.href.includes(this.$data.netDiskInfo.shareCode.slice(1,this.$data.netDiskInfo.shareCode.length)))return}else if(!window.location.href.includes(this.$data.netDiskInfo.shareCode))return;if(this.$data.netDiskInfo.netDiskName in Ce.netDisk){let e=Ce.netDisk[this.$data.netDiskInfo.netDiskName];typeof e=="function"?e(this.$data.netDiskInfo):h.warn("自动填写访问码失败："+this.$data.netDiskInfo.netDiskName+"，原因：该网盘未适配");}else h.error("网盘名未找到，跳过自动填写："+this.$data.netDiskInfo);}},netDisk:{baidu:ft,lanzou:mt,tianyiyun:gt,hecaiyun:wt,aliyun:kt,wenshushu:()=>{},nainiu:()=>{},_123pan:yt,weiyun:xt,xunlei:Ct,_115pan:Rt,chengtong:bt,kuake:vt,jianguoyun:()=>{},onedrive:()=>{}},setValue(e){z(this.key,e);},getValue(){return O(this.key)}},At=function(){},P={matchRange_text:{before(e,a=20){const n=A(L.matchRange_text.before(e),a);return parseInt(n.value.toString())},after(e,a=10){const n=A(L.matchRange_text.after(e),a);return parseInt(n.value.toString())}},matchRange_html:{before(e,a=100){const n=A(L.matchRange_html.before(e),a);return parseInt(n.value.toString())},after(e,a=15){const n=A(L.matchRange_html.after(e),a);return parseInt(n.value.toString())}},function:{enable(e,a=!0){return !!A(L.function.enable(e),a).value},linkClickMode(e,a="copy"){return A(L.function.linkClickMode(e),a).value},checkLinkValidity(e,a=!1){return !!A(L.function.checkLinkValidity(e),a).value}},linkClickMode_openBlank:{openBlankWithCopyAccessCode(e,a=!1){return !!A(L.linkClickMode_openBlank.openBlankWithCopyAccessCode(e),a).value}},schemeUri:{enable(e,a=!1){return !!A(L.schemeUri.enable(e),a).value},isForwardLinearChain(e,a=!1){return !!A(L.schemeUri.isForwardLinearChain(e),a).value},isForwardBlankLink(e,a=!1){return !!A(L.schemeUri.isForwardBlankLink(e),a).value},uri(e,a=""){return A(L.schemeUri.uri(e),a).value}}},Se="(123pan|123865|123684|123652|123912).com",Ye={rule:[{link_innerText:`${Se}/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)`,link_innerHTML:`${Se}/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)`,shareCode:new RegExp(`${Se}/s/([a-zA-Z0-9_-]{8,14})`,"gi"),shareCodeNeedRemoveStr:new RegExp(`${Se}/s/`,"gi"),checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"123pan.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://123pan.com/s/{#shareCode#}",copyUrl:`https://123pan.com/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"123盘",key:"_123pan",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0},parseFile:{enable:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardLinearChain:!0,isForwardBlankLink:!0,uri:""}}}},Ge={KEY:"_123pan_User_Authorization",set(e){z(this.KEY,e);},get(){return O(this.KEY)}},St=function(){if(window.location.hostname!=="www.123pan.com"||P.function.linkClickMode(Ye.setting.key)!=="parseFile")return;let e=Q.localStorage.getItem("authorToken");d.isNull(e)||(e=e.replace(/^\"/,"").replace(/\"$/,""),h.success("获取123网盘已登录用户的authorToken值👇"),h.success(e),Ge.set(e));},Fe={init(){Object.keys(Fe.netDisk).forEach(e=>{this.netDisk[e]();});},netDisk:{_123pan:St,lanzouyx:At}},D={protocol:"jumpwsv",pathname:"go",parseDataToSchemeUri(e,a){if(!P.schemeUri.enable(e))return a;let t=P.schemeUri.uri(e);return d.isNull(t)&&(t=this.getSchemeUri(this.get1DMSchemeUriOption(a))),t.startsWith(this.protocol)&&(a=a.replace(/&/g,"{-and-}"),a=a.replace(/#/g,"{-number-}")),t=U.replaceParam(t,{intentData:a}),t},isForwardDownloadLink(e){return P.schemeUri.isForwardLinearChain(e)},isForwardBlankLink(e){return P.schemeUri.isForwardBlankLink(e)},getSchemeUri(e){return `${this.protocol}://${this.pathname}?package=${e.package}&activity=${e.activity}&intentAction=${e.intentAction}&intentData=${e.intentData}&intentExtra=${e.intentExtra}`},get1DMSchemeUriOption(e=""){return {package:"idm.internet.download.manager.plus",activity:"idm.internet.download.manager.UrlHandlerDownloader",intentAction:"android.intent.action.VIEW",intentData:e,intentExtra:""}}};class se{constructor(){F(this,"netDiskIndex",0);F(this,"shareCode","");F(this,"accessCode","");}}class _t extends se{constructor(){super(...arguments);F(this,"panelList",[]);F(this,"Authorization","");F(this,"code",{5113:"您今日下载流量已超出10GB限制，购买VIP会员即可体验无限流量下载",5103:"分享码错误或者分享地址错误",5104:"分享已过期","-1000":"获取出错","-2000":"请求异常","-3000":"请求意外中止","-4000":"请求超时",104:"文件已失效"});}async init(n,t,i){const s=this;if(h.info([n,t,i]),s.netDiskIndex=n,s.shareCode=t,s.accessCode=i,s.panelList=[],s.Authorization=Ge.get(),!await s.checkLinkValidity())return;let o=await s.getFiles();if(o)if(o.length===1&&o[0].Type==0){let l=o[0];if(l.Status==104){f.error("文件已失效");return}let c=l.DownloadUrl,u="";if(c===""){let w=await s.getFileDownloadInfo(l.Etag,l.FileId,l.S3KeyFlag,s.shareCode,l.Size);w&&w.code===0?(c=w.data.DownloadURL,D.isForwardDownloadLink("_123pan")&&(c=D.parseDataToSchemeUri("_123pan",c)),u=d.formatByteToSize(l.Size)):w&&w.code===401?(c="javascript:;",u="请登录后下载"):(c="javascript:;",u="获取下载链接失败");}else D.isForwardDownloadLink("_123pan")&&(c=D.parseDataToSchemeUri("_123pan",c)),u=d.formatByteToSize(l.Size);let p=new Date(l.CreateAt).getTime(),m=new Date(l.UpdateAt).getTime();p=d.formatTime(p),m=d.formatTime(m),k.staticView.oneFile({title:"123盘单文件直链",fileName:l.FileName,fileSize:u,downloadUrl:c,fileUploadTime:p,fileLatestTime:m});}else {f.info("正在递归文件");let l=f.loading("正在解析多文件中，请稍后..."),c=s.getFolderInfo(o,0);l.close(),h.info("递归完毕"),k.staticView.moreFile("123盘文件解析",c);}}async checkLinkValidity(){const n=this;f.info("正在校验链接有效性");let t=`https://www.123pan.com/s/${n.shareCode}`,i=await C.get({url:t,headers:{"User-Agent":d.getRandomPCUA(),Referer:"https://www.123pan.com"}});if(h.info(i),!i.status)return !1;let r=i.data.responseText.match(/window.g_initialProps[\s]*=[\s]*\{(.+?)\};/s);if(r){h.info(r);let o=d.toJSON(`{${r[r.length-1]}}`);if(h.info(o),o.res.code!==0)return f.error(o.res.message),!1;if(o.res.data.HasPwd&&(n.accessCode==null||n.accessCode===""))f.error("密码缺失!"),k.newAccessCodeView("密码缺失","_123pan",n.netDiskIndex,n.shareCode,n.accessCode,c=>{n.init(n.netDiskIndex,n.shareCode,c);});else return !0}else f.error("校验链接-获取初始化内容失败");}async getFiles(n=0){const t=this,i={limit:100,next:1,orderBy:"share_id",orderDirection:"desc",shareKey:t.shareCode,SharePwd:t.accessCode,ParentFileId:n,Page:1};let s=`https://www.123pan.com/b/api/share/get?${d.toSearchParamsStr(i)}`,r=await C.get({url:s,headers:{Accept:"*/*","User-Agent":d.getRandomPCUA(),Referer:`https://www.123pan.com/s/${t.shareCode}`}});if(h.info(r),!r.status)return;let o=r.data,l=d.toJSON(o.responseText);if(l.code===0)return l.data.InfoList;l.code===5103?k.newAccessCodeView(void 0,"_123pan",t.netDiskIndex,t.shareCode,t.accessCode,c=>{t.init(t.netDiskIndex,t.shareCode,c);}):t.code[l.code]?f.error(t.code[l.code]):"message"in l?f.error(l.message):f.error("123盘：未知的JSON格式");}async getFilesByRec(n){const t=this;let i=await C.get({url:`https://www.123pan.com/b/api/share/get?limit=100&next=1&orderBy=share_id&orderDirection=desc&shareKey=${t.shareCode}&SharePwd=${t.accessCode}&ParentFileId=${n}&Page=1`,headers:{Accept:"*/*","User-Agent":d.getRandomAndroidUA(),Referer:`https://www.123pan.com/s/${t.shareCode}`}});if(!i.status)return;let s=i.data;h.info(s);let r=d.toJSON(s.responseText);if(r.code==0)return r.data.InfoList}getFolderInfo(n,t){const i=this;let s=[],r=[],o=[];return n.forEach(l=>{l.Type?r.push({fileName:l.FileName,fileSize:0,fileType:"",createTime:new Date(l.CreateAt).getTime(),latestTime:new Date(l.UpdateAt).getTime(),isFolder:!0,index:t,async clickEvent(){let c=await i.getFilesByRec(l.FileId);return c?i.getFolderInfo(c,t+1):[]}}):o.push({fileName:l.FileName,fileSize:l.Size,fileType:"",createTime:new Date(l.CreateAt).getTime(),latestTime:new Date(l.UpdateAt).getTime(),isFolder:!1,index:t,async clickEvent(){if(l.Status==104)f.error("文件已失效");else if(l.DownloadUrl){let c=l.DownloadUrl;return D.isForwardDownloadLink("_123pan")&&(c=D.parseDataToSchemeUri("_123pan",c)),{url:c,autoDownload:!0,mode:"aBlank"}}else {let c=await i.getFileDownloadInfo(l.Etag,l.FileId,l.S3KeyFlag,i.shareCode,l.Size);if(c&&c.code===0)return {url:c.data.DownloadURL,autoDownload:!0,mode:"aBlank"};c&&c.code===401?f.error("请登录后下载"):f.error("获取下载链接失败");}}});}),r.sort((l,c)=>l.fileName.localeCompare(c.fileName)),o.sort((l,c)=>l.fileName.localeCompare(c.fileName)),s=s.concat(r),s=s.concat(o),s}async getFileDownloadInfo(n,t,i,s,r){const o=this;let l=o.getFileDownloadAuth(),c={"App-Version":"3",Platform:"web","Content-Type":"application/json;charset=UTF-8",Host:"www.123pan.com",Accept:"*/*","User-Agent":d.getRandomPCUA(),Referer:"https://www.123pan.com/s/"+s,Origin:"https://www.123pan.com"};o.Authorization&&Reflect.set(c,"Authorization","Bearer "+o.Authorization),h.success("获取下载链接加密参数："+l);let u=await C.post({url:`https://www.123pan.com/a/api/share/download/info?${l[0]}=${l[1]}`,data:JSON.stringify({Etag:n,FileID:t,S3keyFlag:i,ShareKey:s,Size:r}),responseType:"json",headers:c});if(!u.status)return;let p=u.data,m=d.toJSON(p.responseText);return h.info(m),m.code==0?(m.data.DownloadURL=await o.decodeDownloadUrl(m.data.DownloadURL),m):{code:m.code}}getFileDownloadAuth(){function n(s){var r,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8;if(arguments.length!==0){typeof s=="object"?r=s:((""+s).length===10&&(s=1e3*parseInt(s)),r=new Date(s));var l=s+6e4*new Date(s).getTimezoneOffset(),c=l+36e5*o;return r=new Date(c),{y:r.getFullYear(),m:r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1,d:r.getDate()<10?"0"+r.getDate():r.getDate(),h:r.getHours()<10?"0"+r.getHours():r.getHours(),f:r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes()}}}function t(s){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,o=function(){for(var m,w=[],y=0;y<256;y++){m=y;for(var R=0;R<8;R++)m=1&m?3988292384^m>>>1:m>>>1;w[y]=m;}return w},l=o(),c=s,u=-1,p=0;p<c.length;p++)u=u>>>8^l[255&(u^c.charCodeAt(p))];return u=(-1^u)>>>0,u.toString(r)}function i(s){var r="web",o=3,l=Math.round((new Date().getTime()+60*new Date().getTimezoneOffset()*1e3+288e5)/1e3).toString(),c="a,d,e,f,g,h,l,m,y,i,j,n,o,p,k,q,r,s,t,u,b,c,v,w,s,z",u=Math.round(1e7*Math.random()),p,m,w,y,R,N,S,W,V;for(var H in p=c.split(","),m=n(l),w=m.y,y=m.m,R=m.d,N=m.h,S=m.f,W=[w,y,R,N,S].join(""),V=[],W)V.push(p[Number(W[H])]);var T,M;return T=t(V.join("")),M=t("".concat(l,"|").concat(u,"|").concat(s,"|").concat(r,"|").concat(o,"|").concat(T)),[T,"".concat(l,"-").concat(u,"-").concat(M)]}return i("/a/api/share/download/info")}async decodeDownloadUrl(n){const t=this;if(n==="")return "";let s=new URL(n).search.replace(/^\?params=/gi,"");s=s.split("&")[0];try{let r=decodeURI(atob(s));h.info("正在获取重定向直链"),f.info("正在获取重定向直链");let o=await C.get({url:r,responseType:"json",headers:{"User-Agent":d.getRandomAndroidUA(),Referer:"https://www.123pan.com/s/"+t.shareCode,Origin:"https://www.123pan.com"},allowInterceptConfig:!1,onerror:function(){}});if(h.info(o),!o.status&&o.data.status!==210){let p=new URL(r);return p.searchParams.has("auto_redirect")?(p.searchParams.set("auto_redirect","1"),p.toString()):r}let l=o.data,c=d.toJSON(l.responseText),u=new URL(c.data.redirect_url);return u.searchParams.set("auto_redirect","1"),h.success(c),u.toString()}catch(r){return h.error(r),n}}}class Tt extends se{constructor(){super(...arguments);F(this,"X_Share_Token_Data",{expire_time:"2000-01-01T00:00:00.000Z",expires_in:7200,share_token:""});F(this,"X_Device_Id",null);F(this,"X_Canary","client=web,app=share,version=v2.3.1");}async init(n,t,i){const s=this;if(h.info([n,t,i]),s.netDiskIndex=n,s.shareCode=t,s.accessCode=i,s.X_Device_Id=s.get_X_Device_Id(),h.info("生成X_Device_Id："+s.X_Device_Id),globalThis.location.hostname!=="www.aliyundrive.com"&&globalThis.location.hostname!=="www.alipan.com"){let c=J.getBlankUrl("aliyun",s.netDiskIndex,s.shareCode,s.accessCode),u=f.error(`请在阿里云盘页面解析，<a href="${c}">点我前往</a>`,{html:!0,timeout:1e4});v.on(u.$Qmsg.querySelector("a[href]"),"click",void 0,p=>{d.preventEvent(p),oe.openBlank(c,"aliyun",s.netDiskIndex,s.shareCode,s.accessCode);});return}let r=await this.list_by_share(t,"root");if(!r)return;f.info("正在解析链接");let o=f.loading("正在解析多文件中，请稍后..."),l=s.getFolderInfo(r,0);o.close(),h.info("解析完毕"),k.staticView.moreFile("阿里云盘文件解析",l);}getFolderInfo(n,t=0){const i=this;let s=[],r=[],o=[];return n.forEach(l=>{l.type!=="folder"?o.push({fileName:l.name,fileSize:l.size,fileType:l.file_extension,createTime:new Date(l.created_at).getTime(),latestTime:new Date(l.updated_at).getTime(),isFolder:!1,index:t,async clickEvent(){let c=await i.get_share_link_download_url(l.share_id,l.file_id);if(!c)return;let u=c;return D.isForwardDownloadLink("aliyun")&&(u=D.parseDataToSchemeUri("aliyun",u)),{autoDownload:!0,mode:"aBlank",url:u}}}):r.push({fileName:l.name,fileSize:0,fileType:"",createTime:l.created_at,latestTime:l.updated_at,isFolder:!0,index:t,async clickEvent(){let c=await i.list_by_share(l.share_id,l.file_id);return c?i.getFolderInfo(c,t+1):[]}});}),r.sort((l,c)=>l.fileName.localeCompare(c.fileName)),o.sort((l,c)=>l.fileName.localeCompare(c.fileName)),s=s.concat(r),s=s.concat(o),h.info(["getFilesInfoByRec",s]),s}async list_by_share(n,t,i="name",s="DESC"){const r=this;let o=await C.post("https://api.aliyundrive.com/adrive/v2/file/list_by_share",{data:JSON.stringify({share_id:n,parent_file_id:t,limit:20,image_thumbnail_process:"image/resize,w_256/format,jpeg",image_url_process:"image/resize,w_1920/format,jpeg/interlace,1",video_thumbnail_process:"video/snapshot,t_1000,f_jpg,ar_auto,w_256",order_by:i,order_direction:s}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Origin:"https://www.aliyundrive.com",Referer:"https://www.aliyundrive.com/","X-Canary":r.X_Canary,"X-Device-Id":r.X_Device_Id,"X-Share-Token":await r.get_X_Share_Token(r.shareCode,r.accessCode),"User-Agent":d.getRandomPCUA()},allowInterceptConfig:!1,onerror(){}});if(!o.status){r.handle_request_error(o);return}let l=d.toJSON(o.data.responseText);return h.info(["列出文件列表：",l]),l.items}async get_share_link_download_url(n,t){const i=this;let s=await C.post("https://api.aliyundrive.com/v2/file/get_share_link_download_url",{data:JSON.stringify({expire_sec:600,file_id:t,share_id:n}),headers:{Accept:"application/json, text/plain, */*",Origin:"https://www.aliyundrive.com",Referer:"https://www.aliyundrive.com/","Content-Type":"application/json;charset=UTF-8",Authorization:"Bearer "+i.getAuthorization(),"X-Share-Token":await i.get_X_Share_Token(i.shareCode,i.accessCode),"User-Agent":d.getRandomPCUA()},allowInterceptConfig:!1,onerror(){}});if(!s.status){i.handle_request_error(s);return}let r=d.toJSON(s.data.responseText);return h.info(["获取文件的下载链接：",r]),r.download_url}handle_request_error(n){h.error(n);let t=d.toJSON(n.data.responseText);f.error(t.message);}getAuthorization(){let n=Q.localStorage.getItem("token");if(d.isNotNull(n)&&n!=null){let i=d.toJSON(n).access_token;return h.success(["获取阿里云盘的access_token：",i]),i}else h.error("获取access_token失败，请先登录账号！"),f.error("获取access_token失败，请先登录账号！");}async get_X_Share_Token(n,t){const i=this;if(new Date<new Date(i.X_Share_Token_Data.expire_time))return i.X_Share_Token_Data.share_token;let s=await C.post("https://api.aliyundrive.com/v2/share_link/get_share_token",{data:JSON.stringify({share_id:n,share_pwd:t}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Origin:"https://www.aliyundrive.com",Referer:"https://www.aliyundrive.com/","X-Canary":i.X_Canary,"X-Device-Id":i.X_Device_Id,"User-Agent":d.getRandomPCUA()},allowInterceptConfig:!1,onerror(){}});if(!s.status){i.handle_request_error(s);return}let r=d.toJSON(s.data.responseText);return i.X_Share_Token_Data=r,h.info(["获取share_token：",i.X_Share_Token_Data]),i.X_Share_Token_Data.share_token}get_X_Device_Id(){for(var n=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,t=[],i=0;i<256;++i)t.push((i+256).toString(16).substr(1));function s(){return crypto.getRandomValues(new Uint8Array(16))}var r=function(l){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,u=(t[l[c+0]]+t[l[c+1]]+t[l[c+2]]+t[l[c+3]]+"-"+t[l[c+4]]+t[l[c+5]]+"-"+t[l[c+6]]+t[l[c+7]]+"-"+t[l[c+8]]+t[l[c+9]]+"-"+t[l[c+10]]+t[l[c+11]]+t[l[c+12]]+t[l[c+13]]+t[l[c+14]]+t[l[c+15]]).toLowerCase();if(!function(p){return typeof p=="string"&&n.test(p)}(u))throw TypeError("Stringified UUID is invalid");return u},o=function(l,c,u){var p=(l=l||{}).random||(l.rng||s)();return p[6]=15&p[6]|64,p[8]=63&p[8]|128,r(p)};return o()}}class Dt extends se{init(a,n,t){h.info([a,n,t]),this.netDiskIndex=a,this.shareCode=n,this.accessCode=t;let i=O("baidu-baiduwp-php-url"),s=O("baidu-baiduwp-php-post-form"),r=O("baidu-baiduwp-php-copy-url");if(!i){f.error("请先在设置中配置百度网盘-网址");return}if(!s){f.error("请先在设置中配置百度网盘-表单参数");return}s=U.replaceParam(s,{shareCode:n,accessCode:t});let o=document.createElement("form"),l={},c=new URLSearchParams(s);o.action=i,o.method="post",o.style.display="none",o.target="_blank";for(let[u,p]of c){let m=document.createElement("textarea");m.name=u,m.value=p,o.appendChild(m),l[u]=p;}h.info(["表单数据",l]),document.body.appendChild(o),h.info(["访问网址",i]),r?(oe.copy("baidu",a,n,t,"1.5秒后跳转至解析站"),setTimeout(()=>{o.submit();},1500)):o.submit();}}class Mt extends se{constructor(){super(...arguments);F(this,"errorCode",{UnAuthorized:"请先登录坚果云账号"});}async init(n,t,i){const s=this;h.info([n,t,i]),s.netDiskIndex=n,s.shareCode=t,s.accessCode=i;let r=await s.getRequestDownloadParams();if(r)if(r.isdir){let o=f.loading("正在遍历多文件信息..."),l=await s.getFolderInfo(r.hash);if(!l){o.close();return}let c=s.parseMoreFile(l,r.hash,r.name);o.close(),k.staticView.moreFile("坚果云文件解析",c);}else {let o=d.formatByteToSize(r.size),l=await s.getFileLink(r.hash,r.name);if(!l)return;D.isForwardDownloadLink("jianguoyun")&&(l=D.parseDataToSchemeUri("jianguoyun",l)),h.info(l),k.staticView.oneFile({title:"坚果云盘单文件直链",fileName:r.name,fileSize:o,downloadUrl:l});}}parseMoreFile(n,t="",i=""){const s=this;h.info(["解析多文件信息",n]);let r=[];return n.forEach(o=>{let l=o.relPath;l.startsWith("/")&&(l=l.replace(/^\//,"")),r.push({fileName:l,fileSize:o.size,fileType:"",createTime:o.mtime,latestTime:o.mtime,isFolder:!1,index:0,async clickEvent(){f.info("正在获取下载链接...");let c=await s.getDirLink(t,l,o.relPath);if(c)return f.success("获取成功！"),D.isForwardDownloadLink("jianguoyun")&&(c=D.parseDataToSchemeUri("jianguoyun",c)),h.info(c),{autoDownload:!0,mode:"aBlank",url:c}}});}),r}async getRequestDownloadParams(){const n=this;h.info("获取hash值"),f.info("正在获取请求信息");let t=/var[\s]*PageInfo[\s]*=[\s]*{([\s\S]+)};/i;new FormData().append("pd",n.accessCode);let s={url:`https://www.jianguoyun.com/p/${n.shareCode}`,data:n.accessCode===""?void 0:`pd=${n.accessCode}`,responseType:"html",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Agent":d.getRandomPCUA(),Referer:`https://www.jianguoyun.com/p/${n.shareCode}`}},r;if(n.accessCode===""?r=await C.get(s):r=await C.post(s),!r.status)return;let o=r.data;h.info("请求信息"),h.info(o);let l=o.responseText.match(t);if(l){let c=l[l.length-1];c=`({${c}})`,c=window.eval(c),h.info(c);let u=c.name,p=c.size,m=c.hash,w=c.needsPassword,y=c.owner,R=c.isdir,N=c.errorCode;if(u=decodeURIComponent(u),h.success("是否是文件夹 ===> "+R),h.success("hash ===> "+m),h.success("name ===> "+u),h.success("size ===> "+p),w&&(n.accessCode==null||n.accessCode==="")){f.error("密码不正确!"),k.newAccessCodeView("密码缺失","jianguoyun",n.netDiskIndex,n.shareCode,n.accessCode,S=>{n.init(n.netDiskIndex,n.shareCode,S);});return}if(N==="AuthenticationFailed"){f.error("密码错误"),k.newAccessCodeView(void 0,"jianguoyun",n.netDiskIndex,n.shareCode,n.accessCode,S=>{n.init(n.netDiskIndex,n.shareCode,S);});return}if(m===""||m==null){h.error("hash为空，可能文件被撤销分享了"),f.error("文件分享已被撤销");return}if(p==null&&R==!1){h.error("无size，可能文件被删除了"),f.error(`“${u}”文件已被拥有者（“${y}”）删除`);return}else return {name:u,hash:m,size:p,needsPassword:w,owner:y,isdir:R}}else o.responseText.match("对不起，找不到您指定的文件。")?(h.error("啊噢！ (404) 对不起，找不到您指定的文件。"),f.error("坚果云: 对不起，找不到您指定的文件。")):o.responseText.match("对不起，您的某些输入不正确。")?(h.error("可能该链接不需要访问码或者访问码有问题"),k.newAccessCodeView(void 0,"jianguoyun",n.netDiskIndex,n.shareCode,n.accessCode,c=>{n.init(n.netDiskIndex,n.shareCode,c);})):(h.error("获取PageInfo失败"),f.error("坚果云: 获取PageInfo失败"));}async getFileLink(n="",t=""){var l;const i=this;t=encodeURIComponent(t);let s=await C.get({url:`https://www.jianguoyun.com/d/ajax/fileops/pubFileLink?k=${n}&name=${t}&wm=false${i.accessCode===""?"":"&pd="+i.accessCode}&forwin=1&_=${new Date().getTime()}`,responseType:"json",headers:{"User-Agent":d.getRandomPCUA()},allowInterceptConfig:!1,onerror:function(){}});if(!s.status){if(d.isNotNull((l=s.data)==null?void 0:l.responseText)){let c=d.toJSON(s.data.responseText);h.error(["坚果云",c]),c.errorCode==="UnAuthorized"?i.gotoLogin():f.error(c.detailMsg);}else f.error("请求异常");return}let r=s.data;h.info(["请求信息",r]);let o=d.toJSON(r.responseText);if(h.info(["解析JSON",o]),o.hasOwnProperty("errorCode")){f.error("坚果云: "+o.detailMsg);return}else {if(o.hasOwnProperty("url"))return o.url;f.error("坚果云: 处理下载链接异常");}}async getDirLink(n="",t="",i="/"){var c;const s=this;t=encodeURIComponent(t);let r=await C.get({url:`https://www.jianguoyun.com/d/ajax/dirops/pubDIRLink?k=${n}&dn=${t}&p=${i}&forwin=1&_=${new Date().getTime()}`,responseType:"json",headers:{"User-Agent":d.getRandomPCUA()},allowInterceptConfig:!1,onerror:function(){}});if(!r.status){if(d.isNotNull((c=r.data)==null?void 0:c.responseText)){let u=d.toJSON(r.data.responseText);h.error(["坚果云",u]),u.errorCode==="UnAuthorized"?s.gotoLogin():f.error(u.detailMsg);}else f.error("请求异常");return}let o=r.data;h.info(["请求信息",o]);let l=d.toJSON(o.responseText);if(h.info(l),l.hasOwnProperty("errorCode")){f.error("坚果云: "+l.detailMsg);return}else {if(l.hasOwnProperty("url"))return l.url;f.error("坚果云: 处理下载链接异常");}}async getFolderInfo(n=""){let t=await C.get({url:`https://www.jianguoyun.com/d/ajax/dirops/pubDIRBrowse?hash=${n}&relPath=%2F&_=${new Date().getTime()}`,responseType:"json",headers:{"User-Agent":d.getRandomPCUA()}});if(!t.status)return;let i=t.data;h.info(["请求信息",i]);let s=d.toJSON(i.responseText);if(h.info(s),"objects"in s)return s.objects;f.error("坚果云: 处理多文件信息异常");}gotoLogin(){Z.confirm({title:{text:"提示",position:"center"},content:{text:"解析失败，原因：当前尚未登录坚果云，是否前往登录？"},btn:{reverse:!0,position:"end",ok:{text:"前往",callback:function(n){window.open("https://www.jianguoyun.com/d/login#from=https%3A%2F%2Fwww.jianguoyun.com%2F","_blank");}}}},k.popsStyle.jianGuoYunLoginTip);}}const ee={DEFAULT_HOST_NAME:"www.lanzout.com",MENU_KEY:"lanzou-host-name",get hostname(){return A(this.MENU_KEY,this.DEFAULT_HOST_NAME).value}};class Lt extends se{constructor(){super(...arguments);F(this,"router",{default(n=""){return n.startsWith("/")&&(n=n.replace(/^\//,"")),`https://${ee.hostname}/${n}`},tp(n=""){return n.startsWith("/")&&(n=n.replace(/^\//,"")),`https://${ee.hostname}/tp/${n}`},s(n=""){return n.startsWith("/")&&(n=n.replace(/^\//,"")),`https://${ee.hostname}/s/${n}`}});F(this,"regexp",{unicode:{match:/[%\u4e00-\u9fa5]+/g,tip:"中文链接",isUnicode:!1},noFile:{match:/div>来晚啦...文件取消分享了<\/div>/g,tip:"来晚啦...文件取消分享了"},noExists:{match:/div>文件不存在，或已删除<\/div>/g,tip:"文件不存在，或已删除"},needVipToShare:{match:/class="fbox">非会员.+请先开通会员/gi,tip:"该链接为非会员用户分享的文件，目前无法下载"},moreFile:{match:/<span id=\"filemore\" onclick=\"more\(\);\">/g},sign:{match:/var[\s]*(posign|postsign|vidksek|skdklds)[\s]*=[\s]*'(.+?)';/},fileName:{match:/<title>(.*)<\/title>/},fileSize:{match:/<span class=\"mtt\">\((.*)\)<\/span>/},loadDownHost:{match:/var[\s]*(vkjxld)[\s]*=[\s]*'(.+?)'/i},loadDown:{match:/var[\s]*(loaddown|oreferr|spototo|domianload|hyggid)[\s]*=[\s]*'(.+?)'/i},appleDown:{match:/var[\s]*appitem[\s]*=[\s]*'(.+?)'/i},uploadTime:{match:/mt2\"\>时间:<\/span>(.+?)[\s]*<span/i}});}async init(n,t,i){h.info([n,t,i]),this.netDiskIndex=n,this.shareCode=t,this.accessCode=i,this.regexp.unicode.isUnicode=!!this.shareCode.match(this.regexp.unicode.match),n===2?await this.getMoreFile(this.router.s(this.shareCode)):await this.getFileLink();}async getFileLink(n=!1){var o,l,c,u,p,m,w,y,R;const t=this;let i=this.router.default(this.shareCode);h.info("蓝奏云-获取文件下载链接"+i);let s=await C.get({url:i,headers:{Accept:"*/*","User-Agent":d.getRandomPCUA(),Referer:i},allowInterceptConfig:!1,onerror(){}});if(!s.status){if(h.error(s),s.type==="ontimeout")return;if(d.isNull(s.data.responseText)){f.error("请求异常");return}s.data.responseText.includes("div>文件不存在，或者已被删除</div>")?f.error("文件不存在，或者已被删除"):f.error("未知情况");return}let r=s.data;if(r.readyState!==4){h.error(r),f.error("请求失败，请重试");return}if(r.responseText==null){h.error(r),f.error("获取网页内容为空");return}if(t.checkPageCode(r))if(t.isMoreFile(r))await t.getMoreFile();else {h.info(r);let N=r.responseText;if(n){let V=N.match(/var[\s]*link[\s]*=[\s]*\'tp\/(.+?)\';/i);t.shareCode=V[V.length-1],h.info(`新参数 => ${t.shareCode}`);}let S=v.parseHTML(N,!0,!0),W=S.querySelector('iframe[class^="ifr"]')||S.querySelector('iframe[class^="n_downlink"]');if(W){let V=W.getAttribute("src");h.error(["该链接需要重新通过iframe地址访问获取信息",V]),f.info("正在请求下载信息");let H=((o=S.querySelector("body div.d > div"))==null?void 0:o.innerText)||((l=S.querySelector("#filenajax"))==null?void 0:l.innerText)||((u=(c=S.querySelector("title"))==null?void 0:c.textContent)==null?void 0:u.replace(/ - 蓝奏云$/i,"")),T=N.match(/文件大小：<\/span>(.+?)<br>/i)||((p=S.querySelector("div.n_box div.n_file div.n_filesize"))==null?void 0:p.innerText)||((m=S.querySelector(".d2 table tr td .fileinfo:nth-child(1) .fileinforight"))==null?void 0:m.innerText),M=N.match(/上传时间：<\/span>(.+?)<br>/i)||((w=S.querySelector("#file[class=''] .n_file_info span.n_file_infos"))==null?void 0:w.innerText)||((y=S.querySelector(".d2 table tr td .fileinfo:nth-child(3) .fileinforight"))==null?void 0:y.innerText)||((R=S.querySelector("#file[class='filter'] .n_file_info span.n_file_infos"))==null?void 0:R.innerText);T?(Array.isArray(T)&&(T=T[T.length-1]),typeof T=="string"&&(T=T.replaceAll("大小：",""))):h.error("解析文件大小信息失败"),M?(Array.isArray(M)&&(M=M[M.length-1]),M.toString().toLowerCase().startsWith("android")&&(h.error("解析出的文件上传时间信息是Android/xxxx开头"),M=void 0)):h.error("解析文件上传时间信息失败");let E=await t.getLinkByIframe(V,{fileName:H,fileSize:T,fileUploadTime:M});E&&(D.isForwardDownloadLink("lanzou")&&(E=D.parseDataToSchemeUri("lanzou",E)),k.staticView.oneFile({title:"蓝奏云单文件直链",fileName:H,fileSize:T,downloadUrl:E,fileUploadTime:M}));}else await t.getLink(r);}}checkPageCode(n){const t=this;let i=n.responseText;return i.match(t.regexp.noFile.match)?(f.error(t.regexp.noFile.tip),!1):i.match(t.regexp.noExists.match)?(f.error(t.regexp.noExists.tip),!1):i.match(t.regexp.needVipToShare.match)?(f.error(t.regexp.needVipToShare.tip),!1):!0}isMoreFile(n){const t=this;return n.responseText.match(t.regexp.moreFile.match)?(h.info("该链接为多文件"),!0):(h.info("该链接为单文件"),!1)}async getLink(n){const t=this;let i=n.responseText;if(i==null){h.error("shareCode错误，重新从页面中获取"),await t.getFileLink(!0);return}let s=i.match(t.regexp.sign.match),r="",o="",l=i.match(t.regexp.fileName.match),c=i.match(t.regexp.fileSize.match)||i.match(/<div class="n_filesize">大小：(.+?)<\/div>/i),u=i.match(t.regexp.uploadTime.match)||i.match(/<span class="n_file_infos">(.+?)<\/span>/i);if(l?l=l[l.length-1].trim():l="",c?c=c[c.length-1].trim():c="",u&&(u=u[u.length-1].trim()),s){o=s[s.length-1],h.info(`获取Sign: ${o}`),d.isNotNull(t.accessCode)?(h.info("传入参数=>有密码"),r=t.accessCode):h.info("传入参数=>无密码");let p=await C.post({url:t.router.default("ajaxm.php"),responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","User-Agent":d.getRandomAndroidUA(),Referer:t.router.default(t.shareCode)},data:`action=downprocess&sign=${o}&p=${r}`});if(!p.status)return;let m=p.data;if(h.info(m),m.readyState===4){let w=d.toJSON(m.responseText),y=`${w.dom}/file/${w.url}`;typeof w.url=="string"&&(w.url.startsWith("http")||w.url.startsWith(w.dom))&&(y=w.url),w.zt,"密码不正确".indexOf(w.inf)!=-1?(f.error("密码不正确!"),k.newAccessCodeView(void 0,"lanzou",t.netDiskIndex,t.shareCode,t.accessCode,R=>{t.init(t.netDiskIndex,t.shareCode,R);})):(l=w.inf?w.inf:l,y=await J.getRedirectFinalUrl(y,d.getRandomAndroidUA()),h.info(y),D.isForwardDownloadLink("lanzou")&&(y=D.parseDataToSchemeUri("lanzou",y)),k.staticView.oneFile({title:"蓝奏云单文件直链",fileName:l,fileSize:c,downloadUrl:y,fileUploadTime:u}));}else f.error("请求失败，请重试");}else {let p=i.match(t.regexp.loadDownHost.match),m=i.match(t.regexp.loadDown.match),w=i.match(t.regexp.appleDown.match);if(d.isNull(m)&&(m=i.match(/var[\s]*(cppat)[\s]*=[\s]*'(.+?)'/i)),d.isNull(p)&&w&&(w=w[w.length-1],p=[w],m=[""],h.success(["多文件-当前链接猜测为苹果的文件",w])),d.isNull(p)){f.error("蓝奏云直链：获取sign的域名失败，请反馈开发者",{timeout:3500});return}if(d.isNull(m)){f.error("蓝奏云直链：获取sign失败，请反馈开发者",{timeout:3500});return}let y=`${p[p.length-1]}${m[m.length-1]}`;h.info([l,c,y]),y=await J.getRedirectFinalUrl(y,d.getRandomAndroidUA()),h.info(y),D.isForwardDownloadLink("lanzou")&&(y=D.parseDataToSchemeUri("lanzou",y)),k.staticView.oneFile({title:"蓝奏云单文件直链",fileName:l,fileSize:c,downloadUrl:y,fileUploadTime:u});}}async getLinkByIframe(n,t){const i=this;h.info([n,t]);let s=i.router.default(n),r=await C.get({url:s,headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","User-Agent":d.getRandomPCUA(),Referer:i.router.default(i.shareCode)}});if(!r.status)return;let o=r.data;h.info(o);let l=o.responseText,c=l.match(/var[\s]*aihidcms[\s]*=[\s]*'(.*)';/i),u=l.match(/var[\s]*ciucjdsdc[\s]*=[\s]*'(.*)';/i),p=l.match(/var[\s]*ajaxdata[\s]*=[\s]*'(.+)';/i),m=l.match(/'sign':[\s]*'(.+)',/i),w=l.match(/url[\s]*:[\s]*'(.+)'[\s]*,/),y="ajaxm.php",R="",N="",S="",W="";if(w?y=w[w.length-1]:f.error("提取ajaxm.php的具体参数失败，使用默认的"+y),c)R=c[c.length-1];else {f.error("ajaxm.php请求参数 websignkey 获取失败");return}if(u)N=u[u.length-1];else {f.error("ajaxm.php请求参数 websign 获取失败");return}if(p)S=p[p.length-1];else {f.error("ajaxm.php请求参数 signs 获取失败");return}if(m)W=m[m.length-1];else {f.error("ajaxm.php请求参数 sign 获取失败");return}let V={action:"downprocess",signs:S,sign:W,websign:N,websignkey:R,ves:1,kd:1};h.success("请求的路径参数："+w),h.success("ajaxm.php的请求参数-> "+V);let H=await C.post({url:i.router.default(y),headers:{Accept:"application/json, text/javascript, */*","Content-Type":"application/x-www-form-urlencoded",Referer:i.router.default(i.shareCode),"User-Agent":d.getRandomPCUA()},data:d.toSearchParamsStr(V)});if(!H.status)return;let T=H.data;h.info(T);let M=d.toJSON(T.responseText),E=`${M.dom}/file/${M.url}`;if(M.zt,h.success(["直链",E]),"密码不正确".indexOf(M.inf)!=-1)f.error("密码不正确!"),k.newAccessCodeView(void 0,"lanzou",i.netDiskIndex,i.shareCode,i.accessCode,I=>{i.init(i.netDiskIndex,i.shareCode,I);});else return t.fileName=d.isNotNull(M.inf)?M.inf:t.fileName,E=await J.getRedirectFinalUrl(E,d.getRandomAndroidUA()),h.info(E),E}async getMoreFile(n){const t=this;n==null&&(n=t.router.default(t.shareCode));let i=await C.get({url:n,headers:{Accept:"*/*","User-Agent":d.getRandomAndroidUA(),Referer:n}});if(!i.status)return;let s=i.data;if(h.info(s),s.readyState!==4){f.error("请求失败，请重试");return}let r=s.responseText,o=r.match(/\'fid\':(.+?),/)[1].replaceAll("'",""),l=r.match(/\'uid\':(.+?),/)[1].replaceAll("'",""),c=1,u=r.match(/\'t\':(.+?),/)[1],p=new RegExp(u+`[\\s]*=[\\s]*('|")(.+?)('|");`),m=r.match(p)[2],w=r.match(/\'k\':(.+?),/)[1],y=new RegExp(w+`[\\s]*=[\\s]*('|")(.+?)('|");`),R=r.match(y)[2],S=`lx=${t.shareCode.match(t.regexp.unicode.match)?1:2}&fid=${o}&uid=${l}&pg=${c}&rep=0&t=${m}&k=${R}&up=1&ls=1&pwd=${t.accessCode}`;h.info(`多文件请求参数：${S}`);let W=await C.post({url:t.router.default("filemoreajax.php"),responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","User-Agent":d.getRandomAndroidUA(),Referer:n},data:S});if(!W.status)return;let V=W.data;h.info(V);let H=d.toJSON(V.responseText),T=H.zt,M=H.info;if(T===4)f.error(M);else if(T===1){let E=f.loading("获取文件夹成功，解析文件直链中..."),I=H.text,ae=[];h.info(`本链接一共${I.length}个文件`);for(let ne=0;ne<I.length;ne++){let ie=I[ne],ge=ie.id,ve=ie.name_all,Oe=ie.size,st=ie.icon,Ee=ie.time;ae.push({fileName:ve,fileSize:Oe,fileType:st,createTime:Ee,latestTime:Ee,isFolder:!1,index:0,async clickEvent(){let Ae=await t.parseMoreFile(ge,ve,Oe,Ee);if(Ae.success)return {autoDownload:!0,mode:"aBlank",url:Ae.downloadUrl};h.error(["获取下载信息失败：",Ae]),f.error(Ae.msg);}});}E.close(),k.staticView.moreFile("蓝奏云文件解析",ae);}else "密码不正确".indexOf(M)!==-1?(f.error("密码不正确!"),k.newAccessCodeView(void 0,"lanzou",t.netDiskIndex,t.shareCode,t.accessCode,E=>{t.init(t.netDiskIndex,t.shareCode,E);})):"没有了".indexOf(M)!==-1?f.error("没有文件了"):f.error("未知错误");}async parseMoreFile(n,t,i,s){const r=this;let o=await C.get({url:r.router.default(n),headers:{Accept:"*/*","User-Agent":d.getRandomPCUA(),Referer:r.router.default(r.shareCode)}});if(h.info(o),!o.status)return {success:!1,fileName:t,fileSize:i,fileUploadTime:s,msg:`解析失败，${o.msg}`,downloadUrl:void 0};let c=o.data.responseText,u=v.parseHTML(c,!0,!0),p=u.querySelector('iframe[class^="ifr"]')||u.querySelector('iframe[class^="n_downlink"]');if(!p)return {success:!1,fileName:t,fileSize:i,fileUploadTime:s,msg:"解析iframe链接失败",downloadUrl:void 0};let m=p.getAttribute("src");h.error(["该链接需要重新通过iframe地址访问获取信息",m]),f.info("正在请求下载信息");let w=await r.getLinkByIframe(m,{fileName:t,fileSize:i,fileUploadTime:s});return w?(D.isForwardDownloadLink("lanzou")&&(w=D.parseDataToSchemeUri("lanzou",w)),{success:!0,fileName:t,fileSize:i,fileUploadTime:s,msg:"success",downloadUrl:w}):{success:!1,fileName:t,fileSize:i,fileUploadTime:s,msg:"获取下载链接失败",downloadUrl:void 0}}}const _e={LanZouDiskApp:"lanZouY-disk-app",EncryptList:["Y","y","0","Z","z","N","n","M","I","6","m","W","w","1","X","x","L","l","K","7","k","i","U","u","2","V","v","J","j","8","G","g","F","S","s","3","T","t","H","h","f","E","e","D","Q","q","4","R","r","9","d","a","C","c","B","O","o","5","P","p","b","A"],decodeChar(e){for(let a=0;a<this.EncryptList.length;a++)if(e==this.EncryptList[a])return a;return -1},idEncrypt(e){let a=1,n=0;if(e!=""&&e.length>4){let t;e=e.substring(3,e.length-1);for(let i=0;i<e.length;i++)t=e.charAt(e.length-i-1),n+=this.decodeChar(t)*a,a*=62;}return n},encrypt(e){const a=Cryptojs.enc.Utf8.parse(this.LanZouDiskApp),n=Cryptojs.enc.Utf8.parse(e);return Cryptojs.AES.encrypt(n,a,{mode:Cryptojs.mode.ECB,padding:Cryptojs.pad.Pkcs7})},encryptHex(e){return this.encrypt(e,this.LanZouDiskApp).ciphertext.toString().toUpperCase()}};class Nt extends se{constructor(){super(...arguments);F(this,"uuid");F(this,"userId");F(this,"shareCodeId");}async init(n,t,i){var o,l,c,u;const s=this;h.info([n,t,i]),s.netDiskIndex=n,s.shareCode=t,s.accessCode=i,s.shareCodeId=s.getDecodeShareCodeId(t),s.uuid=s.getEncodeUUID();let r=await this.recommendList(3,"Chrome",s.uuid,2,s.getEncodeTimeStamp(),s.shareCodeId,0,1,60);if(r&&r.list.length){if((l=(o=r.list[0])==null?void 0:o.map)!=null&&l.userId)s.userId=(u=(c=r.list[0])==null?void 0:c.map)==null?void 0:u.userId;else {f.error("解析获取【userId】为空");return}if(r.list[0].folderIds==null){h.success("该链接是 单文件");let p=r.list[0].fileList[0],w=await s.parseFolderInfo(r.list[0].fileList,0)[0].clickEvent();if(w&&!Array.isArray(w)){let y=w.url;D.isForwardDownloadLink("lanzouyx")&&(y=D.parseDataToSchemeUri("lanzouyx",y)),k.staticView.oneFile({title:"蓝奏云优享单文件直链",fileName:p.fileName,fileSize:p.fileSize*1024,downloadUrl:y,fileUploadTime:d.formatToTimeStamp(p.updTime),fileLatestTime:d.formatToTimeStamp(p.updTime)});}}else {h.success("该链接是 多文件"),f.info("正在递归文件");let p=f.loading("正在解析多文件中，请稍后..."),m=s.parseFolderInfo(r.list[0].fileList,0);p.close(),h.info("递归完毕"),k.staticView.moreFile("蓝奏云优享解析",m);}}}parseFolderInfo(n,t){const i=this;let s=[],r=[],o=[];return n.forEach(l=>{l.fileType===2?r.push({fileName:l.folderName,fileSize:0,fileType:"",createTime:new Date(l.updTime).getTime(),latestTime:new Date(l.updTime).getTime(),isFolder:!0,index:t,async clickEvent(c,u){let p=Date.now(),m=i.getEncodeTimeStamp(p),w=l.folderId,y=await i.getFolderInfo(3,"Chrome",i.uuid,2,m,i.shareCodeId,w,1,60);return y&&y.list?i.parseFolderInfo(y.list,t+1):[]}}):o.push({fileName:l.fileName,fileSize:l.fileSize*1024,fileType:"",createTime:new Date(l.updTime).getTime(),latestTime:new Date(l.updTime).getTime(),isFolder:!1,index:t,async clickEvent(){let c=l.fileId,u=l.userId||i.userId,p=i.uuid;if(d.isNull(u)){f.error("获取【userId】为空");return}if(d.isNull(p)){f.error("获取【uuid】为空");return}let m=await i.getDownloadFileUrl(...i.getDownloadFileParams(c,u,p));if(m)return D.isForwardDownloadLink("lanzouyx")&&(m=D.parseDataToSchemeUri("lanzouyx",m)),{url:m,autoDownload:!0,mode:"aBlank"}}});}),r.sort((l,c)=>l.fileName.localeCompare(c.fileName)),o.sort((l,c)=>l.fileName.localeCompare(c.fileName)),s=s.concat(r),s=s.concat(o),s}async recommendList(n=3,t="Chrome",i="",s=2,r="",o="",l=0,c=1,u=60){let p=await C.post(`https://api.ilanzou.com/unproved/recommend/list?devType=${n}&devModel=${t}&uuid=${i}&extra=${s}&timestamp=${r}&shareId=${o}&type=${l}&offset=${c}&limit=${u}`,{headers:{Accept:"application/json, text/plain, */*",Origin:"https://www.ilanzou.com",Referer:"https://www.ilanzou.com/","Sec-Fetch-Site":"same-site",Host:"api.ilanzou.com","User-Agent":d.getRandomPCUA()},responseType:"json"});if(!p.status)return;let m=d.toJSON(p.data.responseText);if(h.success(["获取链接信息：",m]),m.code!==200){f.error("请求链接信息失败");return}if(!m.list.length){f.error("获取链接信息为空");return}return m}async getFolderInfo(n=6,t="Chrome",i="",s=2,r="",o="",l="",c=1,u=60){let p=await C.post(`https://api.ilanzou.com/unproved/share/list?devType=${n}&devModel=${t}&uuid=${i}&extra=${s}&timestamp=${r}&shareId=${o}&folderId=${l}&offset=${c}&limit=${u}`,{headers:{Accept:"application/json, text/plain, */*",Origin:"https://www.ilanzou.com",Referer:"https://www.ilanzou.com/","Sec-Fetch-Site":"same-site",Host:"api.ilanzou.com","User-Agent":d.getRandomPCUA()}});if(!p.status)return;let m=d.toJSON(p.data.responseText);if(h.success(["获取文件列表信息：",m]),m.code===200)return m;f.error(m.msg);}async getDownloadFileUrl(n="",t=1,i=6,s="",r="",o=""){let l=await C.options(`https://api.ilanzou.com/unproved/file/redirect?downloadId=${n}&enable=${t}&devType=${i}&uuid=${s}&timestamp=${r}&auth=${o}`,{});if(l.status){if(h.success(l),l.data.responseText){let c=d.toJSON(l.data.responseText);h.error(c),f.error(c.msg);return}return l.data.finalUrl}}getEncodeUUID(n=21){return ((i=21)=>crypto.getRandomValues(new Uint8Array(i)).reduce((s,r)=>(r&=63,s+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r>62?"-":"_",s),""))(n)}getDecodeShareCodeId(n){return _e.idEncrypt(n)}getEncodeTimeStamp(n=Date.now()){return _e.encryptHex(n)}getDownloadFileParams(n,t="",i){const s=this;let r=Date.now(),o=_e.encryptHex(n+"|"+t),l=1,c=6,u=s.getEncodeTimeStamp(r),p=_e.encryptHex(n+"|"+r);return [o,l,c,i,u,p]}gotoLogin(){Z.confirm({title:{position:"center",text:"蓝奏云优享"},content:{text:"必须先在【蓝奏云优享】进行登录，然后登录成功后刷新获取必备的下载参数【uuid】和【userId】。",html:!1},btn:{reverse:!0,position:"end",ok:{text:"前往",enable:!0,callback(){window.open("https://www.ilanzou.com","_blank");}}}},k.popsStyle.tianYiYunLoginTip);}}class $t extends se{constructor(){super(...arguments);F(this,"panelList",[]);F(this,"panelContent","");F(this,"OK_CODE","0000");}async init(n,t,i){const s=this;h.info([n,t,i]),s.netDiskIndex=n,s.shareCode=t,s.accessCode=i,s.panelList=[],s.panelContent="";let r=await s.checkLinkValidity(s.shareCode,s.accessCode);if(r)if(r.isFolder){f.info("正在递归文件");let o=f.loading("正在解析多文件中，请稍后..."),l=await s.getShareFolder(r.data.guid);if(!l){o.close();return}let c=await s.getShareFiles(r.data.guid);if(!c){o.close();return}let u=s.getFolderInfo(r.data.guid,l,c,0);o.close(),h.info("递归完毕"),k.staticView.moreFile("奶牛快传文件解析",u);}else {let o;if(r.zipDownload?o=await s.getZipFileDownloadUrl(s.shareCode,r.guid,r.fileName):o=await s.getDownloadUrl(s.shareCode,r.guid,r.id),!o)return;D.isForwardDownloadLink("nainiu")&&(o=D.parseDataToSchemeUri("nainiu",o)),k.staticView.oneFile({title:"奶牛快传单文件直链",fileName:r.fileName,fileType:r.fileType,fileSize:r.fileSize,downloadUrl:o,fileUploadTime:r.fileUploadTime,fileLatestTime:r.fileLatestTime,clickCallBack:l=>{s.downloadFile(r.fileName,o);}});}}async checkLinkValidity(n,t){const i=this;let s=await i.getShareByUniqueUrl(n);if(!s)return !1;let r=s.code,o=s.message;if(r!==i.OK_CODE)return f.error(o),!1;{let l=s.data.needPassword,c=s.data.zipDownload;return l&&d.isNull(t)?(f.error("密码缺失!"),k.newAccessCodeView("密码缺失","nainiu",i.netDiskIndex,i.shareCode,i.accessCode,u=>{i.init(i.netDiskIndex,i.shareCode,u);}),!1):c?(f.success("该链接为zip单文件"),{zipDownload:c,guid:s.data.guid,fileSize:d.formatByteToSize(s.data.firstFolder.size),fileName:s.data.firstFolder.title,fileUploadTime:d.formatTime(s.data.firstFolder.created_at),fileLatestTime:d.formatTime(s.data.firstFolder.updated_at)}):s.data.firstFile==null?(f.success("该链接为文件夹类型"),{isFolder:!0,guid:s.data.guid,firstFolder:s.data.firstFolder,data:s.data}):{zipDownload:c,guid:s.data.guid,id:s.data.firstFile.id,fileSize:d.formatByteToSize(s.data.firstFile.file_info.size),fileName:s.data.firstFile.file_info.title,fileType:s.data.firstFile.file_info.format,fileUploadTime:d.formatTime(s.data.firstFile.created_at),fileLatestTime:d.formatTime(s.data.firstFile.updated_at)}}}getFolderInfo(n,t,i,s=0){const r=this;let o=[],l=[],c=[];return t.forEach(u=>{o.push({fileName:u.title,fileSize:0,fileType:"",createTime:u.created_at,latestTime:u.updated_at,isFolder:!0,index:s,async clickEvent(){if(!u.child_folder_count&&!u.content_count)return [];let p=await r.getShareFolder(n,u.id);if(!p)return [];let m=await r.getShareFiles(n,u.id);return m?r.getFolderInfo(n,p,m,s+1):[]}});}),i.forEach(u=>{let p=u.file_info.title,m=u.file_info.format??"";m&&(p=p+"."+m),o.push({fileName:p,fileSize:u.file_info.size,fileType:m,createTime:u.created_at,latestTime:u.updated_at,isFolder:!1,index:s,async clickEvent(){let w=await r.getDownloadUrl(r.shareCode,n,u.id);w&&(D.isForwardDownloadLink("nainiu")&&(w=D.parseDataToSchemeUri("nainiu",w)),r.downloadFile(p,w));}});}),l.sort((u,p)=>u.fileName.localeCompare(p.fileName)),c.sort((u,p)=>u.fileName.localeCompare(p.fileName)),o=o.concat(l),o=o.concat(c),h.info(["getFolderInfo",o]),o}async parseMoreFile(n,t){}async getShareFolder(n,t="",i=0,s=100){const r=this;let o=await C.get(`https://cowtransfer.com/core/api/transfer/share/folders?transferGuid=${n}&folderId=${t}&page=${i}&size=${s}`,{headers:{Accept:"application/json","User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/"}});if(h.success(o),!o.status)return;let l=d.toJSON(o.data.responseText);if(l.code!==r.OK_CODE){f.error(l.message);return}let c=l.data.folders;if(!Array.isArray(c)){f.error("data.folders不是数组");return}return c}async getShareFiles(n,t="",i=0,s=20,r=!1){const o=this;let l=await C.get(`https://cowtransfer.com/core/api/transfer/share/files?transferGuid=${n}&folderId=${t}&page=${i}&size=${s}&subContent=${r}`,{headers:{Accept:"application/json","User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/"}});if(h.success(l),!l.status)return;let c=d.toJSON(l.data.responseText);if(c.code!==o.OK_CODE){f.error(c.message);return}let u=c.data.files;if(!Array.isArray(u)){f.error("data.files不是数组");return}return u}async getShareByUniqueUrl(n){let t=`https://cowtransfer.com/core/api/transfer/share?uniqueUrl=${n}`,i=await C.get({url:t,headers:{"User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/s/"+n}});if(h.info(i),!i.status)return;let s=i.data,r=d.toJSON(s.responseText);return h.info(["转换的JSON",r]),r}async getDownloadUrl(n,t="",i=""){const s=this;let r=`https://cowtransfer.com/core/api/transfer/share/download?transferGuid=${t}&fileId=${i}`,o=await C.get({url:r,headers:{"User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/s/"+n}});if(h.info(o),!o.status)return;let l=o.data,c=d.toJSON(l.responseText);if(h.info(["转换的JSON",c]),c.code===s.OK_CODE)return c.data.downloadUrl;f.error(`奶牛快传-获取直链：${c.message}`);}async getZipFileDownloadUrl(n,t="",i=""){const s=this;let r=`https://cowtransfer.com/core/api/transfer/share/download?transferGuid=${t}&title=${i}`,o=await C.get({url:r,headers:{"User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/s/"+n}});if(h.info(o),!o.status)return;let l=o.data,c=d.toJSON(l.responseText);if(h.info(["转换的JSON",c]),c.code===s.OK_CODE)return c.data.downloadUrl;f.error(`奶牛快传-获取直链：${c.message}`);}async downloadFile(n,t){const i=this;if(h.info(["下载文件：",n,t]),f.info(`调用【GM_download】下载：${n}`),typeof Me>"u"){f.error("当前脚本环境缺失API 【GM_download】");return}let s,r=f.loading("下载中...",{showClose:!0,onClose(){typeof s=="function"&&s();}}),o=!1,l=Me({url:t,name:n,headers:{Referer:"https://cowtransfer.com/s/"+i.shareCode},onload(){r.close(),f.success(`下载 ${n} 已完成`);},onprogress(c){if(typeof c=="object"&&"loaded"in c&&"total"in c&&!o){let p=(c.loaded/c.total*100).toFixed(2);r.setText(`下载中...${p}%`),c.loaded===c.total&&(o=!0);}},onerror(c){r.close(),h.error(["下载失败error👉",c]),typeof c=="object"&&c.error?f.error(`下载 ${n} 失败或已取消 原因：${c.error}`,{timeout:6e3}):f.error(`下载 ${n} 失败或已取消`);},ontimeout(){r.close(),f.error(`下载 ${n} 请求超时`);}});typeof l=="object"&&"abort"in l&&(s=l.abort);}}class Ut extends se{constructor(){super(...arguments);F(this,"shareId");F(this,"shareMode",1);F(this,"code",{ShareNotFoundFlatDir:"抱歉，该文件的分享平铺目录未找到",ShareNotFound:"抱歉，您访问的页面地址有误，或者该页面不存在。",ShareAuditNotPass:"抱歉，该内容审核不通过",FileNotFound:"抱歉，文件不存在",ShareExpiredError:"抱歉，您访问的页面地址有误，或者该页面不存在",ShareAuditWaiting:"抱歉，该链接处于审核中",ShareInfoNotFound:"抱歉，您访问的页面地址有误，或者该页面不存在",FileTooLarge:"抱歉，文件太大，不支持下载",InvalidSessionKey:"天翼云PC端Cookie未生成，是否前去登录？<br />&nbsp;&nbsp;&nbsp;&nbsp;(注意,需要当前浏览器的UA切换成PC且在登录后要等待进入个人云空间后生成Cookie，不是手机端浏览的个人云空间，那样生成的Cookie无法使用)"});}async init(n,t,i){const s=this;h.info([n,t,i]),s.netDiskIndex=n,s.shareCode=t,s.accessCode=i;let r=await s.getShareInfoByCodeV2(t);if(r){if(h.info(["解析的JSON信息",r]),r.needAccessCode&&d.isNull(s.accessCode)){f.error("密码不正确!"),k.newAccessCodeView(void 0,"tianyiyun",s.netDiskIndex,s.shareCode,s.accessCode,o=>{s.init(s.netDiskIndex,s.shareCode,o);});return}if("shareId"in r?this.shareId=r.shareId:this.shareId=await s.getShareId(t,i),"shareMode"in r&&(this.shareMode=r.shareMode),this.shareId!=null)if(r.isFolder){f.info("正在递归文件");let o=f.loading("正在解析多文件中，请稍后..."),l=r.fileId,c=await s.listShareDir(t,i,void 0,void 0,l,l,void 0,this.shareId,void 0,void 0,void 0);if(!c){o.close();return}let u=s.getFolderInfo(t,i,c,0);o.close(),h.info("递归完毕"),k.staticView.moreFile("天翼云文件解析",u);return}else {let o=await s.getDownloadUrl(s.shareCode,s.accessCode,r.fileId,this.shareId);o&&(D.isForwardDownloadLink("tianyiyun")&&(o=D.parseDataToSchemeUri("tianyiyun",o)),k.staticView.oneFile({title:"天翼云单文件直链",fileName:r.fileName,fileSize:d.formatByteToSize(r.fileSize),downloadUrl:o,fileUploadTime:r.fileCreateDate,fileLatestTime:r.fileLastOpTime}));}}}async getUserBriefInfo(n){const t=this;let i=await C.get("https://cloud.189.cn/api/portal/v2/getUserBriefInfo.action",{headers:{Accept:"application/json;charset=UTF-8",Referer:"https://cloud.189.cn/web/share?code="+n,"User-Agent":d.getRandomPCUA()},allowInterceptConfig:!1,onerror(){}});if(h.info(i),!i.status){let r=d.toJSON(i.data.responseText);r.res_code in t.code?f.error(t.code[r.res_code]):f.error("请求异常");return}let s=d.toJSON(i.data.responseText);if(s.res_code===0)return s}async getShareInfoByCodeV2(n){const t=this;let i=await C.post({url:"https://cloud.189.cn/api/open/share/getShareInfoByCodeV2.action",data:`shareCode=${n}`,headers:{Accept:"application/json;charset=UTF-8","Content-Type":"application/x-www-form-urlencoded","User-Agent":d.getRandomPCUA(),"Sign-Type":1,Referer:"https://cloud.189.cn/web/share?code="+n,Origin:"https://cloud.189.cn"},allowInterceptConfig:!1,onerror(){}});if(!i.status){let o=d.toJSON(i.data.responseText);h.error(["获取下载参数失败的JSON信息",o]),o.res_code in t.code?f.error(t.code[o.res_code]):f.error(o.res_message);return}let s=i.data;h.info(s);let r=d.toJSON(s.responseText);if(r.res_code==0)return r;t.code.hasOwnProperty(r.res_code)?f.error(t.code[r.res_code]):f.error("获取FileId失败");}async getShareId(n,t){let i=await C.get({url:`https://cloud.189.cn/api/open/share/checkAccessCode.action?shareCode=${n}&accessCode=${t}`,headers:{Accept:"application/json;charset=UTF-8","Cache-Control":"no-cache","User-Agent":d.getRandomPCUA(),"Sign-Type":1,Referer:`https://cloud.189.cn/web/share?code=${n}`},responseType:"json"});if(!i.status)return;let s=i.data;h.info(s);let r=d.toJSON(s.responseText);if(r.res_code===0&&"shareId"in r)return r.shareId;f.error("获取shareId失败"),h.info(r);}getNoCacheValue(){let n="";for(let t=0;t<17;t++)n+=d.getRandomValue(1,9);return "0."+n}async getDownloadUrl(n,t,i,s){const r=this;let o=await C.get({url:`https://cloud.189.cn/api/open/file/getFileDownloadUrl.action?fileId=${i}&dt=1&shareId=${s}`,headers:{Accept:"application/json;charset=UTF-8","Cache-Control":"no-cache","User-Agent":d.getRandomPCUA(),Referer:`https://cloud.189.cn/web/share?code=${n}`,"Sign-Type":1},responseType:"json",allowInterceptConfig:!1,onerror(){}});if(h.info(o),!o.status){let u=d.toJSON(o.data.responseText);u.errorCode==="InvalidSessionKey"?r.gotoLogin(r.code.InvalidSessionKey):u.res_code in r.code?f.error(r.code[u.res_code]):f.error("请求异常");return}let l=o.data,c=d.toJSON(l.responseText);if(h.info(c),c.res_code===0)return c.fileDownloadUrl;c.res_code==="InvalidSessionKey"||c.errorCode==="InvalidSessionKey"?r.gotoLogin(r.code.InvalidSessionKey):r.code.hasOwnProperty(c.res_code)?f.error(r.code[c.res_code]):(f.error("请求失败"),h.error(l));}gotoLogin(n=""){Z.confirm({title:{position:"center",text:"天翼云"},content:{text:n,html:!1},btn:{reverse:!0,position:"end",ok:{text:"前往",enable:!0,callback(){window.open("https://cloud.189.cn/api/portal/loginUrl.action?redirectURL=https://cloud.189.cn/web/main","_blank");}}}},k.popsStyle.tianYiYunLoginTip);}async listShareDir(n,t,i=1,s=60,r,o,l=!0,c,u=5,p="lastOpTime",m=!0){const w=this,y={pageNum:i,pageSize:s,fileId:r,shareDirFileId:o,isFolder:l,shareId:c,shareMode:this.shareMode,iconOption:u,orderBy:p,descending:m,accessCode:t};let R=await C.get(`https://cloud.189.cn/api/open/share/listShareDir.action?${d.toSearchParamsStr(y)}`,{headers:{Accept:"application/json;charset=UTF-8",Referer:`https://cloud.189.cn/web/share?code=${n}`,"Sign-Type":1,"User-Agent":d.getRandomPCUA()},responseType:"json",allowInterceptConfig:!1,onerror(){}});if(!R.status){let W=d.toJSON(R.data.responseText);h.error(["解析文件夹信息失败",W]),W.res_code in w.code?f.error(w.code[W.res_code]):"res_message"in W?f.error(W.res_message):f.error("解析文件夹信息失败");return}let N=R.data;h.info(N);let S=d.toJSON(N.responseText);if(S.res_code==0)return S.fileListAO;w.code.hasOwnProperty(S.res_code)?f.error(w.code[S.res_code]):f.error("获取FileId失败");}getFolderInfo(n,t,i,s=0){const r=this;let o=[],l=[],c=[];return i.folderList.forEach(u=>{o.push({fileName:u.name,fileSize:0,fileType:"",createTime:d.formatToTimeStamp(u.createDate),latestTime:d.formatToTimeStamp(u.lastOpTime),isFolder:!0,index:s,async clickEvent(){let p=await r.listShareDir(n,t,1,100,u.id,u.id,void 0,r.shareId,void 0,void 0,void 0);return p?r.getFolderInfo(n,t,p,s+1):[]}});}),i.fileList.forEach(u=>{o.push({fileName:u.name,fileSize:u.size,fileType:"",createTime:d.formatToTimeStamp(u.createDate),latestTime:d.formatToTimeStamp(u.lastOpTime),isFolder:!1,index:s,async clickEvent(){let p=await r.getDownloadUrl(n,t,u.id,r.shareId);if(p)return D.isForwardDownloadLink("tianyiyun")&&(p=D.parseDataToSchemeUri("tianyiyun",p)),{autoDownload:!0,mode:"aBlank",url:p}}});}),l.sort((u,p)=>u.fileName.localeCompare(p.fileName)),c.sort((u,p)=>u.fileName.localeCompare(p.fileName)),o=o.concat(l),o=o.concat(c),h.info(["getFolderInfo",o]),o}}class zt extends se{async init(a,n,t){const i=this;if(h.info([a,n,t]),i.netDiskIndex=a,i.shareCode=n,i.accessCode=t,f.info("检查是否已登录UC网盘"),!await i.isLogin()){i.gotoLogin("检测到尚未登录UC网盘，是否前去登录？<br />&nbsp;&nbsp;&nbsp;&nbsp;(注意,需要当前浏览器的UA切换成PC才有登录选项)");return}let r=await i.getStoken(i.shareCode,i.accessCode);if(!r)return;let o=await i.getDetail(i.shareCode,i.accessCode,r);if(!o){f.error("UC网盘：获取detail失败");return}if(o.length===1&&o[0].dir==!1&&o[0].file_type===1){let l=o[0],c=await i.getDownload(i.shareCode,r,l.fid,l.share_fid_token);if(!c)return;if(!c[0].download_url){f.error("获取download_url失败");return}k.staticView.oneFile({title:"UC网盘单文件直链",fileName:c[0].file_name,fileSize:d.formatByteToSize(c[0].size),downloadUrl:c[0].download_url,fileUploadTime:d.formatTime(c[0].created_at),fileLatestTime:d.formatTime(c[0].last_update_at),clickCallBack(){i.downloadFile(c[0].file_name,c[0].download_url);}});}else {f.info("正在递归文件");let l=f.loading("正在解析多文件中，请稍后..."),c=i.getFolderInfo(o,r,0);l.close(),h.info("递归完毕"),k.staticView.moreFile("UC网盘文件解析",c);return}}async isLogin(){let a=await C.get("https://drive.uc.cn/",{headers:{"User-Agent":d.getRandomPCUA()}});if(h.success(["判断是否已登录UC网盘",a]),!!a.status)return a.data.finalUrl==="https://drive.uc.cn/list"?"已登录":!1}downloadFile(a,n){if(h.info(["调用【GM_download】下载：",arguments]),f.info(`调用【GM_download】下载：${a}`),typeof Me>"u"){f.error("当前脚本环境缺失API 【GM_download】");return}let t=f.loading("下载中..."),i=!1;return Me({url:n,name:a,headers:{Referer:"https://drive.uc.cn/"},onload(){t.close(),f.success(`下载 ${a} 已完成`);},onprogress(s){if(typeof s=="object"&&"loaded"in s&&"total"in s&&!i){let o=(s.loaded/s.total*100).toFixed(2);t.setText(`下载中...${o}%`),s.loaded===s.total&&(i=!0);}},onerror(s){t.close(),h.error(["下载失败error👉",s]),typeof s=="object"&&s.error?f.error(`下载 ${a} 失败或已取消 原因：${s.error}`,{timeout:6e3}):f.error(`下载 ${a} 失败或已取消`);},ontimeout(){t.close(),f.error(`下载 ${a} 请求超时`);}})}gotoLogin(a=""){Z.confirm({title:{position:"center",text:"UC网盘"},content:{text:a,html:!1},btn:{reverse:!0,position:"end",ok:{text:"前往",enable:!0,callback(){window.open("https://drive.uc.cn","_blank");}}}},k.popsStyle.tianYiYunLoginTip);}async getStoken(a,n){let t=await C.post("https://pc-api.uc.cn/1/clouddrive/share/sharepage/token?entry=ft&fr=pc&pr=UCBrowser",{data:JSON.stringify({share_for_transfer:!0,passcode:n,pwd_id:a}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8","User-Agent":d.getRandomPCUA(),Origin:"https://drive.uc.cn",Referer:"https://drive.uc.cn/"},allowInterceptConfig:!1,onerror(){}});if(!t.status){let s=d.toJSON(t.data.responseText);h.error(["获取stoken失败JSON信息",s]),"message"in s?f.error(s.message):f.error("请求异常，获取stoken失败");return}let i=d.toJSON(t.data.responseText);if(h.info(["获取stoken：",i]),i.code!==0){h.error(["获取stoken失败",i]),f.error("获取stoken失败");return}return i.data.stoken}async getDetail(a,n,t,i=0,s=0,r=1,o=50,l=0,c=0,u=1){let p=await C.get(`https://pc-api.uc.cn/1/clouddrive/transfer_share/detail?pr=UCBrowser&fr=h5&pwd_id=${a}&__t=${new Date().getTime()}&passcode=${n}&stoken=${encodeURIComponent(t)}&pdir_fid=${i}&force=${s}&_page=${r}&_size=${o}&_fetch_banner=${l}&_fetch_share=${c}&_fetch_total=${u}&_sort=${encodeURIComponent("file_type:asc,file_name:asc")}`,{headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomPCUA(),Origin:"https://drive.uc.cn",Referer:"https://drive.uc.cn/"}});if(!p.status)return;let m=d.toJSON(p.data.responseText);if(h.info(["获取detail：",m]),m.code!==0){h.error(["获取detail失败",m]),f.error("获取detail失败");return}let w=m.metadata;return w&&w._total&&w._total>w._size?await this.getDetail(a,n,t,i,s,r,w._total,l,c,u):m.data.list}async getDownload(a,n,t,i){let s=await C.post("https://pc-api.uc.cn/1/clouddrive/file/download?entry=ft&fr=pc&pr=UCBrowser",{data:JSON.stringify({fids:[t],pwd_id:a,stoken:n,fids_token:[i]}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8","User-Agent":d.getRandomPCUA(),Origin:"https://drive.uc.cn",Referer:"https://drive.uc.cn/"}});if(!s.status)return;let r=d.toJSON(s.data.responseText);if(h.info(["获取download：",r]),r.code!==0){h.error(["获取download失败",r]),f.error("获取download失败");return}if(r.data.length===0){h.error(["获取download detail失败",r]),f.error("获取download detail失败失败");return}return r.data}getFolderInfo(a,n,t=0){const i=this;let s=[],r=[],o=[];return a.forEach(l=>{l.dir==!1&&l.file_type===1?o.push({fileName:l.file_name,fileSize:l.size,fileType:"",createTime:l.created_at,latestTime:l.updated_at,isFolder:!1,index:t,async clickEvent(){let c=await i.getDownload(i.shareCode,n,l.fid,l.share_fid_token);if(c&&c.length?c=c[0].download_url:c="",l.ban)f.error("文件已被禁止下载");else {let u=c;if(D.isForwardDownloadLink("uc")&&(u=D.parseDataToSchemeUri("uc",u)),u===c)i.downloadFile(l.file_name,c);else return {autoDownload:!0,mode:"aBlank",url:c}}}}):r.push({fileName:l.file_name,fileSize:l.size,fileType:"",createTime:l.created_at,latestTime:l.updated_at,isFolder:!0,index:t,async clickEvent(){if(l.include_items===0)return h.success("里面没有文件"),[];let c=await i.getDetail(i.shareCode,i.accessCode,n,l.fid);return c?i.getFolderInfo(c,n,t+1):[]}});}),r.sort((l,c)=>l.fileName.localeCompare(c.fileName)),o.sort((l,c)=>l.fileName.localeCompare(c.fileName)),s=s.concat(r),s=s.concat(o),h.info(["getFilesInfoByRec",s]),s}}class Et extends se{constructor(){super(...arguments);F(this,"token");F(this,"code",{1004:"no token",1008:"您没有权限访问",1013:"糟糕，此任务已过期销毁，下次要记得续期",1066:"对方设置的下载 / 预览次数已用完",1088:"糟糕，您访问的页面不存在"});}async init(n,t,i){const s=this;if(h.info([n,t,i]),s.netDiskIndex=n,s.shareCode=t,s.accessCode=i,f.info("正在请求直链中..."),!await this.getWssToken())return;let o=await this.getPid();o&&await this.getFileNList(o.bid,o.pid);}async getWssToken(){const n=this;let t=await C.post("https://www.wenshushu.cn/ap/login/anonymous",{responseType:"json",data:JSON.stringify({dev_info:"{}"}),headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomAndroidUA(),Referer:"https://www.wenshushu.cn/f/"+n.shareCode}});if(h.success(t),!t.status)return;let i=d.toJSON(t.data.responseText);if(i.code===0)return n.token=i.data.token,i.data.token;i.code in n.code?f.error(n.code[i.code]):f.error("获取wss失败");}async getPid(){const n=this;let t=await C.post({url:"https://www.wenshushu.cn/ap/task/mgrtask",responseType:"json",data:JSON.stringify({tid:n.shareCode,password:"",ufileid:""}),headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomAndroidUA(),Referer:"https://www.wenshushu.cn/f/"+n.shareCode,"x-token":n.token}});if(h.success(t),!t.status)return;let i=t.data,s=d.toJSON(i.responseText);if(s.code===0)return {bid:s.data.boxid,pid:s.data.ufileid};s.code in n.code?f.error(n.code[s.code]):f.error("获取pid失败");}async getFileNList(n,t){const i=this;let s=await C.post("https://www.wenshushu.cn/ap/ufile/nlist",{responseType:"json",data:JSON.stringify({start:0,sort:{name:"asc"},bid:n,pid:t,options:{uploader:"true"},size:50}),headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomAndroidUA(),Referer:"https://www.wenshushu.cn/f/"+i.shareCode,"x-token":i.token}});if(h.success(s),!s.status)return;let r=s.data,o=d.toJSON(r.responseText);o.code===0?o.data.fileList[0].type===2?(f.error("该链接为多层级文件嵌套，跳转"),oe.openBlank(J.getBlankUrl("wenshushu",i.netDiskIndex,i.shareCode,i.accessCode),"wenshushu",i.netDiskIndex,i.shareCode,i.accessCode)):await i.getDownloadUrl(o.data.fileList[0]):o.code in i.code?f.error(i.code[o.code]):f.error("获取文件信息失败");}async getDownloadUrl(n){const t=this;let i=n.fname,s=d.formatByteToSize(n.size),r=await C.post("https://www.wenshushu.cn/ap/dl/sign",{responseType:"json",data:JSON.stringify({ufileid:n.fid,consumeCode:0}),headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomAndroidUA(),Referer:"https://www.wenshushu.cn/f/"+t.shareCode,"x-token":t.token}});if(!r.status)return;h.success(r);let o=r.data,l=d.toJSON(o.responseText);if(l.code==0){let c=l.data.url;c===""?f.error("对方的分享流量不足"):(D.isForwardDownloadLink("wenshushu")&&(c=D.parseDataToSchemeUri("wenshushu",c)),k.staticView.oneFile({title:"文叔叔单文件直链",fileName:i,fileSize:s,downloadUrl:c}));}else l.data in t.code?f.error(t.code[l.data]):f.error("获取下载链接失败");}}const Ne={netDisk:{baidu:Dt,lanzou:Lt,lanzouyx:Nt,tianyiyun:Ut,wenshushu:Et,_123pan:_t,jianguoyun:Mt,nainiu:$t,uc:zt,aliyun:Tt}},J={getBlankUrl(e,a,n,t){let i=b.$rule.matchRule[e][a],s=i.blank;n&&(s=U.replaceParam(s,{shareCode:n})),t&&t!==""?s=U.replaceParam(s,{accessCode:t}):s=s.replace(b.$extraRule.noAccessCodeRegExp,"");let r=b.$match.matchedInfo.get(e).get(n);if(i.paramMatch){let o=r.matchText.match(i.paramMatch),l={};for(let c=0;c<o.length;c++)l[`$${c}`]=o[c];s=U.replaceParam(s,l);}return s},getCopyUrlInfo(e,a,n,t){let i=b.$rule.matchRule[e][a],s=i.copyUrl;n&&(s=U.replaceParam(s,{shareCode:n})),t&&t!==""?s=U.replaceParam(s,{accessCode:t}):s=s.replace(b.$extraRule.noAccessCodeRegExp,"");let r=b.$match.matchedInfo.get(e).get(n);if(i.paramMatch){let o=r.matchText.match(i.paramMatch),l={};for(let c=0;c<o.length;c++)l[`$${c}`]=o[c];s=U.replaceParam(s,l);}return s},async getRedirectFinalUrl(e,a){if(!g.function.getTheDirectLinkAfterRedirection.value)return e;f.success("获取重定向后的直链"),h.info("开始获取重定向后的直链");let n=await C.head({url:e,headers:{"User-Agent":a,Referer:window.location.origin}});return n.status?n.data.finalUrl:e}},oe={copy(e,a,n,t,i="已复制"){d.setClip(J.getCopyUrlInfo(e,a,n,t)),f.success(i);},async parseFile(e,a,n,t){f.info("正在获取直链"),Ne.netDisk[e]?await new Ne.netDisk[e]().init(a,n,t):(h.error(`${e} 不存在解析`),f.error("该链接不存在解析功能"));},openBlank(e,a,n,t,i){var s;h.success(["新标签页打开",[...arguments]]),Ce.$data.enable&&Ce.setValue({url:e,netDiskName:a,netDiskIndex:n,shareCode:t,accessCode:i}),D.isForwardBlankLink(a)&&(e=D.parseDataToSchemeUri(a,e)),(s=document.querySelector("meta[name='referrer']"))==null||s.setAttribute("content","no-referrer"),d.isNotNull(i)&&P.linkClickMode_openBlank.openBlankWithCopyAccessCode(a)?d.setClip(i).then(()=>{window.open(e,"_blank");}):window.open(e,"_blank");},openBlankWithScheme(e,a,n,t){let i=J.getBlankUrl(e,a,n,t);i=D.parseDataToSchemeUri(e,i),window.open(i,"_blank");}},It={async init(e,a,n){let t=J.getBlankUrl("baidu",e,a,n),i=await C.get(t,{headers:{"User-Agent":d.getRandomPCUA(),Host:"pan.baidu.com",Referer:t,Origin:"https://pan.baidu.com"},allowInterceptConfig:!1,onerror(){},ontimeout(){}}),s=i.data.responseText;return !i.status&&d.isNull(s)||i.data.finalUrl.includes("404.html")?x.status.error:s.includes("过期时间：")?x.status.success:s.includes("输入提取")?x.status.needAccessCode:s.includes("不存在")||s.includes("已失效")?x.status.failed:x.status.unknown}},Ft={async init(e,a,n){let t=J.getBlankUrl("lanzou",e,a,n),i=new URL(t),s=await C.get(t,{headers:{"User-Agent":d.getRandomPCUA(),Host:i.hostname,Origin:i.origin,Referer:t},allowInterceptConfig:!1,onerror(){},ontimeout(){}});if(!s.status)return x.status.error;let r=s.data.responseText;return d.isNull(r)?x.status.failed:r.includes("输入密码")?x.status.needAccessCode:r.includes("来晚啦")||r.includes("不存在")?x.status.failed:x.status.success}},Pt={async init(e,a,n){let t=new Ne.netDisk.lanzouyx;t.uuid=t.getEncodeUUID(),t.shareCodeId=t.getDecodeShareCodeId(a);let i=3,s="Chrome",r=2,o=t.getEncodeTimeStamp(),p=await C.post(`https://api.ilanzou.com/unproved/recommend/list?devType=${i}&devModel=${s}&uuid=${t.uuid}&extra=${r}&timestamp=${o}&shareId=${t.shareCodeId}&type=0&offset=1&limit=60`,{headers:{Accept:"application/json, text/plain, */*",Origin:"https://www.ilanzou.com",Referer:"https://www.ilanzou.com/","Sec-Fetch-Site":"same-site",Host:"api.ilanzou.com","User-Agent":d.getRandomPCUA()},responseType:"json",allowInterceptConfig:!1,onerror(){},ontimeout(){}});if(!p.status)return x.status.error;let m=d.toJSON(p.data.responseText);return h.success(["获取链接信息：",m]),m.code!==200?x.status.error:m.list.length?x.status.success:x.status.failed}},Vt={async init(e,a,n){let t=await C.post("https://api.cloud.189.cn/open/share/getShareInfoByCodeV2.action",{data:`shareCode=${a}`,headers:{Accept:"application/json;charset=UTF-8","Content-Type":"application/x-www-form-urlencoded","User-Agent":d.getRandomPCUA(),"Sign-Type":1,Referer:"https://cloud.189.cn/web/share?code="+a,Origin:"https://cloud.189.cn"},allowInterceptConfig:!1,onerror(){},ontimeout(){}}),i=t.data.responseText;return !t.status&&d.isNull(i)?x.status.error:i.includes("ShareInfoNotFound")||i.includes("ShareNotFound")||i.includes("FileNotFound")||i.includes("ShareAuditWaiting")||i.includes("ShareExpiredError")||i.includes("ShareAuditNotPass")?x.status.failed:i.includes("needAccessCode")?x.status.needAccessCode:x.status.success}},Ot={async init(e,a,n){var s;let t=await C.post("https://api.aliyundrive.com/adrive/v3/share_link/get_share_by_anonymous?share_id="+a,{data:JSON.stringify({share_id:a}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","User-Agent":d.getRandomPCUA(),Referer:"https://www.aliyundrive.com/",Origin:"https://www.aliyundrive.com"},allowInterceptConfig:!1,onerror(){},ontimeout(){}}),i=d.toJSON(t.data.responseText);return !t.status&&d.isNull(i)?x.status.error:i.code==="ParamFlowException"||i.code==="NotFound.ShareLink"||i.code==="ShareLink.Cancelled"||i.file_count===0||((s=i.file_infos)==null?void 0:s.length)===0?x.status.failed:x.status.success}},Bt={async init(e,a,n){let t=await C.post("https://www.wenshushu.cn/ap/task/mgrtask",{data:JSON.stringify({tid:a}),headers:{"Content-Type":"application/json","User-Agent":d.getRandomPCUA(),"x-token":"wss:7pmakczzw6i",Host:"www.wenshushu.cn",Origin:"https://www.wenshushu.cn",Referer:J.getBlankUrl("wenshushu",e,a,n)},responseType:"json",allowInterceptConfig:!1,onerror(){},ontimeout(){}});return !t.status&&d.isNull(t.data.responseText)?x.status.error:d.toJSON(t.data.responseText).code!==0?x.status.failed:x.status.success}},Ht={async init(e,a,n){let t=await C.get("https://cowtransfer.com/core/api/transfer/share?uniqueUrl="+a,{headers:{"User-Agent":d.getRandomPCUA(),Host:"cowtransfer.com",Origin:"https://cowtransfer.com/",Referer:"https://cowtransfer.com/"}});if(!t.status&&d.isNull(t.data.responseText))return x.status.error;let i=d.toJSON(t.data.responseText);return i.code!="0000"?x.status.failed:i.data.needPassword&&i.data.needPassword?x.status.needAccessCode:x.status.success}},Zt={async init(e,a,n){let t=await C.get("https://www.123pan.com/api/share/info?shareKey="+a,{headers:{"User-Agent":d.getRandomPCUA(),Host:"www.123pan.com",Origin:"https://www.123pan.com/",Referer:"https://www.123pan.com/"},allowInterceptConfig:!1,onerror(){},ontimeout(){},responseType:"json"});if(!t.status&&d.isNull(t.data.responseText))return x.status.error;let i=d.toJSON(t.data.responseText);return t.data.responseText.includes("分享页面不存在")||i.code!==0?x.status.failed:i.data.HasPwd?x.status.needAccessCode:x.status.success}},jt={async init(e,a,n){let t=J.getBlankUrl("weiyun",e,a,n),i=await C.get(t,{headers:{"User-Agent":d.getRandomPCUA(),Host:"share.weiyun.com",Origin:"https://share.weiyun.com",Referer:t},allowInterceptConfig:!1,onerror(){},ontimeout(){}});if(!i.status&&d.isNull(i.data.responseText))return x.status.error;let s=i.data.responseText;return s.includes("已删除")||s.includes("违反相关法规")||s.includes("已过期")||s.includes("已经删除")||s.includes("目录无效")?x.status.failed:s.includes('"need_pwd":1')||s.includes('"pwd":"')?x.status.needAccessCode:x.status.success}},qt={async init(e,a,n){let t=await C.post("https://xluser-ssl.xunlei.com/v1/shield/captcha/init",{data:JSON.stringify({client_id:"Xqp0kJBXWhwaTpB6",device_id:"925b7631473a13716b791d7f28289cad",action:"get:/drive/v1/share",meta:{package_name:"pan.xunlei.com",client_version:"1.45.0",captcha_sign:"1.fe2108ad808a74c9ac0243309242726c",timestamp:"1645241033384"}}),headers:{"User-Agent":d.getRandomPCUA(),Host:"pan.xunlei.com",Referer:J.getBlankUrl("xunlei",e,a,n),Origin:"https://pan.xunlei.com"},allowInterceptConfig:!1,onerror(){},ontimeout(){}});if(!t.status&&d.isNull(t.data.responseText))return x.status.error;let s=d.toJSON(t.data.responseText).captcha_token,r=await C.get("https://api-pan.xunlei.com/drive/v1/share?share_id="+a,{headers:{"User-Agent":d.getRandomPCUA(),Host:"pan.xunlei.com",Referer:J.getBlankUrl("xunlei",e,a,n),Origin:"https://pan.xunlei.com","x-captcha-token":s,"x-client-id":"Xqp0kJBXWhwaTpB6","x-device-id":"925b7631473a13716b791d7f28289cad"},allowInterceptConfig:!1,onerror(){},ontimeout(){}});if(!r.status&&d.isNull(r.data.responseText))return x.status.error;let o=r.data.responseText;return o.includes("NOT_FOUND")||o.includes("SENSITIVE_RESOURCE")||o.includes("EXPIRED")||o.includes("DELETED")?x.status.failed:o.includes("PASS_CODE_EMPTY")?x.status.needAccessCode:x.status.success}},Wt={async init(e,a,n){let t=J.getBlankUrl("chengtong",e,a,n);const s=new URL(t).pathname.split("/")[1].trim();let r="";if(s==="f"||s==="file")r=`https://webapi.ctfile.com/getfile.php?path=${s}&f=${a}&passcode=${n}&token=0&r=${Math.random()}&ref=`;else if(s==="d"||s==="dir")r=`https://webapi.ctfile.com/getdir.php?path=${s}&d=${a}&folder_id=&passcode=${n}&token=0&r=${Math.random()}&ref=`;else return h.warn(["未知path",[e,a,n]]),x.status.unknown;let o=await C.get(r,{headers:{Host:"webapi.ctfile.com",Origin:"https://url95.ctfile.com",Referer:t,Accept:"application/json, text/javascript, */*; q=0.01","User-Agent":d.getRandomPCUA()},allowInterceptConfig:!1,onerror(){},ontimeout(){}}),l=o.data.responseText;if(!o.status&&d.isNull(l))return x.status.error;let c=d.toJSON(l);return c.code===200?x.status.success:c.code===401?x.status.needAccessCode:c.code===404||c.code===503?x.status.failed:x.status.unknown}},Kt={async init(e,a,n){let i=await C.post("https://drive.quark.cn/1/clouddrive/share/sharepage/token?pr=ucpro&fr=pc",{data:JSON.stringify({pwd_id:a,passcode:""}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8","User-Agent":d.getRandomPCUA(),Origin:"https://pan.quark.cn",Referer:J.getBlankUrl("kuake",e,a,n)},allowInterceptConfig:!1,onerror(){},ontimeout(){}});if(!i.status&&d.isNull(i.data.responseText))return x.status.error;let s=d.toJSON(i.data.responseText);if(s.message.includes("需要提取码"))return x.status.needAccessCode;if(s.message.includes("ok")){let r=s.data.stoken,o={pwd_id:a,stoken:r,_fetch_share:1,__t:Date.now()},l=await C.get(`https://drive-h.quark.cn/1/clouddrive/share/sharepage/detail?${d.toSearchParamsStr(o)}`,{headers:{Accept:"application/json, text/plain, */*",Origin:"https://pan.quark.cn",Referer:"https://pan.quark.cn/","User-Agent":d.getRandomPCUA()},allowInterceptConfig:!1,onerror(){},ontimeout(){}});if(!l.status||d.isNull(l.data.responseText))return x.status.error;let c=d.toJSON(l.data.responseText);return c.data.share.status==1?c.data.share.partial_violation?x.status.partialViolation:x.status.success:x.status.failed}else return x.status.failed}},Jt={async init(e,a,n){let t=J.getBlankUrl("jianguoyun",e,a,n),i=await C.get(t,{headers:{"User-Agent":d.getRandomPCUA(),Host:"www.jianguoyun.com",Referer:J.getBlankUrl("jianguoyun",e,a,n),Origin:"https://www.jianguoyun.com"},allowInterceptConfig:!1,onerror(){},ontimeout(){}}),s=i.data.responseText;return !i.status&&d.isNull(s)?x.status.error:s.includes("<h1>啊噢！")?x.status.failed:x.status.success}},Yt={async init(e,a,n){var o,l,c,u;let t=J.getBlankUrl("onedrive",e,a,n),i=new URL(t),s=await C.get(t,{headers:{"User-Agent":d.getRandomPCUA(),Host:i.hostname,Referer:t,Origin:i.origin},allowInterceptConfig:!1,onerror(){},ontimeout(){}});if(!s.status){let p=(l=(o=s.data)==null?void 0:o.status)==null?void 0:l.toString();return p==="429"?x.status.error:p==="404"?x.status.failed:x.status.error}let r=s.data.responseText;if(d.isNotNull(r))try{if((u=(c=v.parseHTML(r,!0,!0).querySelector("title"))==null?void 0:c.innerHTML)!=null&&u.includes("错误"))return x.status.failed}catch{}return x.status.success}},Gt={async init(e,a,n){let t=await C.get("https://drive.uc.cn/s/"+a,{headers:{"User-Agent":d.getRandomAndroidUA(),Host:"drive.uc.cn",Referer:J.getBlankUrl("uc",e,a,n),Origin:"https://drive.uc.cn"},allowInterceptConfig:!1,onerror(){},ontimeout(){}}),i=t.data.responseText;if(!t.status&&d.isNull(i))return x.status.error;let s=v.parseHTML(i,!0,!0);if(s.querySelector(".h5-page-main")){let r=s.querySelector(".h5-page-main"),o=r.textContent||r.innerText;return o.includes("失效")||o.includes("不存在")||o.includes("违规")||o.includes("删除")?x.status.failed:x.status.unknown}else return s.querySelector(".main-body .input-wrap input")?x.status.needAccessCode:x.status.success}},He=`.netdisk-url-box {\r
	border-bottom: 1px solid #e4e6eb;\r
}\r
.netdisk-url-div {\r
	display: flex;\r
	align-items: center;\r
	width: 100%;\r
	padding: 5px 0px 5px 0px;\r
}\r
.netdisk-icon {\r
	display: contents;\r
}\r
.netdisk-icon .netdisk-icon-img {\r
	cursor: pointer;\r
	width: 28px;\r
	height: 28px;\r
	min-width: 28px;\r
	min-height: 28px;\r
	font-size: 0.8em;\r
	margin: 0px 10px;\r
}\r
.netdisk-url-div .netdisk-icon,\r
.netdisk-url-div .netdisk-status {\r
	flex: 0 0 auto;\r
}\r
.netdisk-url-div .netdisk-url {\r
	flex: 1;\r
}\r
.netdisk-icon .netdisk-icon-img {\r
	border-radius: 10px;\r
	box-shadow: 0 0.3px 0.6px rgb(0 0 0 / 6%), 0 0.7px 1.3px rgb(0 0 0 / 8%),\r
		0 1.3px 2.5px rgb(0 0 0 / 10%), 0 2.2px 4.5px rgb(0 0 0 / 12%),\r
		0 4.2px 8.4px rgb(0 0 0 / 14%), 0 10px 20px rgb(0 0 0 / 20%);\r
}\r
.netdisk-status[data-check-failed] {\r
	padding: 5px 5px;\r
}\r
.netdisk-url {\r
	padding: 5px 5px;\r
}\r
.netdisk-url a {\r
	color: #ff4848 !important;\r
	min-height: 28px;\r
	overflow-x: hidden;\r
	overflow-y: auto;\r
	font-size: 0.8em;\r
	border: none;\r
	display: flex;\r
	align-items: center;\r
	width: 100%;\r
	height: 100%;\r
	padding: 0px;\r
	word-break: break-word;\r
	text-align: left;\r
}\r
.netdisk-status {\r
	display: none;\r
}\r
.netdisk-status[data-check-valid] {\r
	display: flex;\r
	align-items: center;\r
	width: 15px;\r
	height: 15px;\r
}\r
\r
.netdisk-status[data-check-valid="failed"] {\r
	color: red;\r
}\r
\r
.netdisk-status[data-check-valid="partial-violation"] {\r
	color: orange;\r
}\r
\r
.netdisk-status[data-check-valid="error"] {\r
	cursor: pointer;\r
}\r
\r
.netdisk-status[data-check-valid="success"] {\r
	color: green;\r
}\r
\r
.netdisk-status[data-check-valid="loading"] svg {\r
	animation: rotating 2s linear infinite;\r
}\r
\r
.netdisk-url-box:has(.netdisk-status[data-check-valid="failed"]) {\r
	text-decoration: line-through;\r
}\r
\r
.whitesevPop-whitesevPopSetting :focus-visible {\r
	outline-offset: 0;\r
	outline: 0;\r
}\r
.netdisk-url a[isvisited="true"] {\r
	color: #8b8888 !important;\r
}\r
.netdisk-url a:active {\r
	box-shadow: 0 0 0 1px #616161 inset;\r
}\r
.netdisk-url a:focus-visible {\r
	outline: 0;\r
}\r
.whitesevPop-content p[pop] {\r
	text-indent: 0;\r
}\r
.whitesevPop-button[type="primary"] {\r
	border-color: #2d8cf0;\r
	background-color: #2d8cf0;\r
}\r
`,de=function(e,a){return {KEY:e,default:a,get value(){return O(e,a)},set value(n){z(e,n);}}},re={show(){k.Alias.uiLinkAlias==null?(this.createView(),this.initViewEvent()):k.Alias.uiLinkAlias.show();},createView(){const e={view:{"netdisl-small-window-shrink-status":de("netdisl-small-window-shrink-status",!1),"netdisk-ui-small-window-position":de("netdisk-ui-small-window-position",null)}};let a="";k.isMatchedNetDiskIconMap.forEach(t=>{let s=b.$match.matchedInfo.get(t).getItems();Object.keys(s).forEach(r=>{let o=s[r],l=b.handleLinkShow(t,o.netDiskIndex,r,o.accessCode,o.matchText);a=a+this.createViewBoxElementInfo(k.src.icon[t],t,o.netDiskIndex,r,o.accessCode,l).html;});});let n=`
            <div class="netdisk-url-box-all">
                ${a}
            </div>`;if(g.function["netdisk-behavior-mode"].value.toLowerCase().includes("smallwindow")){k.Alias.uiLinkAlias=Z.alert({title:{text:"网盘",position:"center"},content:{text:n,html:!0},btn:{ok:{enable:!1},close:{callback(s){g.function["netdisk-behavior-mode"].value.toLowerCase().includes("suspension")?(G.mode.current_suspension_smallwindow_mode.value="suspension",s.hide(),k.suspension.show()):(k.Alias.uiLinkAlias=void 0,s.close());}}},mask:{enable:!1},animation:"",beforeAppendToPageCallBack(s,r){let o=s.querySelector(".pops-header-control"),l=s.querySelector(".pops-alert-content"),c=v.createElement("button",{className:"pops-header-control",innerHTML:`
                                <i class="pops-icon">
                                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                                    <path fill="currentColor" d="M290.816 774.144h167.936c12.288 0 20.48 8.192 20.48 20.48s-8.192 20.48-20.48 20.48h-219.136c-12.288 0-20.48-8.192-20.48-20.48v-2.048-206.848c0-12.288 8.192-20.48 20.48-20.48s20.48 8.192 20.48 20.48v163.84l210.944-198.656c8.192-8.192 20.48-8.192 28.672 0s8.192 20.48 0 28.672l-208.896 194.56z m462.848-524.288h-167.936c-12.288 0-20.48-8.192-20.48-20.48s8.192-20.48 20.48-20.48h219.136c12.288 0 20.48 8.192 20.48 20.48v208.896c0 12.288-8.192 20.48-20.48 20.48s-20.48-8.192-20.48-20.48v-163.84l-210.944 198.656c-8.192 8.192-20.48 8.192-28.672 0s-8.192-20.48 0-28.672l208.896-194.56z m188.416 323.584c0 12.288-8.192 20.48-20.48 20.48s-20.48-8.192-20.48-20.48v-389.12c0-34.816-26.624-61.44-61.44-61.44h-655.36c-34.816 0-61.44 26.624-61.44 61.44v655.36c0 34.816 26.624 61.44 61.44 61.44h655.36c34.816 0 61.44-26.624 61.44-61.44v-94.208c0-12.288 8.192-20.48 20.48-20.48s20.48 8.192 20.48 20.48v94.208c0 57.344-45.056 102.4-102.4 102.4h-655.36c-57.344 0-102.4-45.056-102.4-102.4v-655.36c0-57.344 45.056-102.4 102.4-102.4h655.36c57.344 0 102.4 45.056 102.4 102.4v389.12z">
                                    </path>
                                </svg>
                                </i>
                                `},{type:"launch","data-header":!0}),u=v.createElement("button",{className:"pops-header-control",innerHTML:`
                                <i class="pops-icon">
                                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                                    <path fill="currentColor" d="M618.496 425.984h167.936c12.288 0 20.48 8.192 20.48 20.48s-8.192 20.48-20.48 20.48h-219.136c-12.288 0-20.48-8.192-20.48-20.48v-2.048-206.848c0-12.288 8.192-20.48 20.48-20.48s20.48 8.192 20.48 20.48v163.84l210.944-198.656c8.192-8.192 20.48-8.192 28.672 0s8.192 20.48 0 28.672l-208.896 194.56z m-192.512 172.032h-167.936c-12.288 0-20.48-8.192-20.48-20.48s8.192-20.48 20.48-20.48h219.136c12.288 0 20.48 8.192 20.48 20.48v208.896c0 12.288-8.192 20.48-20.48 20.48s-20.48-8.192-20.48-20.48v-163.84l-210.944 198.656c-8.192 8.192-20.48 8.192-28.672 0s-8.192-20.48 0-28.672l208.896-194.56z m516.096-24.576c0 12.288-8.192 20.48-20.48 20.48s-20.48-8.192-20.48-20.48v-389.12c0-34.816-26.624-61.44-61.44-61.44h-655.36c-34.816 0-61.44 26.624-61.44 61.44v655.36c0 34.816 26.624 61.44 61.44 61.44h655.36c34.816 0 61.44-26.624 61.44-61.44v-94.208c0-12.288 8.192-20.48 20.48-20.48s20.48 8.192 20.48 20.48v94.208c0 57.344-45.056 102.4-102.4 102.4h-655.36c-57.344 0-102.4-45.056-102.4-102.4v-655.36c0-57.344 45.056-102.4 102.4-102.4h655.36c57.344 0 102.4 45.056 102.4 102.4v389.12z">
                                    </path>
                                </svg>
                                </i>
                                `},{type:"shrink","data-header":!0});v.before(o,c),v.before(o,u),v.on(c,"click",void 0,function(){c.classList.add("pops-hide-important"),u.classList.remove("pops-hide-important"),l.classList.remove("pops-hide-important"),e.view["netdisl-small-window-shrink-status"].value=!1;},{capture:!0}),v.on(u,"click",void 0,function(){u.classList.add("pops-hide-important"),c.classList.remove("pops-hide-important"),l.classList.add("pops-hide-important"),l.classList.add("pops-no-border-important"),e.view["netdisl-small-window-shrink-status"].value=!0;},{capture:!0}),e.view["netdisl-small-window-shrink-status"].value?u.click():c.click();},dragMoveCallBack(s,r,o){e.view["netdisk-ui-small-window-position"].value={left:r,top:o};},class:"whitesevPop",style:`
                    ${He}

                    .pops {
                        --container-title-height: 35px;
                        --content-max-height: ${g.smallWindow["netdisk-ui-small-window-max-height"].value}px;
                        --netdisk-line-space: 8px;
                        --netdisk-icon-size: 24px;
                    }
                    .pops[type-value="alert"]{
                        transform: none;
                    }
                    .pops {
                        max-height: var(--content-max-height);
                    }
                    .pops[type-value=alert] .pops-alert-content{
                        max-height: calc(var(--content-max-height) - var(--container-title-height) - var(--container-bottom-btn-height));
                    }
                    .pops-header-controls button.pops-header-control[type][data-header]{
                        padding: 0px 5px;
                    }
                    .netdisk-url-div{
                        padding: 0px;
                    }
                    .netdisk-icon .netdisk-icon-img{
                        width: var(--netdisk-icon-size);
                        height: var(--netdisk-icon-size);
                        min-width: var(--netdisk-icon-size);
                        min-height: var(--netdisk-icon-size);
                        margin: 0px var(--netdisk-line-space);
                    }
                    .netdisk-status{
                        margin-right: var(--netdisk-line-space);
                    }
                    .netdisk-url{
                        padding: 2px 0px;
                    }
                    `},k.popsStyle.mainViewSmallWindow);let t=e.view["netdisk-ui-small-window-position"].value,i=k.Alias.uiLinkAlias.popsElement;if(t){let s=v.width(i,!0),r=v.height(i,!0),o=v.width(window),l=v.height(window);const{transformLeft:c,transformTop:u}=v.getTransform(i);let p=o-s+c,m=l-r+u,w=0+c,y=0+u;t.top>m?t.top=m:t.top<y&&(t.top=y),t.left>p?t.left=p:t.left<w&&(t.left=w),i.style.transitionDuration="0s",i.style.left=t.left+"px",i.style.top=t.top+"px",setTimeout(()=>{i.style.transitionDuration="0s";},300);}}else k.Alias.uiLinkAlias=Z.alert({title:{text:"网盘",position:"center"},content:{text:n,html:!0},btn:{ok:{enable:!1},close:{callback(t){k.Alias.uiLinkAlias=void 0,t.close();}}},mask:{clickCallBack(t){t(),k.Alias.uiLinkAlias=void 0;}},class:"whitesevPop",style:`
                    ${He}

                    .pops {
                        max-height: ${K.isPhone()?"50vh":"60vh"};
                    }
                    `},k.popsStyle.mainView);k.Alias.uiLinkAlias.popsElement.querySelectorAll(".netdisk-url-box-all .netdisk-url-box").forEach(t=>{let i=t.querySelector(".netdisk-link").getAttribute("data-netdisk"),s=parseInt(t.querySelector(".netdisk-link").getAttribute("data-netdisk-index")),r=t.querySelector(".netdisk-link").getAttribute("data-sharecode"),o=t.querySelector(".netdisk-link").getAttribute("data-accesscode");x.check(t,i,s,r,o);});},initViewEvent(){k.setRightClickMenu(k.Alias.uiLinkAlias.$shadowRoot,".whitesevPop .netdisk-url a"),this.registerIconGotoPagePosition(k.Alias.uiLinkAlias.$shadowRoot),this.setNetDiskUrlClickEvent(k.Alias.uiLinkAlias.$shadowRoot,".netdisk-url a"),k.setGlobalRightClickMenu(k.Alias.uiLinkAlias.$shadowRoot.querySelector(".pops .pops-alert-title > p"));},createElementAttributeRuleInfoJSON(e){return {"data-netdisk":e.netDisk,"data-netdisk-index":e.netDiskIndex,"data-sharecode":e.shareCode,"data-accesscode":e.accessCode}},handleElementAttributeRuleInfo(e,a){let n=this.createElementAttributeRuleInfoJSON(e);for(const t in n){const i=n[t];Array.isArray(a)?a.forEach(s=>{s.setAttribute(t,i.toString());}):a.setAttribute(t,i.toString());}},praseElementAttributeRuleInfo(e){let a={netDiskName:e.getAttribute("data-netdisk"),netDiskIndex:parseInt(e.getAttribute("data-netdisk-index")),shareCode:e.getAttribute("data-sharecode"),accessCode:e.getAttribute("data-accesscode")};return isNaN(a.netDiskIndex)&&(h.warn(["元素上的netDiskIndex的值是NaN",e]),a.netDiskIndex=0),a},createViewBoxElementInfo(e,a,n,t,i,s){let r=v.createElement("div",{className:"netdisk-url-box",innerHTML:`
			<div class="netdisk-url-div">
                <div class="netdisk-icon">
                    <div class="netdisk-icon-img">
                    </div>
                </div>
                <div class="netdisk-status">

                </div>
                <div class="netdisk-url">
                    <a  class="netdisk-link" href="javascript:;" isvisited="false"></a>
                </div>
            </div>
			`}),o=r.querySelector(".netdisk-url-div"),l=r.querySelector(".netdisk-icon"),c=r.querySelector(".netdisk-icon-img"),u=r.querySelector(".netdisk-status"),p=r.querySelector(".netdisk-url"),m=r.querySelector(".netdisk-link");return c.style.cssText=`background: url(${e}) no-repeat;background-size: 100%;`,m.innerHTML=s,this.handleElementAttributeRuleInfo({netDisk:a,netDiskIndex:n,shareCode:t,accessCode:i},[c,m]),{$viewBox:r,$urlDiv:o,$icon:l,$iconImg:c,$checkValidStatus:u,$url:p,$link:m,html:r.outerHTML}},setNetDiskUrlClickEvent(e,a){function n(t){t.target.setAttribute("isvisited","true");let i=t.target;const{netDiskName:s,netDiskIndex:r,shareCode:o,accessCode:l}=re.praseElementAttributeRuleInfo(i);let c=P.function.linkClickMode(s);if(c==="copy")oe.copy(s,r,o,l);else if(c==="openBlank"){let u=J.getBlankUrl(s,r,o,l);P.schemeUri.isForwardBlankLink(s)?oe.openBlankWithScheme(s,r,o,l):oe.openBlank(u,s,r,o,l);}else c==="parseFile"?oe.parseFile(s,r,o,l):(h.error("未知点击动作："+c),f.error("未知点击动作："+c));}v.on(e,"click",a,n);},registerContextMenu(e,a,n=[],t="whitesevSuspensionContextMenu"){let i=[];n.forEach(r=>{i.push({icon:"",iconIsLoading:!1,text:r.text,callback:r.callback});});let s={target:e,targetSelector:a,data:i,isAnimation:!1,className:t,only:!0};Z.rightClickMenu(s);},addLinkView(e,a,n,t,i){if(k.netDiskHistoryMatch.setNetDiskHistoryMatchData(e,a,n,t,i),!k.Alias.uiLinkAlias)return;h.info([e,a,n,t]);let s=k.src.icon[e],r=b.handleLinkShow(e,a,n,t,i),o=this.createViewBoxElementInfo(s,e,a,n,t,r),l=k.Alias.uiLinkAlias.popsElement.querySelector(".netdisk-url-box-all");v.append(l,o.$viewBox);let c=l.children[l.children.length-1];x.check(c,e,a,n,t);},changeLinkView(e,a,n,t,i){if(k.netDiskHistoryMatch.setNetDiskHistoryMatchData(e,a,n,t,i),!k.Alias.uiLinkAlias)return;let s=b.handleLinkShow(e,a,n,t,i),r=k.Alias.uiLinkAlias.popsElement.querySelector(`.netdisk-url a[data-sharecode='${n}'][data-netdisk-index='${a}']`);h.info("修改网盘链接视图"),h.info(r),r.setAttribute("data-accesscode",t),v.html(r,s);},registerIconGotoPagePosition(e){let a,n,t;v.on(e,"click",".whitesevPop .netdisk-icon .netdisk-icon-img",function(i){let r=i.target.getAttribute("data-sharecode");if(g.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode"].value){if(typeof r!="string"){f.error("获取data-sharecode属性失败");return}if(t==null?t=r:t!==r&&(h.info(`上一个搜索：${t}，切换至：${r}`),a=void 0,n=void 0,t=r),a==null&&(a=d.findElementsWithText(document.documentElement,r),n=a.next()),n!=null&&n.value)if(h.success(["定位元素",n]),n.value.nodeType===Node.ELEMENT_NODE&&n.value.getClientRects().length){if(n.value.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),g.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode-with-select"].value){let o=n.value.innerText||n.value.textContent,l,c,u;if(o.includes(r)){let p=Array.from(n.value.childNodes).filter(m=>m.nodeType===Node.TEXT_NODE);for(const m of p)if(m.textContent.includes(r)){l=m,c=m.textContent.indexOf(r),u=c+r.length;break}}try{d.selectElementText(n.value,l,c,u);}catch(p){h.error(p),d.selectElementText(n.value);}}}else if(n.value.nodeType===Node.TEXT_NODE&&n.value.parentElement.getClientRects().length)if(g.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode-with-select"].value){let o=n.value.textContent||n.value.nodeValue,l=n.value,c=o.indexOf(r),u=c+r.length;try{d.selectElementText(n.value,l,c,u);}catch(m){h.error(m),d.selectElementText(n.value.parentElement);}let p=globalThis.getSelection();if(p.rangeCount>0){let w=p.getRangeAt(0).getBoundingClientRect(),y=globalThis.scrollY,R=w.top+y-globalThis.innerHeight/2;globalThis.scrollTo({behavior:"smooth",top:R});}else n.value.parentElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"});}else try{let o=new Range;o.selectNodeContents(n.value);let l=o.getBoundingClientRect(),c=globalThis.scrollY,u=l.top+c-globalThis.innerHeight/2;globalThis.scrollTo({behavior:"smooth",top:u});}catch(o){h.error(o),n.value.parentElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"});}else h.error(["无法定位该元素位置",n.value]),f.error(`无法定位该元素位置，类型：<${(n.value.nodeName||n.value.localName||n.value.tagName).toLowerCase()}>`,{html:!1});if(n=a.next(),n.done){if(!g.smallIconNavgiator["pops-netdisk-icon-click-event-loop-find-sharecode"].value){f.info("已经定位至最后一个元素了");return}a=void 0,n=void 0;}}});}},Xt={async init(e,a,n){let t=await C.get(`https://webapi.115.com/share/snap?share_code=${a}&offset=0&limit=20&receive_code=&cid=`,{headers:{Accept:"application/json, text/javascript, */*;","User-Agent":d.getRandomPCUA(),Host:"webapi.115.com",Referer:"https://115.com/",Origin:"https://115.com"},allowInterceptConfig:!1,onerror(){},ontimeout(){}});if(!t.status)return d.isNull(t.data.responseText)?x.status.failed:x.status.error;let i=d.toJSON(t.data.responseText);if(i.state)return x.status.success;if(typeof i.error=="string"){if(i.error.includes("访问码"))return x.status.needAccessCode;if(i.error.includes("链接")||i.error.includes("分享已取消"))return x.status.failed}return x.status.unknown}},Qt={loading:{code:1,msg:"验证中",setView(e,a){x.setViewCheckValid(e,"loading"),e.innerHTML=K.config.iconSVG.loading;}},success:{code:200,msg:"该链接有效",setView(e,a){x.setViewCheckValid(e,"success"),e.innerHTML=`
			<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
				<path
				fill="currentColor"
				d="M874.119618 149.859922A510.816461 510.816461 0 0 0 511.997 0.00208a509.910462 509.910462 0 0 0-362.119618 149.857842c-199.817789 199.679789-199.817789 524.581447 0 724.260236a509.969462 509.969462 0 0 0 362.119618 149.857842A508.872463 508.872463 0 0 0 874.119618 874.120158c199.836789-199.679789 199.836789-524.581447 0-724.260236zM814.94268 378.210681L470.999043 744.132295a15.359984 15.359984 0 0 1-5.887994 4.095996c-1.751998 1.180999-2.913997 2.362998-5.276994 2.913997a34.499964 34.499964 0 0 1-13.469986 2.914997 45.547952 45.547952 0 0 1-12.897986-2.303998l-4.095996-2.363997a45.291952 45.291952 0 0 1-7.009992-4.095996l-196.902793-193.789796a34.126964 34.126964 0 0 1-10.555989-25.186973c0-9.37399 3.583996-18.74698 9.98399-25.186974a36.429962 36.429962 0 0 1 50.372947 0l169.98382 167.423824L763.389735 330.220732a37.059961 37.059961 0 0 1 50.371947-1.732998 33.647965 33.647965 0 0 1 11.165988 25.186973 35.544963 35.544963 0 0 1-9.98399 24.575974v-0.04z m0 0"></path>
			</svg>
			`,x.setViewAgainCheckClickEvent(e,a);}},error:{code:-404,msg:"网络异常",setView(e,a){x.setViewCheckValid(e,"error"),e.innerHTML=`
			<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
				<path
				fill="currentColor"
				d="M511.808 692.224c-18.048 0-35.136 3.968-50.432 11.392-25.472 12.416-46.528 33.92-57.792 60.032-5.632 14.144-9.024 29.504-9.024 45.952 0 65.152 52.672 117.824 117.248 117.824 65.28 0 117.952-52.672 117.952-117.824 0-64.64-52.672-117.376-117.952-117.376z m0 178.496c-33.408 0-60.608-27.712-60.608-61.12 0-33.472 27.2-60.672 60.608-60.672s61.248 27.2 61.248 60.672c0 33.472-27.776 61.12-61.248 61.12zM286.784 661.632c3.968 3.392 8.512 5.632 12.992 5.632L438.08 523.328c-60.032 14.72-114.432 49.344-155.328 98.624-9.536 11.84-7.872 30.08 4.032 39.68zM622.912 534.656l-43.008 45.312c45.312 13.056 86.72 40.256 117.376 78.208 5.632 6.784 13.568 10.24 22.08 10.24 6.272 0 12.416-2.24 18.176-6.784 11.904-9.6 13.568-27.84 3.392-39.68-31.808-39.104-72.704-69.12-118.016-87.296zM511.808 391.168c17.024 0 33.408 1.216 49.856 3.456l47.68-49.856c-31.744-6.848-64.064-10.24-97.536-10.24-142.784 0-277.12 63.488-367.232 174.656-10.24 11.904-8.576 30.08 3.904 39.68 5.12 4.48 11.328 6.784 18.176 6.784 7.936 0 15.872-3.968 21.568-10.816 79.872-97.536 197.76-153.664 323.584-153.664zM751.616 400.32l-40.256 41.92c47.04 24.96 89.536 60.032 124.096 102.592 10.24 12.48 27.84 14.208 40.256 3.968 11.968-9.6 13.632-27.84 3.968-39.68-36.16-44.8-79.872-81.088-128.064-108.8zM705.152 244.928l42.56-44.672c-73.664-28.992-153.6-44.224-235.904-44.224-196.672 0-380.864 87.872-505.6 239.744-9.6 12.48-7.872 30.08 3.968 40.256 5.632 3.968 11.904 6.208 18.112 6.208 7.936 0 16.448-3.392 22.144-10.176C163.84 292.608 332.096 212.672 511.808 212.672c66.944 0 132.16 10.752 193.344 32.256zM1017.472 395.776c-40.192-49.92-87.296-92.416-139.456-126.976l-39.68 41.344C889.408 343.04 935.36 383.808 973.888 432c9.6 11.904 27.776 13.568 39.68 3.968 11.84-10.176 14.144-27.712 3.904-40.192zM937.408 104.512c-11.328-10.944-29.312-10.496-40.064 0.832L179.008 854.72c-10.816 11.328-10.496 29.248 0.896 40.064 5.44 5.312 12.48 7.872 19.584 7.872 7.488 0 14.848-2.88 20.416-8.704L938.24 144.576c10.88-11.328 10.496-29.248-0.832-40.064z"></path>
			</svg>
			`,x.setViewAgainCheckClickEvent(e,a);}},failed:{code:0,msg:"该链接已失效",setView(e,a){x.setViewCheckValid(e,"failed"),e.innerHTML=`
			<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
				<path
					fill="currentColor"
					d="M549.044706 512l166.189176-166.249412a26.383059 26.383059 0 0 0 0-36.98447 26.383059 26.383059 0 0 0-37.044706 0L512 475.015529l-166.249412-166.249411a26.383059 26.383059 0 0 0-36.98447 0 26.383059 26.383059 0 0 0 0 37.044706L475.015529 512l-166.249411 166.249412a26.383059 26.383059 0 0 0 0 36.98447 26.383059 26.383059 0 0 0 37.044706 0L512 548.984471l166.249412 166.249411a26.383059 26.383059 0 0 0 36.98447 0 26.383059 26.383059 0 0 0 0-37.044706L548.984471 512zM512 1024a512 512 0 1 1 0-1024 512 512 0 0 1 0 1024z"></path>
			</svg>
			`,x.setViewAgainCheckClickEvent(e,a);}},needAccessCode:{code:201,msg:"该链接缺失提取码",setView(e,a){x.setViewCheckValid(e,"needAccessCode"),e.innerHTML=`
			<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
				<path
				fill="currentColor"
				d="M757.810429 373.751333 325.645708 373.751333l0-83.895759c0-103.694687 81.507362-184.922686 185.559183-184.922686 78.121242 0 146.053424 46.74565 173.062568 119.090329 3.865028 10.352789 15.384385 15.609513 25.742291 11.746532 10.351766-3.866051 15.609513-15.390525 11.744485-25.742291C688.844707 121.877815 606.198405 64.918545 511.204891 64.918545c-61.918211 0-119.246895 23.662933-161.423483 66.63156-41.3692 42.142819-64.151066 98.363262-64.151066 158.305469l0 83.895759-20.007683 0c-60.774155 0-110.042255 49.267077-110.042255 110.042255l0 366.139981c0 60.774155 49.267077 110.042255 110.042255 110.042255l492.187769 0c60.775178 0 110.042255-49.267077 110.042255-110.042255L867.852684 483.793588C867.852684 423.01841 818.585607 373.751333 757.810429 373.751333zM827.837318 849.933569c0 38.674834-31.352055 70.02689-70.02689 70.02689L265.62266 919.960459c-38.674834 0-70.02689-31.352055-70.02689-70.02689L195.59577 483.793588c0-38.674834 31.352055-70.02689 70.02689-70.02689l492.187769 0c38.674834 0 70.02689 31.352055 70.02689 70.02689L827.837318 849.933569z"></path>
				<path
				fill="currentColor"
				d="M509.715981 583.832002c-11.048637 0-20.007683 8.959046-20.007683 20.007683l0 110.042255c0 11.048637 8.958022 20.007683 20.007683 20.007683s20.007683-8.958022 20.007683-20.007683L529.723663 603.839685C529.723663 592.790024 520.765641 583.832002 509.715981 583.832002z"></path>
			</svg>
			`,x.setViewAgainCheckClickEvent(e,a);}},partialViolation:{code:202,msg:"存在部分违规文件",setView(e,a){x.setViewCheckValid(e,"partial-violation"),e.innerHTML=`
			<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
				<path 
				fill="currentColor"
				d="M954.963 810.267L543.112 96.919c-14.07-24.37-49.245-24.37-63.315 0L67.945 810.267c-14.07 24.37 3.518 54.832 31.657 54.832h823.703c28.141 0 45.728-30.463 31.658-54.832zM476.699 306.55c0-19.115 15.64-34.755 34.755-34.755 19.115 0 34.755 15.64 34.755 34.755v281.817c0 19.115-15.64 34.755-34.755 34.755-19.115 0-34.755-15.64-34.755-34.755V306.55z m34.755 445.293c-23.198 0-42.004-18.806-42.004-42.004s18.806-42.004 42.004-42.004c23.198 0 42.004 18.806 42.004 42.004s-18.806 42.004-42.004 42.004z"></path>
			</svg>`;}},unknown:{code:-200,msg:"未知检查情况",setView(e,a){x.setViewCheckValid(e,"unknown"),e.innerHTML=`
			<svg viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg">
				<path
				fill="currentColor"
				d="M512.473172 1023.995242A511.814852 511.814852 0 0 1 313.545134 40.351073a512.244696 512.244696 0 0 1 398.855715 943.658633 508.815937 508.815937 0 0 1-199.927677 39.985536z m0-943.658634C274.559237 80.336608 80.629391 274.266455 80.629391 512.18039s193.929846 431.843781 431.843781 431.843781 431.843781-193.929846 431.843781-431.843781S751.386745 80.336608 512.473172 80.336608z"></path>
				<path
				fill="currentColor"
				d="M506.475342 716.10662a39.985535 39.985535 0 0 1-39.985536-39.985535v-76.972156c0-79.971071 64.976495-144.947566 144.947566-144.947565a77.971794 77.971794 0 0 0 0-155.943588H445.4974a56.979388 56.979388 0 0 0-56.979387 56.979388 39.985535 39.985535 0 0 1-79.971071 0c0-74.972879 60.977941-136.950458 136.950458-136.950459h164.940333c86.968539 0 157.942864 70.974325 157.942865 157.942865s-69.974687 157.942864-157.942865 157.942864a64.976495 64.976495 0 0 0-64.976494 64.976495v76.972156a39.985535 39.985535 0 0 1-38.985897 39.985535zM505.475703 742.097218a48.982281 48.982281 0 1 0 48.982281 48.982281 48.982281 48.982281 0 0 0-48.982281-48.982281z"></path>
			</svg>
			`,x.setViewAgainCheckClickEvent(e,a);}}},en={baidu:It,lanzou:Ft,lanzouyx:Pt,tianyiyun:Vt,aliyun:Ot,wenshushu:Bt,nainiu:Ht,_123pan:Zt,weiyun:jt,xunlei:qt,_115pan:Xt,chengtong:Wt,kuake:Kt,jianguoyun:Jt,onedrive:Yt,uc:Gt},x={$data:{isSubscribing:!1,subscribe:[]},status:Qt,netDisk:en,async check(e,a,n,t,i){if(this.$data.subscribe.push({netDiskViewBox:e,netDiskName:a,netDiskIndex:n,shareCode:t,accessCode:i}),!this.$data.isSubscribing){this.$data.isSubscribing=!0;for(let s=0;s<this.$data.subscribe.length;s++){const r=this.$data.subscribe[s];await this.checkLinkValidity(r,!0),await d.sleep(250),this.$data.subscribe.splice(s,1),s--;}this.$data.isSubscribing=!1;}},async checkLinkValidity(e,a){let n=e.netDiskViewBox.querySelector(".netdisk-status");if(this.isViewCheckValid(n)&&!a)return;let t=e.netDiskName;if(!P.function.checkLinkValidity(t)){h.error(["未开启checkLinkValidity功能",e]);return}let i=this.netDisk[e.netDiskName];if(!i||i&&typeof i.init!="function"){h.error(["没有配置该网盘的校验有效性",e]);return}this.status.loading.setView(n,e);let s=await i.init(e.netDiskIndex,e.shareCode,e.accessCode);if(!s){h.error(["该验证函数的返回值不是有效值",[s,e]]);return}s.setView(n,e);},setViewAgainCheckClickEvent(e,a){v.on(e,"click",void 0,()=>{const n=e.closest(".netdisk-url-div"),t=n.querySelector(".netdisk-link"),i=re.praseElementAttributeRuleInfo(t);let s={netDiskViewBox:n,netDiskName:i.netDiskName,netDiskIndex:i.netDiskIndex,shareCode:i.shareCode,accessCode:i.accessCode};this.checkLinkValidity(s,!0);},{once:!0});},isViewCheckValid(e){return !(!e.hasAttribute("data-check-valid")||e.getAttribute("data-check-valid")==="error")},setViewCheckValid(e,a){e.setAttribute("data-check-valid",a);},removeViewCheckValid(e){e.removeAttribute("data-check-valid");},isStatusSuccess(e){return Math.floor(e.code/100)===2},getStatusName(e){for(const a of Object.keys(x.status)){let n=this.status[a];if(e.code===n.code)return a}}},tn={requiredFileMap:new Map,async file(e,a){if(d.isNull(e))return h.error(["NetDiskRequire.file的参数path为空",e]),!1;if(this.requiredFileMap.has(e))return h.warn(["NetDiskRequire.file的参数path已引入过",e]),!0;let n=await C.get(e,a);if(!n.status)return !1;let t=n.data.responseText,i=this.requiredFileMap.get(e);return this.requiredFileMap.set(e,i++),h.info(["加载js文件",e]),Q.eval(`
		let exports = void 0;
		let module = void 0;
		let define = void 0;
		`+t),await d.sleep(300),!0}},Xe=e=>({"matchRange-text-before":P.matchRange_text.before(e).toString(),"matchRange-text-after":P.matchRange_text.after(e).toString()}),Qe=e=>({"matchRange-html-before":P.matchRange_html.before(e).toString(),"matchRange-html-after":P.matchRange_html.after(e).toString()}),X={KEY:"userRule",userRuleContextDataKey:"userRuleContextData",$data:{__userRule:null,get userRule(){return this.__userRule==null&&(this.__userRule=new d.Dictionary),this.__userRule}},init(){this.parseRule(this.getAllRule()).forEach(a=>{this.$data.userRule.set(a.setting.key,a);});},parseRuleStrToRule(e){function a(t){return typeof t.link_innerText!="string"?{success:!1,msg:"regexp缺失的键名: link_innerText，类型: string"}:typeof t.link_innerHTML!="string"?{success:!1,msg:"regexp缺失的键名: link_innerHTML，类型: string"}:typeof t.shareCode!="string"?{success:!1,msg:"regexp缺失的键名: shareCode，类型: string"}:typeof t.shareCodeNeedRemoveStr!="string"?{success:!1,msg:"regexp缺失的键名: shareCodeNeedRemoveStr，类型: string"}:typeof t.uiLinkShow!="string"?{success:!1,msg:"regexp缺失的键名: uiLinkShow，类型: string"}:typeof t.blank!="string"?{success:!1,msg:"regexp缺失的键名: blank，类型: string"}:typeof t.copyUrl!="string"?{success:!1,msg:"regexp缺失的键名: copyUrl，类型: string"}:typeof t.accessCode=="string"&&typeof t.checkAccessCode!="string"?{success:!1,msg:"regexp设置了accessCode但是没有设置checkAccessCode"}:typeof t.accessCode!="string"&&typeof t.checkAccessCode=="string"?{success:!1,msg:"regexp设置了checkAccessCode但是没有设置accessCode"}:{success:!0,msg:"校验rule成功"}}function n(t){return typeof t.name!="string"?{success:!1,msg:"setting缺失的键名: name，类型: string"}:typeof t.enable!="boolean"?{success:!1,msg:"setting缺失的键名: enable，类型: boolean"}:{success:!0,msg:"校验setting成功"}}try{let t=JSON.parse(e);if(typeof t!="object")return {success:!1,msg:"该规则不是object类型"};if(typeof t.key!="string")return {success:!1,msg:"缺失的键名: key，类型: string"};if(typeof t.regexp!="object")return {success:!1,msg:"缺失的键名: regexp，类型: object|Arrany"};if(typeof t.setting!="object")return {success:!1,msg:"缺失的键名: setting，类型: object"};if(Array.isArray(t.regexp))for(const s of t.regexp){let r=a(s);if(!r.success)return r}else {let s=a(t.regexp);if(!s.success)return s}let i=n(t.setting);return i.success?{success:!0,msg:"解析成功",data:t}:i}catch(t){return h.error(t),{success:!1,msg:t.message}}},getBindContext(e){let a=new Je(X.userRuleContextDataKey);return {rule:e,NetDiskRequire:tn,CryptoJS:zn,httpx:C,utils:d,DOMUtils:v,window,unsafeWindow:Q,NetDiskCheckLinkValidity:x,log:h,Qmsg:f,pops:K,setValue:a.set.bind(a),getValue:a.get.bind(a),deleteValue:a.delete.bind(a)}},parseRule(e){function a(t,i,s){const{shareCode:r,shareCodeNeedRemoveStr:o,shareCodeNotMatch:l,checkAccessCode:c,accessCode:u,acceesCodeNotMatch:p,paramMatch:m,...w}=s;let y={...w};return y.link_innerText=U.replaceParam(y.link_innerText,Xe(t)),y.link_innerHTML=U.replaceParam(y.link_innerText,Qe(t)),typeof r=="string"&&(y.shareCode=new RegExp(r,"ig")),typeof o=="string"&&(y.shareCodeNeedRemoveStr=new RegExp(o,"ig")),typeof l=="string"&&(y.shareCodeNotMatch=new RegExp(l,"ig")),typeof c=="string"&&(y.checkAccessCode=new RegExp(c,"ig")),typeof u=="string"&&(y.accessCode=new RegExp(u,"ig")),typeof p=="string"&&(y.acceesCodeNotMatch=new RegExp(p,"ig")),typeof m=="string"&&(y.paramMatch=new RegExp(m,"i")),y}let n=[];for(const t of e){let i={rule:[],setting:{name:t.setting.name,key:t.key,configurationInterface:{matchRange_text:{},matchRange_html:{},function:{},linkClickMode_openBlank:{},schemeUri:{},ownFormList:[]}},isUserRule:!0};const s=t.regexp,r=t.key;if(Array.isArray(s)?s.forEach(c=>{i.rule.push(a(r,t,c));}):i.rule.push(a(r,t,s)),t.setting){if(this.initDefaultValue(L.function.enable(r),!!t.setting.enable),i.setting.configurationInterface.function.enable=!!t.setting.enable,typeof t.setting.isBlank=="boolean"&&(this.initDefaultValue(L.function.linkClickMode(r),"openBlank"),i.setting.configurationInterface.function.linkClickMode={openBlank:{default:!0,enable:!0}}),typeof t.setting.linkClickMode=="object"){let c=d.assign(U.getDefaultLinkClickMode(),t.setting.linkClickMode||{}),u=null,p=Object.keys(c).map(m=>{let w=c[m];if(w.enable)return w.default&&(u=m),{value:m,text:w.text}}).filter(m=>m!=null);u==null&&(u=p[0].value),this.initDefaultValue(L.function.linkClickMode(r),u);}typeof t.setting.openBlankWithCopyAccessCode=="boolean"&&(this.initDefaultValue(L.linkClickMode_openBlank.openBlankWithCopyAccessCode(r),!!t.setting.openBlankWithCopyAccessCode),i.setting.configurationInterface.linkClickMode_openBlank.openBlankWithCopyAccessCode=!!t.setting.openBlankWithCopyAccessCode),typeof t.setting.checkLinkValidity=="boolean"&&(this.initDefaultValue(L.function.checkLinkValidity(r),!!t.setting.checkLinkValidity),i.setting.configurationInterface.function.checkLinkValidity=!!t.setting.checkLinkValidity),typeof t.setting.isForward=="boolean"&&(this.initDefaultValue(L.schemeUri.enable(r),!!t.setting.isForward),i.setting.configurationInterface.schemeUri.enable=!!t.setting.isForward),typeof t.setting.schemeUri=="string"&&(this.initDefaultValue(L.schemeUri.uri(r),t.setting.schemeUri),i.setting.configurationInterface.schemeUri.uri=t.setting.schemeUri),typeof t.setting.innerTextAccessCodeBeforeMaxRange=="number"&&(this.initDefaultValue(L.matchRange_text.before(r),t.setting.innerTextAccessCodeBeforeMaxRange),i.setting.configurationInterface.matchRange_text.before=t.setting.innerTextAccessCodeBeforeMaxRange),typeof t.setting.innerTextAccessCodeAfterMaxRange=="number"&&(this.initDefaultValue(L.matchRange_text.after(r),t.setting.innerTextAccessCodeAfterMaxRange),i.setting.configurationInterface.matchRange_text.after=t.setting.innerTextAccessCodeAfterMaxRange),typeof t.setting.innerHTMLAccessCodeBeforeMaxRange=="number"&&(this.initDefaultValue(L.matchRange_html.before(r),t.setting.innerHTMLAccessCodeBeforeMaxRange),i.setting.configurationInterface.matchRange_html.before=t.setting.innerHTMLAccessCodeBeforeMaxRange),typeof t.setting.innerHTMLAccessCodeAfterMaxRange=="number"&&(this.initDefaultValue(L.matchRange_html.after(r),t.setting.innerHTMLAccessCodeAfterMaxRange),i.setting.configurationInterface.matchRange_html.after=t.setting.innerHTMLAccessCodeAfterMaxRange);}if(typeof t.icon=="string"){let c=t.icon;k.src.addIcon(r,c);}const o=Object.getPrototypeOf(async function(){}).constructor;if(typeof t.checkLinkValidityFunction=="string")try{Reflect.set(x.netDisk,r,{init:new o("netDiskIndex","shareCode","accessCode",t.checkLinkValidityFunction).bind(this.getBindContext(t))});}catch(c){h.error(c);}if(typeof t.AuthorizationFunction=="string")try{Fe.netDisk[r]=new o(t.AuthorizationFunction).bind(this.getBindContext(t));}catch(c){h.error(c);}if(typeof t.AutoFillAccessCodeFunction=="string")try{Ce.netDisk[r]=new o("netDiskInfo",t.AutoFillAccessCodeFunction).bind(this.getBindContext(t));}catch(c){h.error(c);}if(typeof t.parseFunction=="string")try{Reflect.set(Ne.netDisk,r,new Function(t.parseFunction).bind(this.getBindContext(t)));}catch(c){h.error(c);}let l=n.find(c=>c.setting.key===i.setting.key);l?l.rule=l.rule.concat(i.rule):n.push(i);}return n},getNetDiskRuleConfig(){return this.$data.userRule.values()},initDefaultValue(e,a){O(e)==null&&z(e,a);},getTemplateRule(){let e={key:"规则名",icon:"图标链接字符串或图片的base64字符串",regexp:[{link_innerText:"",link_innerHTML:"",shareCode:"",shareCodeNeedRemoveStr:"",uiLinkShow:"",blank:"",copyUrl:""}],setting:{name:"设置界面的名字",enable:!0,linkClickMode:"openBlank",openBlankWithCopyAccessCode:!0}};return this.getFormatRule(e)},addRule(e){let a=this.getAllRule();a.push(e),z(X.KEY,a);},setRule(e,a){if(Array.isArray(a))z(X.KEY,a);else {let n=this.getAllRule(),t=n.findIndex(i=>i.key===e);if(t!==-1)n[t]=null,n[t]=a;else return h.error(["覆盖规则失败",a]),f.error("覆盖规则失败"),!1;this.setRule(e,n);}},deleteRule(e){let a=this.getAllRule(),n=a.findIndex(t=>t.key===e);return n!==-1?(a.splice(n,1),this.setRule(e,a),!0):!1},clearRule(){Ke(X.KEY);},getAllRule(){return O(X.KEY,[])},getRule(e){return O(X.KEY,[]).find(n=>n.key===e)},getFormatRule(e){return JSON.stringify(e||this.getAllRule(),void 0,4)}},nn={rule:[{link_innerText:"pan.baidu.com/s/[0-9a-zA-Z-_]{6,24}([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码|\\?pwd=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"pan.baidu.com/s/[0-9a-zA-Z-_]{6,24}([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码|\\?pwd=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/pan\.baidu\.com\/s\/([0-9a-zA-Z-_]+)/gi,shareCodeNeedRemoveStr:/pan\.baidu\.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码|pwd=)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"pan.baidu.com/s/{#shareCode#}?pwd={#accessCode#}",blank:"https://pan.baidu.com/s/{#shareCode#}?pwd={#accessCode#}",copyUrl:"https://pan.baidu.com/s/{#shareCode#}?pwd={#accessCode#}"},{link_innerText:"pan.baidu.com/(share|wap)/init\\?surl=[0-9a-zA-Z-_]{5,24}([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码|&pwd=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"pan.baidu.com/(share|wap)/init\\?surl=[0-9a-zA-Z-_]{5,24}([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码|&pwd=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/pan\.baidu\.com\/(share|wap)\/init\?surl=([0-9a-zA-Z-_]+)/gi,shareCodeNeedRemoveStr:/pan\.baidu\.com\/(share|wap)\/init\?surl=/gi,checkAccessCode:/(密码|访问码|提取码|&pwd=)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"pan.baidu.com/share/init?surl={#shareCode#}&pwd={#accessCode#}",blank:"https://pan.baidu.com/share/init?surl={#shareCode#}&pwd={#accessCode#}",copyUrl:"https://pan.baidu.com/share/init?surl={#shareCode#}&pwd={#accessCode#}"}],setting:{name:"百度网盘",key:"baidu",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardBlankLink:!0,uri:""}}}},he="GM_Panel",et="data-init",le="data-key",me="data-default-value",an="data-init-more-value",q="data-storage-api",Re=function(e,a,n,t,i,s="",r,o){let l={text:e,type:"input",isNumber:!!r,isPassword:!!o,props:{},attributes:{},description:t,getValue(){return this.props[q].get(a,n)},callback(c,u){this.props[q].set(a,u);},placeholder:s};return Reflect.set(l.attributes,le,a),Reflect.set(l.attributes,me,n),Reflect.set(l.props,q,{get(c,u){return O(c,u)},set(c,u){z(c,u);}}),l},sn=()=>({rule:[{link_innerText:"(lanzou[a-z]{0,1}|lan[a-z]{2}).com/(tp/|u/|)([a-zA-Z0-9_-]{5,22}|[%0-9a-zA-Z]{4,90}|[\\u4e00-\\u9fa5]{1,20})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[a-zA-Z0-9]{3,6}|)",link_innerHTML:"(lanzou[a-z]{0,1}|lan[a-z]{2}).com/(tp/|u/|)([a-zA-Z0-9_-]{5,22}|[%0-9a-zA-Z]{4,90}|[\\u4e00-\\u9fa5]{1,20})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[a-zA-Z0-9]{3,6}|)",shareCode:/(lanzou[a-z]{0,1}|lan[a-z]{2}).com\/(tp\/|u\/|)([a-zA-Z0-9_\-]{5,22}|[%0-9a-zA-Z]{4,90}|[\u4e00-\u9fa5]{1,20})/gi,shareCodeNeedRemoveStr:/(lanzou[a-z]{0,1}|lan[a-z]{2}).com\/(tp\/|u\/|)/gi,shareCodeExcludeRegular:["lanzouyx"],checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{3,})/gi,uiLinkShow:`${ee.hostname}/{#shareCode#} 提取码: {#accessCode#}`,blank:`https://${ee.hostname}/{#shareCode#}`,copyUrl:`https://${ee.hostname}/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"(lanzou[a-z]{0,1}|lan[a-z]{2}).com/s/([a-zA-Z0-9_-]{5,22}|[%0-9a-zA-Z]{4,90}|[\\u4e00-\\u9fa5]{1,20})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[a-zA-Z0-9]{3,6}|)",link_innerHTML:"(lanzou[a-z]{0,1}|lan[a-z]{2}).com/s/([a-zA-Z0-9_-]{5,22}|[%0-9a-zA-Z]{4,90}|[\\u4e00-\\u9fa5]{1,20})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[a-zA-Z0-9]{3,6}|)",shareCode:/(lanzou[a-z]{0,1}|lan[a-z]{2}).com\/s\/([a-zA-Z0-9_\-]{5,22}|[%0-9a-zA-Z]{4,90}|[\u4e00-\u9fa5]{1,20})/gi,shareCodeNeedRemoveStr:/(lanzou[a-z]{0,1}|lan[a-z]{2}).com\/s\//gi,shareCodeExcludeRegular:["lanzouyx"],checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{3,})/gi,uiLinkShow:`${ee.hostname}/s/{#shareCode#} 提取码: {#accessCode#}`,blank:`https://${ee.hostname}/s/{#shareCode#}`,copyUrl:`https://${ee.hostname}/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"蓝奏云",key:"lanzou",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0},parseFile:{enable:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardLinearChain:!1,isForwardBlankLink:!1,uri:""},ownFormList:[{text:"其它配置",type:"forms",forms:[Re("蓝奏云域名",ee.MENU_KEY,ee.DEFAULT_HOST_NAME,"",void 0,`例如：${ee.DEFAULT_HOST_NAME}`)]}]}}}),rn={rule:[{link_innerText:"ilanzou.com/s/([a-zA-Z0-9_-]{5,22})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码|\\?code=)[\\s\\S]{0,{#matchRange-text-after#}}[a-zA-Z0-9]{3,6}|)",link_innerHTML:"ilanzou.com/s/([a-zA-Z0-9_-]{5,22})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码|\\?code=)[\\s\\S]{0,{#matchRange-html-after#}}[a-zA-Z0-9]{3,6}|)",shareCode:/ilanzou.com\/s\/([a-zA-Z0-9_\-]{5,22})/gi,shareCodeNeedRemoveStr:/ilanzou.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码|\?code=)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{3,})/gi,uiLinkShow:"www.ilanzou.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.ilanzou.com/s/{#shareCode#}?code={#accessCode#}",copyUrl:"https://www.ilanzou.com/s/{#shareCode#}?code={#accessCode#}"}],setting:{name:"蓝奏云优享",key:"lanzouyx",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0},parseFile:{enable:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardLinearChain:!1,isForwardBlankLink:!1,uri:""}}}},on={rule:[{link_innerText:"(cloud.189.cn/web/share\\?code=([0-9a-zA-Z_-]){8,14}|cloud.189.cn/t/([a-zA-Z0-9_-]{8,14}))([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"(cloud.189.cn/web/share\\?code=([0-9a-zA-Z_-]){8,14}|cloud.189.cn/t/([a-zA-Z0-9_-]{8,14}))([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/cloud.189.cn\/web\/share\?code=([0-9a-zA-Z_\-]){8,14}|cloud.189.cn\/t\/([a-zA-Z0-9_\-]{8,14})/gi,shareCodeNeedRemoveStr:/cloud\.189\.cn\/t\/|cloud.189.cn\/web\/share\?code=/gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"cloud.189.cn/t/{#shareCode#} 提取码: {#accessCode#}",blank:"https://cloud.189.cn/t/{#shareCode#}",copyUrl:`https://cloud.189.cn/t/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"天翼云",key:"tianyiyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0},parseFile:{enable:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardLinearChain:!1,isForwardBlankLink:!1,uri:""}}}},ln={rule:[{link_innerText:"caiyun.139.com/m/i\\?([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"caiyun.139.com/m/i\\?([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/caiyun\.139\.com\/m\/i\?([a-zA-Z0-9_\-]{8,14})/gi,shareCodeNeedRemoveStr:/caiyun\.139\.com\/m\/i\?/gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"caiyun.139.com/m/i?{#shareCode#} 提取码: {#accessCode#}",blank:"https://caiyun.139.com/m/i?{#shareCode#}",copyUrl:`https://caiyun.139.com/m/i?{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"yun.139.com/link/w/i/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"yun.139.com/link/w/i/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/yun\.139\.com\/link\/w\/i\/([a-zA-Z0-9_\-]{8,14})/gi,shareCodeNeedRemoveStr:/yun\.139\.com\/link\/w\/i\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"yun.139.com/link/w/i/{#shareCode#} 提取码: {#accessCode#}",blank:"https://yun.139.com/link/w/i/{#shareCode#}",copyUrl:`https://yun.139.com/link/w/i/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"中国移动云盘",key:"hecaiyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0}}},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardBlankLink:!1,uri:""}}}},cn={rule:[{link_innerText:"aliyundrive.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"aliyundrive.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/aliyundrive\.com\/s\/([a-zA-Z0-9_\-]{8,14})/g,shareCodeNeedRemoveStr:/aliyundrive\.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"aliyundrive.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.aliyundrive.com/s/{#shareCode#}",copyUrl:`https://www.aliyundrive.com/s/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"aliyundrive.com/t/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"aliyundrive.com/t/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/aliyundrive\.com\/t\/([a-zA-Z0-9_\-]{8,14})/g,shareCodeNeedRemoveStr:/aliyundrive\.com\/t\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"aliyundrive.com/t/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.aliyundrive.com/t/{#shareCode#}",copyUrl:`https://www.aliyundrive.com/t/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"alipan.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"alipan.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/alipan\.com\/s\/([a-zA-Z0-9_\-]{8,14})/g,shareCodeNeedRemoveStr:/alipan\.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"alipan.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.alipan.com/s/{#shareCode#}",copyUrl:`https://www.alipan.com/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"阿里云",key:"aliyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0},parseFile:{enable:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardLinearChain:!0,isForwardBlankLink:!0,uri:""}}}},dn={rule:[{link_innerText:"(wenshushu.cn/f/([a-zA-Z0-9_-]{8,14})|wenshushu.cn/k/([a-zA-Z0-9_-]{8,14}))([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"(wenshushu.cn/f/([a-zA-Z0-9_-]{8,14})|wenshushu.cn/k/([a-zA-Z0-9_-]{8,14}))([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/wenshushu.cn\/f\/([a-zA-Z0-9_-]{8,14})|wenshushu.cn\/k\/([a-zA-Z0-9_-]{8,14})/gi,shareCodeNeedRemoveStr:/wenshushu.cn\/f\/|wenshushu.cn\/k\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/[0-9a-zA-Z]{4}/gi,uiLinkShow:"www.wenshushu.cn/f/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.wenshushu.cn/f/{#shareCode#}",copyUrl:`https://www.wenshushu.cn/f/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"(wss.ink/f/([a-zA-Z0-9_-]{8,14})|ws28.cn/f/([a-zA-Z0-9_-]{8,14})|wss1.cn/f/([a-zA-Z0-9_-]{8,14})|ws59.cn/f/([a-zA-Z0-9_-]{8,14}))([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"(wss.ink/f/([a-zA-Z0-9_-]{8,14})|ws28.cn/f/([a-zA-Z0-9_-]{8,14})|wss1.cn/f/([a-zA-Z0-9_-]{8,14})|ws59.cn/f/([a-zA-Z0-9_-]{8,14}))([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/wss.ink\/f\/([a-zA-Z0-9_-]{8,14})|ws28.cn\/f\/([a-zA-Z0-9_-]{8,14})|wss1.cn\/f\/([a-zA-Z0-9_-]{8,14})|ws59.cn\/f\/([a-zA-Z0-9_-]{8,14})/gi,shareCodeNeedRemoveStr:/wss.ink\/f\/|ws28.cn\/f\/|wss1.cn\/f\/|ws59.cn\/f\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/[0-9a-zA-Z]{4}/gi,uiLinkShow:"www.wenshushu.cn/f/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.wenshushu.cn/f/{#shareCode#}",copyUrl:`https://www.wenshushu.cn/f/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"文叔叔",key:"wenshushu",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0},parseFile:{enable:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardLinearChain:!0,isForwardBlankLink:!0,uri:""}}}},un={rule:[{link_innerText:"cowtransfer.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"cowtransfer.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/cowtransfer.com\/s\/([a-zA-Z0-9_\-]{8,14})/gi,shareCodeNeedRemoveStr:/cowtransfer\.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"cowtransfer.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://cowtransfer.com/s/{#shareCode#}",copyUrl:`https://cowtransfer.com/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"奶牛",key:"nainiu",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0},parseFile:{enable:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardLinearChain:!0,isForwardBlankLink:!0,uri:""}}}},hn={rule:[{link_innerText:"weiyun.com/[0-9a-zA-Z-_]{7,24}([\\s\\S]{0,{#matchRange-text-before#}(访问码|密码|提取码)[\\s\\S]{0,{#matchRange-text-after#}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"weiyun.com/[0-9a-zA-Z-_]{7,24}([\\s\\S]{0,{#matchRange-html-before#}(访问码|密码|提取码)[\\s\\S]{0,{#matchRange-html-after#}[0-9a-zA-Z]{4,6}|)",shareCode:/weiyun.com\/([0-9a-zA-Z\-_]{7,24})/gi,shareCodeNeedRemoveStr:/weiyun.com\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"share.weiyun.com/{#shareCode#} 提取码: {#accessCode#}",blank:"https://share.weiyun.com/{#shareCode#}",copyUrl:`https://share.weiyun.com/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"微云",key:"weiyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardBlankLink:!0,uri:""}}}},pn={rule:[{link_innerText:"xunlei.com/s/[0-9a-zA-Z-_]{8,30}([\\s\\S]{0,{#matchRange-text-before#}}(\\?pwd=|访问码|提取码|密码|)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"xunlei.com/s/[0-9a-zA-Z-_]{8,30}([\\s\\S]{0,{#matchRange-html-before#}}(\\?pwd=|访问码|提取码|密码|)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/xunlei.com\/s\/([0-9a-zA-Z\-_]{8,30})/gi,shareCodeNeedRemoveStr:/xunlei.com\/s\//gi,checkAccessCode:/(\?pwd=|提取码|密码|访问码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"pan.xunlei.com/s/{#shareCode#}?pwd={#accessCode#} 提取码: {#accessCode#}",blank:"https://pan.xunlei.com/s/{#shareCode#}?pwd={#accessCode#}",copyUrl:"https://pan.xunlei.com/s/{#shareCode#}?pwd={#accessCode#}"}],setting:{name:"迅雷云盘",key:"xunlei",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0},parseFile:{enable:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardBlankLink:!0,uri:""}}}},fn={rule:[{link_innerText:"(pan.jc-box.com|download.jamcz.com)/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(pan.jc-box.com|download.jamcz.com)/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/(pan.jc-box.com|download.jamcz.com)\/d\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(pan.jc-box.com|download.jamcz.com)\/d\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,paramMatch:/([a-zA-Z0-9\.]+)\/d\//i,uiLinkShow:"{#$1#}/d/{#shareCode#} 提取码: {#accessCode#}",blank:"https://{#$1#}/d/{#shareCode#}",copyUrl:`https://{#$1#}/d/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"ct.ghpym.com/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"ct.ghpym.com/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/ct.ghpym.com\/d\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/ct.ghpym.com\/d\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,paramMatch:/([a-zA-Z0-9\.]+)\/d\//i,uiLinkShow:"{#$1#}/d/{#shareCode#} 提取码: {#accessCode#}",blank:"http://{#$1#}/d/{#shareCode#}",copyUrl:`http://{#$1#}/d/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"ctfile.com/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"ctfile.com/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/ctfile.com\/d\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/ctfile.com\/d\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"url95.ctfile.com/d/{#shareCode#} 提取码: {#accessCode#}",blank:"https://url95.ctfile.com/d/{#shareCode#}",copyUrl:`https://url95.ctfile.com/d/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"(2k.us|u062.com|545c.com|t00y.com)/file/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(2k.us|u062.com|545c.com|t00y.com)/file/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/(2k.us|u062.com|545c.com|t00y.com)\/file\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(2k.us|u062.com|545c.com|t00y.com)\/file\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"u062.com/file/{#shareCode#} 提取码: {#accessCode#}",blank:"https://u062.com/file/{#shareCode#}",copyUrl:`https://u062.com/file/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"(pan.jc-box.com|545c.com|down.jc-box.com|download.cx05.cc)/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(pan.jc-box.com|545c.com|down.jc-box.com|download.cx05.cc)/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/(pan.jc-box.com|545c.com|down.jc-box.com|download.cx05.cc)\/f\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(pan.jc-box.com|545c.com|down.jc-box.com|download.cx05.cc)\/f\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,paramMatch:/([0-9a-zA-Z\.+])\/f\//i,uiLinkShow:"{#$1#}/f/{#shareCode#} 提取码: {#accessCode#}",blank:"http://{#$1#}/f/{#shareCode#}",copyUrl:`http://{#$1#}/f/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"(ctfile.com|089u.com)/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(ctfile.com|089u.com)/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/(ctfile.com|089u.com)\/f\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(ctfile.com|089u.com)\/f\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"url95.ctfile.com/f/{#shareCode#} 提取码: {#accessCode#}",blank:"https://url95.ctfile.com/f/{#shareCode#}",copyUrl:`https://url95.ctfile.com/f/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"(089u.com|474b.com)/dir/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(089u.com|474b.com)/dir/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{6}|)",shareCode:/(089u.com|474b.com)\/dir\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(089u.com|474b.com)\/dir\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{6})/gi,uiLinkShow:"089u.com/dir/{#shareCode#} 提取码: {#accessCode#}",blank:"https://089u.com/dir/{#shareCode#}",copyUrl:`https://089u.com/dir/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"城通网盘",key:"chengtong",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardBlankLink:!0,uri:""}}}},mn={rule:[{link_innerText:"quark.cn/s/[0-9a-zA-Z-_]{8,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"quark.cn/s/[0-9a-zA-Z-_]{8,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/quark.cn\/s\/([0-9a-zA-Z\-_]{8,24})/gi,shareCodeNeedRemoveStr:/quark.cn\/s\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"quark.cn/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://pan.quark.cn/s/{#shareCode#}",copyUrl:`https://pan.quark.cn/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"夸克网盘",key:"kuake",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardBlankLink:!0,uri:""}}}},gn={rule:[{link_innerText:"magnet:\\?xt=urn:btih:[0-9a-fA-F]{32,40}",link_innerHTML:"magnet:\\?xt=urn:btih:[0-9a-fA-F]{32,40}",shareCode:/magnet:\?xt=urn:btih:([0-9a-fA-F]{32,40})/gi,shareCodeNeedRemoveStr:/magnet:\?xt=urn:btih:/gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"magnet:?xt=urn:btih:{#shareCode#}",blank:"magnet:?xt=urn:btih:{#shareCode#}",copyUrl:"magnet:?xt=urn:btih:{#shareCode#}"}],setting:{name:"BT磁力",key:"magnet",configurationInterface:{function:{enable:!0,linkClickMode:{openBlank:{default:!0}}},schemeUri:{enable:!1,isForwardBlankLink:!0,uri:""}}}},wn={rule:[{link_innerText:"jianguoyun.com/p/[0-9a-zA-Z-_]{16,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]+|)",link_innerHTML:"jianguoyun.com/p/[0-9a-zA-Z-_]{16,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]+|)",shareCode:/jianguoyun.com\/p\/([0-9a-zA-Z\-_]{16,24})/gi,shareCodeNeedRemoveStr:/jianguoyun.com\/p\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{3,6})/gi,uiLinkShow:"jianguoyun.com/p/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.jianguoyun.com/p/{#shareCode#}",copyUrl:`https://www.jianguoyun.com/p/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"坚果云",key:"jianguoyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0},parseFile:{enable:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardLinearChain:!1,isForwardBlankLink:!1,uri:""}}}},kn={rule:[{link_innerText:"[0-9a-zA-Z-_]+.sharepoint.com/[0-9a-zA-Z-_:]+/[0-9a-zA-Z-_:]+/personal/[0-9a-zA-Z-_]+/[0-9a-zA-Z-_]+([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=\\?e=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]+|)",link_innerHTML:"[0-9a-zA-Z-_]+.sharepoint.com/[0-9a-zA-Z-_:]+/[0-9a-zA-Z-_:]+/personal/[0-9a-zA-Z-_]+/[0-9a-zA-Z-_]+([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=\\?e=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]+|)",shareCode:/[0-9a-zA-Z-_]+\/[0-9a-zA-Z-_:]+\/[0-9a-zA-Z-_:]+\/personal\/[0-9a-zA-Z-_]+\/([0-9a-zA-Z\-_]+)/gi,shareCodeNeedRemoveStr:/[0-9a-zA-Z-_]+\/[0-9a-zA-Z-_:]+\/[0-9a-zA-Z-_:]+\/personal\/[0-9a-zA-Z-_]+\//gi,checkAccessCode:/(提取码|密码|访问码|\?password=|\?e=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,8})/gi,paramMatch:/([0-9a-zA-Z-_]+).sharepoint.com\/([0-9a-zA-Z-_:]+)\/([0-9a-zA-Z-_:]+)\/personal\/([0-9a-zA-Z-_]+)\/([0-9a-zA-Z-_]+)/i,uiLinkShow:"{#$1#}.sharepoint.com/{#$2#}/{#$3#}/personal/{#$4#}/{#shareCode#} 提取码: {#accessCode#}",blank:"https://{#$1#}.sharepoint.com/{#$2#}/{#$3#}/personal/{#$4#}/{#shareCode#}?e={#accessCode#}",copyUrl:`https://{#$1#}.sharepoint.com/{#$2#}/{#$3#}/personal/{#$4#}/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"OneDrive",key:"onedrive",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardBlankLink:!1,uri:""}}}},yn={rule:[{link_innerText:"(drive|fast).uc.cn/s/[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]+|)",link_innerHTML:"(drive|fast).uc.cn/s/[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]+|)",shareCode:/(drive|fast).uc.cn\/s\/([0-9a-zA-Z]{8,24})/gi,shareCodeNeedRemoveStr:/(drive|fast).uc.cn\/s\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]+)/gi,uiLinkShow:"drive.uc.cn/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://drive.uc.cn/s/{#shareCode#}",copyUrl:`https://drive.uc.cn/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"UC网盘",key:"uc",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0},parseFile:{enable:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardLinearChain:!1,isForwardBlankLink:!1,uri:""}}}},te=function(e,a,n,t,i,s,r,o,l){let c={text:e,type:"slider",description:o,attributes:{},props:{},getValue(){return this.props[q].get(a,n)},getToolTipContent(u){return typeof r=="function"?r(u):`${u}`},callback(u,p){typeof s=="function"&&s(u,p)||this.props[q].set(a,p);},min:t,max:i,step:l};return Reflect.set(c.attributes,le,a),Reflect.set(c.attributes,me,n),Reflect.set(c.props,q,{get(u,p){return O(u,p)},set(u,p){z(u,p);}}),c},$=function(e,a,n,t,i,s){let r={text:e,type:"switch",description:i,attributes:{},props:{},getValue(){return !!this.props[q].get(a,n)},callback(o,l){let c=!!l;h.success(`${c?"开启":"关闭"} ${e}`),!(typeof t=="function"&&t(o,c))&&this.props[q].set(a,c);},afterAddToUListCallBack:s};return Reflect.set(r.attributes,le,a),Reflect.set(r.attributes,me,n),Reflect.set(r.props,q,{get(o,l){return O(o,l)},set(o,l){z(o,l);}}),r},ce=function(e,a,n,t,i,s){let r=[];typeof t=="function"?r=t():r=t;let o={text:e,type:"select",description:s,attributes:{},props:{},getValue(){return this.props[q].get(a,n)},callback(l,c,u){let p=c;h.info(`选择：${u}`),this.props[q].set(a,p);},data:r};return Reflect.set(o.attributes,le,a),Reflect.set(o.attributes,me,n),Reflect.set(o.props,q,{get(l,c){return O(l,c)},set(l,c){z(l,c);}}),o},xn={rule:[{link_innerText:"115.com/s/[0-9a-zA-Z-_]{8,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"115.com/s/[0-9a-zA-Z-_]{8,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/115.com\/s\/([0-9a-zA-Z\-_]{8,24})/gi,shareCodeNeedRemoveStr:/115.com\/s\//gi,checkAccessCode:/(提取码|密码|\?password=|访问码)[\s\S]+/gi,accessCode:/(\?password=|)([0-9a-zA-Z]{4})/i,uiLinkShow:"115.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://115.com/s/{#shareCode#}",copyUrl:`https://115.com/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"115网盘",key:"_115pan",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:!0,linkClickMode:{openBlank:{default:!0}},checkLinkValidity:!0},linkClickMode_openBlank:{openBlankWithCopyAccessCode:!0},schemeUri:{enable:!1,isForwardBlankLink:!0,uri:""}}}},$e={dataKey:"ruleData",$data:{ruleContent:[]},init(){this.initRule();},initRule(){let e=[nn,sn(),rn,on,ln,cn,dn,un,Ye,hn,pn,xn,fn,mn,gn,wn,kn,yn],a=X.getNetDiskRuleConfig();[...e,...a].forEach(n=>{if(typeof n.setting.key!="string")throw new TypeError("规则未设置key");if(n.rule==null)throw new TypeError("规则未设置rule");const t=n.setting.key,i=n.setting.name,s=n.rule;if(Reflect.has(b.$rule.matchRule,t)){let c=b.$rule.matchRule[t];n.isUserRule?c=[...s,...c]:c=[...c,...s];let u=b.$rule.rule.find(p=>p.setting.key===t);u.rule=c;}else Reflect.set(b.$rule.matchRule,t,n.rule),b.$rule.rule.push(n);Reflect.set(b.$rule.ruleSetting,t,n.setting),n.rule=this.parseRuleMatchRule(n);let r=this.parseRuleSetting(n),o=n.setting.name;k.src.hasIcon(t)&&(K.isPhone()?o=`
					<div style="
						width: 20px;
						height: 20px;
						background: url(${k.src.icon[t]}) no-repeat;
						background-size: 100% 100%;
						">`:o=`
					<div style="
						width: 20px;
						height: 20px;
						background: url(${k.src.icon[t]}) no-repeat;
						background-size: 100% 100%;
						"></div>
					<div style="margin-left: 4px;">${i}</div>`);let l=i;n.isUserRule&&(l+=`<div class="netdisk-custom-rule-edit" data-key="${t}" data-type="${n.setting.name}">${K.config.iconSVG.edit}</div>`,l+=`<div class="netdisk-custom-rule-delete" data-key="${t}" data-type="${n.setting.name}">${K.config.iconSVG.delete}</div>`),this.$data.ruleContent.push({id:"netdisk-panel-config-"+t,title:o,headerTitle:l,attributes:{"data-key":t},forms:r,afterRender:c=>{c.$asideLiElement.setAttribute("data-function-enable",P.function.enable(t,!0).toString());}});});},parseRuleMatchRule(e){let a=e.rule,n=[],t=e.setting.key;for(let i=0;i<a.length;i++){const s=a[i];typeof s.link_innerText=="string"&&(s.link_innerText=U.replaceParam(s.link_innerText,Xe(t))),typeof s.link_innerHTML=="string"&&(s.link_innerHTML=U.replaceParam(s.link_innerHTML,Qe(t))),n.push(s);}return n},parseRuleSetting(e){let a=[];const n=e.setting.configurationInterface,t=e.setting.key;if(n==null)return [];if(n.function){let i=[];if("enable"in n.function){let s=typeof n.function.enable=="boolean"?n.function.enable:!1;i.push($("启用",L.function.enable(t),s,(r,o)=>{const l="data-function-enable";let p=r.target.getRootNode().querySelector(`.pops-panel-aside li[data-key="${t}"]`);p&&p.setAttribute(l,o.toString());},"开启可允许匹配该规则")),n.function.enable=P.function.enable(t);}if("linkClickMode"in n.function){let s=d.assign(U.getDefaultLinkClickMode(),n.function.linkClickMode||{}),r=null,o=Object.keys(s).map(l=>{let c=s[l];if(c.enable)return c.default&&(r=l),{value:l,text:c.text}}).filter(l=>l!=null);r==null&&(r=o[0].value),i.push(ce("点击动作",L.function.linkClickMode(t),r,o,void 0,"点击匹配到的链接的执行的动作"));for(const l in n.function.linkClickMode){const c=n.function.linkClickMode[l];l===P.function.linkClickMode(t)?c.default=!0:c.default=!1;}}if("checkLinkValidity"in n.function){const s=typeof n.function.checkLinkValidity=="boolean"?n.function.checkLinkValidity:!0;i.push($("验证链接有效性",L.function.checkLinkValidity(t),s,void 0,"自动请求链接，判断该链接是否有效，在大/小窗内显示验证结果图标")),n.function.checkLinkValidity=P.function.checkLinkValidity(t);}i.length&&a.push({text:"功能",type:"forms",forms:i});}if(n.linkClickMode_openBlank){let i=[];if("openBlankWithCopyAccessCode"in n.linkClickMode_openBlank){const s=typeof n.linkClickMode_openBlank.openBlankWithCopyAccessCode=="boolean"?n.linkClickMode_openBlank.openBlankWithCopyAccessCode:!1;i.push($("跳转时复制访问码",L.linkClickMode_openBlank.openBlankWithCopyAccessCode(t),s,void 0,"当点击动作是【新标签页打开】时且存在访问码，那就会复制访问码到剪贴板")),n.linkClickMode_openBlank.openBlankWithCopyAccessCode=P.linkClickMode_openBlank.openBlankWithCopyAccessCode(t);}i.length&&a.push({text:"点击动作-新标签页打开",type:"forms",forms:i});}if(n.schemeUri){const i=[];if("enable"in n.schemeUri){const s=typeof n.schemeUri.enable=="boolean"?n.schemeUri.enable:!1;i.push($("启用",L.schemeUri.enable(t),s,void 0,"开启后可进行scheme uri转发")),n.schemeUri.enable=P.schemeUri.enable(t);}if("isForwardBlankLink"in n.schemeUri){const s=typeof n.schemeUri.isForwardBlankLink=="boolean"?n.schemeUri.isForwardBlankLink:!1;i.push($("转发直链",L.schemeUri.isForwardBlankLink(t),s,void 0,"对解析的直链进行scheme转换")),n.schemeUri.isForwardBlankLink=P.schemeUri.isForwardBlankLink(t);}if("isForwardLinearChain"in n.schemeUri){const s=typeof n.schemeUri.isForwardLinearChain=="boolean"?n.schemeUri.isForwardLinearChain:!1;i.push($("转发新标签页链接",L.schemeUri.isForwardBlankLink(t),s,void 0,"对新标签页打开的链接进行scheme转换")),n.schemeUri.isForwardLinearChain=P.schemeUri.isForwardLinearChain(t);}if("uri"in n.schemeUri){const s=typeof n.schemeUri.uri=="string"?n.schemeUri.uri:"";i.push(Re("Uri链接",L.schemeUri.uri(t),s,"自定义的Scheme的Uri链接",void 0,"jumpwsv://go?package=xx&activity=xx&intentAction=xx&intentData=xx&intentExtra=xx")),n.schemeUri.uri=P.schemeUri.uri(t);}i.length&&a.push({text:"Scheme Uri转发",type:"forms",forms:i});}if(n.matchRange_text){let i=[];if("before"in n.matchRange_text){const s=typeof n.matchRange_text.before=="number"?n.matchRange_text.before:0;i.push(te("间隔前",L.matchRange_text.before(t),s,0,100,void 0,void 0,"提取码间隔前的字符长度")),n.matchRange_text.before=P.matchRange_text.before(t);}if("after"in n.matchRange_text){const s=typeof n.matchRange_text.after=="number"?n.matchRange_text.after:0;i.push(te("间隔后",L.matchRange_text.after(t),s,0,100,void 0,void 0,"提取码间隔后的字符长度")),n.matchRange_text.after=P.matchRange_text.after(t);}i.length&&a.push({text:"提取码文本匹配Text",type:"forms",forms:i});}if(n.matchRange_html){let i=[];if("before"in n.matchRange_html){const s=typeof n.matchRange_html.before=="number"?n.matchRange_html.before:0;i.push(te("间隔前",L.matchRange_html.before(t),s,0,100,void 0,void 0,"提取码间隔前的字符长度")),n.matchRange_html.before=P.matchRange_html.before(t);}if("after"in n.matchRange_html){const s=typeof n.matchRange_html.after=="number"?n.matchRange_html.after:0;i.push(te("间隔后",L.matchRange_html.after(t),s,0,100,void 0,void 0,"提取码间隔后的字符长度")),n.matchRange_html.after=P.matchRange_html.after(t);}i.length&&a.push({text:"提取码文本匹配HTML",type:"forms",forms:i});}return n.ownFormList&&a.push(...n.ownFormList),a},getRulePanelContent(){return this.$data.ruleContent}},be={handleShareCode(e,a,n){var r;let t=(r=e.match(a.shareCode))==null?void 0:r.filter(o=>d.isNotNull(o));if(n({status:!0,msg:["正则: shareCode","作用: 获取shareCode","结果: ",JSON.stringify(t)]}),d.isNull(t)){n({status:!1,msg:"匹配shareCode为空"});return}let i=t[0];n({status:!0,msg:["取第一个值: "+i]}),a.shareCodeNeedRemoveStr&&(i=i.replace(a.shareCodeNeedRemoveStr,""),n({status:!0,msg:["正则: shareCodeNeedRemoveStr","作用: 删除ShareCode前面不需要的字符串",`结果: ${i}`]}));let s=a.shareCodeNotMatch;if(s!=null&&i.match(s)){h.error(`不可能的shareCode => ${i}`),n({status:!1,msg:["正则: shareCodeNotMatch","作用: 用于判断提取到的shareCode是否是错误的shareCode","结果: true 该shareCode不是正确的"]});return}for(const o of b.$extraRule.shareCodeNotMatchRegexpList)if(i.match(o)){h.error(`不可能的shareCode => ${i}`),n({status:!1,msg:["正则: 内置的shareCodeNotMatchRegexpList","作用: 使用该正则判断提取到的shareCode是否正确","结果: true 该shareCode不是正确的"]});return}if(i=decodeURI(i),n({status:!0,msg:["对shareCode进行解码: "+i]}),g.aboutShareCode.excludeIdenticalSharedCodes.value&&d.isSameChars(i,g.aboutShareCode.excludeIdenticalSharedCodesCoefficient.value)){n({status:!1,msg:["已开启【排除分享码】且该分享码命中该规则"]});return}if(i.endsWith("http")||i.endsWith("https")){n({status:!1,msg:["该分享码以http|https结尾"]});return}return n({status:!0,msg:"处理完毕的shareCode: "+i}),i},handleAccessCode(e,a,n){var s;let t="";if(!a.checkAccessCode)return n({status:!0,msg:"因未配置规则checkAccessCode，默认accessCode的值为空"}),"";let i=e.match(a.checkAccessCode);if(n({status:!0,msg:["正则: checkAccessCode","作用: 用来判断link_innerText或者link_innerHTML匹配到的字符串中是否存在密码","结果: ",JSON.stringify(i)]}),i){let r=i[i.length-1];n({status:!0,msg:"取最后一个值: "+r});let o=(s=r.match(a.accessCode))==null?void 0:s.filter(l=>d.isNotNull(l));if(n({status:!0,msg:["正则: accessCode","作用: 用来提取link_innerText或者link_innerHTML匹配到的字符串中的密码","结果: ",JSON.stringify(o)]}),d.isNull(o))return n({status:!0,msg:"因↑匹配到的结果为空，默认accessCode的值为空"}),"";o.length&&(t=o[0],n({status:!0,msg:"取第一个值: "+t}),t.startsWith("http")&&(n({status:!0,msg:"排除不可能的accessCode，重置accessCode的值为空"}),t=""));}if(d.isNotNull(t)){for(const r of b.$extraRule.accessCodeNotMatchRegexpList)if(t.match(r)){t="",n({status:!0,msg:["正则: 内置的accessCodeNotMatchRegexpList","作用: 使用该正则判断提取到的accessCode是否正确","结果: true 重置accessCode为空"]});break}a.acceesCodeNotMatch&&t.match(a.acceesCodeNotMatch)&&(t="",n({status:!0,msg:["正则: acceesCodeNotMatch","作用: 用于判断提取到的accessCode是否是错误的accessCode","结果: true 重置accessCode为空"]}));}return n({status:!0,msg:"处理完毕的accessCode: "+t}),t},handleLinkShow(e,a,n,t,i){let s=U.replaceParam(a.uiLinkShow,{shareCode:n});if(i({status:!0,msg:["正则: uiLinkShow","作用: 用于显示在弹窗中的字符串","备注: 对shareCode进行参数替换",`结果: ${s}`]}),t&&t!=""?(s=U.replaceParam(s,{accessCode:t}),i({status:!0,msg:["正则: uiLinkShow","作用: 用于显示在弹窗中的字符串","备注: 对accessCode进行参数替换",`结果: ${s}`]})):(s=s.replace(b.$extraRule.noAccessCodeRegExp,""),i({status:!0,msg:["正则: 内置的noAccessCodeRegExp","作用: 因accessCode为空，使用该正则去除不需要的字符串",`结果: ${s}`]})),a.paramMatch&&d.isNotNull(e)){let r=e.match(a.paramMatch),o={};if(r)for(let l=0;l<r.length;l++)o[`$${l}`]=r[l];s=U.replaceParam(s,o),i({status:!0,msg:["正则: paramMatch","作用: 用于对matchText进行提取需要的关键内容，替换关键字：{#$1#}、{#$2#}...","参数: "+JSON.stringify(o,void 0,4),`结果: ${s}`]});}return i({status:!0,msg:"处理完毕的uiLink: "+s}),s},handleBlank(e,a,n,t,i){let s=U.replaceParam(a.blank,{shareCode:n});if(i({status:!0,msg:["正则: blank","作用: 用于点击跳转的链接","备注: 对shareCode进行参数替换",`结果: ${s}`]}),t&&t!=""?(s=U.replaceParam(s,{accessCode:t}),i({status:!0,msg:["正则: blank","作用: 用于点击跳转的链接","备注: 对accessCode进行参数替换",`结果: ${s}`]})):(s=s.replace(b.$extraRule.noAccessCodeRegExp,""),i({status:!0,msg:["正则: 内置的noAccessCodeRegExp","作用: 因accessCode为空，使用该正则去除不需要的字符串",`结果: ${s}`]})),a.paramMatch&&d.isNotNull(e)){let r=e.match(a.paramMatch),o={};if(r)for(let l=0;l<r.length;l++)o[`$${l}`]=r[l];s=U.replaceParam(s,o),i({status:!0,msg:["正则: paramMatch","作用: 用于对matchText进行提取需要的关键内容，替换关键字：{#$1#}、{#$2#}...","参数: "+JSON.stringify(o,void 0,4),`结果: ${s}`]});}return i({status:!0,msg:"处理完毕的blank: "+s}),s},handleCopyUrl(e,a,n,t,i){let s=U.replaceParam(a.copyUrl,{shareCode:n});if(i({status:!0,msg:["正则: copyUrl","作用: 用于复制到剪贴板的链接","备注: 对shareCode进行参数替换",`结果: ${s}`]}),t&&t!=""?(s=U.replaceParam(s,{accessCode:t}),i({status:!0,msg:["正则: copyUrl","作用: 用于复制到剪贴板的链接","备注: 对accessCode进行参数替换",`结果: ${s}`]})):(s=s.replace(b.$extraRule.noAccessCodeRegExp,""),i({status:!0,msg:["正则: 内置的noAccessCodeRegExp","作用: 因accessCode为空，使用该正则去除不需要的字符串",`结果: ${s}`]})),a.paramMatch&&d.isNotNull(e)){let r=e.match(a.paramMatch),o={};if(r)for(let l=0;l<r.length;l++)o[`$${l}`]=r[l];s=U.replaceParam(s,o),i({status:!0,msg:["正则: paramMatch","作用: 用于对matchText进行提取需要的关键内容，替换关键字：{#$1#}、{#$2#}...","参数: "+JSON.stringify(o,void 0,4),`结果: ${s}`]});}return i({status:!0,msg:"处理完毕的copyUrl: "+s}),s}},tt={addBlockCSS(...e){let a=[];if(e.length!==0&&!(e.length===1&&typeof e[0]=="string"&&e[0].trim()===""))return e.forEach(n=>{Array.isArray(n)?a=a.concat(n):a.push(n);}),qe(`${a.join(`,
`)}{display: none !important;}`)},setGMResourceCSS(e){let a=typeof Be=="function"?Be(e.keyName):"";typeof a=="string"&&a?qe(a):tt.addLinkNode(e.url);},async addLinkNode(e){let a=document.createElement("link");return a.rel="stylesheet",a.type="text/css",a.href=e,v.ready(()=>{document.head.appendChild(a);}),a},fixUrl(e){return e=e.trim(),e.match(/^http(s|):\/\//i)||(e.startsWith("/")||(e+="/"),e=window.location.origin+e),e},async getClipboardText(){function e(t){navigator.clipboard.readText().then(i=>{t(i);}).catch(i=>{h.error(["读取剪贴板内容失败👉",i]),t("");});}function a(t){navigator.permissions.query({name:"clipboard-read"}).then(i=>{e(t);}).catch(i=>{h.error(["申请剪贴板权限失败，尝试直接读取👉",i.message??i.name??i.stack]),e(t);});}function n(){var t,i;return !(typeof((t=navigator==null?void 0:navigator.clipboard)==null?void 0:t.readText)!="function"||typeof((i=navigator==null?void 0:navigator.permissions)==null?void 0:i.query)!="function")}return new Promise(t=>{if(!n()){t("");return}document.hasFocus()?a(t):window.addEventListener("focus",()=>{a(t);},{once:!0});})}},Te={depthQueryShadowRootAllNode(e){let a=[];function n(t){let i=Array.from(t.querySelectorAll("*"));return i.forEach(s=>{if(s.classList&&s.classList.contains("pops-shadow-container"))return;let r=s.shadowRoot;r&&r instanceof ShadowRoot&&a.push({shadowRoot:r,childNode:n(r)});}),i}return n(e),a},ignoreStrRemove(e,a=!1){let n=[];return n.length&&n.forEach(t=>{if(t!=null)if(a)t.innerHTML!=null&&(e=e.replaceAll(t.innerHTML,""));else {let i=t.innerText||t.textContent;i!=null&&(i=i.replaceAll(i,""));}}),e},getPageText(e=document.documentElement,a){let n=[];if(n.push((e==null?void 0:e.textContent)||(e==null?void 0:e.innerText)||""),a){let t=this.depthQueryShadowRootAllNode(e);t.length&&t.forEach(i=>{let s=i.shadowRoot.textContent;s&&n.push(s);});}return n=n.filter(t=>t!==""),n},getPageHTML(e=document.documentElement,a){let n=[];if(n.push(e.innerHTML),a){let t=this.depthQueryShadowRootAllNode(e);t.length&&t.forEach(i=>{let s=i.shadowRoot.innerHTML;s&&n.push(s);});}return n=n.filter(t=>t!==""),n},getInputElementValue(e=document.documentElement,a){let n=[];if(Array.from(e.querySelectorAll("input")).forEach(t=>{n.push(t.value);}),a){let t=this.depthQueryShadowRootAllNode(e);t.length&&t.forEach(i=>{for(let s=0;s<i.childNode.length;s++){const r=i.childNode[s];r instanceof HTMLInputElement&&r.value&&n.push(r.value);}});}return n},getTextAreaElementValue(e=document.documentElement,a){let n=[];if(Array.from(e.querySelectorAll("textarea")).forEach(t=>{n.push(t.value);}),a){let t=this.depthQueryShadowRootAllNode(e);t.length&&t.forEach(i=>{for(let s=0;s<i.childNode.length;s++){const r=i.childNode[s];r instanceof HTMLTextAreaElement&&r.value&&n.push(r.value);}});}return n}},_={isHandleMatch:!1,delayNotMatchCount:0,dispatchMonitorDOMChange:!1,blobUrl:"",GM_matchWorker:void 0,init(){this.initWorkerBlobLink(),this.initWorker(),this.monitorDOMChange();},initWorkerBlobLink(){const e=`
        (() => {
            function ${_.handleRegularMatch.toString()}

            function ${_.uniqueArr}
            
            this.addEventListener(
            "message",
            function (event) {
                const data = event.data;
                let matchedList = [];
                ${_.handleRegularMatch.name}(data,(matchData)=>{
                	matchedList.push(matchData);
                })
                matchedList = ${_.uniqueArr.name}(matchedList);
                this.postMessage({
					options: data,
					msg: "Match End",
					data: matchedList,
					startTime: data.startTime,
					endTime: Date.now(),
                });
            },
            {
                capture: true,
            }
            );
        })();
  		`;let a=new Blob([e]);_.blobUrl=window.URL.createObjectURL(a),h.info(`Worker Blob Link ===> ${_.blobUrl}`);},handleRegularMatch(e,a){const n=Object.keys(e.regular);for(const t of n){const i=e.regular[t];for(let s=0;s<i.length;s++){const r=i[s];let o=[];if(e.matchTextRange.includes("innerText")&&o.push(new RegExp(r.link_innerText,"gi")),e.matchTextRange.includes("innerHTML")&&o.push(new RegExp(r.link_innerHTML,"gi")),!e.matchTextRange.length)throw console.error(e),new TypeError("未设置匹配范围");if(!o.length)throw new TypeError("未知的匹配范围: "+e.matchTextRange);for(let l=0;l<o.length;l++){const c=o[l];for(let u=0;u<e.textList.length;u++){let m=e.textList[u].match(c);m&&m.length&&a({netDiskName:t,netDiskIndex:s,data:m});}}}}},uniqueArr(e){return e.filter((a,n,t)=>n===t.findIndex(i=>JSON.stringify(i)===JSON.stringify(a)))},initWorker(){try{_.GM_matchWorker=new Worker(_.blobUrl),_.GM_matchWorker.onmessage=_.onMessage,_.GM_matchWorker.onerror=_.onError;}catch(e){h.error(["初始化Worker失败，可能页面使用了Content-Security-Policy策略，使用另类方法",e.message]),_.GM_matchWorker={postMessage(a){return new Promise((n,t)=>{let i=[];try{_.handleRegularMatch(a,s=>{i.push(s);});}catch(s){_.onError(s);}finally{i=_.uniqueArr(i),_.onMessage(new MessageEvent("message",{data:{options:a,msg:"Match End",data:i,startTime:a.startTime,endTime:Date.now()}})),n(null);}})}};}},postMessage(e,a){_.GM_matchWorker.postMessage(e,a);},onMessage(e){const a=e.data;a.data.length&&h.success(`成功匹配${a.data.length}个，用时${Date.now()-a.startTime}ms`),a.options.from==="PasteText"&&k.matchPasteText.workerMatchEndCallBack(a),a.options.from.startsWith("FirstLoad")&&_.delayNotMatchCount++,_.successCallBack(a);},onError(e){_.errorCallBack(e);},successCallBack(e){if(!e.data.length){_.matchingEndCallBack();return}const a=[];for(const t of e.data){b.$match.matchedInfoRuleKey.add(t.netDiskName);let i=new Set;t.data.forEach(s=>{i.add(s);}),i.forEach(s=>{let r=b.handleLink(t.netDiskName,t.netDiskIndex,s);r&&a.push({shareCode:r.shareCode,accessCode:r.accessCode,netDiskName:t.netDiskName,netDiskIndex:t.netDiskIndex,matchText:s});});}let n=a.filter((t,i,s)=>s.findIndex(o=>o.accessCode===t.accessCode&&o.netDiskIndex===t.netDiskIndex&&o.netDiskName===t.netDiskName&&o.shareCode===t.shareCode)===i);if(n.forEach(t=>{b.$match.tempMatchedInfo.has(t.netDiskName)&&b.$match.tempMatchedInfo.get(t.netDiskName).set(t.shareCode,t);}),n.forEach(t=>{const{shareCode:i,accessCode:s,netDiskName:r,netDiskIndex:o,matchText:l}=t,u=b.$rule.rule.find(w=>w.setting.key===r).rule[o];let p=!1;if(b.$match.blackMatchedInfo.forEach((w,y)=>{if(y!==t.netDiskName)return;w.has(i)&&(p=!0,h.warn([`匹配到黑名单分享码，已过滤：${i}`,JSON.stringify(t)]));}),p)return;if(u.shareCodeExcludeRegular&&Array.isArray(u.shareCodeExcludeRegular))for(const w of u.shareCodeExcludeRegular){let y=b.$match.matchedInfo.get(w),R=b.$match.tempMatchedInfo.get(w);if(y.startsWith(i)||R.startsWith(i)){h.warn(`${r}：该分享码【${i}】与已匹配到该分享码的规则【${w}】冲突`);return}}const m=b.$match.matchedInfo.get(r);if(b.$data.isMatchedLink=!0,m.startsWith(i)){let w=m.getStartsWith(i);if(typeof w.isForceAccessCode=="boolean"&&w.isForceAccessCode||d.isNotNull(w.accessCode)||d.isNull(s))return;m.set(i,b.getLinkDickObj(s,o,!1,l)),k.view.changeLinkView(r,o,i,s,l),h.info(`该匹配项无密码，设置密码 ${r} ${o}: ${i}  ===> ${s}`);}else m.set(i,b.getLinkDickObj(s,o,!1,l)),k.isMatchedNetDiskIconMap.add(r),k.view.addLinkView(r,o,i,s,l),h.success(`添加链接 ${r} ${o}: ${i}  ===> ${s}`);}),Object.keys(b.$match.tempMatchedInfo.getItems()).forEach(t=>{b.$match.tempMatchedInfo.get(t).clear();}),b.$data.isMatchedLink)switch(g.function["netdisk-behavior-mode"].value){case"suspension_smallwindow".toLowerCase():G.mode.current_suspension_smallwindow_mode.value==="suspension"?k.suspension.show():k.view.show();break;case"suspension_window".toLowerCase():k.suspension.show();break;case"smallwindow".toLowerCase():k.view.show();break;default:h.error(["未知的行为模式："+g.function["netdisk-behavior-mode"].value]);}_.matchingEndCallBack();},errorCallBack(e){_.matchingEndCallBack(!0),h.error(["Worker Error",e]);},matchingEndCallBack(e){if(e)_.isHandleMatch=!1,_.delayNotMatchCount>0&&(_.delayNotMatchCount=0,_.dispatchMonitorDOMChange=!0);else {const a=parseFloat(g.match.delaytime.value.toString())*1e3;setTimeout(()=>{_.matchingEndCallBack(!0);},a);}},monitorDOMChange(){const e=g.match.isAddedNodesToMatch.value,a=g.match.readClipboard.value,n=g.match.pageMatchRange.value;let t=!0,i=!0,s=!0,r=g.match.depthQueryWithShadowRoot.value;const o={};b.$rule.rule.forEach(u=>{let p=u.setting.key;P.function.enable(p)&&(Reflect.has(o,p)?o[p]=[...o[p],...u.rule]:Reflect.set(o,p,u.rule));});async function l(u){if(_.isHandleMatch){_.delayNotMatchCount++;return}if(e&&u&&u.length){let w=!1;for(let y=0;y<u.length;y++){const R=u[y];if(R.addedNodes&&R.addedNodes instanceof NodeList&&R.addedNodes.length){w=!0;break}}if(!w)return}_.isHandleMatch=!0;const p=Date.now();if(a)try{b.$data.clipboardText=await tt.getClipboardText();}catch{}typeof b.$data.clipboardText!="string"&&(b.$data.clipboardText="");const m=[];if(d.isNotNull(b.$data.clipboardText)){let w=b.$data.clipboardText;m.push(w);}if(g.match.allowMatchLocationHref){let w=U.getDecodeComponentUrl();m.push(w);}if(t&&(t=!1,m.length)){_.postMessage({textList:m,matchTextRange:n,regular:o,startTime:p,from:"FirstLoad-DOMChange"});return}if(n.includes("innerText")){let w=Te.getPageText(document.documentElement,r);if(m.push(...w),i){i=!1,_.postMessage({textList:m,matchTextRange:n,regular:o,startTime:p,from:"FirstLoad-Text-DOMChange"});return}}if(n.includes("innerHTML")){let w=Te.getPageHTML(document.documentElement,r);if(m.push(...w),s){s=!1,_.postMessage({textList:m,matchTextRange:n,regular:o,startTime:p,from:"FirstLoad-HTML-DOMChange"});return}}if(g.match.toBeMatchedWithInputElementValue){let w=Te.getInputElementValue(document.documentElement,r);m.push(...w);}if(g.match.toBeMatchedTextAreaElementValue){let w=Te.getTextAreaElementValue(document.documentElement,r);m.push(...w);}_.postMessage({textList:m,matchTextRange:n,regular:o,startTime:p,from:"DOMChange"});}d.mutationObserver(document.documentElement,{callback:l,config:{childList:g.match["mutationObserver-childList"].value,characterData:g.match["mutationObserver-characterData"].value,subtree:g.match["mutationObserver-subtree"].value}});let c=_.dispatchMonitorDOMChange;Object.defineProperty(_,"dispatchMonitorDOMChange",{set:function(u){if(c=u,u){let p=document.querySelectorAll("html");l([{addedNodes:p,attributeName:null,attributeNamespace:null,nextSibling:null,oldValue:null,previousSibling:null,removedNodes:p,target:p[0],type:"attributes"}]);}},get:function(){return c}}),this.dispatchMonitorDOMChange=!0;}},Cn={$el:{$select:null,$log:null,$matchText:null,$button:null},reset(){Object.keys(this.$el).forEach(e=>{Reflect.deleteProperty(this.$el,e);});},setLog(e,...a){let n="";a.forEach(i=>{n!==""&&(n+=`
`),typeof i!="string"?n+=JSON.stringify(i,void 0,4):n+=i;});let t=v.createElement("p",{innerText:n},{"data-tag":e});v.append(this.$el.$log,t);},clearLog(){this.$el.$log.innerHTML="";},showUI(e){if(this.reset(),d.isNull(e.regexp)){f.error("请先配置regexp");return}let a=this,t=X.parseRule([e])[0].rule,i=Z.confirm({title:{text:`调试规则 ${e.key}`,position:"center"},content:{text:`
                    <div class="custom-rule-container">
                        <textarea class="custom-rule-match-text" placeholder="请输入需要测试匹配的字符串"></textarea>
                        <div class="custom-rule-input-container">
                        <select class="custom-rule-select-regexp"></select>
                        <button class="custom-rule-run-match-button" type="primary" data-icon="" data-righticon="false">
                            <span>执行</span>
                        </button>
                        </div>
                    </div>
                    <div class="custom-rule-match-log">
                        <div>匹配日志↓</div>
                        <div class="custom-rule-match-log-container"></div>
                    </div>
                    `,html:!0},btn:{ok:{enable:!1}},style:`
                .custom-rule-container{
                    display: flex;
                    align-items: center;
                }
                .custom-rule-select-regexp{
                    width: 100%;
                    height: 32px;
                    line-height: 32px;
                    border: 1px solid rgb(184, 184, 184, var(--pops-bd-opacity));
                    border-radius: 5px;
                    text-align: center;
                    outline: 0;
                    background: rgb(255, 255, 255, var(--pops-bg-opacity));
                    box-shadow: none;
                }
                .custom-rule-input-container{
                    display: flex;
                    flex-wrap: wrap;
                    justify-content: center;
                    margin: 5px;
                    width: 30%;
                }
                .custom-rule-select-regexp-item{

                }
                button.custom-rule-run-match-button{
                    margin-top: 5px;
                }
                textarea.custom-rule-match-text{
                    width: 100%;
                    min-height: 70px;
                    outline: none;
                    margin: 0px;
                    background-image: none;
                    background-color: transparent;
                    display: inline-block;
                    resize: vertical;
                    padding: 5px;
                    line-height: 1.5;
                    box-sizing: border-box;
                    border: 1px solid rgb(220, 223, 230);
                    appearance: none;
                }
                .custom-rule-match-log{

                }
                .custom-rule-match-log-container{
                    padding: 5px;
                    background: rgb(229, 229, 229);
                }
                .custom-rule-match-log-container p{
                    margin: 2px 0px;
                    border-bottom: 1px solid #000000;
                }
                .custom-rule-match-log-container p:last-child{
                    border-bottom: 0px;
                    margin-bottom: 0px;
                }
                .custom-rule-match-log-container p[data-tag]{
                
                }
                .custom-rule-match-log-container p[data-tag="info"]{

                }
                .custom-rule-match-log-container p[data-tag="success"]{
                    color: green;
                }
                .custom-rule-match-log-container p[data-tag="warn"]{
                    color: yellow;
                }
                .custom-rule-match-log-container p[data-tag="error"]{
                    color: red;
                }
                `},k.popsStyle.customRuleDebugView);this.$el.$select=i.$shadowRoot.querySelector(".custom-rule-select-regexp"),this.$el.$matchText=i.$shadowRoot.querySelector(".custom-rule-match-text"),this.$el.$log=i.$shadowRoot.querySelector(".custom-rule-match-log-container"),this.$el.$button=i.$shadowRoot.querySelector(".custom-rule-run-match-button"),t.forEach((o,l)=>{this.$el.$select.appendChild(v.createElement("option",{className:"custom-rule-select-regexp-item",innerText:"regexp下标:"+l,"data-value":o}));});function s(o){Array.isArray(o.msg)?a.setLog(o.status?"info":"error",...o.msg):a.setLog(o.status?"info":"error",o.msg),o.status||a.setLog("error","执行完毕");}function r(){try{if(d.isNull(a.$el.$matchText.value)){f.error("请先输入待匹配的字符串");return}a.clearLog();let o=e.key,l=a.$el.$select.selectedIndex,c=a.$el.$select.selectedOptions[l]["data-value"];h.info(["当前选中的规则: ",c]);let u={};u[e.key]=[c];let p=[];if(_.handleRegularMatch({regular:u,textList:[a.$el.$matchText.value],matchTextRange:["innerText","innerHTML"],startTime:Date.now(),from:"Debug"},m=>{p.push(...m.data);}),!p.length){a.setLog("error","未成功匹配到数据");return}p=_.uniqueArr(p),a.setLog("info","成功匹配到的数据 ==> ",p),p.forEach((m,w)=>{a.setLog("success","当前处理的字符串: "+m),a.setLog("success","当前执行: 对shareCode进行处理获取");let y=be.handleShareCode(m,c,s);if(d.isNull(y))return;a.setLog("info"," "),a.setLog("info","================分割线================"),a.setLog("info"," "),a.setLog("success","当前执行: 对accessCode进行处理获取");let R=be.handleAccessCode(m,c,s);a.setLog("info"," "),a.setLog("info","================分割线================"),a.setLog("info"," "),a.setLog("success","当前执行: 对uiLinkShow进行处理获取");let N=be.handleLinkShow(m,c,y,R,s);a.setLog("info"," "),a.setLog("info","================分割线================"),a.setLog("info"," "),a.setLog("success","当前执行: 对blank进行处理获取");let S=be.handleBlank(m,c,y,R,s);a.setLog("info"," "),a.setLog("info","================分割线================"),a.setLog("info"," "),a.setLog("success","当前执行: 对copyUrl进行处理获取");let W=be.handleCopyUrl(m,c,y,R,s);a.setLog("success","执行完毕");});}catch(o){h.error(o),a.setLog(o.toString());}}v.on(a.$el.$button,"click",void 0,r);}},vn=`.pops[type-value="confirm"] .pops-confirm-content {\r
	overflow: hidden;\r
}\r
/* textarea美化 */\r
.pops.whitesevPopNetDiskCustomRules[type-value="confirm"]\r
	.pops-confirm-content\r
	textarea {\r
	width: 100%;\r
	height: 100%;\r
	border: none;\r
	outline: none;\r
	padding: 0;\r
	margin: 0;\r
	-webkit-appearance: none;\r
	-moz-appearance: none;\r
	appearance: none;\r
	background-image: none;\r
	background-color: transparent;\r
\r
	display: inline-block;\r
	resize: vertical;\r
	padding: 5px 15px;\r
	line-height: 1.5;\r
	box-sizing: border-box;\r
	border: 1px solid #dcdfe6;\r
	transition: border-color 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);\r
	appearance: none;\r
	resize: none;\r
}\r
/* 获得焦点 */\r
.pops.whitesevPopNetDiskCustomRules[type-value="confirm"]\r
	.pops-confirm-content\r
	textarea:focus {\r
	outline: none;\r
	border-color: #3677f0;\r
}\r
/* 提示文字 */\r
.pops.whitesevPopNetDiskCustomRules[type-value="confirm"]\r
	.pops-confirm-content\r
	textarea::placeholder {\r
	color: #c0c4cc;\r
}\r
/* 鼠标hover */\r
.pops.whitesevPopNetDiskCustomRules[type-value="confirm"]\r
	.pops-confirm-content\r
	textarea:hover {\r
	border-color: #c0c4cc;\r
}\r
`,Ue={show(e,a){let n="添加";e&&(n="编辑"),n+="自定义规则";let t=null;function i(l,c){let u=t.value.trim(),p=X.parseRuleStrToRule(u);if(p.success){let m=p.data;e?X.setRule(a,m):X.addRule(m),f.success("保存成功");}else f.error(p.msg);}function s(l){let c=t.value.trim(),u=X.parseRuleStrToRule(c);if(u.success){let p=u.data;Cn.showUI(p);}else f.error(u.msg);}function r(l){try{let c=JSON.parse(t.value),u=X.getFormatRule(c);t.value=u,f.success("格式化成功");}catch(c){h.error(c),f.error(c.message,{html:!0,timeout:3500});}}if(t=Z.confirm({title:{text:n,position:"center"},content:{text:'<textarea class="netdisk-custom-rules" placeholder="请输入自定义规则"></textarea>',html:!0},btn:{merge:!0,mergeReverse:!1,reverse:!1,position:"space-between",ok:{text:"保存",callback:(l,c)=>{i();}},cancel:{text:"调试",callback:(l,c)=>{s();}},other:{enable:!0,text:"格式化",type:"xiaomi-primary",callback:(l,c)=>{r();}}},class:"whitesevPopNetDiskCustomRules",style:vn},k.popsStyle.customRulesView).$shadowRoot.querySelector("textarea"),e){let l=X.getRule(a);t.value=X.getFormatRule(l);}else t.value=X.getTemplateRule();}},nt=`div[class^="netdisk-custom-rule-"] {\r
	display: flex;\r
	align-items: center;\r
	margin-left: 10px;\r
	cursor: pointer;\r
}\r
div[class^="netdisk-custom-rule-"] svg,\r
div[class^="netdisk-custom-rule-"] svg {\r
	width: 1.2em;\r
	height: 1.2em;\r
}\r
/* 控件被禁用的颜色 */\r
aside.pops-panel-aside li[data-key][data-function-enable="false"] {\r
	color: #a8abb2;\r
	filter: grayscale(100%);\r
}\r
`,ze={show(){var t;if(k.Alias.settingAlias){h.error("设置界面已存在"),f.error("设置界面已存在");return}let e=Y.getPanelContentConfig(),a=$e.getRulePanelContent();e=e.concat(a);let n=Z.panel({title:{text:`${((t=fe==null?void 0:fe.script)==null?void 0:t.name)||it}-设置`,position:"center"},content:e,btn:{close:{enable:!0,callback(i){i.close(),k.Alias.settingAlias=void 0;}}},mask:{clickCallBack(i){i(),k.Alias.settingAlias=void 0;}},class:"whitesevPopSetting",style:nt},k.popsStyle.settingView);k.Alias.settingAlias=n,this.setRuleHeaderControlsClickEvent(n.$shadowRoot);},showPanel(e={}){},setRuleHeaderControlsClickEvent(e){v.on(e,"click",".netdisk-custom-rule-edit",function(a){let n=a.target,t=n.getAttribute("data-key");n.getAttribute("data-type"),Ue.show(!0,t);}),v.on(e,"click",".netdisk-custom-rule-delete",function(a){let n=a.target,t=n.getAttribute("data-key"),i=n.getAttribute("data-type");Z.alert({title:{text:"提示",position:"center"},content:{text:`确定删除自定义规则 ${i}(${t}) 吗？`},btn:{ok:{callback(s){if(X.deleteRule(t)){let o=k.Alias.settingAlias.$shadowRoot.querySelector(`.pops-panel-aside > ul > li[data-key="${t}"]`),l=o.previousElementSibling,c=o.nextElementSibling;l?l.click():c&&c.click(),o==null||o.remove(),f.success("删除成功"),s.close();}else f.error("删除自定义规则失败");}}}});});}},bn=`.whitesevSuspension {\r
	top: 0;\r
	position: fixed;\r
	right: 10px;\r
	border-radius: 12px;\r
}\r
.whitesevSuspension .whitesevSuspensionMain {\r
	background: #fff;\r
	border: 1px solid #f2f2f2;\r
	box-shadow: 0 0 15px #e4e4e4;\r
	box-sizing: border-box;\r
	border-radius: inherit;\r
	height: inherit;\r
	width: inherit;\r
}\r
.whitesevSuspension .whitesevSuspensionFloor {\r
	border-bottom: 1px solid #f2f2f2;\r
	position: relative;\r
	box-sizing: border-box;\r
	border-radius: inherit;\r
	height: inherit;\r
	width: inherit;\r
}\r
.whitesevSuspension .whitesevSuspensionFloor .netdisk {\r
	background-position: center center;\r
	background-size: 115% 115%;\r
	background-repeat: no-repeat;\r
	display: flex;\r
	align-items: center;\r
	justify-content: center;\r
	border-radius: inherit;\r
	height: inherit;\r
	width: inherit;\r
}\r
.whitesevSuspension .whitesevSuspensionFloor .netdisk:hover {\r
	transition: all 300ms linear;\r
	background-color: #e4e4e4;\r
	transform: scale(1.1);\r
}\r
.whitesevPop-content p[pop] {\r
	height: 100%;\r
}\r
`,G={position:{suspensionX:de("suspensionX",B.width(window)-50),suspensionY:de("suspensionY",(B.height(window)-50)/2),suspensionMaxX:de("susponsionMax-x",B.width(window)-50),suspensionMaxY:de("suspensionMax-y",B.height(window)-50),isRight:de("isRight",!1)},mode:{current_suspension_smallwindow_mode:de("current_suspension_smallwindow_mode","suspension")}},De={suspensionNode:null,isShow:!1,isSetEvent:!1,isRandBg:!1,show(){this.isShow||(this.isShow=!0,this.createUI(),this.setSuspensionPosition()),this.isSetEvent||(this.isSetEvent=!0,this.setSuspensionEvent(),this.setResizeEventListener()),this.backgroundSwitch(),this.showSuspension();},showSuspension(){this.suspensionNode.style.display="";},hideSuspension(){this.suspensionNode.style.display="none";},isTopWindow(){return Q.self.window===Q.top.window},createUI(){g.suspension.size.value<15&&(g.suspension.size.value=15),g.suspension.size.value>250&&(g.suspension.size.value=250),g.suspension.opacity.value<.1&&(g.suspension.opacity.value=.1),g.suspension.opacity.value>1&&(g.suspension.opacity.value=1);let e=B.createElement("div",{className:"whitesev-suspension-shadow-container"}),a=e.attachShadow({mode:"open"});this.suspensionNode=B.createElement("div",{id:"whitesevSuspensionId",className:"whitesevSuspension",innerHTML:`
                <style type="text/css">
				/* 动态生成z-index */
				.whitesevSuspension{
					z-index: ${d.getMaxValue(4e3,d.getMaxZIndex(10))};;
				}

				${bn}

                </style>
                <div class="whitesevSuspensionMain">
                <div class="whitesevSuspensionFloor">
                    <div class="netdisk"></div>
                </div>
                </div>
                `},{style:`
                    width: ${g.suspension.size.value}px;
                    height: ${g.suspension.size.value}px;
                    opacity: ${g.suspension.opacity.value}
                `}),a.appendChild(this.suspensionNode),document.body.appendChild(e);},setSuspensionEvent(){let e=k.suspension.suspensionNode,a=new In(e),n,t=!1,i=!1,s=0,r=0;a.on("pan",function(o){if(!t){t=!0;let l=e.getBoundingClientRect();s=o.x-l.left,r=o.y-l.top,B.css(e,{cursor:"move",transition:"none"});}if(o.phase==="move"){let l=B.width(window)-g.suspension.size.value,c=B.height(window)-g.suspension.size.value,u=o.x-s,p=o.y-r;u=u>l?l:u,p=p>c?c:p,u=u<0?0:u,p=p<0?0:p,De.saveSuspensionPosition({x:u,y:p}),B.css(e,{left:u+"px",top:p+"px"});}if(o.phase==="end"){t=!1,B.css(e,{cursor:"auto"});let l=parseInt(B.css(e,"left"));if(g.suspension["suspended-button-adsorption-edge"].value){let c=0;l>=B.width(window)/2?(c=B.width(window)-g.suspension.size.value,k.suspension.isTopWindow()&&(G.position.isRight.value=!0)):k.suspension.isTopWindow()&&(G.position.isRight.value=!1),De.saveSuspensionPosition({x:c}),B.css(e,{left:c+"px"});}B.css(e,{transition:"left 300ms ease 0s"});}}),a.on(["click","tap"],function(o){clearTimeout(n),n=void 0,i?(i=!1,ze.show()):(n=setTimeout(()=>{i=!1,g.function["netdisk-behavior-mode"].value.includes("smallwindow")&&(G.mode.current_suspension_smallwindow_mode.value="smallwindow",k.suspension.hideSuspension()),k.view.show();},200),i=!0);}),k.setGlobalRightClickMenu(e);},saveSuspensionPosition(e){k.suspension.isTopWindow()&&e!=null&&(typeof e.x=="number"&&(G.position.suspensionX.value=e.x),typeof e.y=="number"&&(G.position.suspensionY.value=e.y),G.position.suspensionMaxX.value=G.position.suspensionMaxX.default,G.position.suspensionMaxY.value=G.position.suspensionMaxY.default);},setResizeEventListener(){B.on(globalThis,"resize",void 0,()=>{let e=document.activeElement;if(d.isPhone()){if(["input","textarea"].includes(e.localName))return;if(e.hasAttribute("contenteditable")&&e.getAttribute("contenteditable")==="true"||e.closest("[contenteditable='true']"))return;if(!document.hasFocus())return}this.setSuspensionPosition();});},setSuspensionPosition(){const e=B.width(window)-g.suspension.size.value,a=B.height(window)-g.suspension.size.value,n=G.position.suspensionMaxX.value,t=G.position.suspensionMaxY.value;G.position.suspensionMaxX.default=e,G.position.suspensionMaxY.default=a;let i=G.position.suspensionX.value,s=G.position.suspensionY.value;if(e!==n){h.warn("当前页面最大x和上次记录的不一致");let r=i/n,o=e*r,l=i;i=o,h.table([{介绍:"上次记录的值",X:l,MAX_X:n,percent:r},{介绍:"当前页面的值",X:i,MAX_X:e}]);}if(a!==t){h.warn("当前页面最大y和上次记录的不一致");let r=s/t,o=a*r,l=s;s=o,h.table([{介绍:"上次记录的值",Y:l,MAX_Y:t,percent:r},{介绍:"当前页面的值",Y:s,MAX_Y:a}]);}i>e?(h.warn("left超出最大值，重置为最大值"),i=e):i<0&&(h.warn("left超出最小值，重置为0"),i=0),s>a?(h.warn("top超出最大值，重置为最大值"),s=a):s<0&&(h.warn("top超出最小值，重置为0"),s=0),g.suspension["suspended-button-adsorption-edge"].value&&(G.position.isRight.value?i=e:i=0),De.saveSuspensionPosition({x:i,y:s}),B.css(k.suspension.suspensionNode,{left:i+"px",top:s+"px"});},backgroundSwitch(){if(this.isRandBg)return;function e(){let r=[];return k.isMatchedNetDiskIconMap.forEach(o=>{r=[...r,k.src.icon[o]];}),r}function a(r,o){n=e(),B.fadeOut(s,r,function(){t++,t=t<n.length?t:0,o=n[t],B.css(s,{"background-image":`url(${o})`}),B.fadeIn(s,r,function(){setTimeout(()=>{a(parseInt(g.suspension["randbg-time"].value.toString()),o);},parseInt(g.suspension["randbg-show-time"].value.toString()));});});}let n=[],t=0;n=e();let i=n[t],s=k.suspension.suspensionNode.querySelector(".whitesevSuspension .netdisk");B.css(s,{"background-image":`url(${i})`}),!(n.length<2||g.suspension["randbg-time"].value<=0)&&(this.isRandBg=!0,a(parseInt(g.suspension["randbg-time"].value.toString().toString()),i));}},Ze=`.pops-folder-list .list-name-text {\r
	max-width: 300px;\r
}\r
.netdisk-static-link-onefile .pops-folder-list .list-name-text {\r
	max-width: 220px;\r
}\r
.netdisk-static-link-onefile\r
	.pops-mobile-folder-content\r
	.pops-folder-list\r
	.list-name-text {\r
	max-width: unset;\r
}\r
`,Rn={oneFile(e){h.success(["成功获取单文件直链",e]),Z.folder({title:{text:e.title},folder:[{fileName:e.fileName,fileSize:e.fileSize,fileType:e.fileType??"",createTime:e.fileUploadTime||e.fileLatestTime,latestTime:e.fileLatestTime||e.fileUploadTime,isFolder:!1,index:0,async clickEvent(){if(typeof e.clickCallBack=="function")e.clickCallBack(e);else return {autoDownload:!0,mode:"aBlank",url:e.downloadUrl}}}],btn:{ok:{text:"下载",callback(){typeof e.clickCallBack=="function"?e.clickCallBack(e):window.open(e.downloadUrl,"_blank");}}},class:"netdisk-static-link-onefile",style:Ze},k.popsStyle.oneFileStaticView);},moreFile(e,a=[]){h.success(["文件解析信息",a]),Z.folder({title:{text:e},folder:a,style:Ze},k.popsStyle.moreFileStaticView);}},An=function(e="密码错误",a="",n,t,i,s=()=>{}){const r=Z.prompt({title:{text:e,position:"center",html:!1},btn:{reverse:!0,position:"end",cancel:{text:"取消"},ok:{callback:o=>{var y,R,N,S;let l=o.text.replace(/[\s]*/gi,""),c=b.handleLinkShow(a,n,t,l,void 0),u=`.netdisk-url a[data-netdisk='${a}'][data-sharecode='${t}']`,p=`.netdiskrecord-link a[data-netdisk='${a}'][data-sharecode='${t}']`,m=(R=(y=k.Alias.uiLinkAlias)==null?void 0:y.$shadowRoot)==null?void 0:R.querySelector(u),w=(S=(N=k.Alias.historyAlias)==null?void 0:N.$shadowRoot)==null?void 0:S.querySelector(p);m&&(m.setAttribute("data-accesscode",l),v.html(m,c)),w&&(w.setAttribute("data-accesscode",l),v.html(w,c)),h.info(`${a} 重新输入的密码：${l}`),s(l),o.close();}}},content:{placeholder:"请重新输入密码",focus:!0,select:!0,text:i==null?"":typeof i=="string"?i:""}},k.popsStyle.inputNewAccessCodeView);v.listenKeyboard(r.$shadowRoot,"keypress",o=>{o==="Enter"&&r.$shadowRoot.querySelector(".pops-prompt-btn-ok").click();});},Sn=`.pops[type-value="confirm"] .pops-confirm-content {\r
	overflow: hidden;\r
}\r
.netdisk-match-paste-text {\r
	--textarea-bd-color: #dcdfe6;\r
	display: inline-block;\r
	resize: vertical;\r
	padding: 5px 15px;\r
	line-height: 1.5;\r
	box-sizing: border-box;\r
	color: #606266;\r
	border: 1px solid var(--textarea-bd-color);\r
	border-radius: 4px;\r
	transition: border-color 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);\r
	outline: none;\r
	margin: 0;\r
	-webkit-appearance: none;\r
	-moz-appearance: none;\r
	appearance: none;\r
	background: none;\r
	width: 100%;\r
	height: 100%;\r
	appearance: none;\r
	resize: none;\r
}\r
.netdisk-match-paste-text:hover {\r
	--textarea-bd-color: #c0c4cc;\r
}\r
.netdisk-match-paste-text:focus {\r
	--textarea-bd-color: #3677f0;\r
}\r
`,_n={show(){let e=Z.confirm({title:{text:"主动识别文本",position:"center"},content:{text:`
                    <textarea class="netdisk-match-paste-text"></textarea>
                    `,html:!0},btn:{ok:{text:"识别",callback(){var n,t;let a=((t=(n=e.popsElement)==null?void 0:n.querySelector(".netdisk-match-paste-text"))==null?void 0:t.value)||"";a.trim()!==""&&(a=U.replaceChinese(a),_.postMessage({textList:[a],matchTextRange:g.match.pageMatchRange.value,regular:b.$rule.matchRule,startTime:Date.now(),from:"PasteText"}));}}},class:"whitesevPopNetDiskMatchPasteText",style:Sn},k.popsStyle.matchPasteTextView);e.popsElement.querySelector("textarea").focus();},workerMatchEndCallBack(e){e.data.length?f.success(`成功匹配${e.data.length}个，用时${Date.now()-e.startTime}ms`):f.error("未识别到链接");}},Tn=`.whitesevPopNetDiskHistoryMatch .pops-confirm-content ul {\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content li {\r
	display: flex;\r
	flex-direction: column;\r
	justify-content: center;\r
	border-radius: 10px;\r
	box-shadow: 0 0.3px 0.6px rgb(0 0 0 / 6%), 0 0.7px 1.3px rgb(0 0 0 / 8%),\r
		0 1.3px 2.5px rgb(0 0 0 / 10%), 0 2.2px 4.5px rgb(0 0 0 / 12%),\r
		0 4.2px 8.4px rgb(0 0 0 / 14%), 0 10px 20px rgb(0 0 0 / 20%);\r
	margin: 20px 10px;\r
	padding: 10px;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-search {\r
	height: 11%;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-table {\r
	height: calc(85% - 40px);\r
	overflow: auto;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-page {\r
	display: flex;\r
	justify-content: center;\r
	align-items: center;\r
	margin-top: 10px;\r
}\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-search\r
	input {\r
	border: none;\r
	border-bottom: 1px solid #000000;\r
	padding: 0px 5px;\r
	line-height: 28px;\r
	width: -moz-available;\r
	width: -webkit-fill-available;\r
	width: fill-available;\r
	margin: 5px 5px 0px 5px;\r
	background: none;\r
}\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-search\r
	input:focus-visible {\r
	outline: none;\r
	border-bottom: 1px solid #0009ff;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link {\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link a {\r
	color: #ff4848;\r
	font-size: 0.8em;\r
	border: none;\r
	word-break: break-word;\r
}\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-link\r
	a[isvisited="true"] {\r
	color: #8b8888;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-icon {\r
}\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-icon\r
	.netdisk-icon-img {\r
	width: 28px;\r
	height: 28px;\r
	min-width: 28px;\r
	min-height: 28px;\r
	font-size: 0.8em;\r
	border-radius: 10px;\r
	box-shadow: 0 0.3px 0.6px rgb(0 0 0 / 6%), 0 0.7px 1.3px rgb(0 0 0 / 8%),\r
		0 1.3px 2.5px rgb(0 0 0 / 10%), 0 2.2px 4.5px rgb(0 0 0 / 12%),\r
		0 4.2px 8.4px rgb(0 0 0 / 14%), 0 10px 20px rgb(0 0 0 / 20%);\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-url {\r
	color: #000;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-top-url {\r
	color: #000;\r
}\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-functions\r
	button.btn-delete {\r
	background: #263cf3;\r
	color: #fff;\r
}\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-functions\r
	button.btn-delete:active {\r
	background: #6e7be8;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-icon,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-url,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-top-url,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-add-time,\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-update-time,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-url-title,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-functions {\r
	display: flex;\r
	margin: 5px 0px;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-icon p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-url p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-top-url p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-add-time p,\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-update-time\r
	p,\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-url-title\r
	p,\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-functions\r
	p {\r
	min-width: 80px;\r
	max-width: 80px;\r
	align-self: center;\r
}\r
`,Dn={storageKey:"netDiskHistoryMatch",isSetOtherEvent:!1,dataPaging:void 0,show(){let e=this.getNetDiskHistoryMatchData(),a="",n=this;e=this.orderNetDiskHistoryMatchData(e);for(let t=0;t<10;t++)e[t]&&(a+=n.getTableHTML(e[t]).html);a=`
        <div class="netdiskrecord-search">
            <input type="text" placeholder="搜索链接/网址/网址标题，可正则搜索">
        </div>
        <div class="netdiskrecord-table"><ul>${a}</ul></div>
        <div class="netdiskrecord-page">

        </div>`,k.Alias.historyAlias=Z.confirm({title:{text:"历史匹配记录",position:"center"},content:{text:a,html:!0},btn:{reverse:!0,position:"space-between",ok:{enable:!0,callback(t){t.close(),k.Alias.historyAlias=void 0;}},close:{callback(t){t.close(),k.Alias.historyAlias=void 0;}},cancel:{enable:!1},other:{enable:!0,text:`清空所有(${e.length})`,type:"xiaomi-primary",callback:t=>{Z.confirm({title:{text:"删除",position:"center"},content:{text:"确定清空所有的记录？",html:!1},btn:{ok:{enable:!0,callback(i){n.clearNetDiskHistoryMatchData(),v.remove(k.Alias.historyAlias.$shadowRoot.querySelectorAll(".whitesevPopNetDiskHistoryMatch .pops-confirm-content ul li")),i.close(),v.html(k.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-page"),""),v.text(k.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .pops-confirm-btn-other"),v.text(k.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .pops-confirm-btn-other")).replace(/[\d]+/gi,"0"));}},cancel:{text:"取消",enable:!0}}});}}},mask:{clickCallBack(t){t(),k.Alias.historyAlias=null;}},class:"whitesevPopNetDiskHistoryMatch",style:Tn},k.popsStyle.historyMatchView),this.setDataPaging(e),this.setEvent(k.Alias.historyAlias.$shadowRoot),this.setSearchEvent(),k.setRightClickMenu(k.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch"),".netdiskrecord-link a",!0);},getCSS(){},getTableHTML(e){let a=b.handleLinkShow(e.netDiskName,e.netDiskIndex,e.shareCode,e.accessCode,e.matchText),n=v.createElement("li",{innerHTML:`
			<div class="netdiskrecord-link">
				<p>链接</p>
				<a  href="javascript:;" isvisited="false">${a}</a>
			</div>
			<div class="netdiskrecord-icon">
				<p>网盘</p>
				<div class="netdisk-icon-img"></div>
			</div>
			<div class="netdiskrecord-url">
				<p>网址</p>
				<a href="${e.url}" target="_blank">${e.url}</a>
			</div>
			<div class="netdiskrecord-url-title">
				<p>网址标题</p>
				${e.title}
			</div>
			<div class="netdiskrecord-add-time">
				<p>记录时间</p>
				${d.formatTime(e.addTime)}
			</div>
			<div class="netdiskrecord-update-time">
				<p>更新时间</p>
				${d.formatTime(e.updateTime)}
			</div>
			<div class="netdiskrecord-functions">
				<p>功能</p>
				<button class="btn-delete">删除</button>
			</div>
			`}),t=n.querySelector(".netdiskrecord-link"),i=t.querySelector("a"),s=n.querySelector(".netdiskrecord-icon"),r=n.querySelector(".netdisk-icon-img"),o=n.querySelector(".netdiskrecord-url"),l=n.querySelector(".netdiskrecord-url-title"),c=n.querySelector(".netdiskrecord-add-time"),u=n.querySelector(".netdiskrecord-update-time"),p=n.querySelector(".netdiskrecord-functions"),m=p.querySelector(".btn-delete");if(re.handleElementAttributeRuleInfo({netDisk:e.netDiskName,netDiskIndex:e.netDiskIndex,shareCode:e.shareCode,accessCode:e.accessCode},i),r.style.cssText=`background: url(${k.src.icon[e.netDiskName]}) no-repeat;background-size:100%`,e.url!==e.topURL){let w=v.createElement("div",{className:"netdiskrecord-top-url",innerHTML:`
				<p>Top网址</p>
				<a href="${e.topURL}" target="_blank">${e.topURL}</a>
				`});v.after(o,w);}return m.setAttribute("data-json",JSON.stringify(e)),Reflect.set(m,"data-json",e),{$liItemContainer:n,$link:t,$linkAnchor:i,$icon:s,$iconImg:r,$url:o,$urlTitle:l,$addTime:c,$updateTime:u,$features:p,$featuresBtnDelete:m,html:n.outerHTML}},setEvent(e){let a=this;k.view.setNetDiskUrlClickEvent(e,".whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link a"),v.on(e,"click",".whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-functions button.btn-delete",function(n){var u;let t=Z.loading({parent:e.querySelector(".whitesevPopNetDiskHistoryMatch .pops-confirm-content ul"),content:{text:"删除中..."},only:!0,addIndexCSS:!1}),i=n.target,s=i.getAttribute("data-json");(u=i.closest("li"))==null||u.remove(),a.deleteNetDiskHistoryMatchData(s),t==null||t.close();let r=v.text(e.querySelector(".whitesevPopNetDiskHistoryMatch .pops-confirm-btn-other")),o=r.match(/[\d]+/gi),l=parseInt(o[o.length-1]);l--,r=r.replace(/[\d]+/gi,l.toString()),v.text(e.querySelector(".whitesevPopNetDiskHistoryMatch .pops-confirm-btn-other"),r);let c=a.getNetDiskHistoryMatchData();c=a.orderNetDiskHistoryMatchData(c),a.dataPaging.refresh(c),a.pageChangeCallBack(c,a.dataPaging.CONFIG.currentPage);});},pageChangeCallBack(e,a){let n=(a-1)*10,t="";for(let i=0;i<10&&e[n];i++){t+=this.getTableHTML(e[n]).html;n++;}k.Alias.historyAlias.$shadowRoot.querySelectorAll(".whitesevPopNetDiskHistoryMatch .netdiskrecord-table ul li").forEach(i=>i.remove()),v.append(k.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-table ul"),t);},setDataPaging(e){let a=this,n=new En({data:e,pageCount:10,pageStep:K.isPhone()?2:4,currentPage:1,pageChangeCallBack:function(t){a.pageChangeCallBack(e,t);}});this.dataPaging=n,n.addCSS(k.Alias.historyAlias.$shadowRoot),n.append(k.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-page"));},setSearchEvent(){let e=!1,a,n=this;function t(){if(e)return;e=!0,a=Z.loading({parent:k.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .pops-confirm-content ul"),content:{text:"搜索中..."},only:!0,addIndexCSS:!1});let i=k.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-search input").value.trim(),s=n.getNetDiskHistoryMatchData();if(s=n.orderNetDiskHistoryMatchData(s),i===""){let o="";s.forEach((l,c)=>{c>9||(o+=n.getTableHTML(l).html);}),k.Alias.historyAlias.$shadowRoot.querySelectorAll(".whitesevPopNetDiskHistoryMatch .netdiskrecord-table ul li").forEach(l=>l.remove()),v.append(k.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-table ul"),o),a==null||a.close(),e=!1,n.setDataPaging(s);return}let r="";s.forEach(o=>{(b.handleLinkShow(o.netDiskName,o.netDiskIndex,o.shareCode,o.accessCode,o.matchText).match(new RegExp(i,"ig"))||o.url.match(new RegExp(i,"ig"))||o.topURL.match(new RegExp(i,"ig"))||o.title.match(new RegExp(i,"ig")))&&(r+=n.getTableHTML(o).html);}),v.remove(k.Alias.historyAlias.$shadowRoot.querySelectorAll(".whitesevPopNetDiskHistoryMatch .netdiskrecord-table ul li")),v.append(k.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-table ul"),r),v.remove(k.Alias.historyAlias.$shadowRoot.querySelectorAll(".whitesevPopNetDiskHistoryMatch .netdiskrecord-page > *")),a==null||a.close(),a=void 0,e=!1;}v.listenKeyboard(k.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-search input"),"keypress",i=>{i==="Enter"&&t();});},orderNetDiskHistoryMatchData(e){let a=g.historyMatch["netdisk-history-match-ordering-rule"].value,n=a.indexOf("降序")!==-1,t=a.indexOf("记录时间")!==-1?"addTime":"updateTime";return d.sortListByProperty(e,i=>i[t],n),e},setNetDiskHistoryMatchData(e,a,n,t,i){if(!g.historyMatch.saveMatchNetDisk.value)return;let s=this.getNetDiskHistoryMatchData();for(let o=0;o<s.length;o++){const l=s[o];if(l.url===window.location.href&&l.topURL===top.window.location.href&&l.netDiskName===e&&n.startsWith(l.shareCode)&&l.netDiskIndex===a){if(l.matchText!==i){h.success(["匹配历史记录 -> 设置新的matchText",[i]]),s[o].matchText=i,s[o].updateTime=Date.now(),s[o].title&&(s[o].title=document.title),z(this.storageKey,s);return}if(l.accessCode!==t){h.success("匹配历史记录 -> 修改accessCode"),s[o].accessCode=t,s[o].updateTime=Date.now(),s[o].title&&(s[o].title=document.title),z(this.storageKey,s);return}if(l.accessCode===t)return}}h.success("匹配历史记录 -> 增加新的");let r=Date.now();s=[...s,{url:window.location.href,topURL:top.window.location.href,netDiskName:e,netDiskIndex:a,shareCode:n,accessCode:t,addTime:r,updateTime:r,title:document.title||top.document.title,matchText:i}],z(this.storageKey,s);},getNetDiskHistoryMatchData(){let e=O(this.storageKey);return e==null&&(e=[],z(this.storageKey,e)),e},checkAndRepairLocalData(){let e=0,a=O(this.storageKey);if(Array.isArray(a))for(let n=0;n<a.length;n++){const t=a[n];typeof t.matchText!="string"&&(t.matchText="",e++);}else a=[];return z(this.storageKey,a),{count:a.length,repairCount:e}},deleteNetDiskHistoryMatchData(e){let a=!1,n=this.getNetDiskHistoryMatchData();for(let t=0;t<n.length;t++)if(JSON.stringify(n[t])===e){h.success(["删除 ===> ",n[t]]),n.splice(t,1),a=!0;break}return a&&z(this.storageKey,n),a},clearNetDiskHistoryMatchData(){z(this.storageKey,[]);}},k={Alias:{uiLinkAlias:void 0,historyAlias:void 0,settingAlias:void 0},isMatchedNetDiskIconMap:new Set,defaultForbiddenScroll:!1,popsStyle:pt,src:{icon:{},hasIcon(e){return Reflect.has(this.icon,e)},addIcon(e,a){return this.hasIcon(e)?(h.warn("图标字典中已存在该icon："+e),!1):Reflect.set(this.icon,e,a)}},suspension:De,view:re,staticView:Rn,newAccessCodeView:An,netDiskHistoryMatch:Dn,matchPasteText:_n,get websiteRule(){return ue},setGlobalRightClickMenu(e){k.view.registerContextMenu(e,void 0,[{text:"设置",callback(){h.info("打开-设置"),ze.show();}},{text:"历史匹配记录",callback(){h.info("打开-历史匹配记录"),k.netDiskHistoryMatch.show();}},{text:"自定义规则",callback(){h.info("打开-自定义规则"),Ue.show(!1);}},{text:"网站规则",callback(){h.info("打开-网站规则"),ue.show();}},{text:"主动识别文本",callback(){h.info("打开-主动识别文本"),k.matchPasteText.show();}}]);},setRightClickMenu(e,a,n){let t=[{text:"复制链接",callback:function(i,s){let r=s.target;const{netDiskName:o,netDiskIndex:l,shareCode:c,accessCode:u}=re.praseElementAttributeRuleInfo(r);oe.copy(o,l,c,u);}},{text:"访问链接",callback:function(i,s){let r=s.target;const{netDiskName:o,netDiskIndex:l,shareCode:c,accessCode:u}=re.praseElementAttributeRuleInfo(r);let p=J.getBlankUrl(o,l,c,u);oe.openBlank(p,o,l,c,u);}},{text:"修改访问码",callback:function(i,s){let r=s.target;const{netDiskName:o,netDiskIndex:l,shareCode:c,accessCode:u}=re.praseElementAttributeRuleInfo(r);function p(w){let y=new Date().getTime(),R=O(k.netDiskHistoryMatch.storageKey),N=!1;R.forEach(S=>{if(S.netDiskName===o&&S.netDiskIndex===l&&S.shareCode===c&&S.accessCode===u){S=d.assign(S,{accessCode:w,updateTime:y}),h.success(["成功找到项",S]),N=!0;return}}),N?(z(k.netDiskHistoryMatch.storageKey,R),r.closest("li").querySelector(".netdiskrecord-update-time").lastChild.textContent=d.formatTime(y),r.setAttribute("data-accesscode",w),f.success(`
                                <div style="text-align: left;">旧: ${u}</div>
                                <div style="text-align: left;">新: ${w}</div>`,{html:!0})):f.error("修改失败");}function m(w){i.target.setAttribute("data-accesscode",w);let y=b.$match.matchedInfo.get(o);if(y.has(c)){let R=y.get(c);y.set(c,b.getLinkDickObj(w,l,!0,R.matchText)),f.success(`
                                <div style="text-align: left;">旧: ${u}</div>
                                <div style="text-align: left;">新: ${w}</div>`,{html:!0});}else f.error("该访问码不在已获取的字典中："+c);}k.newAccessCodeView(this.text,o,l,c,u,w=>{n?p(w):m(w);});}}];n||(t.push({text:"删除当前项",callback:function(i,s){let r=s.target,o=r.closest(".netdisk-url-box");const{netDiskName:l,netDiskIndex:c,shareCode:u,accessCode:p}=re.praseElementAttributeRuleInfo(r);let m=!1;b.$match.matchedInfo.forEach((w,y)=>{y===l&&w.forEach((R,N)=>{N===u&&(m=!0,w.delete(N),h.info(["删除：",y,JSON.stringify(R)]));});}),b.$match.matchedInfoRuleKey.clear(),b.$match.matchedInfo.forEach((w,y)=>{w.length&&b.$match.matchedInfoRuleKey.add(y);}),m?o.remove():f.error("发生意外情况，未在已匹配到的信息中到对应的网盘信息");}}),t.push({text:"删除所有项",callback:function(i,s){let r=s.target,o=r.closest(".netdisk-url-box-all");re.praseElementAttributeRuleInfo(r),b.$match.matchedInfo.forEach((l,c)=>{l.clear();}),b.$match.matchedInfoRuleKey.clear(),o.innerHTML="";}})),k.view.registerContextMenu(e,a,t);}},Z={alert(e,a){return e=this.handleDetails(e,a),K.alert(e)},confirm(e,a){return e=this.handleDetails(e,a),K.confirm(e)},loading(e){return typeof e.animation>"u"&&(e.animation=g.pops.popsAnimation.value),typeof e.forbiddenScroll>"u"&&(e.forbiddenScroll=k.defaultForbiddenScroll),K.loading(e)},prompt(e,a){return e=this.handleDetails(e,a),K.prompt(e)},folder(e,a){return e=this.handleDetails(e,a),e.sort={name:g.popsFolder["pops-folder-sort-name"].value,isDesc:g.popsFolder["pops-folder-sort-is-desc"].value,callback(n,t,i,s){g.popsFolder["pops-folder-sort-name"].value=i,g.popsFolder["pops-folder-sort-is-desc"].value=s;}},K.folder(e)},panel(e,a){return e=this.handleDetails(e,a),K.panel(e)},rightClickMenu(e){return e=this.handleDetails(e),K.rightClickMenu(e)},handleDetails(e,a){if(e=Object.assign({animation:g.pops.popsAnimation.value,drag:g.pops.pcDrag.value,dragLimit:g.pops.pcDragLimit.value,forbiddenScroll:k.defaultForbiddenScroll},e),a!=null)if(K.isPhone()){let n=typeof a.Mobile.width=="function"?a.Mobile.width():a.Mobile.width,t=typeof a.Mobile.height=="function"?a.Mobile.height():a.Mobile.height;e.width=n,e.height=t;}else {let n=typeof a.PC.width=="function"?a.PC.width():a.PC.width,t=typeof a.PC.height=="function"?a.PC.height():a.PC.height;e.width=n,e.height=t;}if(e.mask==null&&(e.mask={}),typeof e.mask.enable!="boolean"&&(e.mask.enable=!0),e.mask.clickEvent==null&&(e.mask.clickEvent={}),typeof e.mask.clickEvent.toClose!="boolean"&&(e.mask.clickEvent.toClose=g.pops.clickMaskToCloseDialog.value),g.pops.popsAcrylic.value){let n=`
            .pops {
                --acrylic-opacity: 0.7;
                --acrylic-color: rgba(232, 232, 232, var(--acrylic-opacity));
                --acrylic-blur: 30px;
                --acrylic-saturate: 125%;
                --pops-bg-opacity: var(--acrylic-opacity);
            }
            .pops {
                backdrop-filter: blur(var(--acrylic-blur)) saturate(var(--acrylic-saturate));
                background-color: var(--acrylic-color);
            }
            .pops[type-value=panel]{
                --aside-bg-color: rgba(221, 221, 221, var(--acrylic-opacity));
            }
            `;typeof e.style=="string"?e.style+=n:e.style=n;}return e.zIndex=()=>{let t=d.getMaxZIndex(10),i=K.config.InstanceUtils.getPopsMaxZIndex(10).zIndex;return d.getMaxValue(t,i)+10},e}},Mn=`/* 容器 */\r
.website-rule-container {\r
}\r
/* 每一条规则 */\r
.website-rule-item {\r
	display: flex;\r
	align-items: center;\r
	line-height: 1;\r
	font-size: 16px;\r
	padding: 4px 4px;\r
	gap: 6px;\r
}\r
/* 规则名 */\r
.website-rule-item .website-rule-name {\r
	flex: 1;\r
	white-space: nowrap;\r
	text-overflow: ellipsis;\r
	overflow: hidden;\r
}\r
/* 操作按钮 */\r
.website-rule-item .website-controls {\r
	display: flex;\r
	align-items: center;\r
	text-overflow: ellipsis;\r
	overflow: hidden;\r
	white-space: nowrap;\r
	gap: 8px;\r
	padding: 0px 4px;\r
}\r
/* 编辑和删除按钮 */\r
.website-rule-item .website-rule-edit,\r
.website-rule-item .website-rule-delete {\r
	width: 16px;\r
	height: 16px;\r
	cursor: pointer;\r
}\r
/* 启用按钮 */\r
.website-rule-item .website-rule-enable {\r
}\r
/* 编辑按钮 */\r
.website-rule-item .website-rule-edit {\r
}\r
/* 删除按钮 */\r
.website-rule-item .website-rule-delete {\r
}\r
`,Pe=function(e,a,n,t,i,s,r,o,l){return {text:e,type:"button",description:a,attributes:{},props:{},buttonIcon:t,buttonIsRightIcon:i,buttonIconIsLoading:s,buttonType:r,buttonText:n,callback(u){typeof o=="function"&&o(u);},afterAddToUListCallBack:l}};function Ve(e){if(e===null||typeof e!="object")return e;let a=Array.isArray(e)?[]:{};for(let n in e)e.hasOwnProperty(n)&&(a[n]=Ve(e[n]));return a}let Ln=[{a:1},{b:2}];Ve(Ln);const je={show(e,a,n){function t(V){return {get(H,T){let M=j.getRule(V);return Reflect.get(M.data,H)??T},set(H,T){let M=j.getRule(V);Reflect.set(M.data,H,T),j.updateRule(M);}}}function i(V){return {get(H,T){let M=j.getRule(V);return Reflect.get(M,H)??T},set(H,T){j.updateRuleValue(o.uuid,H,T);}}}function s(){if(a==null&&j.deleteRule(o.uuid),n==null)ue.updateRuleContaienrElement(e);else {let V=j.getRule(o.uuid);ue.updateRuleItemElement(V,n,e);}}let r=Z.confirm({title:{text:a==null?"添加规则":"编辑规则",position:"center"},content:{text:`
                    <ul class="website-rule-container">
                    </ul>
                    `,html:!0},btn:{close:{enable:!0,callback(V,H){r.close(),s();}},cancel:{enable:!0,text:"取消",callback(V,H){r.close(),s();}},ok:{enable:!0,text:"确定",callback(V,H){var M;let T=j.getRule(o.uuid);if(((M=T.name)==null?void 0:M.trim())===""){f.error("规则名称不能为空");return}if(T.url.trim()===""){f.error("匹配网址不能为空");return}else try{new RegExp(T.url);}catch(E){h.error(E),f.error("匹配网址不能被正确解析为正则表达式："+E.message,{timeout:5e3});return}r.close(),a==null?ue.appendRuleItemElement(e,T):ue.updateRuleItemElement(T,n,e);}}},mask:{clickEvent:{toClose:!1,toHide:!1}},style:`
                ${K.config.cssText.panelCSS}
                
                .website-rule-container {
                    
                }
                .website-rule-container li{
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 5px 20px;
                }
                .pops-panel-item-left-main-text{
                    white-space: nowrap;
                }
                .pops-panel-item-right-text{
                    padding-left: 30px;
                }
                .pops-panel-item-right-text,
                .pops-panel-item-right-main-text{
                    text-overflow: ellipsis;
                    overflow: hidden;
                    white-space: nowrap;
                }
                `},k.popsStyle.websiteEditRuleView),o=a??{enable:!0,uuid:d.generateUUID(),name:"",url:"",data:{}};a==null&&j.addRule(o);let l=K.config.panelHandleContentUtils(),c=r.$shadowRoot.querySelector(".website-rule-container"),u=v.createElement("li",{innerHTML:`
                <div class="pops-panel-item-left-text">
                    <p class="pops-panel-item-left-main-text">UUID</p>
                </div>
                <div class="pops-panel-item-right-text">
                    <p class="pops-panel-item-right-main-text">${o.uuid}</p>
                </div>
                `},{"data-key":"uuid","data-default-value":o.uuid});c.appendChild(u);let p=$("启用","enable",!0,void 0,void 0,void 0);Reflect.set(p.props,q,i(o.uuid));let m=l.createSectionContainerItem_switch(p);c.appendChild(m);let w=Re("规则名称","name","","",void 0,void 0,void 0);Reflect.set(w.props,q,i(o.uuid));let y=l.createSectionContainerItem_input(w);c.appendChild(y);let R=Re("匹配网址","url","","",void 0,void 0,void 0);Reflect.set(R.props,q,i(o.uuid));let N=l.createSectionContainerItem_input(R);c.appendChild(N);let S=Pe("覆盖设置","","自定义",void 0,!1,!1,"primary",V=>{let H=Y.getPanelContentConfig().concat($e.getRulePanelContent()),T=Ve(H);console.log(T);function M(E){E.forEach(I=>{if(typeof(I==null?void 0:I.props)=="object"&&Reflect.has(I.props,q)){let ne=t(o.uuid);Reflect.set(I.props,q,ne);}let ae=I.forms;ae&&Array.isArray(ae)&&M(ae);});}for(let E=0;E<T.length;E++){let I=T[E];if(!I.forms)continue;if(typeof I.afterRender=="function"&&(I!=null&&I.id.toString().startsWith("netdisk-panel-config-"))&&(I.afterRender=ne=>{let ie=ne.asideConfig.attributes["data-key"],ge=L.function.enable(ie);ne.$asideLiElement.setAttribute("data-function-enable",j.getRuleDataValue(o.uuid,ge,!0));}),typeof I.attributes=="object"&&I.forms!=null&&le in I.attributes){let ne=I.attributes[le],ie=$("启用",Le.features.customAccessCodeEnable(ne),!1,void 0,"启用后将允许执行下面的功能",void 0);Reflect.set(ie.props,q,t(o.uuid));let ge=Re("自定义访问码",Le.features.customAccessCode(ne),"","让获取的到的链接的访问码都为自定义的访问码",void 0,"请输入自定义访问码",!1,!1);Reflect.set(ge.props,q,t(o.uuid));let ve={text:"额外功能",type:"forms",forms:[ie,ge]};I.forms.length?I.forms.splice(1,0,ve):I.forms.push(ve);}let ae=I.forms;ae&&Array.isArray(ae)&&M(ae);}Z.panel({title:{text:"覆盖设置",position:"center"},content:T,btn:{close:{enable:!0,callback(E){E.close(),k.Alias.settingAlias=void 0;}}},mask:{clickCallBack(E){E(),k.Alias.settingAlias=void 0;}},class:"whitesevPopSetting",style:`
						${nt}


						/* 隐藏顶部的图标 */
						.netdisk-custom-rule-edit,
						.netdisk-custom-rule-delete{
							display: none !important;
						}
						`},k.popsStyle.settingView);},void 0),W=l.createSectionContainerItem_button(S);c.appendChild(W);}},ue={$data:{isShowEditView:!1},show(){const e=this;this.$data.isShowEditView=!0;let a=j.getAllRule(),n=Z.confirm({title:{text:"网站规则",position:"center"},content:{text:`
                    <div class="website-rule-container">
                    </div>
                    `,html:!0},btn:{merge:!0,reverse:!1,position:"space-between",ok:{enable:!0,type:"primary",text:"添加",callback(t){je.show(n.$shadowRoot);}},close:{enable:!0,callback(t){e.$data.isShowEditView=!1,t.close();}},cancel:{enable:!0,type:"default",text:"过滤",callback(t,i){}},other:{enable:!0,type:"xiaomi-primary",text:`清空所有(${a.length})`,callback(t){let i=Z.confirm({title:{text:"提示",position:"center"},content:{text:"确定清空所有的规则？",html:!1},btn:{ok:{enable:!0,callback:function(s){if(h.success("清空所有"),j.deleteAllRule(),j.getAllRule().length){f.error("清空全部规则失败");return}else f.success("已清空全部规则");e.updateDeleteAllBtnText(n.$shadowRoot),e.clearContent(n.$shadowRoot),i.close();}},cancel:{text:"取消",enable:!0}}});}}},mask:{clickCallBack(t,i){e.$data.isShowEditView=!1,t();}},class:"pops-website-rule",style:`
				${K.config.cssText.panelCSS}

				${Mn}
				`},k.popsStyle.websiteRuleView);this.updateRuleContaienrElement(n.$shadowRoot);},parseElement(e){let a=e.querySelector(".website-rule-container"),n=e.querySelector(".pops-confirm-btn button.pops-confirm-btn-other");return {$container:a,$deleteBtn:n}},parseItemElement(e){let a=e.querySelector(".website-rule-enable .pops-panel-switch"),n=e.querySelector(".website-rule-enable .pops-panel-switch__input"),t=e.querySelector(".website-rule-enable .pops-panel-switch__core"),i=e.querySelector(".website-rule-edit"),s=e.querySelector(".website-rule-delete");return {$enableSwitch:a,$enableSwitchInput:n,$enableSwitchCore:t,$edit:i,$delete:s}},createRuleItemElement(e,a){let n=v.createElement("div",{className:"website-rule-item",innerHTML:`
			<div class="website-rule-name">${e.name??e.url}</div>
			<div class="website-controls">
				<div class="website-rule-enable">
					<div class="pops-panel-switch">
						<input class="pops-panel-switch__input" type="checkbox">
						<span class="pops-panel-switch__core">
							<div class="pops-panel-switch__action">
							</div>
						</span>
					</div>
				</div>
				<div class="website-rule-edit">
					${K.config.iconSVG.edit}
				</div>
				<div class="website-rule-delete">
					${K.config.iconSVG.delete}
				</div>
			</div>
			`});n.setAttribute("data-uuid",e.uuid);let t="pops-panel-switch-is-checked";const{$enableSwitch:i,$enableSwitchCore:s,$enableSwitchInput:r,$delete:o,$edit:l}=this.parseItemElement(n);return v.on(s,"click",c=>{let u=!1;i.classList.contains(t)?(i.classList.remove(t),u=!1):(i.classList.add(t),u=!0),r.checked=u,e.enable=u,j.updateRule(e);}),e.enable&&i.classList.add(t),v.on(l,"click",c=>{d.preventEvent(c),je.show(a,e,n);}),v.on(o,"click",c=>{d.preventEvent(c);let u=Z.confirm({title:{text:"提示",position:"center"},content:{text:"确定删除该规则？",html:!1},btn:{ok:{enable:!0,callback:function(p){h.success("删除规则"),j.deleteRule(e.uuid)?(f.success("已删除规则"),n.remove(),ue.updateDeleteAllBtnText(a),u.close()):f.error("删除规则失败");}},cancel:{text:"取消",enable:!0}}});}),n},appendRuleItemElement(e,a){const{$container:n}=this.parseElement(e);if(Array.isArray(a))for(let t=0;t<a.length;t++){const i=a[t];n.appendChild(this.createRuleItemElement(i,e));}else n.appendChild(this.createRuleItemElement(a,e));this.updateDeleteAllBtnText(e);},updateRuleContaienrElement(e){this.clearContent(e),this.parseElement(e);let a=j.getAllRule();this.appendRuleItemElement(e,a),this.updateDeleteAllBtnText(e);},updateRuleItemElement(e,a,n){let t=this.createRuleItemElement(e,n);a.after(t),a.remove();},clearContent(e){const{$container:a}=this.parseElement(e);a.innerHTML="";},setDeleteBtnText(e,a,n=!1){const{$deleteBtn:t}=this.parseElement(e);n?t.innerHTML=a:t.innerText=a;},updateDeleteAllBtnText(e){let a=j.getAllRule();this.setDeleteBtnText(e,`清空所有(${a.length})`);}},we=new Je("websiteRule"),Nn=(e,a,n)=>{if(ue.$data.isShowEditView)return a;let i=j.getUrlMatchedRule().find(s=>{let r=j.getRuleData(s);return Reflect.has(r,e)});return i?Reflect.get(j.getRuleData(i),e):a},$n=function(e,a,n){return {KEY:e,default:a,get value(){let t=O(e,a);return typeof n=="function"?n(e,t,a):t},set value(t){z(e,t);}}},A=function(e,a){return $n(e,a,Nn)},g={toast:{position:A("qmsg-config-position","top"),maxnums:A("qmsg-config-maxnums",3),showreverse:A("qmsg-config-showreverse",!0)},pops:{popsAnimation:A("popsAnimation","pops-anim-fadein-zoom"),clickMaskToCloseDialog:A("clickMaskToCloseDialog",!0),pcDrag:A("pcDrag",!0),pcDragLimit:A("pcDragLimit",!0),popsAcrylic:A("popsAcrylic",!1)},popsFolder:{"pops-folder-sort-name":A("pops-folder-sort-name","fileName"),"pops-folder-sort-is-desc":A("pops-folder-sort-is-desc",!1)},smallIconNavgiator:{"pops-netdisk-icon-click-event-find-sharecode":A("pops-netdisk-icon-click-event-find-sharecode",!0),"pops-netdisk-icon-click-event-find-sharecode-with-select":A("pops-netdisk-icon-click-event-find-sharecode-with-select",!0),"pops-netdisk-icon-click-event-loop-find-sharecode":A("pops-netdisk-icon-click-event-loop-find-sharecode",!0)},suspension:{size:A("size",50),opacity:A("opacity",1),"randbg-time":A("randbg-time",1500),"randbg-show-time":A("randbg-show-time",1200),"suspended-button-adsorption-edge":A("suspended-button-adsorption-edge",!1)},smallWindow:{"netdisk-ui-small-window-width":A("netdisk-ui-small-window-width",250),"netdisk-ui-small-window-max-height":A("netdisk-ui-small-window-max-height",200)},historyMatch:{"netdisk-history-match-ordering-rule":A("netdisk-history-match-ordering-rule","按 更新时间 - 降序"),saveMatchNetDisk:A("saveMatchNetDisk",!1)},match:{pageMatchRange:A("pageMatchRange",["innerText","innerHTML"]),depthQueryWithShadowRoot:A("depthQueryWithShadowRoot",!1),readClipboard:A("readClipboard",!1),allowMatchLocationHref:A("allowMatchLocationHref",!0),toBeMatchedWithInputElementValue:A("to-be-matched-inputElementValue",!1),toBeMatchedTextAreaElementValue:A("to-be-matched-textAreaElementValue",!1),delaytime:A("delaytime",.8),isAddedNodesToMatch:A("isAddedNodesToMatch",!1),"mutationObserver-childList":A("mutationObserver-childList",!0),"mutationObserver-characterData":A("mutationObserver-characterData",!0),"mutationObserver-subtree":A("mutationObserver-subtree",!0)},function:{"netdisk-behavior-mode":A("netdisk-behavior-mode","suspension_smallwindow"),autoFillAccessCode:A("autoFillAccessCode",!0),getTheDirectLinkAfterRedirection:A("getTheDirectLinkAfterRedirection",!1)},aboutShareCode:{excludeIdenticalSharedCodesCoefficient:A("excludeIdenticalSharedCodesCoefficient",1),excludeIdenticalSharedCodes:A("excludeIdenticalSharedCodes",!1)}},Un="网盘链接识别",at=!1,d=ye.noConflict(),v=B.noConflict(),K=Ie,zn=CryptoJS??window.CryptoJS??Q.CryptoJS,En=DataPaging??window.DataPaging??Q.DataPaging,h=new d.Log(fe,Q.console||ut.console);var We;const it=((We=fe==null?void 0:fe.script)==null?void 0:We.name)||Un,In=Ie.config.Utils.AnyTouch();h.config({debug:at,logMaxCount:1e3,autoClearConsole:!0,tag:!0});f.config(Object.defineProperties({html:!0,autoClose:!0,showClose:!1},{position:{get(){return g.toast.position.value}},maxNums:{get(){return g.toast.maxnums.value}},showReverse:{get(){return g.toast.showreverse.value}},zIndex:{get(){let e=ye.getMaxZIndex(10),a=Ie.config.InstanceUtils.getPopsMaxZIndex(e).zIndex;return ye.getMaxValue(e,a)+100}}}));const Fn=new d.GM_Menu({GM_getValue:O,GM_setValue:z,GM_registerMenuCommand:lt,GM_unregisterMenuCommand:ct}),C=new d.Httpx(dt);C.interceptors.request.use(e=>(ht.handle(e),e));C.interceptors.response.use(void 0,e=>(h.error(["拦截器-请求错误",e]),e.type==="onabort"?f.warning("请求取消"):e.type==="onerror"?f.error("请求异常"):e.type==="ontimeout"?f.error("请求超时"):f.error("其它错误"),e));C.config({logDetails:at,headers:{"User-Agent":d.getRandomPCUA()}});Q.Object.defineProperty,Q.Function.prototype.apply,Q.Function.prototype.call,Q.Element.prototype.appendChild,Q.setTimeout;const qe=d.addStyle.bind(d),ke=function(e,a,n,t,i,s="default",r){let o=i,l=()=>r.getShowText(n,o),c=Pe(e,a,l,"keyboard",!1,!1,s,async u=>{var w;let m=(w=u.target.closest(".pops-panel-button"))==null?void 0:w.querySelector("span");if(r.isWaitPress){f.warning("请先执行当前的录入操作");return}if(r.hasOptionValue(n))r.emptyOption(n),f.success("清空快捷键");else {let y=f.loading("请按下快捷键...",{showClose:!0}),{status:R,option:N,key:S}=await r.enterShortcutKeys(n);y.close(),R?(h.success(["成功录入快捷键",N]),f.success("成功录入")):f.error(`快捷键 ${r.translateKeyboardValueToButtonText(N)} 已被 ${S} 占用`);}m.innerHTML=l();});return c.attributes={},Reflect.set(c.attributes,et,()=>!1),c};class Pn{constructor(a){F(this,"key","short-cut");F(this,"isWaitPress",!1);typeof a=="string"&&(this.key=a);}initConfig(a,n){this.hasOption(a)||this.setOption(a,n);}getStorageKey(){return this.key}getLocalAllOptions(){return O(this.key,[])}hasOption(a){return !!this.getLocalAllOptions().find(i=>i.key===a)}hasOptionValue(a){if(this.hasOption(a)){let n=this.getOption(a);return (n==null?void 0:n.value)!=null}else return !1}getOption(a,n){return this.getLocalAllOptions().find(s=>s.key===a)??n}setOption(a,n){let t=this.getLocalAllOptions(),i=t.findIndex(s=>s.key===a);i==-1?t.push({key:a,value:n}):Reflect.set(t[i],"value",n),z(this.key,t);}emptyOption(a){let n=!1,t=this.getLocalAllOptions(),i=t.findIndex(s=>s.key===a);return i!==-1&&(t[i].value=null,n=!0),z(this.key,t),n}deleteOption(a){let n=!1,t=this.getLocalAllOptions(),i=t.findIndex(s=>s.key===a);return i!==-1&&(t.splice(i,1),n=!0),z(this.key,t),n}translateKeyboardValueToButtonText(a){let n="";return a.ohterCodeList.forEach(t=>{n+=d.stringTitleToUpperCase(t,!0)+" + ";}),n+=d.stringTitleToUpperCase(a.keyName),n}getShowText(a,n){if(this.hasOption(a)){let t=this.getOption(a);return t.value==null?n:this.translateKeyboardValueToButtonText(t.value)}else return n}async enterShortcutKeys(a){return new Promise(n=>{this.isWaitPress=!0;let t=v.listenKeyboard(window,"keyup",(i,s,r)=>{const o={keyName:i,keyValue:s,ohterCodeList:r},l=JSON.stringify(o),c=this.getLocalAllOptions();for(let u=0;u<c.length;u++){let p=c[u];if(p.key===a)continue;const m=JSON.stringify(p.value);let w=!1;if(p.value!=null&&l===m&&(w=!0),w){this.isWaitPress=!1,t.removeListen(),n({status:!1,key:p.key,option:o});return}}this.setOption(a,o),this.isWaitPress=!1,t.removeListen(),n({status:!0,key:a,option:o});});})}initGlobalKeyboardListener(a){let n=this.getLocalAllOptions();if(!n.length){h.warn("没有设置快捷键");return}let t=this;function i(o,l){v.listenKeyboard(o,"keydown",(c,u,p)=>{if(t.isWaitPress)return;n=t.getLocalAllOptions();let m=n.findIndex(w=>{let y=w.value,R={keyName:c,keyValue:u,ohterCodeList:p};if(JSON.stringify(y)===JSON.stringify(R))return w});if(m!=-1){let w=n[m];h.info(["调用快捷键",w]),w.key in l&&l[w.key].callback();}});}let s={},r={};Object.keys(a).forEach(o=>{let l=a[o];(l.target==null||typeof l.target=="string"&&l.target==="")&&(l.target="window"),l.target==="window"?Reflect.set(s,o,l):Reflect.set(r,o,l);}),i(window,s),v.ready(()=>{Object.keys(r).forEach(async o=>{let l=r[o];if(typeof l.target=="string")d.waitNode(l.target,1e4).then(c=>{if(!c)return;let u={};Reflect.set(u,o,l),i(c,u);});else if(typeof l.target=="function"){let c=await l.target();if(c==null)return;let u={};Reflect.set(u,o,l),i(c,u);}else {let c={};Reflect.set(c,o,l),i(l.target,c);}});});}}const pe={shortCut:new Pn("GM_shortcut"),init(){this.shortCut.initGlobalKeyboardListener(this.getShortCutMap());},getShortCutMap(){return {"netdisk-keyboard-open-setting":{target:"window",callback:()=>{h.info("【打开】⚙ 设置"),ze.show();}},"netdisk-keyboard-open-history-matching-records":{target:"window",callback:()=>{h.info("【打开】⚙ 历史匹配记录"),k.netDiskHistoryMatch.show();}},"netdisk-keyboard-open-user-rule":{target:"window",callback:()=>{h.info("【打开】⚙ 用户自定义规则"),Ue.show(!1);}},"netdisk-keyboard-open-proactively-recognize-text":{target:"window",callback:()=>{h.info("【打开】⚙ 主动识别文本"),k.matchPasteText.show();}}}}},Vn=function(e,a,n,t,i,s,r="请至少选择一个选项",o){let l=[];typeof t=="function"?l=t():l=t;let c={text:e,type:"select-multiple",description:s,placeholder:r,attributes:{},props:{},getValue(){return this.props[q].get(a,n)},selectConfirmDialogDetails:o,callback(u){let p=[];u.forEach(m=>{p.push(m.value);}),this.props[q].set(a,p),h.info(["多选-选择：",p]);},data:l};return Reflect.set(c.attributes,le,a),Reflect.set(c.attributes,me,n),Reflect.set(c.props,q,{get(u,p){return O(u,p)},set(u,p){z(u,p);}}),c},On={id:"netdisk-panel-config-all-setting",title:"总设置",isDefault:!0,forms:[{type:"forms",text:"",forms:[{type:"deepMenu",text:"Toast",forms:[{type:"forms",text:"",className:"netdisk-panel-forms-toast",forms:[ce("位置",g.toast.position.KEY,g.toast.position.default,[{value:"topleft",text:"左上角"},{value:"top",text:"顶部"},{value:"topright",text:"右上角"},{value:"left",text:"左边"},{value:"center",text:"中间"},{value:"right",text:"右边"},{value:"bottomleft",text:"左下角"},{value:"bottom",text:"底部"},{value:"bottomright",text:"右下角"}],void 0,`Toast显示在九宫格的位置，默认: ${g.toast.position.default}`),ce("同时最多显示的数量",g.toast.maxnums.KEY,g.toast.maxnums.default,[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"},{value:5,text:"5"}],void 0,`默认: ${g.toast.maxnums.default}`),$("逆序弹出",g.toast.showreverse.KEY,g.toast.showreverse.value,void 0,"默认是自上往下显示Toast，逆序则是自下往上显示Toast")]}]},{type:"deepMenu",text:"弹窗",forms:[{className:"netdisk-panel-forms-pops",type:"forms",text:"",forms:[ce("动画",g.pops.popsAnimation.KEY,g.pops.popsAnimation.default,[{value:"",text:"无"},{value:"pops-anim-spread",text:"spread"},{value:"pops-anim-shake",text:"shake"},{value:"pops-anim-rolling-left",text:"rolling-left"},{value:"pops-anim-rolling-right",text:"rolling-right"},{value:"pops-anim-slide-top",text:"slide-top"},{value:"pops-anim-slide-bottom",text:"slide-bottom"},{value:"pops-anim-slide-left",text:"slide-left"},{value:"pops-anim-slide-right",text:"slide-right"},{value:"pops-anim-fadein",text:"fadein"},{value:"pops-anim-fadein-zoom",text:"fadein-zoom"},{value:"pops-anim-fadein-alert",text:"fadein-alert"},{value:"pops-anim-don",text:"don"},{value:"pops-anim-roll",text:"roll"},{value:"pops-anim-sandra",text:"sandra"},{value:"pops-anim-gather",text:"gather"}],void 0,`显示/关闭的动画效果，默认: ${g.pops.popsAnimation.default}`),$("点击弹窗遮罩层关闭弹窗",g.pops.clickMaskToCloseDialog.KEY,g.pops.clickMaskToCloseDialog.default,void 0,"点击遮罩层触发关闭弹窗事件"),$("窗口拖拽",g.pops.pcDrag.KEY,g.pops.pcDrag.default,void 0,"长按标题栏可拖拽移动弹窗"),$("限制拖拽距离",g.pops.pcDragLimit.KEY,g.pops.pcDragLimit.default,void 0,"只能在浏览器的可视窗口内拖动"),$("亚克力效果",g.pops.popsAcrylic.KEY,g.pops.popsAcrylic.default,void 0,"")]}]},{type:"deepMenu",text:"文件弹窗",forms:[{type:"forms",text:"",className:"netdisk-panel-forms-pops-folder",forms:[ce("排序名",g.popsFolder["pops-folder-sort-name"].KEY,g.popsFolder["pops-folder-sort-name"].default,[{value:"fileName",text:"文件名"},{value:"latestTime",text:"修改时间"},{value:"fileSize",text:"大小"}],void 0,"当前的规则"),ce("排序规则",g.popsFolder["pops-folder-sort-is-desc"].KEY,g.popsFolder["pops-folder-sort-is-desc"].default,[{value:!1,text:"升序"},{value:!0,text:"降序"}],void 0,"当前的规则")]}]},{type:"deepMenu",text:"小图标导航",forms:[{type:"forms",text:"",forms:[$("点击定位分享码",g.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode"].KEY,g.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode"].default,void 0,"自动滚动页面至包含分享码的元素"),$("选中分享码",g.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode-with-select"].KEY,g.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode-with-select"].default,void 0,"使用光标选中分享码/元素"),$("循环定位",g.smallIconNavgiator["pops-netdisk-icon-click-event-loop-find-sharecode"].KEY,g.smallIconNavgiator["pops-netdisk-icon-click-event-loop-find-sharecode"].default,void 0,"关闭则是每一个元素只定位一次")]}]},{type:"deepMenu",text:"悬浮按钮",forms:[{type:"forms",text:"",forms:[te("大小",g.suspension.size.KEY,g.suspension.size.default,15,250,(e,a)=>{g.suspension.size.value=parseInt(a.toString()),k.suspension.isShow&&(v.css(k.suspension.suspensionNode,{width:g.suspension.size.value,height:g.suspension.size.value}),k.suspension.setSuspensionPosition());},e=>`${e}px`,"悬浮按钮的大小，默认: "+g.suspension.size.default),te("透明度",g.suspension.opacity.KEY,g.suspension.opacity.default,.1,1,(e,a)=>{g.suspension.opacity.value=parseFloat(a.toString()),k.suspension.isShow&&v.css(k.suspension.suspensionNode,{opacity:g.suspension.opacity.value});},void 0,"值越小越透明，默认: "+g.suspension.opacity.default,.1),te("背景轮播时间",g.suspension["randbg-time"].KEY,g.suspension["randbg-time"].default,0,1e4,void 0,e=>`${e}ms`,"淡入/淡出的时间，默认: "+g.suspension["randbg-time"].default+"ms",100),te("背景显示时间",g.suspension["randbg-show-time"].KEY,g.suspension["randbg-show-time"].default,0,1e4,void 0,e=>`${e}ms`,"图标显示的持续时间，默认: 1200",100),$("吸附边缘",g.suspension["suspended-button-adsorption-edge"].KEY,g.suspension["suspended-button-adsorption-edge"].default,void 0,"移动悬浮按钮松开后自动吸附边缘")]}]},{type:"deepMenu",text:"小窗模式",forms:[{type:"forms",text:"",className:"netdisk-panel-forms-small-window",forms:[te("宽度",g.smallWindow["netdisk-ui-small-window-width"].KEY,g.smallWindow["netdisk-ui-small-window-width"].default,50,v.width(window),void 0,e=>`${e}px`,"设置小窗宽度(px)，默认: 250",1),te("高度",g.smallWindow["netdisk-ui-small-window-max-height"].KEY,g.smallWindow["netdisk-ui-small-window-max-height"].default,50,v.height(window),void 0,e=>`${e}px`,"设置小窗最大高度(px)，默认: "+g.smallWindow["netdisk-ui-small-window-max-height"].default,1)]}]},{type:"deepMenu",text:"历史匹配记录",forms:[{type:"forms",text:"",className:"netdisk-panel-history-match",forms:[ce("排序规则",g.historyMatch["netdisk-history-match-ordering-rule"].KEY,g.historyMatch["netdisk-history-match-ordering-rule"].default,[{value:"按 记录时间 - 升序",text:"按 记录时间 - 升序"},{value:"按 记录时间 - 降序",text:"按 记录时间 - 降序"},{value:"按 更新时间 - 升序",text:"按 更新时间 - 升序"},{value:"按 更新时间 - 降序",text:"按 更新时间 - 降序"}]),Pe("修复存储记录","如果【匹配记录】弹窗打不开，可能是存储的数据缺失某些字段，可尝试点击此处进行修复","修复",void 0,void 0,!1,"primary",()=>{try{const{count:e,repairCount:a}=k.netDiskHistoryMatch.checkAndRepairLocalData();a===0?f.info("不存在需要修复的数据"):f.success(`共计: ${e} 条，修复${a}条`);}catch(e){f.error("修复异常："+e.toString());}}),$("保存匹配记录",g.historyMatch.saveMatchNetDisk.KEY,g.historyMatch.saveMatchNetDisk.default,void 0,"将匹配到的链接信息进行本地存储，可点击【油猴菜单-⚙ 历史匹配记录】进行查看")]}]},{type:"deepMenu",text:"匹配设置",forms:[{type:"forms",text:"文本匹配范围",forms:[Vn("匹配规则类型",g.match.pageMatchRange.KEY,g.match.pageMatchRange.default,[{value:"innerText",text:"普通文本"},{value:"innerHTML",text:"超文本"}],void 0,"执行的文本匹配规则",void 0,{height:"auto"}),$("深入ShadowRoot获取匹配文本",g.match.depthQueryWithShadowRoot.KEY,g.match.depthQueryWithShadowRoot.default,void 0,"遍历ShadowRoot，获取匹配的内容"),$("匹配剪贴板",g.match.readClipboard.KEY,g.match.readClipboard.default,void 0,"Api兼容性查看：<a href='https://caniuse.com/mdn-api_permissions_permission_clipboard-read' target='_blank'>读取剪贴板权限申请</a>、<a href='https://caniuse.com/mdn-api_clipboard_readtext' target='_blank'>直接读取剪贴板</a>"),$("匹配当前URL",g.match.allowMatchLocationHref.KEY,g.match.allowMatchLocationHref.default,void 0,"提取window.location.href进行匹配"),$("匹配input标签的内容",g.match.toBeMatchedWithInputElementValue.KEY,g.match.toBeMatchedWithInputElementValue.default,void 0,"提取页面中的&lt;input&gt;的内容进行匹配"),$("匹配textarea标签的内容",g.match.toBeMatchedTextAreaElementValue.KEY,g.match.toBeMatchedTextAreaElementValue.default,void 0,"提取页面中的&lt;textarea&gt;的内容进行匹配")]},{type:"forms",text:"页面内容改变时的观察器",forms:[te("匹配间隔",g.match.delaytime.KEY,g.match.delaytime.default,0,5,void 0,e=>`${e}s`,"匹配文本完毕后的延迟xxx秒允许下一次匹配",.1),$("添加元素时进行匹配",g.match.isAddedNodesToMatch.KEY,g.match.isAddedNodesToMatch.default,void 0,"当监听到页面添加元素时才进行匹配文本"),$("观察器：childList",g.match["mutationObserver-childList"].KEY,g.match["mutationObserver-childList"].default,void 0,"子节点的变动（新增、删除或者更改）"),$("观察器：characterData",g.match["mutationObserver-characterData"].KEY,g.match["mutationObserver-characterData"].default,void 0,"节点内容或节点文本的变动"),$("观察器：subtree",g.match["mutationObserver-subtree"].KEY,g.match["mutationObserver-subtree"].default,void 0,"是否将观察器应用于该节点的所有后代节点")]}]},{type:"deepMenu",text:"功能",forms:[{type:"forms",text:"",className:"netdisk-panel-forms-function",forms:[ce("行为模式",g.function["netdisk-behavior-mode"].KEY,g.function["netdisk-behavior-mode"].default,[{text:"悬浮按钮+小窗",value:"suspension_smallwindow"},{text:"悬浮按钮+大窗",value:"suspension_window"},{text:"小窗",value:"smallwindow"}],void 0,"匹配到链接时触发的UI执行"),$("自动输入访问码",g.function.autoFillAccessCode.KEY,g.function.autoFillAccessCode.default,void 0,"通过主动点击链接跳转时，会自动输入网盘访问码"),$("获取重定向后的直链",g.function.getTheDirectLinkAfterRedirection.KEY,g.function.getTheDirectLinkAfterRedirection.default,void 0,"对获取的链接再进行一次重定向获取链接")]}]},{type:"deepMenu",text:"分享码相关",forms:[{type:"forms",text:"",className:"netdisk-panel-forms-share-code",forms:[$("排除分享码",g.aboutShareCode.excludeIdenticalSharedCodes.KEY,g.aboutShareCode.excludeIdenticalSharedCodes.default,void 0,"启用后会根据【相同系数】排除掉匹配到的分享码"),te("相同系数",g.aboutShareCode.excludeIdenticalSharedCodesCoefficient.KEY,g.aboutShareCode.excludeIdenticalSharedCodesCoefficient.default,0,1,void 0,e=>e.toString(),"例如分享码: aaaaaaaabb，它的相同系数是0.8，设置相同系数≥0.8时会被排除",.01)]}]},{type:"deepMenu",text:"快捷键",forms:[{className:"netdisk-panel-forms-shortcut-keys",text:"",type:"forms",forms:[ke("【打开】⚙ 设置","","netdisk-keyboard-open-setting",void 0,"暂无快捷键","default",pe.shortCut),ke("【打开】⚙ 历史匹配记录","","netdisk-keyboard-open-history-matching-records",void 0,"暂无快捷键","default",pe.shortCut),ke("【打开】⚙ 访问码规则","","netdisk-keyboard-open-accesscode-rule",void 0,"暂无快捷键","default",pe.shortCut),ke("【打开】⚙ 自定义规则","","netdisk-keyboard-open-user-rule",void 0,"暂无快捷键","default",pe.shortCut),ke("【打开】⚙ 网站规则","","netdisk-keyboard-website-rule",void 0,"暂无快捷键","default",pe.shortCut),ke("【打开】⚙ 识别文本","","netdisk-keyboard-open-proactively-recognize-text",void 0,"暂无快捷键","default",pe.shortCut)]}]}]}]},Y={$data:{__data:null,__oneSuccessExecMenu:null,__onceExec:null,__listenData:null,get data(){return Y.$data.__data==null&&(Y.$data.__data=new d.Dictionary),Y.$data.__data},get oneSuccessExecMenu(){return Y.$data.__oneSuccessExecMenu==null&&(Y.$data.__oneSuccessExecMenu=new d.Dictionary),Y.$data.__oneSuccessExecMenu},get onceExec(){return Y.$data.__onceExec==null&&(Y.$data.__onceExec=new d.Dictionary),Y.$data.__onceExec},get scriptName(){return it},key:he,attributeKeyName:le,attributeDefaultValueName:me},$listener:{get listenData(){return Y.$data.__listenData==null&&(Y.$data.__listenData=new d.Dictionary),Y.$data.__listenData}},init(){this.initPanelDefaultValue(this.getPanelContentConfig().concat($e.getRulePanelContent())),this.initExtensionsMenu();},isTopWindow(){return Q.top===Q.self},initExtensionsMenu(){this.isTopWindow()&&Fn.add([{key:"show_pops_panel_setting",text:"⚙ 设置",autoReload:!1,isStoreValue:!1,showText(e){return e},callback:()=>{ze.show();}},{key:"showNetDiskHistoryMatch",text:"⚙ 历史匹配记录",autoReload:!1,isStoreValue:!1,showText(e){return e},callback(){k.netDiskHistoryMatch.show();}},{key:"websiteRule",text:"⚙ 网站规则",autoReload:!1,isStoreValue:!1,showText(e){return e},callback(){k.websiteRule.show();}},{key:"showUserRule",text:"⚙ 自定义规则",autoReload:!1,isStoreValue:!1,showText(e){return e},callback(){Ue.show(!1);}},{key:"showMatchPasteText",text:"⚙ 识别文本",autoReload:!1,isStoreValue:!1,showText(e){return e},callback(){k.matchPasteText.show();}}]);},initPanelDefaultValue(e){function a(t){if(!t.attributes||t.type==="button")return;let i={},s=t.attributes[le];s!=null&&(i[s]=t.attributes[me]);let r=t.attributes[et];if(typeof r=="function"){let c=r();if(typeof c=="boolean"&&!c)return}let o=t.attributes[an];o&&typeof o=="object"&&Object.assign(i,o);let l=Object.keys(i);if(!l.length){h.warn(["请先配置键",t]);return}l.forEach(c=>{let u=i[c];O(c)==null&&z(c,u);});}function n(t){for(let i=0;i<t.length;i++){let s=t[i];a(s);let r=s.forms;r&&Array.isArray(r)&&n(r);}}for(let t=0;t<e.length;t++){let i=e[t];if(!i.forms)continue;let s=i.forms;s&&Array.isArray(s)&&n(s);}},setValue(e,a){let n=O(he,{}),t=n[e];n[e]=a,z(he,n),this.$listener.listenData.has(e)&&this.$listener.listenData.get(e).callback(e,t,a);},getValue(e,a){let t=O(he,{})[e];return t??(this.$data.data.has(e)?this.$data.data.get(e):a)},deleteValue(e){let a=O(he,{}),n=a[e];Reflect.deleteProperty(a,e),z(he,a),this.$listener.listenData.has(e)&&this.$listener.listenData.get(e).callback(e,n,void 0);},addValueChangeListener(e,a,n){let t=Math.random();return this.$listener.listenData.set(e,{id:t,key:e,callback:a}),n&&n.immediate&&a(e,this.getValue(e),this.getValue(e)),t},removeValueChangeListener(e){let a=null;for(const[n,t]of this.$listener.listenData.entries())if(t.id===e){a=n;break}typeof a=="string"?this.$listener.listenData.delete(a):console.warn("没有找到对应的监听器");},triggerMenuValueChange(e,a,n){if(this.$listener.listenData.has(e)){let t=this.$listener.listenData.get(e);if(typeof t.callback=="function"){let i=this.getValue(e),s=i,r=i;typeof a<"u"&&arguments.length>1&&(s=a),typeof n<"u"&&arguments.length>2&&(r=n),t.callback(e,r,s);}}},hasKey(e){let a=O(he,{});return e in a},execMenu(e,a,n=!1){if(!(typeof e=="string"||typeof e=="object"&&Array.isArray(e)))throw new TypeError("key 必须是字符串或者字符串数组");let t=[];typeof e=="object"&&Array.isArray(e)?t=[...e]:t.push(e);let i;for(let s=0;s<t.length;s++){const r=t[s];if(!this.$data.data.has(r)){h.warn(`${e} 键不存在`);return}let o=Y.getValue(r);if(n&&(o=!o),!o)break;i=o;}i&&a(i);},execMenuOnce(e,a,n,t){if(typeof e!="string")throw new TypeError("key 必须是字符串");if(!this.$data.data.has(e)){h.warn(`${e} 键不存在`);return}if(this.$data.oneSuccessExecMenu.has(e))return;this.$data.oneSuccessExecMenu.set(e,1);let i=()=>{let c=Y.getValue(e);return typeof n=="function"?n(e,c):c},s=[],r=c=>{let u=i(),p=[];if(c instanceof HTMLStyleElement?p=[c]:Array.isArray(c)&&(p=[...c.filter(m=>m!=null&&m instanceof HTMLStyleElement)]),u)s=s.concat(p);else for(let m=0;m<p.length;m++)p[m].remove(),p.splice(m,1),m--;},o=c=>{let u=[];if(c){let p=a(c,r);p instanceof HTMLStyleElement?u=[p]:Array.isArray(p)&&(u=[...p.filter(m=>m!=null&&m instanceof HTMLStyleElement)]);}for(let p=0;p<s.length;p++)s[p].remove(),s.splice(p,1),p--;s=[...u];};this.addValueChangeListener(e,(c,u,p)=>{let m=p;typeof t=="function"&&(m=t(c,p,u)),o(m);});let l=i();l&&o(l);},execInheritMenuOnce(e,a,n,t){let i=this;const s=(r,o)=>{let l=i.getValue(r),c=i.getValue(o);if(typeof t=="function"){let u=t(l,c);if(u!==void 0)return u}return l};this.execMenuOnce(e,n,()=>s(e,a),()=>s(e,a)),this.execMenuOnce(a,()=>{},()=>!1,()=>(this.triggerMenuValueChange(e),!1));},onceExec(e,a){if(typeof e!="string")throw new TypeError("key 必须是字符串");this.$data.onceExec.has(e)||(a(),this.$data.onceExec.set(e,1));},getPanelContentConfig(){return [On]}};Object.assign(k.src.icon,typeof RESOURCE_ICON>"u"?{}:RESOURCE_ICON);j.init();X.init();$e.init();Y.init();b.init();pe.init();v.ready(()=>{Ce.init(),Fe.init(),_.init();});

})(Qmsg, DOMUtils, Utils, pops);