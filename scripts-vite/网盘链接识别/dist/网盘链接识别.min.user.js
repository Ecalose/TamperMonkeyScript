// ==UserScript==
// @name         网盘链接识别
// @namespace    https://github.com/WhiteSevs/TamperMonkeyScript
// @version      2025.9.14
// @author       WhiteSevs
// @description  识别网页中显示的网盘链接，目前包括百度网盘、蓝奏云、天翼云、中国移动云盘(原:和彩云)、阿里云、文叔叔、奶牛快传、123盘、腾讯微云、迅雷网盘、115网盘、夸克网盘、城通网盘(部分)、坚果云、UC网盘、BT磁力、360云盘，支持蓝奏云、天翼云(需登录)、123盘、奶牛、UC网盘(需登录)、坚果云(需登录)和阿里云盘(需登录，且限制在网盘页面解析)直链获取下载，页面动态监控加载的链接，可自定义规则来识别小众网盘/网赚网盘或其它自定义的链接。
// @license      GPL-3.0-only
// @icon         data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAACsJJREFUeF7tXW+IHdUVP2c2u8kHIQYL0TRIaK1SgrFFaZsvVkpAo6YR1LJpa9jUd++83SUpSrUNBFRCrVgxNOv+mTOvJBBNmtpamoQG9UNBKLHFDzEtFttKBdOYQENE/Lb75vZd2cVNum/uvXNnZt/MnoGQD+/c8+d3fu+c+2f2PgR+ljQCuKSj5+CBCbDEScAEYAIscQSWePhcAZgASxyBJR4+VwAmQHEIjIyM3DAzM/M1pdSXEfEWALgVANbkaPE0ABwhomdz1GmtSgixHxF3Wg8wC55HxPeVUu8DgP7/jRUrVvxpbGzsY/PQbBK5VwCd9Ha7vVkptRkA9L8yHiKisAxDczaklL8GgAfLsImIryql3gSAqBPnh3nazI0AjUZjbRAEjwLAI3k6aKtLKbUjjuODtvI+cs1m894kSY776Mg49hwAxHkSIRcCSCl10nXy12YMLI9hrxDR/XkoMukQQrQQ8WGTXIGfn0PEZ6IoGvO14U0AKeUJALjH15Ecxr9ARHn2464uCSEOI+K2HHz2VXGUiAZ9lHgRQEp5BgBu9nEgr7FBEGyZmprSZCz8EUIMIuKRwg3ZGfiAiK63E/1/qcwEkFJ+BAArsxrOedzLRPSdnHWmqgvD8EBntj5Ups0UWxeI6NosvmQigBDibUTckMVgAWNKXwHMxSClfBwAtgPA+gLiclX5GhHd6TrImQBhGO5RSu11MHQREY8nSXICEf/R399/bnx8/KLD+CUl2plf3BgEwa1JktyOiN8HgKscAHCuhE4EaDabQ0mSHLBxSCml5weHlFKHWq3WBZsxLHM5AlLKLwLAQwCwCwBWWeLzKBHts5S1fx9ASnkdALxluZPXIiJh6wTLpSMwPDx8U7vd/iEADFtgdTZJko2tVuushawTAZ4EgCdMSpVSW+M4PmaS48/dEZBSWuWgMznfR0R6X8b4WLUA228/Ig5GUXTUaJUFMiMghNiEiK+bFCxbtuxLExMT/zLJ2RLAhnmTRDRiMsif+yMQhuFupdTTaZoQcZfNTqEVAYQQf0TEO1IMXurr69s4OTn5rn94rMEGAYul+Ekiutuky0iAoaGhqwcGBi4ZFD1FRLpK8FMSAkKIHyHiz9PM2bQBIwGklPcBwO9SDH0CAF8hovdKip3NAECj0VgdBMHf05aHSqntcRwfSm0VJjSllD8DgJ90k1NKTcVxbLM8MZnizx0RkFL+BgC6noAi4nNRFD3mSwB96NH1xKnMc3hHfGovbnEoZdweNraAMAxPKaW+0Q1NRFwfRdE7tUe7BwOUUuqTWL3j2u0xHhIZCSCl1K8gdT1pIiKjjh7ErhYujY6OXjM9Pf3ftGBM+TEmT0qpfAzUAukeDsI3P0yAHk6ujWtMABuUaizDBKhxcm1CYwLYoFRjGSZAjZNrExoTwAalGsswAWqcXJvQmAA2KNVYhglQ4+TahMYEsEGpxjK1IYCU8vcAcJvlW8dVTqn+C9+3iGhrHkHUggCmIPIAqhd1mA5qbHw2YWeysehnAWVetGADaMkyzn/Jc6V/dSDAeQBYXTLwvWLOeF5vcrQOBEg9bjYBUPXPTSXaFB8TwIRQj3/OBDC8cNLj+fN2r+oEOE1EX/VBwVTCfHRXYWzBBDDmx7gKMNyF92PfO/pMBPAFKO9Zsyupio7PNz9GAuiAuyzVcrmZo2iA6k4A3/xYEUAb0Xfjtdvt+xBxlVLqeF538jEB8nmrOmt+rAngWvps5ZkA+RDAFu8r5XqBAP9J2f8/R0SfzxrcQuMWgXClxueKVS8QQB8CfbuL48fyOjSZ078IBCg1vsoRYHYSs+BuYN4rgDRbc8CVabMIW5UkwLyZ7O2zAbxR1MWPZVeAeZVH3y5eeHyVJYCr41nlF4sAWf0tetyizwGKDnCx9wHKjs/VHhPgCsR6oS+7JtFHngnABPDhT/XG8hzg8pxxBeAKUL1vsY/HXAG4AvCNJ/M4wC2AW4BPQa3eWG4B3AK4BXAL6F65eCOoelXdyWNuAdwCuAVwC+AWMIcALwN5GejUQisvzHMAngPwHIDnADwH4DlAFw7wPkDlu3x6ADwHyDgHCMPwLqXUJgCYDoLgpampqb9VkSt1JUDW/FgtA6WUvwSAH1yR8Bc7vxSmf9i4Uk8dCeCTHyMBDL8a9j0iOlwlBtSNAL75sSGA/v1Z/TPmCz3/JqIvMAEWDwEppVd+bAhQq3VzDSuAV36YABXfCvYlNBOACbC01s2+35jF6/YLW/aNhysAVwCuAPMRqNpWMFcAx5rsC5ijucLFfePhFsAtgFsAt4AUDviWmMJroKMBjsfxNJABc2RYyeK++VmKc4CevrfPlT9MAEfEZn+cqrR7CR3dcxZnAjhD9unl16XdS5jBPachTAAnuD4Tnr0Bvefu7XMNhwngiljN5JkANUuoazhMAFfEaia/6ATo7+//3Pj4+MWa4VqZcAwEOE9E16UFY7MPkLZu1ro3ENFfK4NYjRwVQtyIiO92CwkR34yiaKMvAY4BwJZuSpRSD8Rx/Nsa4VqZUMIw3KaUSnsr+1dEtM2LAEKIvYi4J4VlB6Mo2lEZ1GrkqBBiEhGbKSE9Q0S7vQggpfwuALyUouRikiTrW63WhRph2/OhSCn1q/qnAeCqlOp8dxzHJ70IMDIycsPMzMw/05QopR6L4/i5nketRg5KKZ8EgCfSQlq+fPnKsbGxj70IoAdLKf8AAJtTmHYmjuNbaoRvT4cyPDx8U7vdPgUAq1Ja86tRFN1lCsS4CtAKwjDcqZTab1DWIiJhMsif+yMgpZwAgGGDpqeISFeJ1MeKADZtQFtRSm2N41ivGvgpCAGb0t8p2ucA4DYi+tDkhhUBZtvA8wDwiFEh4mAURUdNcvy5OwJCiE2I+LrFSKtvv9ZjTYBGo7E2CALdd9ZaODDZ19f3i8nJya6bFBY6WGQeAmEY7lZKPW0BivW334kAs1VAVwBdCWyeSwCg5w2HOvcIvGczgGUuR6DRaKxGRH0Hw0OIuMEGH0TcFUXRmI2sMwFmSXACAO6xNQAAnyilXuysIv4cBMFfoih6x2HskhIdHR29Znp6eo1Saj0iPgAA30qb6S8AzlEiGnQBzboFzFcqpTwDADe7GCpIVm+EHCGiZwvSn6pWCLEfEXcuhu0FbH5ARNe7+pKJALOV4CMAWOlqsCB56sx4w4J0L6h29o2iB8u0mWLrAhFdm8WXzATQxoQQb9v2pizOuYxRSu2I4/igy5isss1m894kSY5nHZ/zuNeI6M6sOr0IoI2GYbhHKbU3qwM5jnulcyx9f476uqoSQrQQ8eEybBlsvOz7G8veBNAONpvNoSRJfgoAaxYRlBeIqJR+3DmHP9w5h089Zi0Yh7N6NUZE+3zt5EKA2TmBfvNE92G9HVw6EYIg2DI1NaVXKIU/QohBRDxSuKGFDexLkuT5VqulSeD95EaAOU+klJ8SQSn1TUS8w9tDOwXepdDOzGdSYRgeUEoNuY7LKH8SEU/29fWdnJiY0LeC5fbkToD5ng0NDV09MDCgSfB1AFiHiOuUUusAINOMtUvUpa8A5pH9cQDYDgDrc8sIgH6vQk+uzyRJcqa/v/9U3kmf72uhBMgRFFZVEAJMgIKArYpaJkBVMlWQn0yAgoCtilomQFUyVZCfTICCgK2KWiZAVTJVkJ9MgIKArYra/wGYigzMiqJYZwAAAABJRU5ErkJggg==
// @supportURL   https://github.com/WhiteSevs/TamperMonkeyScript/issues
// @match        *://*/*
// @require      https://fastly.jsdelivr.net/gh/WhiteSevs/TamperMonkeyScript@86be74b83fca4fa47521cded28377b35e1d7d2ac/lib/CoverUMD/index.js
// @require      https://fastly.jsdelivr.net/gh/WhiteSevs/TamperMonkeyScript@7272395d2c4ef6f254ee09724e20de4899098bc0/scripts-vite/%E7%BD%91%E7%9B%98%E9%93%BE%E6%8E%A5%E8%AF%86%E5%88%AB/%E7%BD%91%E7%9B%98%E9%93%BE%E6%8E%A5%E8%AF%86%E5%88%AB-%E5%9B%BE%E6%A0%87.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/utils@2.8.0/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/domutils@1.6.6/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/pops@2.4.5/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/qmsg@1.4.0/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/gh/WhiteSevs/TamperMonkeyScript@886625af68455365e426018ecb55419dd4ea6f30/lib/CryptoJS/index.js
// @connect      *
// @connect      lanzoub.com
// @connect      lanzouc.com
// @connect      lanzoue.com
// @connect      lanzouf.com
// @connect      lanzoug.com
// @connect      lanzouh.com
// @connect      lanzoui.com
// @connect      lanzouj.com
// @connect      lanzouk.com
// @connect      lanzoul.com
// @connect      lanzoum.com
// @connect      lanzouo.com
// @connect      lanzoup.com
// @connect      lanzouq.com
// @connect      lanzous.com
// @connect      lanzout.com
// @connect      lanzouu.com
// @connect      lanzouv.com
// @connect      lanzouw.com
// @connect      lanzoux.com
// @connect      lanzouy.com
// @connect      lanosso.com
// @connect      lanzn.com
// @connect      lanzog.com
// @connect      lanpw.com
// @connect      lanpv.com
// @connect      lanzv.com
// @connect      wwentua.com
// @connect      ilanzou.com
// @connect      189.cn
// @connect      123pan.com
// @connect      123pan.cn
// @connect      wenshushu.cn
// @connect      jianguoyun.com
// @connect      cowtransfer.com
// @connect      cowcs.com
// @connect      aliyundrive.com
// @connect      baidu.com
// @connect      139.com
// @connect      weiyun.com
// @connect      xunlei.com
// @connect      115.com
// @connect      quark.cn
// @connect      jianguoyun.com
// @connect      uc.cn
// @connect      ctfile.com
// @connect      sharepoint.com
// @connect      whatslink.info
// @connect      www.yunpan.com
// @connect      link.yunpan.com
// @grant        GM_deleteValue
// @grant        GM_download
// @grant        GM_getResourceText
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_openInTab
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-start
// ==/UserScript==

(function (f, z, Ae, ot, Pt) {
	'use strict';

	var mt=typeof GM_deleteValue<"u"?GM_deleteValue:void 0,bt=typeof GM_download<"u"?GM_download:void 0,Ct=typeof GM_getResourceText<"u"?GM_getResourceText:void 0,re=typeof GM_getValue<"u"?GM_getValue:void 0,Be=typeof GM_info<"u"?GM_info:void 0,Vt=typeof GM_openInTab<"u"?GM_openInTab:void 0,Bt=typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0,de=typeof GM_setValue<"u"?GM_setValue:void 0,zt=typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0,Ht=typeof GM_xmlhttpRequest<"u"?GM_xmlhttpRequest:void 0,he=typeof unsafeWindow<"u"?unsafeWindow:void 0,Gt=window;const Ke={waitRemove(...a){a.forEach(e=>{typeof e=="string"&&d.waitNodeList(e).then(t=>{t.forEach(n=>n.remove());});});},createBlockCSSNode(...a){let e=[];if(a.length!==0&&!(a.length===1&&typeof a[0]=="string"&&a[0].trim()===""))return a.forEach(t=>{Array.isArray(t)?e=e.concat(t):e.push(t);}),z.createElement("style",{type:"text/css",innerHTML:`${e.join(`,
`)}{display: none !important;}`})},addBlockCSS(...a){let e=[];if(a.length!==0&&!(a.length===1&&typeof a[0]=="string"&&a[0].trim()===""))return a.forEach(t=>{Array.isArray(t)?e=e.concat(t):e.push(t);}),xt(`${e.join(`,
`)}{display: none !important;}`)},setGMResourceCSS(a){let e=typeof Ct=="function"?Ct(a.keyName):null;typeof e=="string"&&e?xt(e):Ke.loadStyleLink(a.url);},async loadStyleLink(a){let e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=a,z.ready(()=>{document.head.appendChild(e);});},async loadScript(a){let e=document.createElement("script");return e.src=a,new Promise(t=>{e.onload=()=>{t(null);},(document.head||document.documentElement).appendChild(e);})},fixUrl(a){return a=a.trim(),a.match(/^http(s|):\/\//i)?a:a.startsWith("//")?(a.startsWith("///")||(a=window.location.protocol+a),a):(a.startsWith("/")||(a+="/"),a=window.location.origin+a,a)},fixHttps(a){if(a.startsWith("https://")||!a.startsWith("http://"))return a;let e=new URL(a);return e.protocol="https:",e.toString()},lockScroll(...a){let e=document.createElement("style");e.innerHTML=`
			.pops-overflow-hidden-important {
				overflow: hidden !important;
			}
		`;let t=[document.documentElement,document.body].concat(...a||[]);return t.forEach(n=>{n.classList.add("pops-overflow-hidden-important");}),(document.head||document.documentElement).appendChild(e),{recovery(){t.forEach(n=>{n.classList.remove("pops-overflow-hidden-important");}),e.remove();}}},async getClipboardText(){function a(n){navigator.clipboard.readText().then(r=>{n(r);}).catch(r=>{g.error("读取剪贴板内容失败👉",r),n("");});}function e(n){navigator.permissions.query({name:"clipboard-read"}).then(r=>{a(n);}).catch(r=>{g.error("申请剪贴板权限失败，尝试直接读取👉",r.message??r.name??r.stack),a(n);});}function t(){return !(typeof navigator?.clipboard?.readText!="function"||typeof navigator?.permissions?.query!="function")}return new Promise(n=>{if(!t()){n("");return}document.hasFocus()?e(n):window.addEventListener("focus",()=>{e(n);},{once:true});})},escapeHtml(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/©/g,"&copy;").replace(/®/g,"&reg;").replace(/™/g,"&trade;").replace(/→/g,"&rarr;").replace(/←/g,"&larr;").replace(/↑/g,"&uarr;").replace(/↓/g,"&darr;").replace(/—/g,"&mdash;").replace(/–/g,"&ndash;").replace(/…/g,"&hellip;").replace(/ /g,"&nbsp;").replace(/\r\n/g,"<br>").replace(/\r/g,"<br>").replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")},interval(a,e,t=5e3){let n,r=t-e,s=e,i=async l=>{let o=await a(l);if(typeof o=="boolean"&&!o||l){d.workerClearTimeout(n);return}if(s+=e,s>r){i(true);return}n=d.workerSetTimeout(()=>{i(false);},e);};i(false);},findParentNode(a,e,t){if(t){let n=z.closest(a,t);if(n)return n.querySelector(e)}else return z.matches(a,e)?a:z.closest(a,e)}},Oe={qmsg_config_position:{key:"qmsg-config-position",defaultValue:"bottom"},qmsg_config_maxnums:{key:"qmsg-config-maxnums",defaultValue:3},qmsg_config_showreverse:{key:"qmsg-config-showreverse",defaultValue:false}},d=Ae.noConflict(),b=z.noConflict(),B=ot,g=new d.Log(Be,he.console||Gt.console);let ht=Be?.script?.name||void 0;const jt=ot.config.Utils.AnyTouch(),Nt=false;g.config({debug:Nt,logMaxCount:1e3,autoClearConsole:true,tag:true});f.config({isHTML:true,autoClose:true,showClose:false,consoleLogContent(a){const e=a.getSetting().type;if(e==="loading")return  false;const t=a.getSetting().content;return e==="warning"?g.warn(t):e==="error"?g.error(t):g.info(t),true},get position(){return J.getValue(Oe.qmsg_config_position.key,Oe.qmsg_config_position.defaultValue)},get maxNums(){return J.getValue(Oe.qmsg_config_maxnums.key,Oe.qmsg_config_maxnums.defaultValue)},get showReverse(){return J.getValue(Oe.qmsg_config_showreverse.key,Oe.qmsg_config_showreverse.defaultValue)},get zIndex(){let a=Ae.getMaxZIndex(),e=ot.config.InstanceUtils.getPopsMaxZIndex().zIndex;return Ae.getMaxValue(a,e)+100}});B.GlobalConfig.setGlobalConfig({zIndex:()=>{let a=Ae.getMaxZIndex(void 0,void 0,t=>{if(t?.classList?.contains("qmsg-shadow-container")||t?.closest("qmsg")&&t.getRootNode()instanceof ShadowRoot)return  false}),e=ot.config.InstanceUtils.getPopsMaxZIndex().zIndex;return Ae.getMaxValue(a,e)+100},mask:{enable:true,clickEvent:{toClose:false,toHide:false}},drag:true});const ze=new d.GM_Menu({GM_getValue:re,GM_setValue:de,GM_registerMenuCommand:Bt,GM_unregisterMenuCommand:zt}),M=new d.Httpx({xmlHttpRequest:Ht,logDetails:Nt});M.interceptors.request.use(a=>a);M.interceptors.response.use(void 0,a=>(g.error("拦截器-请求错误",a),a.type==="onabort"?f.warning("请求取消",{consoleLogContent:true}):a.type==="onerror"?f.error("请求异常",{consoleLogContent:true}):a.type==="ontimeout"?f.error("请求超时",{consoleLogContent:true}):f.error("其它错误",{consoleLogContent:true}),a));he.Object.defineProperty,he.Function.prototype.apply,he.Function.prototype.call,he.Element.prototype.appendChild,he.setTimeout;const xt=d.addStyle.bind(d),He=z.selector.bind(z),qt=z.selectorAll.bind(z);new d.GM_Cookie;const It="GM_Panel",wt="data-init",ue="data-key",me="data-default-value",Zt="data-init-more-value",O="data-storage-api",xe={get width(){return globalThis.innerWidth},get height(){return globalThis.innerHeight}},j={setting:{get width(){return xe.width<550?"88vw":xe.width<700?"550px":"700px"},get height(){return xe.height<450?"70vh":xe.height<550?"450px":"550px"}},settingMiddle:{get width(){return xe.width<350?"88vw":"350px"},get height(){return xe.height<450?"88vh":"450px"}},settingBig:{get width(){return xe.width<800?"92vw":"800px"},get height(){return xe.height<600?"80vh":"600px"}},info:{get width(){return xe.width<350?"88vw":"350px"},get height(){return xe.height<250?"88vh":"250px"}}};class Fe{storageKey;listenerData;constructor(e){if(typeof e=="string"){let t=e.trim();if(t=="")throw new Error("key参数不能为空字符串");this.storageKey=t;}else throw new Error("key参数类型错误，必须是字符串");this.listenerData=new Ae.Dictionary;}getLocalValue(){let e=re(this.storageKey);return e==null&&(e={},this.setLocalValue(e)),e}setLocalValue(e){de(this.storageKey,e);}set(e,t){let n=this.get(e),r=this.getLocalValue();Reflect.set(r,e,t),this.setLocalValue(r),this.triggerValueChangeListener(e,n,t);}get(e,t){let n=this.getLocalValue();return Reflect.get(n,e)??t}getAll(){return this.getLocalValue()}delete(e){let t=this.get(e),n=this.getLocalValue();Reflect.deleteProperty(n,e),this.setLocalValue(n),this.triggerValueChangeListener(e,t,void 0);}has(e){let t=this.getLocalValue();return Reflect.has(t,e)}keys(){let e=this.getLocalValue();return Reflect.ownKeys(e)}values(){let e=this.getLocalValue();return Reflect.ownKeys(e).map(t=>Reflect.get(e,t))}clear(){mt(this.storageKey);}addValueChangeListener(e,t){let n=Math.random(),r=this.listenerData.get(e)||[];return r.push({id:n,key:e,callback:t}),this.listenerData.set(e,r),n}removeValueChangeListener(e){let t=false;for(const[n,r]of this.listenerData.entries()){for(let s=0;s<r.length;s++){const i=r[s];(typeof e=="string"&&i.key===e||typeof e=="number"&&i.id===e)&&(r.splice(s,1),s--,t=true);}this.listenerData.set(n,r);}return t}triggerValueChangeListener(e,t,n){if(!this.listenerData.has(e))return;let r=this.listenerData.get(e);for(let s=0;s<r.length;s++){const i=r[s];if(typeof i.callback=="function"){let l=this.get(e),o,c;typeof t<"u"&&arguments.length>=2?c=t:c=l,typeof n<"u"&&arguments.length>2?o=n:o=l,i.callback(e,c,o);}}}}const Te=new Fe(It),Ne={$data:{__contentConfig:null,get contentConfig(){return this.__contentConfig==null&&(this.__contentConfig=new d.Dictionary),this.__contentConfig}},addContentConfig(a){Array.isArray(a)||(a=[a]);let e=this.$data.contentConfig.keys().length;this.$data.contentConfig.set(e,a);},getAllContentConfig(){return this.$data.contentConfig.values().flat()},getConfig(a=0){return this.$data.contentConfig.get(a)??[]},getDefaultBottomContentConfig(){return [{id:"script-version",title:`版本：${Be?.script?.version||"未知"}`,isBottom:true,forms:[],clickFirstCallback(a,e,t){let n=Be?.script?.supportURL||Be?.script?.namespace;return typeof n=="string"&&d.isNotNull(n)&&window.open(n,"_blank"),false}}]}},lt={$data:{__menuOption:[{key:"show_pops_panel_setting",text:"⚙ 设置",autoReload:false,isStoreValue:false,showText(a){return a},callback:()=>{J.showPanel(Ne.getConfig(0));}}],get menuOption(){return this.__menuOption}},init(){this.initExtensionsMenu();},initExtensionsMenu(){J.isTopWindow()&&ze.add(this.$data.menuOption);},addMenuOption(a){Array.isArray(a)||(a=[a]),this.$data.menuOption.push(...a);},updateMenuOption(a){Array.isArray(a)||(a=[a]),a.forEach(e=>{let t=this.$data.menuOption.findIndex(n=>n.key===e.key);t!==-1&&(this.$data.menuOption[t]=e);});},getMenuOption(a=0){return this.$data.menuOption[a]},deleteMenuOption(a=0){this.$data.menuOption.splice(a,1);}},J={$data:{__contentConfigInitDefaultValue:null,__onceExecMenuData:null,__urlChangeReloadMenuExecOnce:null,__onceExecData:null,__panelConfig:{},$panel:null,panelContent:[],get contentConfigInitDefaultValue(){return this.__contentConfigInitDefaultValue==null&&(this.__contentConfigInitDefaultValue=new d.Dictionary),this.__contentConfigInitDefaultValue},contentConfigInitDisabledKeys:[],get onceExecMenuData(){return this.__onceExecMenuData==null&&(this.__onceExecMenuData=new d.Dictionary),this.__onceExecMenuData},get urlChangeReloadMenuExecOnce(){return this.__urlChangeReloadMenuExecOnce==null&&(this.__urlChangeReloadMenuExecOnce=new d.Dictionary),this.__urlChangeReloadMenuExecOnce},get onceExecData(){return this.__onceExecData==null&&(this.__onceExecData=new d.Dictionary),this.__onceExecData},get scriptName(){return ht},get panelConfig(){return this.__panelConfig},set panelConfig(a){this.__panelConfig=a;},key:It,attributeKeyName:ue,attributeDefaultValueName:me},init(){this.initContentDefaultValue(),lt.init();},isTopWindow(){return he.top===he.self},initContentDefaultValue(){const a=n=>{if(!n.attributes||n.type==="button"||n.type==="forms"||n.type==="deepMenu")return;let r=n.attributes[wt];if(typeof r=="function"){let o=r();if(typeof o=="boolean"&&!o)return}let s=new Map,i=n.attributes[ue];if(i!=null){const o=n.attributes[me];s.set(i,o);}let l=n.attributes[Zt];if(typeof l=="object"&&l&&Object.keys(l).forEach(o=>{s.set(o,l[o]);}),!s.size){g.warn(["请先配置键",n]);return}if(n.type==="switch"){let o=typeof n.disabled=="function"?n.disabled():n.disabled;typeof o=="boolean"&&o&&this.$data.contentConfigInitDisabledKeys.push(...s.keys());}for(const[o,c]of s.entries())this.setDefaultValue(o,c);},e=n=>{for(let r=0;r<n.length;r++){let s=n[r];a(s);let i=s.forms;i&&Array.isArray(i)&&e(i);}},t=[...Ne.getAllContentConfig()];for(let n=0;n<t.length;n++){let r=t[n];if(!r.forms)continue;const s=r.forms;s&&Array.isArray(s)&&e(s);}this.$data.contentConfigInitDisabledKeys=[...new Set(this.$data.contentConfigInitDisabledKeys)];},setDefaultValue(a,e){this.$data.contentConfigInitDefaultValue.has(a)&&g.warn("请检查该key(已存在): "+a),this.$data.contentConfigInitDefaultValue.set(a,e);},setValue(a,e){Te.set(a,e);},getValue(a,e){let t=Te.get(a);return t??(this.$data.contentConfigInitDefaultValue.has(a)?this.$data.contentConfigInitDefaultValue.get(a):e)},deleteValue(a){Te.delete(a);},hasKey(a){return Te.has(a)},addValueChangeListener(a,e){return Te.addValueChangeListener(a,(n,r,s)=>{e(a,s,r);})},removeValueChangeListener(a){Te.removeValueChangeListener(a);},triggerMenuValueChange(a,e,t){Te.triggerValueChangeListener(a,t,e);},exec(a,e,t,n=true){const r=this;let s;typeof a=="string"||Array.isArray(a)?s=()=>a:s=a;let i=false,l=s(),o=[];Array.isArray(l)?(i=true,o=l):o.push(l);let c=o.find(R=>!this.$data.contentConfigInitDefaultValue.has(R));if(c){g.warn(`${c} 键不存在`);return}let u=JSON.stringify(o);if(n&&this.$data.onceExecMenuData.has(u))return this.$data.onceExecMenuData.get(u);let p=[],h=[],m=(R,I)=>{let v=[];Array.isArray(I)||(I=[I]),I.forEach(_=>{if(_!=null&&_ instanceof HTMLStyleElement){v.push(_);return}}),p=p.concat(v);},w=R=>this.getValue(R),k=()=>{for(let R=0;R<p.length;R++)p[R].remove(),p.splice(R,1),R--;},C=()=>{let R=false;return typeof t=="function"?R=t(o):R=o.every(I=>w(I)),R},A=R=>{let I=C(),v=[];if(I){let _=o.map(N=>this.getValue(N)),S=e({value:i?_:_[0],addStyleElement:(...N)=>m(true,...N)});Array.isArray(S)||(S=[S]),S.forEach(N=>{if(N!=null&&N instanceof HTMLStyleElement){v.push(N);return}});}k(),p=[...v];};n&&o.forEach(R=>{let I=this.addValueChangeListener(R,(v,_,S)=>{A();});h.push(I);}),A();let $={reload(){A();},clear(){this.clearStoreStyleElements(),this.removeValueChangeListener(),n&&r.$data.onceExecMenuData.delete(u);},clearStoreStyleElements:()=>k(),removeValueChangeListener:()=>{h.forEach(R=>{this.removeValueChangeListener(R);});}};return this.$data.onceExecMenuData.set(u,$),$},execMenu(a,e,t=false,n=false){return this.exec(a,r=>e(r),r=>r.every(i=>{let l=!!this.getValue(i);return J.$data.contentConfigInitDisabledKeys.includes(i)&&(l=false,g.warn(`.execMenu${n?"Once":""} ${i} 被禁用`)),t&&(l=!l),l}),n)},execMenuOnce(a,e,t=false,n=false){const r=this.execMenu(a,e,t,true);if(n&&r){const s=()=>{r.reload();};this.removeUrlChangeWithExecMenuOnceListener(a),this.addUrlChangeWithExecMenuOnceListener(a,s);const i=r.clear;r.clear=()=>{i(),this.removeUrlChangeWithExecMenuOnceListener(a);};}return r},deleteExecMenuOnce(a){return a=this.transformKey(a),this.$data.onceExecMenuData.delete(a),this.$data.urlChangeReloadMenuExecOnce.delete(a),Te.removeValueChangeListener(a)},onceExec(a,e){if(a=this.transformKey(a),typeof a!="string")throw new TypeError("key 必须是字符串");this.$data.onceExecData.has(a)||(e(),this.$data.onceExecData.set(a,1));},deleteOnceExec(a){a=this.transformKey(a),this.$data.onceExecData.delete(a);},addUrlChangeWithExecMenuOnceListener(a,e){a=this.transformKey(a),this.$data.urlChangeReloadMenuExecOnce.set(a,e);},removeUrlChangeWithExecMenuOnceListener(a){a=this.transformKey(a),this.$data.urlChangeReloadMenuExecOnce.delete(a);},triggerUrlChangeWithExecMenuOnceEvent(a){this.$data.urlChangeReloadMenuExecOnce.forEach((e,t)=>{e(a);});},showPanel(a,e=`${ht}-设置`,t=false,n=false){this.$data.$panel=null,this.$data.panelContent=[];let r=a.findIndex(i=>(typeof i.isBottom=="function"?i.isBottom():!!i.isBottom)&&i.id==="script-version")!==-1;!t&&!r&&a.push(...Ne.getDefaultBottomContentConfig());let s=B.panel({title:{text:e,position:"center",html:false,style:""},content:a,btn:{close:{enable:true,callback:(i,l)=>{i.close(),this.$data.$panel=null;}}},mask:{enable:true,clickEvent:{toClose:true,toHide:false},clickCallBack:(i,l)=>{i(),this.$data.$panel=null;}},width:j.setting.width,height:j.setting.height,drag:true,only:true,...this.$data.panelConfig});this.$data.$panel=s,this.$data.panelContent=a,n||this.registerConfigSearch({$panel:s,content:a});},registerConfigSearch(a){const{$panel:e,content:t}=a;let n=async(u,p)=>{if(u==null)return;let h=await p(u);return h&&typeof h.isFind=="boolean"&&h.isFind?h.data:await n(h.data,p)},r=(u,p)=>{const h=new IntersectionObserver(m=>{m.forEach(w=>{w.isIntersecting&&(p?.(),h.disconnect());});},{root:null,threshold:1});h.observe(u),u.scrollIntoView({behavior:"smooth",block:"center"});},s=u=>{const p="pops-flashing";b.animationend(u,()=>{u.classList.remove(p);}),u.classList.add(p);},i=(u,p)=>{d.preventEvent(u);let h=B.alert({title:{text:"搜索配置",position:"center"},content:{text:`
						<div class="search-wrapper">
							<input class="search-config-text" name="search-config" type="text" placeholder="请输入需要搜素的配置名称">
						</div>
						<div class="search-result-wrapper"></div>
					`,html:true},btn:{ok:{enable:false}},mask:{clickEvent:{toClose:true}},width:j.settingMiddle.width,height:"auto",drag:true,style:`
					${B.config.cssText.panelCSS}

					.search-wrapper{
						border-bottom: 1px solid rgb(235, 238, 245, 1);
					}
					.pops-content:has(.search-result-wrapper:empty) .search-wrapper{
						border-bottom: 0;
					}
					.search-config-text{
						width: 100%;
						border: 0;
						height: 32px;
						padding: 0px 10px;
						outline: none;
					}
					.search-result-wrapper{
						max-height: 400px;
						overflow: auto;
					}
					.search-result-item{
						cursor: pointer;
						padding: 5px 10px;
						display: flex;
						flex-direction: column;
					}
					.search-result-item:hover{
						background-color: #D8F1FD;
					}
					.search-result-item-path{
						display: flex;
    					align-items: center;
					}
					.search-result-item-description{
						font-size: 0.8em;
						color: #6c6c6c;
					}
					${a.searchDialogStyle??""}
				`});h.$shadowRoot.querySelector(".search-wrapper");let m=h.$shadowRoot.querySelector(".search-config-text"),w=h.$shadowRoot.querySelector(".search-result-wrapper");m.focus();let k=()=>{b.empty(w);},C=$=>{const R=d.queryProperty($,v=>v?.next?{isFind:false,data:v.next}:{isFind:true,data:v});let I=b.createElement("div",{className:"search-result-item",innerHTML:`
							<div class="search-result-item-path">${R.matchedData?.path}</div>
							<div class="search-result-item-description">${R.matchedData?.description??""}</div>
						`});return b.on(I,"click",v=>{let S=e.$shadowRoot.querySelectorAll("aside.pops-panel-aside .pops-panel-aside-top-container li")[$.index];if(!S){f.error(`左侧项下标${$.index}不存在`);return}S.scrollIntoView({behavior:"smooth",block:"center"}),S.click(),n($.next,async N=>{if(N?.next){let T=await d.waitNode(()=>Array.from(e.$shadowRoot.querySelectorAll(".pops-panel-deepMenu-nav-item")).find(E=>{const P=Reflect.get(E,"__formConfig__");return typeof P=="object"&&P!=null&&P.text===N.name}),2500);if(T)T.click();else return f.error("未找到对应的二级菜单"),{isFind:true,data:N};return {isFind:false,data:N.next}}else {let T=await d.waitNode(()=>Array.from(e.$shadowRoot.querySelectorAll("li:not(.pops-panel-deepMenu-nav-item)")).find(E=>Reflect.get(E,"__formConfig__")===N.matchedData?.formConfig),2500);if(T){r(T);let E=T.closest(".pops-panel-forms-fold[data-fold-enable]");E&&(E.querySelector(".pops-panel-forms-fold-container").click(),await d.sleep(500)),r(T,()=>{s(T);});}else f.error("未找到对应的菜单项");return {isFind:true,data:N}}});}),I},A=$=>{const R=new RegExp($,"i"),I=[],v=(S,N)=>{for(let T=0;T<S.length;T++){const E=S[T];let P=E.forms;if(P&&Array.isArray(P)){const Z=d.deepClone(N);if(E.type==="deepMenu"){const Q=d.queryProperty(Z,te=>te?.next?{isFind:false,data:te.next}:{isFind:true,data:te});Q.next={name:E.text};}v(P,Z);}else {let Z=Reflect.get(E,"text"),Q=Reflect.get(E,"description");const te=[Z,Q];let fe=te.findIndex(pe=>{if(typeof pe=="string")return pe.match(R)});if(fe!==-1){const pe=d.deepClone(N),Ie=d.queryProperty(pe,we=>we?.next?{isFind:false,data:we.next}:{isFind:true,data:we});Ie.next={name:Z,matchedData:{path:"",formConfig:E,matchedText:te[fe],description:Q}};const Ee=[];d.queryProperty(pe,we=>{const Qe=we?.name;return typeof Qe=="string"&&Qe.trim()!==""&&Ee.push(Qe),we?.next?{isFind:false,data:we.next}:{isFind:true,data:we}});const Xe=Ee.join(Ke.escapeHtml(" - "));Ie.next.matchedData.path=Xe,I.push(pe);}}}};for(let S=0;S<t.length;S++){const N=t[S];if(!N.forms||N.isBottom&&N.id==="script-version")continue;const T=N.forms;if(T&&Array.isArray(T)){let E=N.title;typeof E=="function"&&(E=E()),v(T,{index:S,name:E});}}let _=document.createDocumentFragment();for(const S of I){let N=C(S);_.appendChild(N);}k(),w.append(_);};b.on(m,"input",d.debounce($=>{d.preventEvent($);let R=b.val(m).trim();if(R===""){k();return}A(R);},200));},l=null,o=false,c;b.on(e.$shadowRoot,"dblclick","aside.pops-panel-aside .pops-panel-aside-item:not(#script-version)",i),b.on(e.$shadowRoot,"touchend","aside.pops-panel-aside .pops-panel-aside-item:not(#script-version)",(u,p)=>{clearTimeout(c),c=void 0,o&&l===p?(o=false,l=null,i(u)):(c=setTimeout(()=>{o=false;},200),o=true,l=p);},{capture:true}),e.$shadowRoot.appendChild(b.createElement("style",{type:"text/css",textContent:`
					.pops-flashing{
						animation: double-blink 1.5s ease-in-out;
					}
					@keyframes double-blink {
						 0% {
							background-color: initial;
						}
						25% {
							background-color: yellow;
						}
						50% {
							background-color: initial;
						}
						75% {
							background-color: yellow;
						}
						100% {
							background-color: initial;
						}
					}
				`}));},transformKey(a){if(Array.isArray(a)){const e=a.sort();return JSON.stringify(e)}else return a}};class Kt{CONFIG={data:[],pageCount:5,pageStep:3,currentPage:1,pageChangeCallBack:function(e){},prevBtn:{enable:true,callBack:function(){}},nextBtn:{enable:true,callBack:function(){}},firstBtn:{enable:true,callBack:function(){}},lastBtn:{enable:true,callBack:function(){}}};PAGE_CONFIG={getCurrentPage:()=>this.DOM_CONFIG.getAttributeWithPageId(this.DOM_CONFIG.getAttributeWithCurrentPage()),maxPage:1};DOM_CONFIG={dataPagingNode:{localName:"div",id:"whitesev-datapaging",dom:null},firstBtnNode:{localName:"a",className:"pg-first",svgHTML:'<svg t="1694497357294" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4758" width="20"><path d="M730.639277 211.376748l60.943177 60.943176-301.698894 301.698893L428.940384 513.075641z" p-id="4759"></path><path d="M730.496772 814.924547l60.943176-60.943176-301.698893-301.698893L428.797879 513.225654z" p-id="4760"></path><path d="M298.666667 213.333333h85.333333v597.333334H298.666667z" p-id="4761"></path></svg>',get:()=>this.DOM_CONFIG.dataPagingNode.dom.querySelector(`${this.DOM_CONFIG.firstBtnNode.localName}.${this.DOM_CONFIG.firstBtnNode.className}`)},prevBtnNode:{localName:"a",className:"pg-prev",svgHTML:'<svg t="1694497840770" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5272" width="20"><path d="M620.322607 151.04875l60.943176 60.943176-362.038672 362.038672L258.283935 513.087422z" p-id="5273"></path><path d="M620.180101 875.252545l60.943177-60.943176-362.038672-362.038672L258.141429 513.213873z" p-id="5274"></path></svg>',get:()=>this.DOM_CONFIG.dataPagingNode.dom.querySelector(`${this.DOM_CONFIG.prevBtnNode.localName}.${this.DOM_CONFIG.prevBtnNode.className}`)},nextBtnNode:{localName:"a",className:"pg-next",svgHTML:'<svg t="1694497949481" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5465" width="20"><path d="M403.399239 151.02258l-60.943177 60.943177 362.038672 362.038672L765.437911 513.061252z" p-id="5466"></path><path d="M403.576858 875.263008l-60.943176-60.943176 362.038672-362.038672L765.61553 513.224336z" p-id="5467"></path></svg>',get:()=>this.DOM_CONFIG.dataPagingNode.dom.querySelector(`${this.DOM_CONFIG.nextBtnNode.localName}.${this.DOM_CONFIG.nextBtnNode.className}`)},lastBtnNode:{localName:"a",className:"pg-last",svgHTML:'<svg t="1694498035538" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2299" width="20"><path d="M516.266667 490.666667L256 230.4 315.733333 170.666667l320 320L315.733333 810.666667 256 750.933333l260.266667-260.266666zM678.4 170.666667h85.333333v640h-85.333333V170.666667z" p-id="2300"></path></svg>',get:()=>this.DOM_CONFIG.dataPagingNode.dom.querySelector(`${this.DOM_CONFIG.lastBtnNode.localName}.${this.DOM_CONFIG.lastBtnNode.className}`)},setAttributeWithPageId:(e,t)=>{e.setAttribute("page-id",t);},getAttributeWithPageId:e=>e?.getAttribute("page-id")?parseInt(e.getAttribute("page-id")):null,hasAttributeWithPageId:e=>e.hasAttribute("page-id"),setAttributeWithCurrentPage:e=>{e.setAttribute("data-current-page","");},getAttributeWithCurrentPage:e=>(e||this.DOM_CONFIG.dataPagingNode.dom).querySelector("a[data-current-page]"),hasAttributeWithCurrentPage:e=>e.hasAttribute("data-current-page"),removeAttributeWithCurrentPage:e=>{e.removeAttribute("data-current-page");},setAttributeWithDisabled:e=>{e.setAttribute("disabled","true");},removeAllAttributeWithDisabled:e=>{(e||this.DOM_CONFIG.dataPagingNode.dom).querySelectorAll("a[class][disabled]").forEach(t=>{t.removeAttribute("disabled");});},getFirstPageNode:e=>(e||this.DOM_CONFIG.dataPagingNode.dom).querySelector("a[page-id='1']"),getLastPageNode:e=>(e||this.DOM_CONFIG.dataPagingNode.dom).querySelector(`a[page-id='${this.PAGE_CONFIG.maxPage}']`),getAllPageNode:e=>(e||this.DOM_CONFIG.dataPagingNode.dom).querySelectorAll("a[page-id]")};constructor(e){this.changeConfig(e);}addCSS(e=document.head){let t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=`@charset "utf-8";
		#${this.DOM_CONFIG.dataPagingNode.id} {
			text-align: center;
			display: inline-block;
		}
		#${this.DOM_CONFIG.dataPagingNode.id} .${this.DOM_CONFIG.firstBtnNode.className},
		#${this.DOM_CONFIG.dataPagingNode.id} .${this.DOM_CONFIG.prevBtnNode.className},
		#${this.DOM_CONFIG.dataPagingNode.id} .${this.DOM_CONFIG.nextBtnNode.className},
		#${this.DOM_CONFIG.dataPagingNode.id} .${this.DOM_CONFIG.lastBtnNode.className} {
			font-family: Arial, sans-serif;
			color: #333;
			font-size: 22px;
			fill: currentColor;
			display: inline-flex;
			justify-content: center;
			align-items: center;
			text-decoration: none;
		}
		#${this.DOM_CONFIG.dataPagingNode.id} a,
		#${this.DOM_CONFIG.dataPagingNode.id} span {
			width: 45px;
			height: 40px;
			border: 1px solid #ebebeb;
			margin-left: -1px;
			color: #000000;
			line-height: 40px;
			float: left;
			font-size: 15px;
			text-decoration: none;
			margin: 0 2px;
			border-radius: 6px;
		}
		#${this.DOM_CONFIG.dataPagingNode.id} a:hover,
		#${this.DOM_CONFIG.dataPagingNode.id} span:hover {
			border-color: #3897cd;
			color: #3897cd;
			position: relative;
			z-index: 1;
		}
		#${this.DOM_CONFIG.dataPagingNode.id} a {
			cursor: pointer;
			user-select: none;
		}
		#${this.DOM_CONFIG.dataPagingNode.id} a[data-current-page] {
			background-color: #222a35;
			color: #fff;
			border-color: #ebebeb;
			position: relative;
			z-index: 1;
		}
		#${this.DOM_CONFIG.dataPagingNode.id} a.${this.DOM_CONFIG.firstBtnNode.className}[disabled="true"],
		#${this.DOM_CONFIG.dataPagingNode.id} a.${this.DOM_CONFIG.prevBtnNode.className}[disabled="true"],
		#${this.DOM_CONFIG.dataPagingNode.id} a.${this.DOM_CONFIG.nextBtnNode.className}[disabled="true"],
		#${this.DOM_CONFIG.dataPagingNode.id} a.${this.DOM_CONFIG.lastBtnNode.className}[disabled="true"]{
			cursor: not-allowed;
			border: 1px solid transparent;
			color: #c9c9c9;
		}
		`,e.appendChild(t);}getDataPagingNode(){let e=this,t=document.createElement(e.DOM_CONFIG.dataPagingNode.localName);e.DOM_CONFIG.dataPagingNode.dom=t,t.id=e.DOM_CONFIG.dataPagingNode.id;let n=document.createElement(e.DOM_CONFIG.firstBtnNode.localName);n.innerHTML=e.DOM_CONFIG.firstBtnNode.svgHTML;let r=document.createElement(e.DOM_CONFIG.prevBtnNode.localName);r.innerHTML=e.DOM_CONFIG.prevBtnNode.svgHTML;let s=document.createElement(e.DOM_CONFIG.nextBtnNode.localName);s.innerHTML=e.DOM_CONFIG.nextBtnNode.svgHTML;let i=document.createElement(e.DOM_CONFIG.lastBtnNode.localName);if(i.innerHTML=e.DOM_CONFIG.lastBtnNode.svgHTML,n.className=e.DOM_CONFIG.firstBtnNode.className,r.className=e.DOM_CONFIG.prevBtnNode.className,s.className=e.DOM_CONFIG.nextBtnNode.className,i.className=e.DOM_CONFIG.lastBtnNode.className,e.PAGE_CONFIG.maxPage=Math.ceil(e.CONFIG.data.length/e.CONFIG.pageCount),e.CONFIG.currentPage<1?e.CONFIG.currentPage=1:e.CONFIG.currentPage>e.PAGE_CONFIG.maxPage&&(e.CONFIG.currentPage=e.PAGE_CONFIG.maxPage),e.PAGE_CONFIG.maxPage<2)return t;e.CONFIG.firstBtn.enable&&(this.setFirstBtnClickEvent(n,t),t.appendChild(n)),e.CONFIG.prevBtn.enable&&(this.setPrevBtnClickEvent(r,t),t.appendChild(r));let l=e.CONFIG.currentPage;if(e.CONFIG.pageStep>e.PAGE_CONFIG.maxPage)for(let o=l;o<=e.PAGE_CONFIG.maxPage;o++){let c=document.createElement("a");e.DOM_CONFIG.setAttributeWithPageId(c,o),c.innerText=o,e.CONFIG.currentPage===o&&e.DOM_CONFIG.setAttributeWithCurrentPage(c),this.setPageBtnClickEvent(c,t),t.appendChild(c);}else if(l+e.CONFIG.pageStep>e.PAGE_CONFIG.maxPage){l=e.PAGE_CONFIG.maxPage;let o=[];for(let c=0;c<e.CONFIG.pageStep;c++){let u=document.createElement("a");e.DOM_CONFIG.setAttributeWithPageId(u,l),u.innerText=l,e.CONFIG.currentPage===l&&e.DOM_CONFIG.setAttributeWithCurrentPage(u),this.setPageBtnClickEvent(u,t),o=[...o,u],l--;}o.reverse(),o.forEach(c=>{t.appendChild(c);});}else for(let o=0;o<e.CONFIG.pageStep;o++){let c=document.createElement("a");e.DOM_CONFIG.setAttributeWithPageId(c,l),c.innerText=l,e.CONFIG.currentPage===l&&e.DOM_CONFIG.setAttributeWithCurrentPage(c),this.setPageBtnClickEvent(c,t),t.appendChild(c),l++;}return e.CONFIG.nextBtn.enable&&(this.setNextBtnClickEvent(s,t),t.appendChild(s)),e.CONFIG.lastBtn.enable&&(this.setLastBtnClickEvent(i,t),t.appendChild(i)),e.CONFIG.currentPage===1?(e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.firstBtnNode.get()),e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.prevBtnNode.get())):e.CONFIG.currentPage===e.PAGE_CONFIG.maxPage&&(e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.nextBtnNode.get()),e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.lastBtnNode.get())),t}setFirstBtnClickEvent(e,t){let n=this;e.onclick=function(){let r=n.DOM_CONFIG.getAttributeWithCurrentPage();if(n.DOM_CONFIG.getAttributeWithPageId(r)===1)return;n.CONFIG.firstBtn.callBack();let s=n.DOM_CONFIG.getAllPageNode(t);for(let i=0;i<n.CONFIG.pageStep;i++){let l=s[i];i===0?n.DOM_CONFIG.setAttributeWithCurrentPage(l):n.DOM_CONFIG.removeAttributeWithCurrentPage(l),n.DOM_CONFIG.setAttributeWithPageId(l,i+1),l.innerText=i+1;}n.DOM_CONFIG.removeAllAttributeWithDisabled(t),n.DOM_CONFIG.getFirstPageNode(t)&&(n.DOM_CONFIG.setAttributeWithDisabled(n.DOM_CONFIG.firstBtnNode.get()),n.DOM_CONFIG.setAttributeWithDisabled(n.DOM_CONFIG.prevBtnNode.get())),n.CONFIG.pageChangeCallBack(1);};}setPrevBtnClickEvent(e,t){let n=this;e.onclick=function(){let r=n.DOM_CONFIG.getAttributeWithCurrentPage();n.DOM_CONFIG.getAttributeWithPageId(r)!==1&&(n.CONFIG.prevBtn.callBack(),n.DOM_CONFIG.hasAttributeWithPageId(r.previousElementSibling)?r.previousElementSibling.click():(n.DOM_CONFIG.getAllPageNode(t).forEach((i,l)=>{let o=n.DOM_CONFIG.getAttributeWithPageId(i);o--,n.DOM_CONFIG.setAttributeWithPageId(i,o),i.innerText=o;}),n.CONFIG.pageChangeCallBack(n.PAGE_CONFIG.getCurrentPage())),n.DOM_CONFIG.removeAllAttributeWithDisabled(t),n.DOM_CONFIG.getFirstPageNode(t)&&n.PAGE_CONFIG.getCurrentPage()==1&&(n.DOM_CONFIG.setAttributeWithDisabled(n.DOM_CONFIG.firstBtnNode.get()),n.DOM_CONFIG.setAttributeWithDisabled(n.DOM_CONFIG.prevBtnNode.get())));};}setNextBtnClickEvent(e,t){let n=this;e.onclick=function(){let r=n.DOM_CONFIG.getAttributeWithCurrentPage();n.DOM_CONFIG.getAttributeWithPageId(r)!==n.PAGE_CONFIG.maxPage&&(n.CONFIG.nextBtn.callBack(),n.DOM_CONFIG.hasAttributeWithPageId(r.nextElementSibling)?r.nextElementSibling.click():(n.DOM_CONFIG.getAllPageNode(t).forEach((i,l)=>{let o=n.DOM_CONFIG.getAttributeWithPageId(i);o++,!(o>n.PAGE_CONFIG.maxPage)&&(n.DOM_CONFIG.setAttributeWithPageId(i,o),i.innerText=o);}),n.CONFIG.pageChangeCallBack(n.PAGE_CONFIG.getCurrentPage())),n.DOM_CONFIG.removeAllAttributeWithDisabled(t),n.DOM_CONFIG.getLastPageNode()&&n.PAGE_CONFIG.getCurrentPage()==n.PAGE_CONFIG.maxPage&&(n.DOM_CONFIG.setAttributeWithDisabled(n.DOM_CONFIG.nextBtnNode.get()),n.DOM_CONFIG.setAttributeWithDisabled(n.DOM_CONFIG.lastBtnNode.get())));};}setLastBtnClickEvent(e,t){let n=this;e.onclick=function(){let r=n.DOM_CONFIG.getAttributeWithCurrentPage();if(n.DOM_CONFIG.getAttributeWithPageId(r)===n.PAGE_CONFIG.maxPage)return;n.CONFIG.lastBtn.callBack();let s=Array.from(n.DOM_CONFIG.getAllPageNode(t));s.reverse();let i=n.PAGE_CONFIG.maxPage,l=0;for(;!(n.PAGE_CONFIG.maxPage-i>3);){let o=s[l];if(o==null)break;l===0?n.DOM_CONFIG.setAttributeWithCurrentPage(o):n.DOM_CONFIG.removeAttributeWithCurrentPage(o),n.DOM_CONFIG.setAttributeWithPageId(o,i),o.innerText=i,i--,l++;}n.DOM_CONFIG.removeAllAttributeWithDisabled(t),n.DOM_CONFIG.setAttributeWithDisabled(n.DOM_CONFIG.nextBtnNode.get()),n.DOM_CONFIG.setAttributeWithDisabled(n.DOM_CONFIG.lastBtnNode.get()),n.CONFIG.pageChangeCallBack(n.PAGE_CONFIG.maxPage);};}setPageBtnClickEvent(e,t){let n=this;e.onclick=function(r){let s=r.target;n.DOM_CONFIG.getAllPageNode(t).forEach(i=>{i==s?n.DOM_CONFIG.hasAttributeWithCurrentPage(s)||(n.DOM_CONFIG.setAttributeWithCurrentPage(s),n.CONFIG.pageChangeCallBack(n.PAGE_CONFIG.getCurrentPage())):n.DOM_CONFIG.removeAttributeWithCurrentPage(i);}),n.DOM_CONFIG.removeAllAttributeWithDisabled(t),n.DOM_CONFIG.getFirstPageNode(t)&&n.PAGE_CONFIG.getCurrentPage()==1&&(n.DOM_CONFIG.setAttributeWithDisabled(n.DOM_CONFIG.firstBtnNode.get()),n.DOM_CONFIG.setAttributeWithDisabled(n.DOM_CONFIG.prevBtnNode.get())),n.DOM_CONFIG.getLastPageNode()&&n.PAGE_CONFIG.getCurrentPage()==n.PAGE_CONFIG.maxPage&&(n.DOM_CONFIG.setAttributeWithDisabled(n.DOM_CONFIG.nextBtnNode.get()),n.DOM_CONFIG.setAttributeWithDisabled(n.DOM_CONFIG.lastBtnNode.get()));};}append(e){let t=this;t.DOM_CONFIG.dataPagingNode.dom?.remove(),t.DOM_CONFIG.dataPagingNode.dom=null,e.appendChild(t.getDataPagingNode());}changeConfig(e){Object.assign(this.CONFIG,e);}refresh(e){if(e.length===this.CONFIG.data.length)return;this.CONFIG.data=[],this.CONFIG.data=e;let t=this.PAGE_CONFIG.getCurrentPage(),n=Math.ceil(e.length/this.CONFIG.pageCount);t>n&&(t=n),this.CONFIG.currentPage=t;let r=this.DOM_CONFIG.dataPagingNode.dom.parentElement;this.append(r);}}var Wt=Kt;const Se=ht||"网盘链接识别",Yt=Wt??window.DataPaging??he.DataPaging,Pe=Pt??window.CryptoJS??he.CryptoJS,Ge={$data:{__storeApiFn:null,get storeApiValue(){return this.__storeApiFn||(this.__storeApiFn=new Ae.Dictionary),this.__storeApiFn}},getStorageApi(a){if(this.hasStorageApi(a))return this.$data.storeApiValue.get(a)},hasStorageApi(a){return this.$data.storeApiValue.has(a)},setStorageApi(a,e){this.$data.storeApiValue.set(a,e);},initComponentsStorageApi(a,e,t){let n;this.hasStorageApi(a)?n=this.getStorageApi(a):n=t,this.setComponentsStorageApiProperty(e,n);},setComponentsStorageApiProperty(a,e){Reflect.set(a.props,O,e);}},H=function(a,e,t,n,r,s,i,l){let o={text:a,type:"switch",description:r,disabled:i,attributes:{},props:{},getValue(){return this.props[O].get(e,t)},callback(c,u){let p=!!u;if(g.success(`${p?"开启":"关闭"} ${a}`),typeof n=="function"&&n(c,p))return;this.props[O].set(e,p),typeof l=="function"&&l(c,p);},afterAddToUListCallBack:s};return Reflect.set(o.attributes,ue,e),Reflect.set(o.attributes,me,t),Ge.initComponentsStorageApi("switch",o,{get(c,u){return J.getValue(c,u)},set(c,u){J.setValue(c,u);}}),o},W=function(a,e,t,n,r,s="",i,l,o,c){let u={text:a,type:"input",isNumber:!!i,isPassword:!!l,attributes:{},props:{},description:n,afterAddToUListCallBack:o,getValue(){return this.props[O].get(e,t)},callback(p,h,m){if(typeof r=="function"&&r(p,h,m))return;this.props[O].set(e,h);},placeholder:s};return Reflect.set(u.attributes,ue,e),Reflect.set(u.attributes,me,t),Ge.initComponentsStorageApi("input",u,{get(p,h){return J.getValue(p,h)},set(p,h){J.setValue(p,h);}}),u},nt=function(a,e,t,n,r,s,i,l,o,c){let u={text:a,type:"button",attributes:{},props:{},description:e,buttonIcon:n,buttonIsRightIcon:r,buttonIconIsLoading:s,buttonType:i,buttonText:t,callback(p){typeof l=="function"&&l(p);},afterAddToUListCallBack:o};return Reflect.set(u.attributes,wt,()=>{u.disable=false;}),u},Jt={tianYiYunLoginTip:{PC:{width:"30vw",height:"280px"},Mobile:{width:"80vw",height:"250px"}},jianGuoYunLoginTip:{PC:{width:"350px",height:"200px"},Mobile:{width:"350px",height:"200px"}},settingView:{PC:{width:"800px",height:"600px"},Mobile:{width:"92vw",height:"80vh"}},setDefaultValueView:{PC:{width:"350px",height:"200px"},Mobile:{width:"350px",height:"200px"}},mainView:{PC:{width:"500px",height:"100%"},Mobile:{width:"88vw",height:"50vh"}},mainViewSmallWindow:{PC:{get width(){return y.smallWindow["netdisk-ui-small-window-width"].value+"px"},height:"auto"},Mobile:{get width(){return y.smallWindow["netdisk-ui-small-window-width"].value+"px"},height:"auto"}},oneFileStaticView:{PC:{width:"550px",height:"350px"},Mobile:{width:"88vw",height:"300px"}},moreFileStaticView:{PC:{width:"700px",height:"600px"},Mobile:{width:"88vw",height:"500px"}},inputNewAccessCodeView:{PC:{width:"400px",height:"200px"},Mobile:{width:"88vw",height:"160px"}},historyMatchView:{PC:{width:"50vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},customRulesView:{PC:{width:"50vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},customRuleDebugView:{PC:{width:"55vw",height:"70vh"},Mobile:{width:"88vw",height:"70vh"}},matchPasteTextView:{PC:{width:"50vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},accessCodeRuleView:{PC:{width:"50vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},accessCodeRuleEditView:{PC:{width:"44vw",height:"50vh"},Mobile:{width:"70vw",height:"45vh"}},websiteRuleView:{PC:{width:"45vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},websiteEditRuleView:{PC:{width:"45vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}}},Xt=function(a){window.location.hostname==="pan.baidu.com"&&window.location.pathname==="/share/init"&&window.location.search.startsWith("?surl=")&&(g.success("自动填写链接",a),d.waitNode("div.verify-form #accessCode").then(e=>{if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}f.success("自动填充访问码"),e.value=a.accessCode,d.dispatchEvent(e,"input"),document.querySelector("div.verify-form #submitBtn")?.click();})),window.location.hostname==="pan.baidu.com"&&window.location.pathname==="/wap/init"&&window.location.search.startsWith("?surl=")&&(g.success("自动填写链接",a),d.waitNode("div.extractWrap div.extract-content div.extractInputWrap.extract input[type=text]").then(e=>{if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}f.success("自动填充访问码"),e.value=a.accessCode,d.dispatchEvent(e,"input"),document.querySelector("div.extractWrap div.extract-content button.m-button")?.click();}));},Qt=function(a){window.location.hostname.match(/lanzou[a-z]{1}.com/gi)&&(g.success("自动填写链接",a),d.waitNode("#pwd").then(e=>{if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}f.success("自动填充访问码"),e.value=a.accessCode,d.dispatchEvent(e,"input"),(document.querySelector("#passwddiv div.passwddiv-input > div")||e.nextElementSibling)?.click(),document.querySelector("#sub")?.click();}),d.waitNode("#f_pwd").then(e=>{d.mutationObserver(e,{config:{attributes:true,attributeFilter:["style"]},callback:(t,n)=>{let r=document.querySelector("#f_pwd #pwd");if(!d.isVisible(r)){g.error("输入框不可见，不输入密码");return}n.disconnect(),g.success("自动填充访问码并关闭观察者"),f.success("自动填充访问码"),r.value=a.accessCode,d.dispatchEvent(r,"input"),document.querySelector("#f_pwd #sub")?.click();}});}));},ea=function(a){function e(t,n){let r=0,s=30,i=setInterval(()=>{if(r++,r>s){g.error("结束循环检查，退出。"),clearInterval(i);return}if(!d.isVisible(t)){g.warn(`第 ${r} 次：输入框不可见，不输入密码`);return}n(),clearInterval(i);},500);}window.location.hostname==="cloud.189.cn"&&(g.success("自动填写链接",a),d.waitNode("input#code_txt").then(t=>{e(t,()=>{f.success("自动填充访问码");let n=document.querySelector(".btn.btn-primary.visit");t.value=a.accessCode,t._value=a.accessCode,d.dispatchEvent(t,"input"),d.dispatchEvent(n,"click");});})),window.location.hostname==="h5.cloud.189.cn"&&(g.success("自动填写链接",a),d.waitNode("input.access-code-input").then(t=>{e(t,()=>{f.success("自动填充访问码"),t.value=a.accessCode,t._value=a.accessCode,d.dispatchEvent(t,"input"),d.dispatchEvent(document.querySelector("div.button"),"click");});}));},ta=function(a){window.location.hostname==="caiyun.139.com"&&(g.success("自动填写链接",a),d.waitNode("#token-input").then(e=>{if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}f.success("自动填充访问码"),e.value=a.accessCode,d.dispatchEvent(e,"input"),document.querySelector("#homepage div.token div.token-form a").click();}),d.waitNode("#app div.token-form input[type=text]").then(e=>{if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}f.success("自动填充访问码"),e.value=a.accessCode,d.dispatchEvent(e,"input"),document.querySelector("div.token-form a.btn-token").click();}));},kt={async waitReactPropsToSet(a,e,t){Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]);function n(){let r=null;return typeof a=="string"?r=b.selector(a):typeof a=="function"?r=a():a instanceof HTMLElement&&(r=a),r}typeof a=="string"&&!await d.waitNode(a,1e4)||t.forEach(r=>{typeof r.msg=="string"&&g.info(r.msg);function s(){let i=n();if(i==null)return {status:false,isTimeout:true,inst:null,$el:i};let l=d.getReactObj(i);if(l==null)return {status:false,isTimeout:false,inst:null,$el:i};let o=Array.from(e).findIndex(p=>{let h=l[p];if(!h)return  false;let m=r.check(h,i);return m=!!m,m}),c=e[o],u=l[c];return {status:o!==-1,isTimeout:false,inst:u,$el:i}}d.waitPropertyByInterval(()=>n(),()=>s().status,250,1e4).then(()=>{let i=s();if(i.status){let l=i.inst;r.set(l,i.$el);}else typeof r.failWait=="function"&&r.failWait(i.isTimeout);});});}},aa=function(a){(window.location.hostname==="www.aliyundrive.com"||window.location.hostname==="www.alipan.com")&&(g.success("自动填写链接",a),b.ready(()=>{d.waitAnyNode(["#root input.ant-input[placeholder*='提取码']","#root input[name=pwd][placeholder*='提取码']"]).then(e=>{kt.waitReactPropsToSet(e,["reactProps","reactFiber"],{check(t){return typeof t?.onChange=="function"||typeof t?.memoizedProps?.onChange=="function"},set(t){if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}e.value=a.accessCode,(t?.onChange||t?.memoizedProps?.onChange)({currentTarget:e,target:e}),f.success("自动填充访问码");let r=He('#root button[type="submit"]');if(!r){f.error("提交按钮不存在");return}r.click();}});});}));},na=function(a){window.location.hostname==="www.123pan.com"&&(g.success("自动填写链接",a),b.ready(()=>{d.waitAnyNode(["#app .ca-fot input.ant-input[type=text][placeholder*='提取码']","#app .appinput input.ant-input[type=text][placeholder*='提取码']"]).then(e=>{kt.waitReactPropsToSet(e,["reactProps","reactFiber"],{check(t){return typeof t?.onChange=="function"||typeof t?.memoizedProps?.onChange=="function"},set(t){if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}e.value=a.accessCode,(t?.onChange||t?.memoizedProps?.onChange)({currentTarget:e,target:e}),f.success("自动填充访问码");let r=e.nextElementSibling;if(!r){f.error("提交按钮不存在");return}r.click();}});});}));},ra=function(a){window.location.hostname==="share.weiyun.com"&&(g.success("自动填写链接",a),d.waitNode("#app input.input-txt").then(e=>{if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}f.success("自动填充访问码"),e.value=a.accessCode,d.dispatchEvent(e,"input"),d.dispatchEvent(e,"change"),setTimeout(()=>{document.querySelector(".form-item button.btn-main").click();},500);}),d.waitNode(".input-wrap input.pw-input").then(e=>{if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}f.success("自动填充访问码"),e.value=a.accessCode,d.dispatchEvent(e,"input"),d.dispatchEvent(e,"change"),setTimeout(()=>{document.querySelector(".pw-btn-wrap button.btn").click();},500);}));},ia=function(a){window.location.hostname==="pan.xunlei.com"&&(g.success("自动填写链接",a),d.waitNode("#__layout div.pass-input-wrap input.td-input__inner").then(e=>{if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}g.error("输入框不可见，不输入密码"),e.value=a.accessCode,d.dispatchEvent(e,"input"),d.dispatchEvent(e,"change"),setTimeout(()=>{document.querySelector("#__layout div.pass-input-wrap button.td-button").click();},500);}),d.waitNode("#__layout div.pass-wrapper input.td-input__inner").then(e=>{if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}g.error("输入框不可见，不输入密码"),e.value=a.accessCode,d.dispatchEvent(e,"input"),d.dispatchEvent(e,"change"),setTimeout(()=>{document.querySelector("#__layout div.pass-wrapper button.td-button").click();},500);}));},sa=function(a){window.location.hostname==="pan.quark.cn"&&(g.success("自动填写链接",a),b.ready(()=>{d.waitNode("#ice-container input.ant-input[class*=ShareReceive][placeholder*='提取码']").then(e=>{kt.waitReactPropsToSet(e,["reactProps","reactEventHandlers"],{check(t){return typeof t?.onChange=="function"||typeof t?.memoizedProps?.onChange=="function"},set(t){if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}e.value=a.accessCode,(t?.onChange||t?.memoizedProps?.onChange)({currentTarget:e,target:e}),f.success("自动填充访问码");}});});}));},oa=function(a){g.success("自动填写链接",a),d.waitNode("#passcode").then(e=>{if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}f.success("自动填充访问码"),e.value=a.accessCode,d.dispatchEvent(e,"input"),He("#main-content .form-group button.btn[type=button]").click();});},la=function(a){["115.com","115cdn.com","anxia.com"].includes(window.location.hostname)&&(g.success("自动填写链接",a),d.waitNode("input.text",1e4).then(e=>{if(e){if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}f.success("自动填充访问码"),e.value=a.accessCode,d.dispatchEvent(e,"input"),He("#js-share_code div.form-decode div.submit a").click();}}));},ca=function(a){window.location.hostname.endsWith(".link.yunpan.com")&&(g.success("自动填写链接",a),d.waitNode("#extract-bg-container input.pwd-input").then(e=>{if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}f.success("自动填充访问码"),e.value=a.accessCode,d.dispatchEvent(e,"input"),He("#extract-bg-container input.submit-btn")?.click();}),d.waitNode("#extractForm input.pwd-input").then(e=>{if(!d.isVisible(e)){g.error("输入框不可见，不输入密码");return}f.success("自动填充访问码"),e.value=a.accessCode,d.dispatchEvent(e,"input"),He("#extractForm input.submit-btn")?.click();}));},V={matchRange_text:{before:a=>`${a}-text-match-range-before`,after:a=>`${a}-text-match-range-after`},matchRange_html:{before:a=>`${a}-html-match-range-before`,after:a=>`${a}-html-match-range-after`},function:{enable:a=>`${a}-enable`,checkLinkValidity:a=>`${a}-check-link-valid`,checkLinkValidityHoverTip:a=>`${a}-check-link-valid-hover-tip`,linkClickMode:a=>`${a}-click-mode`},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:a=>`${a}-open-blank-auto-fill-accesscode`,openBlankWithCopyAccessCode:a=>`${a}-open-blank-with-copy-accesscode`},schemeUri:{enable:a=>`${a}-scheme-uri-enable`,isForwardLinearChain:a=>`${a}-scheme-uri-forward-linear-chain`,isForwardBlankLink:a=>`${a}-scheme-uri-forward-blank-link`,uri:a=>`${a}-scheme-uri-uri`}},Ve={features:{customAccessCodeEnable:a=>`${a}-custom-accesscode-enable`,customAccessCode:a=>`${a}-custom-accesscode`}},Y={matchRange_text:{before(a,e=20){const t=F(V.matchRange_text.before(a),e);return parseInt(t.value.toString())},after(a,e=10){const t=F(V.matchRange_text.after(a),e);return parseInt(t.value.toString())}},matchRange_html:{before(a,e=100){const t=F(V.matchRange_html.before(a),e);return parseInt(t.value.toString())},after(a,e=15){const t=F(V.matchRange_html.after(a),e);return parseInt(t.value.toString())}},function:{enable(a,e=true){return !!F(V.function.enable(a),e).value},linkClickMode(a,e="copy"){return F(V.function.linkClickMode(a),e).value},checkLinkValidity(a,e=false){return !!F(V.function.checkLinkValidity(a),e).value},checkLinlValidityHoverTip(a,e=true){return !!F(V.function.checkLinkValidityHoverTip(a),e).value}},linkClickMode_openBlank:{openBlankAutoFilleAccessCode(a,e=true){return !!F(V.linkClickMode_openBlank.openBlankAutoFilleAccessCode(a),e).value},openBlankWithCopyAccessCode(a,e=false){return !!F(V.linkClickMode_openBlank.openBlankWithCopyAccessCode(a),e).value}},schemeUri:{enable(a,e=false){return !!F(V.schemeUri.enable(a),e).value},isForwardLinearChain(a,e=false){return !!F(V.schemeUri.isForwardLinearChain(a),e).value},isForwardBlankLink(a,e=false){return !!F(V.schemeUri.isForwardBlankLink(a),e).value},uri(a,e=""){return F(V.schemeUri.uri(a),e).value}}},We={key:"tempNetDiskInfo",$data:{netDiskInfo:null,get enable(){return y.features.autoFillAccessCode.value}},init(){if(!this.$data.enable)return;this.$data.netDiskInfo=this.getValue();let a=false;for(let e=0;e<this.$data.netDiskInfo.length;e++){const t=this.$data.netDiskInfo[e];if(!Y.linkClickMode_openBlank.openBlankAutoFilleAccessCode(t.ruleKeyName))continue;let r=t.accessCode;if(r==null||typeof r=="string"&&r.trim()==="")continue;let s=t.shareCode;if(t.ruleKeyName==="baidu"&&s.startsWith("1")&&(s=s.slice(1,s.length)),window.location.href.includes(s)){let l=We.netDisk[t.ruleKeyName];typeof l=="function"?(g.success("成功匹配到对应的自动填充访问码的网盘信息：",t),l(t)):g.warn("自动填充访问码失败："+t.ruleKeyName+"，原因：该网盘未适配"),a=true;break}}a||g.error("未触发自动填充访问码，原因：未找到对应的网盘信息：👇",this.$data.netDiskInfo);},netDisk:{baidu:Xt,lanzou:Qt,tianyiyun:ea,hecaiyun:ta,aliyun:aa,wenshushu:()=>{},nainiu:()=>{},_123pan:na,weiyun:ra,xunlei:ia,_115pan:la,chengtong:oa,kuake:sa,jianguoyun:()=>{},onedrive:()=>{},"360yunpan":ca},setValue(a){de(this.key,a);},addValue(a){let e=a.accessCode;if(e==null||typeof e=="string"&&e.trim()==="")return;let t=this.getValue();t=t.filter(n=>!(n.ruleKeyName===a.ruleKeyName&&n.shareCode===a.shareCode)),t.push(a),this.setValue(t);},getValue(){let a=re(this.key,[]);return Array.isArray(a)||(a=[a]),a=a.filter(e=>Date.now()-e.time<1440*60*1e3),this.setValue(a),a}},ua=function(){},et="(123pan|123865|123684|123652|123912).(com|cn)",Tt={rule:[{link_innerText:`${et}/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)`,link_innerHTML:`${et}/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)`,shareCode:new RegExp(`${et}/s/([a-zA-Z0-9_-]{8,14})`,"gi"),shareCodeNeedRemoveStr:new RegExp(`${et}/s/`,"gi"),checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"123pan.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://123pan.com/s/{#shareCode#}",copyUrl:`https://123pan.com/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"123盘",key:"_123pan",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:true,isForwardBlankLink:true,uri:""}}}},Mt={KEY:"_123pan_User_Authorization",set(a){de(this.KEY,a);},get(){return re(this.KEY)}},da=function(){if(window.location.hostname!=="www.123pan.com"||Y.function.linkClickMode(Tt.setting.key)!=="parseFile")return;let a=he.localStorage.getItem("authorToken");d.isNull(a)||(a=a.replace(/^\"/,"").replace(/\"$/,""),g.success("获取123网盘已登录用户的authorToken值👇"),g.success(a),Mt.set(a));},yt={init(){Object.keys(yt.netDisk).forEach(a=>{this.netDisk[a]();});},netDisk:{_123pan:da,lanzouyx:ua}},ne={getDefaultLinkClickMode(){return {copy:{default:false,enable:true,text:"复制到剪贴板"},"copy-closePopup":{default:false,enable:true,text:"复制到剪贴板 & 关闭弹窗"},openBlank:{default:false,enable:true,text:"新标签页打开"},"openBlank-closePopup":{default:false,enable:true,text:"新标签页打开 & 关闭弹窗"},parseFile:{default:false,enable:false,text:"文件解析"},"parseFile-closePopup":{default:false,enable:false,text:"文件解析 & 关闭弹窗"},own:{default:false,enable:false,text:"自定义动作"}}},replaceParam(a,e={}){return typeof a!="string"||Object.keys(e).forEach(t=>{let n=e[t];if(d.isNotNull(n)){try{a=a.replaceAll(`{#encodeURI-${t}#}`,encodeURI(n));}catch{g.error("encodeURI-替换的文本失败",[n]);}try{a=a.replaceAll(`{#encodeURIComponent-${t}#}`,encodeURIComponent(n));}catch{g.error("encodeURIComponent-替换的文本失败",[n]);}try{a=a.replaceAll(`{#decodeURI-${t}#}`,decodeURI(n));}catch{g.error("decodeURI-替换的文本失败",[n]);}try{a=a.replaceAll(`{#decodeURIComponent-${t}#}`,decodeURIComponent(n));}catch{g.error("encodeURIComponent-替换的文本失败",[n]);}a=a.replaceAll(`{#${t}#}`,n);}}),a},replaceChinese(a){return a.replace(/[\u4e00-\u9fa5]/g,"")},getDecodeComponentUrl(a=window.location.href){try{a=decodeURIComponent(a);}catch{}return a}},q={protocol:"jumpwsv",pathname:"go",parseDataToSchemeUri(a,e){if(!this.isEnableForward(a))return e;let n=Y.schemeUri.uri(a);return d.isNull(n)&&(n=this.getSchemeUri(this.get1DMSchemeUriOption(e))),n.startsWith(this.protocol)&&(e=e.replace(/&/g,"{-and-}"),e=e.replace(/#/g,"{-number-}")),n=ne.replaceParam(n,{intentData:e}),n},isEnableForward(a){return Y.schemeUri.enable(a)},isForwardDownloadLink(a){return this.isEnableForward(a)&&Y.schemeUri.isForwardLinearChain(a)},isForwardBlankLink(a){return this.isEnableForward(a)&&Y.schemeUri.isForwardBlankLink(a)},getSchemeUri(a){return `${this.protocol}://${this.pathname}?${d.toSearchParamsStr(a)}`},get1DMSchemeUriOption(a=""){return {package:"idm.internet.download.manager.plus",activity:"idm.internet.download.manager.UrlHandlerDownloader",intentAction:"android.intent.action.VIEW",intentData:a,intentExtra:""}}};class be{ruleIndex=0;shareCode="";accessCode="";init(e){this.ruleIndex=e.ruleIndex,this.shareCode=e.shareCode,this.accessCode=e.accessCode;}}class pa extends be{panelList=[];Authorization="";code={5113:"您今日下载流量已超出10GB限制，购买VIP会员即可体验无限流量下载",5103:"分享码错误或者分享地址错误",5104:"分享已过期","-1000":"获取出错","-2000":"请求异常","-3000":"请求意外中止","-4000":"请求超时",104:"文件已失效"};Headers={"user-agent":"123pan/v2.4.0(Android_7.1.2;Xiaomi)",platform:"android","app-version":"61","x-app-version":"2.4.0"};async init(e){super.init(e);const t=this;let{ruleIndex:n,shareCode:r,accessCode:s}=e;if(this.panelList=[],this.Authorization=Mt.get(),!await this.checkLinkValidity())return;let l=await this.getFiles();if(l)if(l.length===1&&l[0].Type==0){let o=l[0];if(o.Status==104){f.error("文件已失效");return}let c=o.DownloadUrl,u="";if(c===""){let m=await t.getFileDownloadInfo(o.Etag,o.FileId,o.S3KeyFlag,t.shareCode,o.Size);m&&m.code===0?(c=m.data.DownloadURL,q.isForwardDownloadLink("_123pan")&&(c=q.parseDataToSchemeUri("_123pan",c)),u=d.formatByteToSize(o.Size)):m&&m.code===401?(c="javascript:;",u="请登录后下载"):(c="javascript:;",u="获取下载链接失败");}else q.isForwardDownloadLink("_123pan")&&(c=q.parseDataToSchemeUri("_123pan",c)),u=d.formatByteToSize(o.Size);let p=new Date(o.CreateAt).getTime(),h=new Date(o.UpdateAt).getTime();p=d.formatTime(p),h=d.formatTime(h),x.staticView.oneFile({title:"123盘单文件直链",fileName:o.FileName,fileSize:u,downloadUrl:c,fileUploadTime:p,fileLatestTime:h});}else {f.info("正在递归文件");let o=f.loading("正在解析多文件中，请稍后..."),c=t.getFolderInfo(l,0);o.close(),g.info("递归完毕"),x.staticView.moreFile("123盘文件解析",c);}}async checkLinkValidity(){const e=this;f.info("正在校验链接有效性");let t=`https://www.123pan.com/s/${e.shareCode}`,n=await M.get({url:t,headers:{"User-Agent":d.getRandomPCUA(),Referer:"https://www.123pan.com"}});if(g.info(n),!n.status)return  false;let s=n.data.responseText.match(/window.g_initialProps[\s]*=[\s]*\{(.+?)\};/s);if(s){g.info(s);let i=d.toJSON(`{${s[s.length-1]}}`);if(g.info(i),i.res.code!==0)return f.error(i.res.message),false;if(i.res.data.HasPwd&&(e.accessCode==null||e.accessCode===""))f.error("密码缺失!"),x.newAccessCodeView("密码缺失","_123pan",e.ruleIndex,e.shareCode,e.accessCode,o=>{e.init({ruleIndex:e.ruleIndex,shareCode:e.shareCode,accessCode:o.accessCode});});else return  true}else f.error("校验链接-获取初始化内容失败");}async getFiles(e=0){const t=this,n={limit:100,next:1,orderBy:"share_id",orderDirection:"desc",shareKey:t.shareCode,SharePwd:t.accessCode,ParentFileId:e,Page:1};let r=`https://www.123pan.com/b/api/share/get?${d.toSearchParamsStr(n)}`,s=await M.get({url:r,headers:{Accept:"*/*",Referer:`https://www.123pan.com/s/${t.shareCode}`,...t.Headers}});if(g.info(s),!s.status)return;let i=s.data,l=d.toJSON(i.responseText);if(l.code===0)return l.data.InfoList;l.code===5103?x.newAccessCodeView(void 0,"_123pan",t.ruleIndex,t.shareCode,t.accessCode,o=>{t.init({ruleIndex:t.ruleIndex,shareCode:t.shareCode,accessCode:o.accessCode});}):t.code[l.code]?f.error(t.code[l.code]):"message"in l?f.error(l.message):f.error("123盘：未知的JSON格式");}async getFilesByRec(e){const t=this;let n=await M.get({url:`https://www.123pan.com/b/api/share/get?limit=100&next=1&orderBy=share_id&orderDirection=desc&shareKey=${t.shareCode}&SharePwd=${t.accessCode}&ParentFileId=${e}&Page=1`,headers:{Accept:"*/*",Referer:`https://www.123pan.com/s/${t.shareCode}`,...t.Headers}});if(!n.status)return;let r=n.data;g.info(r);let s=d.toJSON(r.responseText);if(s.code==0)return s.data.InfoList}getFolderInfo(e,t){const n=this;let r=[],s=[],i=[];return e.forEach(l=>{l.Type?s.push({fileName:l.FileName,fileSize:0,fileType:"",createTime:new Date(l.CreateAt).getTime(),latestTime:new Date(l.UpdateAt).getTime(),isFolder:true,index:t,async clickEvent(){let o=await n.getFilesByRec(l.FileId.toString());return o?n.getFolderInfo(o,t+1):[]}}):i.push({fileName:l.FileName,fileSize:l.Size,fileType:"",createTime:new Date(l.CreateAt).getTime(),latestTime:new Date(l.UpdateAt).getTime(),isFolder:false,index:t,async clickEvent(){if(l.Status==104)f.error("文件已失效");else if(l.DownloadUrl){let o=l.DownloadUrl;return q.isForwardDownloadLink("_123pan")&&(o=q.parseDataToSchemeUri("_123pan",o)),{url:o,autoDownload:true,mode:"aBlank"}}else {let o=await n.getFileDownloadInfo(l.Etag,l.FileId,l.S3KeyFlag,n.shareCode,l.Size);if(o&&o.code===0)return {url:o.data.DownloadURL,autoDownload:true,mode:"aBlank"};o&&o.code===401?f.error("请登录后下载"):f.error(o?.message||"获取下载链接失败");}}});}),s.sort((l,o)=>l.fileName.localeCompare(o.fileName)),i.sort((l,o)=>l.fileName.localeCompare(o.fileName)),r=r.concat(s),r=r.concat(i),r}async getFileDownloadInfo(e,t,n,r,s){const i=this;let l=i.getFileDownloadAuth(),o={"Content-Type":"application/json;charset=UTF-8",Host:"www.123pan.com",Accept:"*/*",Referer:"https://www.123pan.com/s/"+r,Origin:"https://www.123pan.com",...i.Headers};i.Authorization&&Reflect.set(o,"Authorization","Bearer "+i.Authorization),g.success("获取下载链接加密参数："+l);let c=await M.post(`https://www.123pan.com/a/api/share/download/info?${l[0]}=${l[1]}`,{data:JSON.stringify({Etag:e,FileID:t,S3keyFlag:n,ShareKey:r,Size:s}),responseType:"json",headers:o});if(!c.status)return;let u=c.data,p=d.toJSON(u.responseText);return g.info(p),p.code==0?(p.data.DownloadURL=i.decodeDownloadUrl(p.data.DownloadURL),p):{code:p.code,message:p.message}}getFileDownloadAuth(){function e(r){var s,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8;if(arguments.length!==0){typeof r=="object"?s=r:((""+r).length===10&&(r=1e3*parseInt(r)),s=new Date(r));var l=r+6e4*new Date(r).getTimezoneOffset(),o=l+36e5*i;return s=new Date(o),{y:s.getFullYear(),m:s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1,d:s.getDate()<10?"0"+s.getDate():s.getDate(),h:s.getHours()<10?"0"+s.getHours():s.getHours(),f:s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes()}}}function t(r){for(var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,i=function(){for(var p,h=[],m=0;m<256;m++){p=m;for(var w=0;w<8;w++)p=1&p?3988292384^p>>>1:p>>>1;h[m]=p;}return h},l=i(),o=r,c=-1,u=0;u<o.length;u++)c=c>>>8^l[255&(c^o.charCodeAt(u))];return c=(-1^c)>>>0,c.toString(s)}function n(r){var s="web",i=3,l=Math.round((new Date().getTime()+60*new Date().getTimezoneOffset()*1e3+288e5)/1e3).toString(),o="a,d,e,f,g,h,l,m,y,i,j,n,o,p,k,q,r,s,t,u,b,c,v,w,s,z",c=Math.round(1e7*Math.random()),u,p,h,m,w,k,C,A,$;for(var R in u=o.split(","),p=e(l),h=p.y,m=p.m,w=p.d,k=p.h,C=p.f,A=[h,m,w,k,C].join(""),$=[],A)$.push(u[Number(A[R])]);var I,v;return I=t($.join("")),v=t("".concat(l,"|").concat(c,"|").concat(r,"|").concat(s,"|").concat(i,"|").concat(I)),[I,"".concat(l,"-").concat(c,"-").concat(v)]}return n("/a/api/share/download/info")}decodeDownloadUrl(e){return e===""?"":e}}class ha extends be{X_Share_Token_Data={expire_time:"2000-01-01T00:00:00.000Z",expires_in:7200,share_token:""};X_Device_Id=null;X_Canary="client=web,app=share,version=v2.3.1";async init(e){super.init(e);const t=this;let{ruleIndex:n,shareCode:r,accessCode:s}=e;if(t.X_Device_Id=t.get_X_Device_Id(),g.info("生成X_Device_Id："+t.X_Device_Id),globalThis.location.hostname!=="www.aliyundrive.com"&&globalThis.location.hostname!=="www.alipan.com"){let c=X.getBlankUrl({ruleKeyName:"aliyun",ruleIndex:n,shareCode:r,accessCode:s}),u=f.error(`请在阿里云盘页面解析，<a href="${c}">点我前往</a>`,{timeout:1e4,isHTML:true});b.on(u.$Qmsg.querySelector("a[href]"),"click",void 0,p=>{d.preventEvent(p),Ce.openBlankUrl(c,"aliyun",t.ruleIndex,t.shareCode,t.accessCode);});return}let i=await this.list_by_share(r,"root");if(!i)return;f.info("正在解析链接");let l=f.loading("正在解析多文件中，请稍后..."),o=t.getFolderInfo(i,0);l.close(),g.info("解析完毕"),x.staticView.moreFile("阿里云盘文件解析",o);}getFolderInfo(e,t=0){const n=this;let r=[],s=[],i=[];return e.forEach(l=>{l.type!=="folder"?i.push({fileName:l.name,fileSize:l.size,fileType:l.file_extension,createTime:new Date(l.created_at).getTime(),latestTime:new Date(l.updated_at).getTime(),isFolder:false,index:t,async clickEvent(){let o=await n.get_share_link_download_url(l.share_id,l.file_id);if(!o)return;let c=o;return q.isForwardDownloadLink("aliyun")&&(c=q.parseDataToSchemeUri("aliyun",c)),{autoDownload:true,mode:"aBlank",url:c}}}):s.push({fileName:l.name,fileSize:0,fileType:"",createTime:l.created_at,latestTime:l.updated_at,isFolder:true,index:t,async clickEvent(){let o=await n.list_by_share(l.share_id,l.file_id);return o?n.getFolderInfo(o,t+1):[]}});}),s.sort((l,o)=>l.fileName.localeCompare(o.fileName)),i.sort((l,o)=>l.fileName.localeCompare(o.fileName)),r=r.concat(s),r=r.concat(i),g.info("getFilesInfoByRec",r),r}async list_by_share(e,t,n="name",r="DESC"){const s=this;let i=await M.post("https://api.aliyundrive.com/adrive/v2/file/list_by_share",{data:JSON.stringify({share_id:e,parent_file_id:t,limit:20,image_thumbnail_process:"image/resize,w_256/format,jpeg",image_url_process:"image/resize,w_1920/format,jpeg/interlace,1",video_thumbnail_process:"video/snapshot,t_1000,f_jpg,ar_auto,w_256",order_by:n,order_direction:r}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Origin:"https://www.aliyundrive.com",Referer:"https://www.aliyundrive.com/","X-Canary":s.X_Canary,"X-Device-Id":s.X_Device_Id,"X-Share-Token":await s.get_X_Share_Token(s.shareCode,s.accessCode),"User-Agent":d.getRandomPCUA()},allowInterceptConfig:false});if(!i.status){s.handle_request_error(i);return}let l=d.toJSON(i.data.responseText);return g.info("列出文件列表：",l),l.items}async get_share_link_download_url(e,t){const n=this;let r=await M.post("https://api.aliyundrive.com/v2/file/get_share_link_download_url",{data:JSON.stringify({expire_sec:600,file_id:t,share_id:e}),headers:{Accept:"application/json, text/plain, */*",Origin:"https://www.aliyundrive.com",Referer:"https://www.aliyundrive.com/","Content-Type":"application/json;charset=UTF-8",Authorization:"Bearer "+n.getAuthorization(),"X-Share-Token":await n.get_X_Share_Token(n.shareCode,n.accessCode),"User-Agent":d.getRandomPCUA()},responseType:"arraybuffer",allowInterceptConfig:false});if(!r.status){n.handle_request_error(r);return}let s=d.toJSON(r.data.responseText);return g.info("获取文件的下载链接：",s),s.download_url}handle_request_error(e){g.error(e);let t=d.toJSON(e.data.responseText);t.message==""?f.error(e.msg):f.error(t.message);}getAuthorization(){let e=he.localStorage.getItem("token");if(d.isNotNull(e)&&e!=null){let n=d.toJSON(e).access_token;return g.success("获取阿里云盘的access_token：",n),n}else g.error("获取access_token失败，请先登录账号！"),f.error("获取access_token失败，请先登录账号！");}async get_X_Share_Token(e,t){const n=this;if(new Date<new Date(n.X_Share_Token_Data.expire_time))return n.X_Share_Token_Data.share_token;let r=await M.post("https://api.aliyundrive.com/v2/share_link/get_share_token",{data:JSON.stringify({share_id:e,share_pwd:t}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Origin:"https://www.aliyundrive.com",Referer:"https://www.aliyundrive.com/","X-Canary":n.X_Canary,"X-Device-Id":n.X_Device_Id,"User-Agent":d.getRandomPCUA()},allowInterceptConfig:false});if(!r.status){n.handle_request_error(r);return}let s=d.toJSON(r.data.responseText);return n.X_Share_Token_Data=s,g.info("获取share_token：",n.X_Share_Token_Data),n.X_Share_Token_Data.share_token}get_X_Device_Id(){for(var e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,t=[],n=0;n<256;++n)t.push((n+256).toString(16).substr(1));function r(){return crypto.getRandomValues(new Uint8Array(16))}var s=function(l){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,c=(t[l[o+0]]+t[l[o+1]]+t[l[o+2]]+t[l[o+3]]+"-"+t[l[o+4]]+t[l[o+5]]+"-"+t[l[o+6]]+t[l[o+7]]+"-"+t[l[o+8]]+t[l[o+9]]+"-"+t[l[o+10]]+t[l[o+11]]+t[l[o+12]]+t[l[o+13]]+t[l[o+14]]+t[l[o+15]]).toLowerCase();if(!(function(u){return typeof u=="string"&&e.test(u)})(c))throw TypeError("Stringified UUID is invalid");return c},i=function(l,o,c){var u=(l=l||{}).random||(l.rng||r)();return u[6]=15&u[6]|64,u[8]=63&u[8]|128,s(u)};return i()}}class fa extends be{async init(e){super.init(e);let{ruleIndex:t,shareCode:n,accessCode:r}=e,s=re("baidu-baiduwp-php-url"),i=re("baidu-baiduwp-php-post-form"),l=re("baidu-baiduwp-php-copy-url");if(!s){f.error("请先在设置中配置百度网盘-网址");return}if(!i){f.error("请先在设置中配置百度网盘-表单参数");return}i=ne.replaceParam(i,{shareCode:n,accessCode:r});let o=document.createElement("form"),c={},u=new URLSearchParams(i);o.action=s,o.method="post",o.style.display="none",o.target="_blank";for(let[p,h]of u){let m=document.createElement("textarea");m.name=p,m.value=h,o.appendChild(m),c[p]=h;}g.info("表单数据",c),document.body.appendChild(o),g.info("访问网址",s),l?(Ce.copy("baidu",t,n,r,"1.5秒后跳转至解析站"),setTimeout(()=>{o.submit();},1500)):o.submit();}}const G={alert(a,e){return a=this.handleDetails(a,e),B.alert(a)},confirm(a,e){return a=this.handleDetails(a,e),B.confirm(a)},loading(a){return typeof a.animation>"u"&&(a.animation=y.pops.popsAnimation.value),typeof a.forbiddenScroll>"u"&&(a.forbiddenScroll=x.defaultForbiddenScroll),B.loading(a)},prompt(a,e){return a=this.handleDetails(a,e),B.prompt(a)},folder(a,e){return a=this.handleDetails(a,e),a.sort={name:y.popsFolder["pops-folder-sort-name"].value,isDesc:y.popsFolder["pops-folder-sort-is-desc"].value,callback(t,n,r,s){y.popsFolder["pops-folder-sort-name"].value=r,y.popsFolder["pops-folder-sort-is-desc"].value=s;}},B.folder(a)},panel(a,e){return a=this.handleDetails(a,e),B.panel(a)},rightClickMenu(a){return a=this.handleDetails(a),B.rightClickMenu(a)},handleDetails(a,e){if(a=Object.assign({animation:y.pops.popsAnimation.value,drag:y.pops.pcDrag.value,dragLimit:y.pops.pcDragLimit.value,forbiddenScroll:x.defaultForbiddenScroll},a),e!=null)if(B.isPhone()){let t=typeof e.Mobile.width=="function"?e.Mobile.width():e.Mobile.width,n=typeof e.Mobile.height=="function"?e.Mobile.height():e.Mobile.height;a.width=t,a.height=n;}else {let t=typeof e.PC.width=="function"?e.PC.width():e.PC.width,n=typeof e.PC.height=="function"?e.PC.height():e.PC.height;a.width=t,a.height=n;}if(a.mask==null&&(a.mask={}),typeof a.mask.enable!="boolean"&&(a.mask.enable=true),a.mask.clickEvent==null&&(a.mask.clickEvent={}),typeof a.mask.clickEvent.toClose!="boolean"&&(a.mask.clickEvent.toClose=y.pops.clickMaskToCloseDialog.value),y.pops.popsAcrylic.value){let t=`
            .pops {
                --acrylic-opacity: 0.7;
                --acrylic-color: rgba(232, 232, 232, var(--acrylic-opacity));
                --acrylic-blur: 30px;
                --acrylic-saturate: 125%;
                --pops-bg-opacity: var(--acrylic-opacity);
            }
            .pops {
                backdrop-filter: blur(var(--acrylic-blur)) saturate(var(--acrylic-saturate)) !important;
                background-color: var(--acrylic-color) !important;
            }
            .pops[type-value=panel]{
                --aside-bg-color: rgba(221, 221, 221, var(--acrylic-opacity));
				--pops-bg-color: #f2f2f2;
				--title-bg-color: var(--acrylic-color);
				--aside-bg-color: var(--acrylic-color);
				--container-item-bg-color: var(--acrylic-color);
            }
            `;typeof a.style=="string"?a.style+=t:a.style=t;}return a.zIndex=()=>{let n=d.getMaxZIndex(10),r=B.config.InstanceUtils.getPopsMaxZIndex(10).zIndex;return d.getMaxValue(99999,n,r)+10},a}},vt=`.pops[type-value="alert"] .pops-alert-title:has(+ .pops-alert-content .netdisk-url-box-all:empty) {\r
	border-bottom: none;\r
}\r
.netdisk-url-box {\r
	border-bottom: 1px solid #e4e6eb;\r
}\r
.netdisk-url-div {\r
	display: flex;\r
	align-items: center;\r
	width: 100%;\r
	padding: 5px 0px 5px 0px;\r
}\r
.netdisk-icon {\r
	display: contents;\r
}\r
.netdisk-icon .netdisk-icon-img {\r
	cursor: pointer;\r
	width: 28px;\r
	height: 28px;\r
	min-width: 28px;\r
	min-height: 28px;\r
	font-size: 0.8em;\r
	margin: 0px 10px;\r
}\r
.netdisk-url-div .netdisk-icon,\r
.netdisk-url-div .netdisk-status {\r
	flex: 0 0 auto;\r
}\r
.netdisk-url-div .netdisk-url {\r
	flex: 1;\r
}\r
.netdisk-icon .netdisk-icon-img {\r
	border-radius: 10px;\r
	box-shadow: 0 0.3px 0.6px rgb(0 0 0 / 6%), 0 0.7px 1.3px rgb(0 0 0 / 8%), 0 1.3px 2.5px rgb(0 0 0 / 10%),\r
		0 2.2px 4.5px rgb(0 0 0 / 12%), 0 4.2px 8.4px rgb(0 0 0 / 14%), 0 10px 20px rgb(0 0 0 / 20%);\r
}\r
.netdisk-status[data-check-failed] {\r
	padding: 5px 5px;\r
}\r
.netdisk-url {\r
	padding: 5px 5px;\r
}\r
.netdisk-url a {\r
	color: #ff4848 !important;\r
	min-height: 28px;\r
	overflow-x: hidden;\r
	overflow-y: auto;\r
	font-size: 0.8em;\r
	border: none;\r
	display: flex;\r
	align-items: center;\r
	width: 100%;\r
	height: 100%;\r
	padding: 0px;\r
	word-break: break-word;\r
	text-align: left;\r
}\r
.netdisk-status {\r
	display: none;\r
}\r
.netdisk-status[data-check-valid] {\r
	display: flex;\r
	align-items: center;\r
	width: 15px;\r
	height: 15px;\r
	color: #000000;\r
}\r
\r
.netdisk-status[data-check-valid="failed"] {\r
	color: red;\r
}\r
\r
.netdisk-status[data-check-valid="partial-violation"] {\r
	color: orange;\r
}\r
\r
.netdisk-status[data-check-valid="error"] {\r
	cursor: pointer;\r
}\r
\r
.netdisk-status[data-check-valid="success"] {\r
	color: green;\r
}\r
\r
.netdisk-status[data-check-valid="verify"] {\r
	color: #faad14;\r
}\r
\r
.netdisk-status[data-check-valid="loading"] svg {\r
	animation: rotating 2s linear infinite;\r
}\r
\r
.netdisk-url-box:has(.netdisk-status[data-check-valid="failed"]) {\r
	text-decoration: line-through;\r
}\r
\r
.whitesevPop-whitesevPopSetting :focus-visible {\r
	outline-offset: 0;\r
	outline: 0;\r
}\r
.netdisk-url a[isvisited="true"] {\r
	color: #8b8888 !important;\r
}\r
.netdisk-url a:active {\r
	box-shadow: 0 0 0 1px #616161 inset;\r
}\r
.netdisk-url a:focus-visible {\r
	outline: 0;\r
}\r
.whitesevPop-content p[pop] {\r
	text-indent: 0;\r
}\r
.whitesevPop-button[data-type="primary"] {\r
	border-color: #2d8cf0;\r
	background-color: #2d8cf0;\r
}\r
`,Me=function(a,e){return {KEY:a,default:e,get value(){return re(a,e)},set value(t){de(a,t);}}};class ga{option;constructor(e){this.option=e;}showView(){let e=B.alert({title:{text:this.option.title,position:"center"},content:{text:`
                <div class="filter-container"></div>
                `},btn:{ok:{text:"关闭",type:"default"}},drag:true,mask:{enable:true},width:window.innerWidth>500?"350px":"80vw",height:window.innerHeight>500?"300px":"70vh",style:`
            .filter-container{
                height: 100%;
                display: flex;
                flex-direction: column;
                gap: 20px;
            }
            .filter-container button{
                text-wrap: wrap;
                padding: 8px;
                height: auto;
                text-align: left;
            }
            `}),t=e.$shadowRoot.querySelector(".filter-container"),n=document.createDocumentFragment();this.option.filterOption.forEach(r=>{let s=b.createElement("button",{innerText:r.name},{type:"button"}),i=async()=>{(await this.option.getAllRuleInfo()).forEach(async o=>{await r.filterCallBack(o.data)?b.show(o.$el,false):b.hide(o.$el,false);}),typeof this.option.execFilterCallBack=="function"&&await this.option.execFilterCallBack(),e.close();};b.on(s,"click",async l=>{d.preventEvent(l),!(typeof r.callback=="function"&&!await r.callback(l,i))&&await i();}),n.appendChild(s);}),t.appendChild(n);}}class ma{option;constructor(e){this.option=e;}async showView(){let e=B.confirm({title:{text:this.option.title,position:"center"},content:{text:`
                    <form class="rule-form-container" onsubmit="return false">
                        <ul class="rule-form-ulist"></ul>
                        <input type="submit" style="display: none;" />
                    </form>
                    `,html:true},btn:d.assign({ok:{callback:async()=>{await s();}}},this.option.btn||{},true),drag:true,mask:{enable:true},style:`
                ${B.config.cssText.panelCSS}
                
                .rule-form-container {
                    
                }
                .rule-form-container li{
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 5px 20px;
                    gap: 10px;
                }
				.rule-form-ulist-dynamic{
					--button-margin-top: 0px;
					--button-margin-right: 0px;
					--button-margin-bottom: 0px;
					--button-margin-left: 0px;
					display: flex;
					flex-direction: column;
					align-items: flex-start;
					padding: 5px 0px 5px 20px;
				}
				.rule-form-ulist-dynamic__inner{
					width: 100%;
				}
				.rule-form-ulist-dynamic__inner-container{
					display: flex;
					align-items: center;
				}
				.dynamic-forms{
					width: 100%;
				}
                .pops-panel-item-left-main-text{
                    max-width: 150px;
                }
                .pops-panel-item-right-text{
                    padding-left: 30px;
                }
                .pops-panel-item-right-text,
                .pops-panel-item-right-main-text{
                    text-overflow: ellipsis;
                    overflow: hidden;
                    white-space: nowrap;
                }
				.pops-panel-item-left-desc-text{
					line-height: normal;
					margin-top: 6px;
					font-size: 0.8em;
					color: rgb(108, 108, 108);
				}

                ${this.option?.style??""}
            `,width:typeof this.option.width=="function"?this.option.width():window.innerWidth>500?"500px":"88vw",height:typeof this.option.height=="function"?this.option.height():window.innerHeight>500?"500px":"80vh"}),t=e.$shadowRoot.querySelector(".rule-form-container");e.$shadowRoot.querySelector("input[type=submit]");let n=e.$shadowRoot.querySelector(".rule-form-ulist"),r=await this.option.getView(await this.option.data());n.appendChild(r);const s=async()=>{(await this.option.onsubmit(t,await this.option.data())).success&&(e.close(),await this.option.dialogCloseCallBack(true));};}}class $t{option;constructor(e){this.option=e;}async showView(e){const t=this;let n=this.option.contentConfig;n.forEach(r=>{r.forms=[],r.headerTitle=r.headerTitle||r.title,r.subscribe?.enable&&(r.headerTitle=r.headerTitle+`
					<div class="subscribe-container">
						<button class="subscribe-btn" type="button" data-type="subscribe" data-has-icon="false" data-righticon="false">
							<span>${r.subscribe?.title||"订阅"}</span>
						</button>
					</div>`);let s=r.clickCallback;r.clickCallback=async(i,l,o)=>{if(typeof s=="function"&&s(i,o,o),r.subscribe&&r.subscribe.enable){let h=l.querySelector(".subscribe-btn");const m=r.subscribe;b.on(h,"click",async w=>{d.preventEvent(w),await m?.callback?.();let k=await this.enterDeepMenu(o,m?.headerTitle||m?.title||"订阅",()=>{this.updateRuleContaienrElement(r.ruleOption,m,o);}),C=k.$rightRuleContainer;this.createButtonControls(C,C,m,async()=>{let $=B.prompt({title:{text:"添加订阅",position:"center"},content:{text:"",focus:true,placeholder:"输入URL"},btn:{cancel:{enable:false},ok:{enable:true,text:"下一步",async callback(v,_){let S=b.val(R).trim();if(S==="")return;g.info("订阅："+S);let N=f.loading("正在获取订阅信息...");try{let T=await m?.getSubscribeInfo(S);if(T.data){v.close();let E=T.data,P=E.data.title||E.subscribeData.title||E.data.url,Z=B.alert({title:{text:"添加订阅",position:"center"},content:{text:`
																	<div class="subscribe-network-title">
																		<span>订阅链接名称：</span>
																		<input type="text" placeholder="输入订阅链接的名称">
																	</div>
																	<div class="subscribe-network-data-count"></div>
																	<div class="subscribe-network-home-url"></div>
																	<div class="subscribe-network-url"></div>
																	<div class="subscribe-network-version"></div>
																	<div class="subscribe-network-last-modified"></div>
																`,html:!0},btn:{ok:{text:"添加",type:"subscribe",callback:async(Xe,we)=>{await m.addData(E)||f.error("该订阅已存在",{consoleLogContent:!0}),t.updateRuleContaienrElement(m,m,k.$section),Xe.close();}}},drag:!0,mask:{enable:!0},width:j.setting.width,height:"auto",style:`
																.pops button[data-type="subscribe"]{
																	--button-color: #ffffff;
																	--button-bd-color: #67b279;
																	--button-bg-color: #67b279;
																}
																.pops button[data-type="subscribe"]:hover{
																	--button-color: #ffffff;
																	--button-bd-color:rgb(91, 159, 107);;
																	--button-bg-color:rgb(91, 159, 107);;
																}

																.pops-alert-content{
																	display: flex;
																	flex-direction: column;
																	gap: 4px;
																	padding: 20px;
																}
																.pops-alert-content a {
																	color: #3d3d3d;
																}
																.pops-alert-content > div{
																	display: flex;
																}
																.pops-alert-content > div > span:first-child{
																	white-space: nowrap;
																}
																.subscribe-network-title input{
																	width: 100%;
																	flex: 1 1 auto;
																	line-height: 1.3;
																	outline: none;
																	text-overflow: ellipsis;
																	border-radius: 8px;
																	border: 1px solid #e4e4e4;
																	background-color: #f6f6f6;
																	padding: 16px 16px 16px 16px;
																	font-size: 16px;
																}
																.subscribe-network-title input:focus{

																}
															`}),Q=Z.$shadowRoot.querySelector(".subscribe-network-title input"),te=Z.$shadowRoot.querySelector(".subscribe-network-data-count"),fe=Z.$shadowRoot.querySelector(".subscribe-network-home-url"),pe=Z.$shadowRoot.querySelector(".subscribe-network-url"),Ie=Z.$shadowRoot.querySelector(".subscribe-network-version"),Ee=Z.$shadowRoot.querySelector(".subscribe-network-last-modified");b.val(Q,P),b.on(Q,["input","propertychange"],Xe=>{let we=b.val(Q);E.data.title=we===""?void 0:we;}),b.html(te,`
																<span>规则数量：</span>
																<span>${E.subscribeData.ruleData.length}</span>
															`),typeof E.subscribeData.homePage=="string"?b.html(fe,`
																<span>主页：</span>
																<a href="${E.subscribeData.homePage}" target="_blank">${E.subscribeData.homePage}</a>
															`):fe.remove(),b.html(pe,`
																<span>URL：</span>
																<a href="${E.data.url}" target="_blank">${E.data.url}</a>
															`),E.subscribeData.version!=null?b.html(Ie,`
																	<span>版本：</span>
																	<span>${E.subscribeData.version}</span>
																`):Ie.remove(),E.subscribeData.lastModified!=null?b.html(Ee,`
																	<span>更新时间：</span>
																	<span>${d.formatTime(E.subscribeData.lastModified)}</span>
																`):Ee.remove();}else f.error(T.msg,{consoleLogContent:!0});}catch(T){f.error(T.toString(),{consoleLogContent:true});}finally{N.close();}}}},drag:true,mask:{enable:true},width:j.info.width,height:"auto"}),R=$.$shadowRoot.querySelector("input"),I=$.$shadowRoot.querySelector(".pops-prompt-btn-ok ");b.on(R,["input","propertychange"],v=>{b.val(R)===""?b.attr(I,"disabled","true"):b.removeAttr(I,"disabled");}),b.listenKeyboard(R,"keydown",(v,_,S,N)=>{v==="Enter"&&S.length===0&&(d.preventEvent(N),d.dispatchEvent(I,"click"));}),d.dispatchEvent(R,"input");});let A=await m.data();await this.addRuleElement(m,m,k.$section,A);});}let c=this.createButtonControls(o,o,r.ruleOption,async()=>{this.showEditView(r.ruleOption,void 0,false,await r.ruleOption.getAddData(),o);}),u=await r.ruleOption.data(),p=false;await this.addRuleElement(r.ruleOption,void 0,o,u,(h,m)=>{(typeof e=="function"?e(h):true)||(p=true,b.hide(m,false));}),p&&c.$ruleControlFilter&&b.text(c.$ruleControlFilter,"取消过滤");};}),B.panel({title:{text:typeof this.option.title=="function"?this.option.title():this.option.title,position:"center"},content:n,btn:{close:{enable:true,callback(r,s){r.close();}}},drag:true,mask:{enable:true,clickEvent:{toClose:false}},class:this.option.className||"rule-panel-view",width:j.settingBig.width,height:j.settingBig.height,style:`
                ${this.option.style||""}
                .pops button[data-type="subscribe"]{
                    --button-color: #ffffff;
                    --button-bd-color: #67b279;
                    --button-bg-color: #67b279;
                }
                .pops button[data-type="subscribe"]:hover{
                    --button-color: #ffffff;
                    --button-bd-color:rgb(91, 159, 107);;
                    --button-bg-color:rgb(91, 159, 107);;
                }
                section.pops-panel-container .pops-panel-container-header-ul li:has(.subscribe-btn){
                    justify-content: space-between !important;
                }
				section.pops-panel-container ul li.rule-controls{
					justify-content: flex-start;
					overflow-x: auto;
				}

				section.pops-panel-container ul:has(>.rule-view-container){
					overflow: hidden;
					display: flex;
					flex-direction: column;
					margin: var(--pops-panel-forms-container-item-margin-top-bottom) var(--pops-panel-forms-margin-left-right);
					gap: var(--pops-panel-forms-container-item-margin-top-bottom);
				}

				.rule-view-container{
					margin: 0;
					margin-top: 0;
					overflow: auto;
					background: #ffffff;
					border-radius: var(--pops-panel-forms-container-item-border-radius);
					padding: 5px 10px;
					position: relative;
					flex: 1;
				}
				.rule-view-container:empty{
					display: none;
				}
				.rule-item{
					display: flex;
					align-items: center;
					line-height: normal;
					font-size: 16px;
					padding: 4px 8px;
					gap: 8px;
				}
				.rule-name{
					flex: 1;
					white-space: nowrap;
					text-overflow: ellipsis;
					overflow: hidden;
				}
				.rule-controls{
					display: flex;
					align-items: center;
					text-overflow: ellipsis;
					overflow: hidden;
					white-space: nowrap;
					gap: 8px;
					padding: 0px;
				}
				.rule-controls button{
					margin: 0;
				}
				.rule-controls-enable{
					
				}
				.rule-controls-edit{
					
				}
				.rule-controls-delete{
					
				}
				.rule-controls-edit,
				.rule-controls-delete{
					width: 16px;
					height: 16px;
					cursor: pointer;
				}

				section.pops-panel-container > ul li:not(.pops-panel-forms-container-item){
					margin: 0;
				}
            `});}async enterDeepMenu(e,t,n){const r={duration:220,easing:"ease-in-out"},s=e.matches("section")?e:e.closest("section"),i=b.createElement("section",{className:"pops-panel-container pops-panel-deepMenu-container",innerHTML:`
				<ul class="pops-panel-container-header-ul pops-panel-deepMenu-container-header-ul">
					<li class="pops-panel-container-header-title-text pops-panel-deepMenu-container-header">
						<i class="pops-panel-deepMenu-container-left-arrow-icon">${B.config.iconSVG.arrowLeft}</i>
						<p class="pops-panel-deepMenu-container-header-title-text">${t}</p>
					</li>
				</ul>
				<ul class="pops-panel-container-main-ul"></ul>
			`}),l=i.querySelector(".pops-panel-deepMenu-container-header-ul"),o=i.querySelector(".pops-panel-deepMenu-container-left-arrow-icon"),c=i.querySelector(".pops-panel-container-main-ul");b.on(o,"click",async p=>{d.preventEvent(p);const h=()=>{const m=s;b.removeClass(m,"pops-hide-important"),b.remove(i),n();};if(this.option.useDeepMenuSwtichAnimation&&document.startViewTransition){const m=document.startViewTransition(h);await m.ready,await Promise.all([i.animate([{transform:"translateX(0)"},{transform:"translateX(100%)"}],r).finished,s.animate([{transform:"translateX(-100%)"},{transform:"translateX(0)"}],r).finished]),await m.finished;}else h();});const u=()=>{b.addClass(s,"pops-hide-important"),b.after(s,i);};if(this.option.useDeepMenuSwtichAnimation&&document.startViewTransition){const p=document.startViewTransition(u);await p.ready,await i.animate([{transform:"translateX(100%)"},{transform:"translateX(0)"}],r).finished,await p.finished;}else u();return {$section:i,$headerContainer:l,$arrowLeft:o,$rightRuleContainer:c,quiteDeepMenu:()=>{o.click();}}}createButtonControls(e,t,n,r){let s=n.btnControls,i=b.createElement("li",{className:"rule-controls"});b.append(e,i);let l=null;s?.add?.enable&&(l=b.createElement("button",{className:"rule-control-add",innerHTML:"<span>添加</span>"},{type:"button","data-type":"primary","data-has-icon":"false","data-righticon":"false"}),b.on(l,"click",async m=>{d.preventEvent(m);let w=await n.btnControls?.add?.callback?.call(this,{event:m,$section:t});typeof w=="boolean"&&!w||await r?.();}),b.append(i,l));let o=null;s?.filter?.enable&&(o=b.createElement("button",{className:"rule-control-filter",innerHTML:"<span>过滤</span>"},{type:"button","data-type":"default","data-has-icon":"false","data-righticon":"false"}),b.on(o,"click",async m=>{d.preventEvent(m);let w=await s?.filter?.callback?.();if(typeof w=="boolean"&&!w)return;let k=()=>Array.from(t.querySelectorAll(".rule-view-container .rule-item")),C=o;if(C)if(b.text(C).includes("取消")){let A=await s?.filter?.cancelFilterCallback?.({$button:C,getAllRuleElement:k});if(typeof A=="boolean"&&!A)return;k().forEach($=>{b.show($,false);}),b.text(C,"过滤");}else {let A="过滤规则";typeof s?.filter?.title=="function"?A=s?.filter?.title():typeof s?.filter?.title=="string"&&(A=s?.filter?.title),new ga({title:A,filterOption:s?.filter?.option||[],execFilterCallBack(){b.text(C,"取消过滤");},getAllRuleInfo:()=>k().map(R=>({data:this.parseRuleElement(R).data,$el:R}))}).showView();}}),b.append(i,o));let c=null;s?.clearAll?.enable&&(c=b.createElement("button",{className:"rule-control-clear-all",innerHTML:"<span>清空所有</span>"},{type:"button","data-type":"xiaomi-primary","data-has-icon":"false","data-righticon":"false"}),b.on(c,"click",m=>{d.preventEvent(m);let w=B.confirm({title:{text:"提示",position:"center"},content:{text:"确定清空所有的数据？",html:false},btn:{ok:{enable:true,callback:async k=>{g.success("清空所有");let C=await s?.clearAll?.callback?.();if(typeof C=="boolean"&&!C)return;let A=await n?.data();if(!A||A.length){f.error("清理失败");return}else f.success("清理成功");await this.updateDeleteAllBtnText(n,i),this.clearContent(t),w.close();}},cancel:{text:"取消",enable:true}},drag:true,mask:{enable:true},width:"300px",height:"200px"});}),b.append(i,c));let u=null;s?.import?.enable&&(u=b.createElement("button",{className:"rule-control-import",innerHTML:"<span>导入</span>"},{type:"button","data-type":"default","data-has-icon":"false","data-righticon":"false"}),b.on(u,"click",async m=>{d.preventEvent(m);await s?.import?.callback?.(()=>{this.updateRuleContaienrElement(n,void 0,t);});}),b.append(i,u));let p=null;s?.export?.enable&&(p=b.createElement("button",{className:"rule-control-export",innerHTML:"<span>导出</span>"},{type:"button","data-type":"default","data-has-icon":"false","data-righticon":"false"}),b.on(p,"click",async m=>{d.preventEvent(m);await s?.export?.callback?.({event:m});}),b.append(i,p));let h=b.createElement("div",{className:"rule-view-container",innerHTML:""});return b.append(t,h),{$ruleContainer:h,$ruleControls:i,$ruleControlAdd:l,$ruleControlFilter:o,$ruleControlClearAll:c,$ruleControlImport:u,$ruleControlExport:p}}parseViewElement(e){let t=e.querySelector(".rule-view-container"),n=e.querySelector(".rule-control-clear-all");return {$container:t,$deleteBtn:n}}parseRuleElement(e){let t=e.querySelector(".rule-controls-enable"),n=t.querySelector(".pops-panel-switch"),r=t.querySelector(".pops-panel-switch__input"),s=t.querySelector(".pops-panel-switch__core"),i=e.querySelector(".rule-controls-edit"),l=e.querySelector(".rule-controls-delete");return {$enable:t,$enableSwitch:n,$enableSwitchInput:r,$enableSwitchCore:s,$edit:i,$delete:l,data:Reflect.get(e,"data-rule")}}async createRuleElement(e,t,n,r){let s=n,i=await e.getDataItemName(s),l=b.createElement("div",{className:"rule-item",innerHTML:`
			<div class="rule-name">${i}</div>
			<div class="rule-controls">
				<div class="rule-controls-enable">
					<div class="pops-panel-switch">
						<input class="pops-panel-switch__input" type="checkbox">
						<span class="pops-panel-switch__core">
							<div class="pops-panel-switch__action">
							</div>
						</span>
					</div>
				</div>
				<div class="rule-controls-edit">
					${B.config.iconSVG.edit}
				</div>
				<div class="rule-controls-delete">
					${B.config.iconSVG.delete}
				</div>
			</div>
			`});Reflect.set(l,"data-rule",s);let o="pops-panel-switch-is-checked";const{$enable:c,$enableSwitch:u,$enableSwitchCore:p,$enableSwitchInput:h,$delete:m,$edit:w}=this.parseRuleElement(l);return e.btnControls?.ruleEnable?.enable?(b.on(p,"click",async k=>{let C=false;if(u.classList.contains(o)?(u.classList.remove(o),C=false):(u.classList.add(o),C=true),h.checked=C,await e?.btnControls?.ruleEnable?.callback(s,C),C&&t){let A=n,$=await t.getSubscribeInfo(A.data.url);if($.data){let R=$.data;R.uuid=A.uuid,R.data=A.data,R.data.latestUpdateTime=Date.now(),await t.updateData(R);}else A.data.updateFailedTime=Date.now(),await t.updateData(A),g.error(A),f.error($.msg,{consoleLogContent:true});await this.updateRuleContaienrElement(e,t,r);}}),await e?.btnControls?.ruleEnable?.getEnable(s)&&u.classList.add(o)):c.remove(),e?.btnControls?.ruleEdit?.enable?b.on(w,"click",k=>{if(d.preventEvent(k),typeof e.btnControls?.ruleEdit?.callback=="function"){let C=e.btnControls?.ruleEdit?.callback({context:this,event:k,option:e,subscribeOption:t,ruleData:s,$section:r,$ruleItem:l,enterDeepMenu:async A=>{let $=await this.enterDeepMenu(r,A.headerTitle||"",()=>{this.updateRuleContaienrElement(e,t,r);}),R=$.$rightRuleContainer;this.createButtonControls(R,$.$rightRuleContainer,A,void 0);let I=await A.data();await this.addRuleElement(A,void 0,$.$section,I);}});if(typeof C=="boolean"&&!C)return}this.showEditView(e,t,true,s,r,l,C=>{s=null,s=C;});}):w.remove(),e?.btnControls?.ruleDelete?.enable?b.on(m,"click",k=>{d.preventEvent(k);let C=B.confirm({title:{text:"提示",position:"center"},content:{text:"确定删除该条数据？",html:false},btn:{ok:{enable:true,callback:async A=>{g.success("删除数据"),await e?.btnControls?.ruleDelete?.deleteCallBack(s)?(f.success("成功删除该数据"),l.remove(),await this.updateDeleteAllBtnText(e,r),C.close()):f.error("删除该数据失败");}},cancel:{text:"取消",enable:true}},drag:true,mask:{enable:true},width:"300px",height:"200px"});}):m.remove(),l}async addRuleElement(e,t,n,r,s){let{$container:i}=this.parseViewElement(n),l=[],o=Array.isArray(r)?r:[r],c=document.createDocumentFragment();for(let u=0;u<o.length;u++){let p=o[u],h=await this.createRuleElement(e,t,p,n);c.appendChild(h),s?.(p,h),l.push(h);}return i.appendChild(c),await this.updateDeleteAllBtnText(e,n),l}async updateRuleContaienrElement(e,t,n){this.clearContent(n);const{$container:r}=this.parseViewElement(n);let s=await e.data();await this.addRuleElement(e,t,n,s),await this.updateDeleteAllBtnText(e,n);}async updateRuleItemElement(e,t,n,r,s){let i=await this.createRuleElement(e,t,n,s);return r.after(i),r.remove(),i}clearContent(e){const{$container:t}=this.parseViewElement(e);b.html(t,"");}setDeleteBtnText(e,t,n=false){const{$deleteBtn:r}=this.parseViewElement(e);n?b.html(r,t):b.text(r,t);}async updateDeleteAllBtnText(e,t){let r=(await e.data()).length,s="清空所有";r!==0&&(s+=`(${r})`),this.setDeleteBtnText(t,s);}showEditView(e,t,n,r,s,i,l,o){let c=async p=>{if(p){if(typeof o=="function"){let h=await e.getData(r);o(h);}}else if(n||await e.deleteData(r),typeof l=="function"){let h=await e.getData(r);l(h);}};new ma({title:n?"编辑":"添加",data:()=>r,dialogCloseCallBack:c,getView:async p=>await e.btnControls?.ruleEdit?.getView?.(p,n),btn:{ok:{enable:true,text:n?"修改":"添加"},cancel:{callback:async(p,h)=>{p.close(),await c(false);}},close:{callback:async(p,h)=>{p.close(),await c(false);}}},onsubmit:async(p,h)=>{let m=await e?.btnControls?.ruleEdit?.onsubmit?.(p,n,h);return m.success?n?(f.success("修改成功"),s&&await this.updateRuleItemElement(e,t,m.data,i,s)):s&&await this.addRuleElement(e,t,s,m.data):n&&g.error("修改失败"),m},style:e?.btnControls?.ruleEdit?.style,width:e?.btnControls?.ruleEdit?.viewWidth,height:e?.btnControls?.ruleEdit?.viewHeight}).showView();}}let Et=class{option;storageApi;constructor(e){this.option=e,this.storageApi=new Fe(e.STORAGE_API_KEY);}getAllSubscribe(){return this.storageApi.get(this.option.STORAGE_KEY,[])}getAllSubscribeRule(e=false){let t=this.getAllSubscribe(),n=[];for(let r=0;r<t.length;r++){const s=t[r];if(!(e&&!s.data.enable))for(let i=0;i<s.subscribeData.ruleData.length;i++){const l=s.subscribeData.ruleData[i];e&&!l.enable||(l.subscribeUUID=s.uuid,n.push(l));}}return n}getSubscribe(e){return this.getAllSubscribe().find(n=>n.uuid==e)}getSubscribeRule(e,t){let n=this.getSubscribe(e);if(n)return n.subscribeData.ruleData.find(s=>s.uuid===t)}deleteAllSubscribe(){this.storageApi.delete(this.option.STORAGE_KEY);}deleteSubscribe(e){let t=typeof e=="string"?e:e.uuid,n=this.getAllSubscribe(),r=n.findIndex(s=>s.uuid===t);return r!==-1&&(n.splice(r,1),this.storageApi.set(this.option.STORAGE_KEY,n)),r!==-1}clearSubscribe(e){let t=typeof e=="string"?e:e.uuid,n=this.getAllSubscribe(),r=n.findIndex(s=>s.uuid===t);return r!==-1?(n[r].subscribeData.ruleData=[],this.storageApi.set(this.option.STORAGE_KEY,n),true):false}addSubscribe(e){let t=false,n=this.getAllSubscribe();return n.findIndex(s=>s.uuid===e.uuid)===-1&&(n.push(e),t=true),t&&this.storageApi.set(this.option.STORAGE_KEY,n),t}updateSubscribe(e){let t=false,n=this.getAllSubscribe(),r=n.findIndex(s=>s.uuid===e.uuid);return r!==-1&&(n[r]=e,t=true),t&&this.storageApi.set(this.option.STORAGE_KEY,n),t}updateSubscribeRule(e,t){let n=false,r=this.getAllSubscribe(),s=r.find(i=>i.uuid===e);if(s){let i=s.subscribeData.ruleData.findIndex(l=>l.uuid===t.uuid);i!==-1&&(s.subscribeData.ruleData[i]=t,n=true);}return n&&this.storageApi.set(this.option.STORAGE_KEY,r),true}deleteSubscribeRule(e,t){let n=false,r=this.getAllSubscribe(),s=r.findIndex(i=>i.uuid===e);if(s!==-1){let l=r[s].subscribeData.ruleData.findIndex(o=>o.uuid===t.uuid);l!==-1&&(r[s].subscribeData.ruleData.splice(l,1),this.storageApi.set(this.option.STORAGE_KEY,r),n=true);}return n}async getSubscribeInfo(e){let t=await M.get(e,{allowInterceptConfig:false,timeout:1e4,headers:{"User-Agent":d.getRandomPCUA()}});if(!t.status)return g.error(t),{data:null,msg:"获取订阅信息失败"};let n=t.data.responseText,r=d.toJSON(n);return typeof r.title=="string"&&typeof r.version=="number"&&typeof r.lastModified=="number"&&Array.isArray(r.ruleData)?{data:{uuid:d.generateUUID(),subscribeData:r,data:{enable:true,url:e,latestUpdateTime:Date.now(),updateFailedTime:null}},msg:""}:(g.error(r),{data:null,msg:"订阅链接的内容格式不正确"})}async updateAllSubscribe(){let e=this.getAllSubscribe();for(let t=0;t<e.length;t++){const n=e[t];if(!n.data.enable||typeof n.data.updateFailedTime=="number"&&d.formatTime(n.data.updateFailedTime,"yyyyMMdd")===d.formatTime(Date.now(),"yyyyMMdd")||typeof n.data.latestUpdateTime=="number"&&d.formatTime(Date.now(),"yyyyMMdd")===d.formatTime(n.data.latestUpdateTime,"yyyyMMdd"))continue;let r=await this.getSubscribeInfo(n.data.url),s=false;if(r.data){let i=r.data;i.uuid=n.uuid,i.data=n.data,i.data.latestUpdateTime=Date.now();let l=i.data.title||i.subscribeData.title||i.data.url;n.data.updateFailedTime=null,s=this.updateSubscribe(i),s?g.success(`更新订阅成功：${l}`):g.error(`更新订阅失败：${l}`,n);}else g.error("更新订阅失败："+r.msg,n);s||(n.data.updateFailedTime=Date.now(),this.updateSubscribe(n));}}importSubscribe(e){let t=B.alert({title:{text:"请选择导入方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="local">本地导入</div>
                    <div class="btn-control" data-mode="network">网络导入</div>
                    <div class="btn-control" data-mode="clipboard">剪贴板导入</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(o,c){o.close();}}},drag:true,mask:{enable:true},width:j.info.width,height:j.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),n=t.$shadowRoot.querySelector(".btn-control[data-mode='local']"),r=t.$shadowRoot.querySelector(".btn-control[data-mode='network']"),s=t.$shadowRoot.querySelector(".btn-control[data-mode='clipboard']"),i=async o=>{let c=this.getAllSubscribe(),u=[],p=[];for(let h=0;h<o.length;h++){const m=o[h];let w=c.findIndex(k=>k.uuid===m.uuid);w!==-1?p.push({index:w,data:m}):u.push(m);}await new Promise(h=>{if(globalThis.confirm(`存在相同的uuid的规则 ${p.length}条，是否进行覆盖？`))for(const w of p)c[w.index]=w.data;h(true);}),c=c.concat(u),this.storageApi.set(this.option.STORAGE_KEY,c),f.success(`共 ${o.length} 条订阅，新增 ${u.length} 条`),e?.();},l=o=>new Promise(async c=>{let u=d.toJSON(o);if(!Array.isArray(u)){g.error(u),f.error("导入失败，格式不符合（不是数组）",{consoleLogContent:true}),c(false);return}if(!u.length){f.error("导入失败，解析出的数据为空",{consoleLogContent:true}),c(false);return}let p=u[0];if(!(typeof p.data=="object"&&p.data!=null&&typeof p.subscribeData=="object"&&p.subscribeData!=null&&typeof p.uuid=="string")){f.error("导入失败，解析的格式不符合",{consoleLogContent:true}),c(false);return}await i(u),c(true);});b.on(n,"click",o=>{d.preventEvent(o),t.close();let c=b.createElement("input",{type:"file",accept:".json"});b.on(c,["propertychange","input"],u=>{if(!c.files?.length)return;let p=c.files[0],h=new FileReader;h.onload=()=>{l(h.result);},h.readAsText(p,"UTF-8");}),c.click();}),b.on(r,"click",o=>{d.preventEvent(o),t.close();let c=B.prompt({title:{text:"网络导入",position:"center"},content:{text:"",placeholder:"请填写URL",focus:true},btn:{close:{enable:true,callback(h,m){h.close();}},ok:{text:"导入",callback:async(h,m)=>{let w=h.text;if(d.isNull(w)){f.error("请填入完整的url");return}let k=f.loading("正在获取配置..."),C=await M.get(w,{allowInterceptConfig:false});if(k.close(),!C.status){g.error(C),f.error("获取配置失败",{consoleLogContent:true});return}await l(C.data.responseText)&&h.close();}},cancel:{enable:false}},drag:true,mask:{enable:true},width:j.info.width,height:"auto"}),u=c.$shadowRoot.querySelector("input"),p=c.$shadowRoot.querySelector(".pops-prompt-btn-ok");b.on(u,["input","propertychange"],h=>{b.val(u)===""?b.attr(p,"disabled","true"):b.removeAttr(p,"disabled");}),b.listenKeyboard(u,"keydown",(h,m,w)=>{h==="Enter"&&w.length===0&&b.val(u)!==""&&d.dispatchEvent(p,"click");}),d.dispatchEvent(u,"input");}),b.on(s,"click",async o=>{d.preventEvent(o),t.close();let c=await Ke.getClipboardText();if(c.trim()===""){f.warning("获取到的剪贴板内容为空");return}await l(c);});}exportSubscribe(e="rule.json"){let t=B.alert({title:{text:"请选择导出方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="only-export-rule-list">导出订阅</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(s,i){s.close();}}},drag:true,mask:{enable:true},width:j.info.width,height:j.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),n=t.$shadowRoot.querySelector(".btn-control[data-mode='only-export-rule-list']"),r=(s,i)=>{let l=new Blob([JSON.stringify(i,null,4)]),o=window.URL.createObjectURL(l),c=document.createElement("a");c.href=o,c.download=s,c.click(),setTimeout(()=>{window.URL.revokeObjectURL(o);},1500);};b.on(n,"click",s=>{d.preventEvent(s);try{let i=this.getAllSubscribe();if(i.length===0){f.warning("订阅为空，无需导出");return}r(e,i),t.close();}catch(i){f.error(i.toString(),{consoleLogContent:true});}});}};const ae=new Et({STORAGE_API_KEY:"character-mapping-rule",STORAGE_KEY:"character-mapping-subscribe-rule"}),pt=new Fe("character-mapping-rule"),ct={$data:{STORAGE_KEY:"character-mapping",EXPORT_CONFIG_KEY:"rule-export-config"},getTemplateData(){return {uuid:d.generateUUID(),subscribeUUID:null,enable:true,name:"",data:{url:"",isRegExp:true,regExpFlag:"ig",searchValue:"",replaceValue:""},dynamicData:[]}},getRulePanelViewOption(a){const e=this;let t=B.config.PanelHandlerComponents(),n=()=>a??this.getTemplateData();function r(i){return {get(l,o){return i[l]??o},set(l,o){i[l]=o;}}}return {id:"netdisk-rule",title:"字符映射",headerTitle:"字符映射规则",subscribe:{enable:true,data(){return ae.getAllSubscribe()},getData:i=>ae.getSubscribe(i.uuid)??i,getDataItemName(i){return `
						<style>
							.subscribe-rule-title-info-wrapper{
								display: flex;
								flex-direction: column;
								gap: 4px;
							}
							.subscribe-rule-title-info-wrapper .rule-name-text{
								white-space: nowrap;
								text-overflow: ellipsis;
								overflow: hidden;
								font-weight: 600;
								font-size: 16px;
								line-height: 24px;
							}
							.subscribe-rule-title-info-wrapper .subscribe-rule-small-span-text{
								font-size: 14px;
								line-height: 16px;
								white-space: pre-wrap;
							}
						</style>
						<div class="subscribe-rule-title-info-wrapper">
							<div class="rule-name-text" style="white-space: nowrap;text-overflow: ellipsis;overflow: hidden;font-size: 16px;font-weight: 600;line-height: 24px;">${i.data.title||i.subscribeData.title||i.data.url}</div>
								<div class="subscribe-rule-small-span-text">${i.subscribeData.ruleData.length} 条规则，更新于：${d.formatTime(i.data.latestUpdateTime,"yyyy年MM月dd日 HH:mm:ss")}${typeof i.data.updateFailedTime=="number"?`，<span style="color: red;">更新失败于：${d.formatTime(i.data.updateFailedTime,"yyyy年MM月dd日 HH:mm:ss")}</span>`:""}</div>
								${i.subscribeData.homePage?`<a href="${i.subscribeData.homePage}" class="subscribe-rule-small-span-text" target="_blank" style="color:#67b279;">转到主页</a>`:""}
								<a href="${i.data.url}" class="subscribe-rule-small-span-text" target="_blank" style="color:#67b279;">订阅地址</a>
						</div>`},addData:i=>ae.addSubscribe(i),updateData:i=>ae.updateSubscribe(i),deleteData:i=>ae.deleteSubscribe(i),btnControls:{add:{enable:true},filter:{enable:true,title:"过滤订阅",option:[{name:"过滤【已启用】的订阅",filterCallBack(i){return i.data.enable}},{name:"过滤【未启用】的订阅",filterCallBack(i){return !i.data.enable}}]},clearAll:{enable:true,callback:()=>{ae.deleteAllSubscribe();}},ruleEnable:{enable:true,getEnable(i){return i.data.enable},async callback(i,l){i.data.enable=l,ae.updateSubscribe(i);}},ruleEdit:{enable:true,callback:i=>{let l=i.ruleData.uuid;return i.enterDeepMenu({headerTitle:i.ruleData.data.title||i.ruleData.subscribeData.title||i.ruleData.data.url,data(){return ae.getSubscribe(l)?.subscribeData?.ruleData??i.ruleData.subscribeData.ruleData},getData(o){return ae.getSubscribeRule(l,o.uuid)??o},getDataItemName(o){return o.name??o.data.url},addData(o){return  true},updateData(o){return ae.updateSubscribeRule(l,o)},deleteData(o){return ae.deleteSubscribeRule(l,o)},btnControls:{filter:{enable:true,option:[{name:"过滤【已启用】的规则",filterCallBack(o){return o.enable}},{name:"过滤【未启用】的规则",filterCallBack(o){return !o.enable}}]},clearAll:{enable:true,callback:()=>{ae.clearSubscribe(l);}},ruleEnable:{enable:true,getEnable(o){return o.enable},callback(o,c){o.enable=c,ae.updateSubscribeRule(l,o);}},ruleEdit:{enable:true,getView:(o,c)=>{c||(o=n());let u=document.createDocumentFragment(),p=H("启用","enable",true);Reflect.set(p.props,O,r(o));let h=t.createSectionContainerItem_switch(p),m=W("规则名称","name","","",void 0,"必填");Reflect.set(m.props,O,r(o));let w=t.createSectionContainerItem_input(m),k=W("匹配网址","url","","",void 0,"必填，可正则");Reflect.set(k.props,O,r(o.data));let C=t.createSectionContainerItem_input(k),A=S=>{let N=this.getTemplateData(),T=W("字符规则","searchValue",N.data.searchValue,"",void 0,"必填，可正则");Reflect.set(T.props,O,r(S));let E=t.createSectionContainerItem_input(T),P=H("是否启用正则","isRegExp",N.data.isRegExp,void 0,"使用正则进行匹配字符规则");Reflect.set(P.props,O,r(o.data));let Z=t.createSectionContainerItem_switch(P),Q=W("正则标识符","regExpFlag",N.data.regExpFlag,"",void 0,"i:不区分大小写  g:全局");Reflect.set(Q.props,O,r(o.data));let te=t.createSectionContainerItem_input(Q),fe=W("映射为","replaceValue",N.data.replaceValue,"",void 0,"");Reflect.set(fe.props,O,r(o.data));let pe=t.createSectionContainerItem_input(fe);return {$data_searchValue:E,$data_isRegExp:Z,$data_regExpFlag:te,$data_replaceValue:pe}},$=b.createElement("div",{className:"rule-form-ulist-dynamic",innerHTML:`
												<div class="rule-form-ulist-dynamic__inner">

												</div>
												<div class="pops-panel-button pops-panel-button-no-icon">
													<button class="pops-panel-button_inner" type="button" data-type="default">
														<i class="pops-bottom-icon" is-loading="false"></i>
														<span class="pops-panel-button-text">添加额外属性</span>
													</button>
												</div>`}),R=$.querySelector(".rule-form-ulist-dynamic__inner"),I=$.querySelector(".pops-panel-button"),v=S=>{let N=this.getTemplateData();S=S??{searchValue:N.data.searchValue,isRegExp:N.data.isRegExp,regExpFlag:N.data.regExpFlag,replaceValue:N.data.replaceValue};let T=b.createElement("div",{className:"rule-form-ulist-dynamic__inner-container",innerHTML:`
										<div class="dynamic-control-delete">
											<div class="pops-panel-button pops-panel-button-no-icon">
												<button class="pops-panel-button_inner" type="button" data-type="danger">
													<i class="pops-bottom-icon" is-loading="false"></i>
													<span class="pops-panel-button-text">×</span>
												</button>
											</div>
										</div>
										<ul class="dynamic-forms">

										</ul>`}),E=T.querySelector(".dynamic-control-delete");b.on(E,"click",pe=>{if(d.preventEvent(pe),T.remove(),Array.isArray(o.dynamicData)){let Ie=o.dynamicData.findIndex(Ee=>Ee==S);Ie!==-1&&o.dynamicData.splice(Ie,1);}});let P=T.querySelector(".dynamic-forms"),{$data_searchValue:Z,$data_isRegExp:Q,$data_regExpFlag:te,$data_replaceValue:fe}=A(S);P.appendChild(Z),P.appendChild(Q),P.appendChild(te),P.appendChild(fe),R.appendChild(T);};if(b.on(I,"click",S=>{d.preventEvent(S),v();}),Array.isArray(o.dynamicData))for(let S=0;S<o.dynamicData.length;S++){const N=o.dynamicData[S];v(N);}let _=A(o.data);return u.appendChild(h),u.appendChild(w),u.appendChild(C),u.appendChild(_.$data_searchValue),u.appendChild(_.$data_isRegExp),u.appendChild(_.$data_regExpFlag),u.appendChild(_.$data_replaceValue),u.appendChild($),u},onsubmit:(o,c,u)=>{let p=o.querySelectorAll(".rule-form-ulist > li"),h=this.getTemplateData();return c&&(h.uuid=u.uuid),p.forEach(m=>{let w=Reflect.get(m,"__formConfig__"),k=Reflect.get(w,"attributes"),C=Reflect.get(m,O),A=Reflect.get(k,ue),$=Reflect.get(k,me),R=C.get(A,$);Reflect.has(h,A)?Reflect.set(h,A,R):Reflect.has(h.data,A)?Reflect.set(h.data,A,R):g.error(`${A}不在数据中`);}),o.querySelectorAll(".rule-form-ulist-dynamic__inner-container").forEach(m=>{let w={};m.querySelectorAll(".dynamic-forms > li").forEach(k=>{let C=Reflect.get(k,"__formConfig__");if(!C)return;let A=Reflect.get(C,"attributes");if(!A)return;let $=Reflect.get(k,O),R=Reflect.get(A,ue),I=Reflect.get(A,me),v=$.get(R,I);Reflect.set(w,R,v);}),h.dynamicData.push(w);}),h.name.trim()===""?(f.error("规则名称不能为空"),{success:false,data:h}):h.data.url.trim()===""?(f.error("匹配网址不能为空"),{success:false,data:h}):h.data.searchValue.trim()===""||Array.isArray(h.dynamicData)&&h.dynamicData.findIndex(m=>m.searchValue.trim()==="")!==-1?(f.error("字符规则不能为空"),{success:false,data:h}):c?{success:this.updateData(h),data:h}:{success:this.addData(h),data:h}}},ruleDelete:{enable:true,deleteCallBack(o){return ae.deleteSubscribeRule(l,o)}}}}),false}},ruleDelete:{enable:true,deleteCallBack:i=>ae.deleteSubscribe(i)},import:{enable:true,callback(i){ae.importSubscribe(()=>{i();});}},export:{enable:true,callback(){ae.exportSubscribe(Se+"-字典映射-订阅.json");}}},getSubscribeInfo:ae.getSubscribeInfo.bind(ae)},ruleOption:{btnControls:{add:{enable:true},filter:{enable:true,title:"过滤规则",option:[{name:"过滤【已启用】的规则",filterCallBack(i){return i.enable}},{name:"过滤【未启用】的规则",filterCallBack(i){return !i.enable}},{name:"过滤【在当前网址生效】的规则",filterCallBack(i){return !!window.location.href.match(i.data.url)}}]},clearAll:{enable:true,callback:()=>{e.clearData();}},import:{enable:true,callback:i=>{e.importRule(()=>{i();});}},export:{enable:true,callback:()=>{e.exportRule(Se+"-字符映射.json",Se+"-字符映射-订阅模式.json");}},ruleEnable:{enable:true,getEnable(i){return i.enable},callback:(i,l)=>{i.enable=l,e.updateData(i);}},ruleEdit:{enable:true,getView:(i,l)=>{let o=document.createDocumentFragment();l||(i=n());let c=H("启用","enable",true);Reflect.set(c.props,O,r(i));let u=t.createSectionContainerItem_switch(c),p=W("规则名称","name","","",void 0,"必填");Reflect.set(p.props,O,r(i));let h=t.createSectionContainerItem_input(p),m=W("匹配网址","url","","",void 0,"必填，可正则");Reflect.set(m.props,O,r(i.data));let w=t.createSectionContainerItem_input(m),k=v=>{let _=this.getTemplateData(),S=W("字符规则","searchValue",_.data.searchValue,"",void 0,"必填，可正则");Reflect.set(S.props,O,r(v));let N=t.createSectionContainerItem_input(S),T=H("是否启用正则","isRegExp",_.data.isRegExp,void 0,"使用正则进行匹配字符规则");Reflect.set(T.props,O,r(i.data));let E=t.createSectionContainerItem_switch(T),P=W("正则标识符","regExpFlag",_.data.regExpFlag,"",void 0,"i:不区分大小写  g:全局");Reflect.set(P.props,O,r(i.data));let Z=t.createSectionContainerItem_input(P),Q=W("映射为","replaceValue",_.data.replaceValue,"",void 0,"");Reflect.set(Q.props,O,r(i.data));let te=t.createSectionContainerItem_input(Q);return {$data_searchValue:N,$data_isRegExp:E,$data_regExpFlag:Z,$data_replaceValue:te}},C=b.createElement("div",{className:"rule-form-ulist-dynamic",innerHTML:`
									<div class="rule-form-ulist-dynamic__inner">

									</div>
									<div class="pops-panel-button pops-panel-button-no-icon">
										<button class="pops-panel-button_inner" type="button" data-type="default">
											<i class="pops-bottom-icon" is-loading="false"></i>
											<span class="pops-panel-button-text">添加额外属性</span>
										</button>
									</div>`}),A=C.querySelector(".rule-form-ulist-dynamic__inner"),$=C.querySelector(".pops-panel-button"),R=v=>{let _=this.getTemplateData();v=v??{searchValue:_.data.searchValue,isRegExp:_.data.isRegExp,regExpFlag:_.data.regExpFlag,replaceValue:_.data.replaceValue};let S=b.createElement("div",{className:"rule-form-ulist-dynamic__inner-container",innerHTML:`
										<div class="dynamic-control-delete">
											<div class="pops-panel-button pops-panel-button-no-icon">
												<button class="pops-panel-button_inner" type="button" data-type="danger">
													<i class="pops-bottom-icon" is-loading="false"></i>
													<span class="pops-panel-button-text">×</span>
												</button>
											</div>
										</div>
										<ul class="dynamic-forms">

										</ul>`}),N=S.querySelector(".dynamic-control-delete");b.on(N,"click",te=>{if(d.preventEvent(te),S.remove(),Array.isArray(i.dynamicData)){let fe=i.dynamicData.findIndex(pe=>pe==v);fe!==-1&&i.dynamicData.splice(fe,1);}});let T=S.querySelector(".dynamic-forms"),{$data_searchValue:E,$data_isRegExp:P,$data_regExpFlag:Z,$data_replaceValue:Q}=k(v);T.appendChild(E),T.appendChild(P),T.appendChild(Z),T.appendChild(Q),A.appendChild(S);};if(b.on($,"click",v=>{d.preventEvent(v),R();}),Array.isArray(i.dynamicData))for(let v=0;v<i.dynamicData.length;v++){const _=i.dynamicData[v];R(_);}let I=k(i.data);return o.appendChild(u),o.appendChild(h),o.appendChild(w),o.appendChild(I.$data_searchValue),o.appendChild(I.$data_isRegExp),o.appendChild(I.$data_regExpFlag),o.appendChild(I.$data_replaceValue),o.appendChild(C),o},onsubmit:(i,l,o)=>{let c=i.querySelectorAll(".rule-form-ulist > li"),u=this.getTemplateData();return l&&(u.uuid=o.uuid),c.forEach(p=>{let h=Reflect.get(p,"__formConfig__"),m=Reflect.get(h,"attributes"),w=Reflect.get(p,O),k=Reflect.get(m,ue),C=Reflect.get(m,me),A=w.get(k,C);Reflect.has(u,k)?Reflect.set(u,k,A):Reflect.has(u.data,k)?Reflect.set(u.data,k,A):g.error(`${k}不在数据中`);}),i.querySelectorAll(".rule-form-ulist-dynamic__inner-container").forEach(p=>{let h={};p.querySelectorAll(".dynamic-forms > li").forEach(m=>{let w=Reflect.get(m,"__formConfig__");if(!w)return;let k=Reflect.get(w,"attributes");if(!k)return;let C=Reflect.get(m,O),A=Reflect.get(k,ue),$=Reflect.get(k,me),R=C.get(A,$);Reflect.set(h,A,R);}),u.dynamicData.push(h);}),u.name.trim()===""?(f.error("规则名称不能为空"),{success:false,data:u}):u.data.url.trim()===""?(f.error("匹配网址不能为空"),{success:false,data:u}):u.data.searchValue.trim()===""||Array.isArray(u.dynamicData)&&u.dynamicData.findIndex(p=>p.searchValue.trim()==="")!==-1?(f.error("字符规则不能为空"),{success:false,data:u}):l?{success:this.updateData(u),data:u}:{success:this.addData(u),data:u}}},ruleDelete:{enable:true,deleteCallBack:i=>e.deleteData(i)}},data:()=>this.getData(),getAddData:()=>n(),getData:i=>this.getData().find(c=>c.uuid===i.uuid)??i,getDataItemName:i=>i.name??i.data.url,updateData:i=>this.updateData(i),deleteData:i=>this.deleteData(i)}}},getUrlMatchedRule(a=true,e=window.location.href){let t=this.getData(),n=ae.getAllSubscribeRule(a);return t=t.concat(n),t.filter(r=>{if(!(a&&!r.enable))return !!e.match(r.data.url)})},getMappingData(a=window.location.href){let e=this.getUrlMatchedRule(true,a),t=[];return e.forEach(n=>{try{let r=Array.isArray(n.dynamicData)?[...n.dynamicData].concat(n.data):[n.data];for(let s=0;s<r.length;s++){const i=r[s];i.isRegExp?t.push({searchValue:new RegExp(i.searchValue,i.regExpFlag),replaceValue:i.replaceValue}):t.push({searchValue:i.searchValue,replaceValue:i.replaceValue});}}catch(r){g.error("字符映射规则转换发生错误：",r);}}),t},getData(){return re(this.$data.STORAGE_KEY,[])},setData(a){de(this.$data.STORAGE_KEY,a);},addData(a){let e=this.getData();return e.findIndex(n=>n.uuid==a.uuid)===-1?(e.push(a),de(this.$data.STORAGE_KEY,e),true):false},updateData(a){let e=this.getData(),t=e.findIndex(r=>r.uuid==a.uuid),n=false;return t!==-1&&(n=true,e[t]=a),this.setData(e),n},deleteData(a){let e=this.getData(),t=e.findIndex(r=>r.uuid==a.uuid),n=false;return t!==-1&&(n=true,e.splice(t,1)),this.setData(e),n},clearData(){mt(this.$data.STORAGE_KEY);},exportRule(a="rule.json",e="rule-subscribe.json"){let t=G.alert({title:{text:"请选择导出方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="only-export-rule-list">导出规则</div>
                    <div class="btn-control" data-mode="export-to-subscribe">导出订阅规则</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(i,l){i.close();}}},mask:{enable:true},drag:true,width:j.info.width,height:j.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),n=t.$shadowRoot.querySelector(".btn-control[data-mode='only-export-rule-list']"),r=t.$shadowRoot.querySelector(".btn-control[data-mode='export-to-subscribe']"),s=(i,l)=>{let o=new Blob([JSON.stringify(l,null,4)]),c=window.URL.createObjectURL(o),u=document.createElement("a");u.href=c,u.download=i,u.click(),setTimeout(()=>{window.URL.revokeObjectURL(c);},1500);};b.on(n,"click",i=>{d.preventEvent(i);try{let l=this.getData();if(l.length===0){f.warning("规则为空，无需导出");return}s(a,l),t.close();}catch(l){f.error(l.toString(),{consoleLogContent:true});}}),b.on(r,"click",i=>{d.preventEvent(i);const l=this;t.close();try{if(this.getData().length===0){f.warning("规则为空，无需导出");return}let c=B.config.PanelHandlerComponents(),u=function(v){return {get(_,S){return v[_]??S},set(_,S){v[_]=S,pt.set(l.$data.EXPORT_CONFIG_KEY,v);}}},p=()=>{let v=pt.get(this.$data.EXPORT_CONFIG_KEY,{});if(v?.title===""||v.title==null){f.error("订阅标题不能为空");return}if(v.version==null){f.error("版本号不能为空");return}else v.version=Number(v.version);v.homePage==null&&(v.homePage=void 0),v.lastModified=Date.now(),v.ruleData=this.getData(),s(e,v),h.close();},h=G.alert({title:{text:"请填写导出配置",position:"center"},content:{text:`
							
						`,html:!0},btn:{ok:{enable:!0,text:"导出",callback(v,_){p();}},close:{enable:!0,callback(v,_){v.close();}}},mask:{enable:!0},drag:!0,width:j.info.width,height:j.info.height,style:`
						${B.config.cssText.panelCSS}

						.pops-alert-content li{
							list-style-type: none;
							display: flex;
							align-items: center;
							justify-content: space-between;
							margin: 10px;
						}
					`}),m=h.$shadowRoot.querySelector(".pops-alert-content"),w=pt.get(this.$data.EXPORT_CONFIG_KEY,{}),k=W("订阅标题","title","","",void 0,"");Reflect.set(k.props,O,u(w));let C=c.createSectionContainerItem_input(k),A=W("版本号","version","","",void 0,"",!1);Reflect.set(A.props,O,u(w));let $=c.createSectionContainerItem_input(A),R=W("主页地址","homePage","","",void 0,"选填");Reflect.set(R.props,O,u(w));let I=c.createSectionContainerItem_input(R);b.append(m,C),b.append(m,$),b.append(m,I);}catch(o){f.error(o.toString(),{consoleLogContent:true});}});},importRule(a){let e=G.alert({title:{text:"请选择导入方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="local">本地导入</div>
                    <div class="btn-control" data-mode="network">网络导入</div>
                    <div class="btn-control" data-mode="clipboard">剪贴板导入</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(l,o){l.close();}}},mask:{enable:true},drag:true,width:j.info.width,height:j.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
            `}),t=e.$shadowRoot.querySelector(".btn-control[data-mode='local']"),n=e.$shadowRoot.querySelector(".btn-control[data-mode='network']"),r=e.$shadowRoot.querySelector(".btn-control[data-mode='clipboard']"),s=l=>{let o=this.getData(),c=[];for(let u=0;u<l.length;u++){const p=l[u];o.findIndex(m=>m.uuid===p.uuid)!==-1||c.push(p);}o=o.concat(c),this.setData(o),f.success(`共 ${l.length} 条规则，新增 ${c.length} 条`),a?.();},i=l=>new Promise(o=>{let c=d.toJSON(l);if(!Array.isArray(c)){g.error(c),f.error("导入失败，格式不符合（不是数组）",{consoleLogContent:true}),o(false);return}if(!c.length){f.error("导入失败，解析出的数据为空",{consoleLogContent:true}),o(false);return}s(c),o(true);});b.on(t,"click",l=>{d.preventEvent(l),e.close();let o=b.createElement("input",{type:"file",accept:".json"});b.on(o,["propertychange","input"],c=>{if(!o.files?.length)return;let u=o.files[0],p=new FileReader;p.onload=()=>{i(p.result);},p.readAsText(u,"UTF-8");}),o.click();}),b.on(n,"click",l=>{d.preventEvent(l),e.close();let o=G.prompt({title:{text:"网络导入",position:"center"},content:{text:"",placeholder:"请填写URL",focus:true},btn:{close:{enable:true,callback(p,h){p.close();}},ok:{text:"导入",callback:async(p,h)=>{let m=p.text;if(d.isNull(m)){f.error("请填入完整的url");return}let w=f.loading("正在获取配置..."),k=await M.get(m,{allowInterceptConfig:false});if(w.close(),!k.status){g.error(k),f.error("获取配置失败",{consoleLogContent:true});return}await i(k.data.responseText)&&p.close();}},cancel:{enable:false}},mask:{enable:true},drag:true,width:j.info.width,height:"auto"}),c=o.$shadowRoot.querySelector("input"),u=o.$shadowRoot.querySelector(".pops-prompt-btn-ok");b.on(c,["input","propertychange"],p=>{b.val(c)===""?b.attr(u,"disabled","true"):b.removeAttr(u,"disabled");}),b.listenKeyboard(c,"keydown",(p,h,m)=>{p==="Enter"&&m.length===0&&b.val(c)!==""&&d.dispatchEvent(u,"click");}),d.dispatchEvent(c,"input");}),b.on(r,"click",async l=>{d.preventEvent(l),e.close();let o=await d.getClipboardInfo();if(o.error!=null){f.error(o.error.toString());return}if(o.content.trim()===""){f.warning("获取到的剪贴板内容为空");return}await i(o.content);});}},K=new Et({STORAGE_API_KEY:"websiteRule",STORAGE_KEY:"rule-subscribe"});class ba{option;storageApi;constructor(e){this.option=e,this.storageApi=new Fe(e.STORAGE_API_KEY);}getAllSubscribe(){return this.storageApi.get(this.option.STORAGE_KEY,[])}getAllSubscribeRule(e=false){let t=this.getAllSubscribe(),n=[];for(let r=0;r<t.length;r++){const s=t[r];if(!(e&&!s.data.enable))for(let i=0;i<s.subscribeData.ruleData.length;i++){const l=s.subscribeData.ruleData[i];e&&!l.setting.enable||(l.subscribeUUID=s.uuid,n.push(l));}}return n}getSubscribe(e){return this.getAllSubscribe().find(n=>n.uuid==e)}getSubscribeRule(e,t){let n=this.getSubscribe(e);if(n)return n.subscribeData.ruleData.find(s=>s.key===t)}deleteAllSubscribe(){this.storageApi.delete(this.option.STORAGE_KEY);}deleteSubscribe(e){let t=typeof e=="string"?e:e.uuid,n=this.getAllSubscribe(),r=n.findIndex(s=>s.uuid===t);return r!==-1&&(n.splice(r,1),this.storageApi.set(this.option.STORAGE_KEY,n)),r!==-1}clearSubscribe(e){let t=typeof e=="string"?e:e.uuid,n=this.getAllSubscribe(),r=n.findIndex(s=>s.uuid===t);return r!==-1?(n[r].subscribeData.ruleData=[],this.storageApi.set(this.option.STORAGE_KEY,n),true):false}addSubscribe(e){let t=false,n=this.getAllSubscribe();return n.findIndex(s=>s.uuid===e.uuid)===-1&&(n.push(e),t=true),t&&this.storageApi.set(this.option.STORAGE_KEY,n),t}updateSubscribe(e){let t=false,n=this.getAllSubscribe(),r=n.findIndex(s=>s.uuid===e.uuid);return r!==-1&&(n[r]=e,t=true),t&&this.storageApi.set(this.option.STORAGE_KEY,n),t}updateSubscribeRule(e,t){let n=false,r=this.getAllSubscribe(),s=r.find(i=>i.uuid===e);if(s){let i=s.subscribeData.ruleData.findIndex(l=>l.key===t.key);i!==-1&&(s.subscribeData.ruleData[i]=t,n=true);}return n&&this.storageApi.set(this.option.STORAGE_KEY,r),true}deleteSubscribeRule(e,t){let n=false,r=typeof t=="string"?t:t.key,s=this.getAllSubscribe(),i=s.findIndex(l=>l.uuid===e);if(i!==-1){let o=s[i].subscribeData.ruleData.findIndex(c=>c.key===r);o!==-1&&(s[i].subscribeData.ruleData.splice(o,1),this.storageApi.set(this.option.STORAGE_KEY,s),n=true);}return n}async getSubscribeInfo(e){let t=await M.get(e,{allowInterceptConfig:false,timeout:1e4,headers:{"User-Agent":d.getRandomPCUA()}});if(!t.status)return g.error(t),{data:null,msg:"获取订阅信息失败"};let n=t.data.responseText,r=d.toJSON(n);return typeof r.title=="string"&&typeof r.version=="number"&&typeof r.lastModified=="number"&&Array.isArray(r.ruleData)?{data:{uuid:d.generateUUID(),subscribeData:r,data:{enable:true,url:e,latestUpdateTime:Date.now(),updateFailedTime:null}},msg:""}:(g.error(r),{data:null,msg:"订阅链接的内容格式不正确"})}async updateAllSubscribe(){let e=this.getAllSubscribe();for(let t=0;t<e.length;t++){const n=e[t];if(!n.data.enable||typeof n.data.updateFailedTime=="number"&&d.formatTime(n.data.updateFailedTime,"yyyyMMdd")===d.formatTime(Date.now(),"yyyyMMdd")||typeof n.data.latestUpdateTime=="number"&&d.formatTime(Date.now(),"yyyyMMdd")===d.formatTime(n.data.latestUpdateTime,"yyyyMMdd"))continue;let r=await this.getSubscribeInfo(n.data.url),s=false;if(r.data){let i=r.data;i.uuid=n.uuid,i.data=n.data,i.data.latestUpdateTime=Date.now();let l=i.data.title||i.subscribeData.title||i.data.url;n.data.updateFailedTime=null,s=this.updateSubscribe(i),s?g.success(`更新订阅成功：${l}`):g.error(`更新订阅失败：${l}`,n);}else g.error("更新订阅失败："+r.msg,n);s||(n.data.updateFailedTime=Date.now(),this.updateSubscribe(n));}}importSubscribe(e){let t=G.alert({title:{text:"请选择导入方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="local">本地导入</div>
                    <div class="btn-control" data-mode="network">网络导入</div>
                    <div class="btn-control" data-mode="clipboard">剪贴板导入</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(o,c){o.close();}}},mask:{enable:true},drag:true,width:j.info.width,height:j.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),n=t.$shadowRoot.querySelector(".btn-control[data-mode='local']"),r=t.$shadowRoot.querySelector(".btn-control[data-mode='network']"),s=t.$shadowRoot.querySelector(".btn-control[data-mode='clipboard']"),i=o=>{let c=this.getAllSubscribe(),u=[];for(let p=0;p<o.length;p++){const h=o[p];c.findIndex(w=>w.uuid===h.uuid)!==-1||u.push(h);}c=c.concat(u),this.storageApi.set(this.option.STORAGE_KEY,c),f.success(`共 ${o.length} 条订阅，新增 ${u.length} 条`),e?.();},l=o=>new Promise(c=>{let u=d.toJSON(o);if(!Array.isArray(u)){g.error(u),f.error("导入失败，格式不符合（不是数组）",{consoleLogContent:true}),c(false);return}if(!u.length){f.error("导入失败，解析出的数据为空",{consoleLogContent:true}),c(false);return}let p=u[0];if(!(typeof p.data=="object"&&p.data!=null&&typeof p.subscribeData=="object"&&p.subscribeData!=null&&typeof p.uuid=="string")){f.error("导入失败，解析的格式不符合",{consoleLogContent:true}),c(false);return}i(u),c(true);});b.on(n,"click",o=>{d.preventEvent(o),t.close();let c=b.createElement("input",{type:"file",accept:".json"});b.on(c,["propertychange","input"],u=>{if(!c.files?.length)return;let p=c.files[0],h=new FileReader;h.onload=()=>{l(h.result);},h.readAsText(p,"UTF-8");}),c.click();}),b.on(r,"click",o=>{d.preventEvent(o),t.close();let c=G.prompt({title:{text:"网络导入",position:"center"},content:{text:"",placeholder:"请填写URL",focus:true},btn:{close:{enable:true,callback(h,m){h.close();}},ok:{text:"导入",callback:async(h,m)=>{let w=h.text;if(d.isNull(w)){f.error("请填入完整的url");return}let k=f.loading("正在获取配置..."),C=await M.get(w,{allowInterceptConfig:false});if(k.close(),!C.status){g.error(C),f.error("获取配置失败",{consoleLogContent:true});return}await l(C.data.responseText)&&h.close();}},cancel:{enable:false}},mask:{enable:true},drag:true,width:j.info.width,height:"auto"}),u=c.$shadowRoot.querySelector("input"),p=c.$shadowRoot.querySelector(".pops-prompt-btn-ok");b.on(u,["input","propertychange"],h=>{b.val(u)===""?b.attr(p,"disabled","true"):b.removeAttr(p,"disabled");}),b.listenKeyboard(u,"keydown",(h,m,w)=>{h==="Enter"&&w.length===0&&b.val(u)!==""&&d.dispatchEvent(p,"click");}),d.dispatchEvent(u,"input");}),b.on(s,"click",async o=>{d.preventEvent(o),t.close();let c=await d.getClipboardInfo();if(c.error!=null){f.error(c.error.toString());return}if(c.content.trim()===""){f.warning("获取到的剪贴板内容为空");return}await l(c.content);});}exportSubscribe(e="rule.json"){let t=G.alert({title:{text:"请选择导出方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="only-export-rule-list">导出订阅</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(s,i){s.close();}}},mask:{enable:true},drag:true,width:j.info.width,height:j.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),n=t.$shadowRoot.querySelector(".btn-control[data-mode='only-export-rule-list']"),r=(s,i)=>{let l=new Blob([JSON.stringify(i,null,4)]),o=window.URL.createObjectURL(l),c=document.createElement("a");c.href=o,c.download=s,c.click(),setTimeout(()=>{window.URL.revokeObjectURL(o);},1500);};b.on(n,"click",s=>{d.preventEvent(s);try{let i=this.getAllSubscribe();if(i.length===0){f.warning("订阅为空，无需导出");return}r(e,i),t.close();}catch(i){f.error(i.toString(),{consoleLogContent:true});}});}}const ee=new ba({STORAGE_API_KEY:"userRule",STORAGE_KEY:"rule-subscribe"}),Je={init(){this.updateAllSubscribe();},getPanelView(a=0){let e={title:"规则管理器",contentConfig:[le.getRulePanelViewOption(),ye.getRulePanelViewOption(),ct.getRulePanelViewOption()]};return e.contentConfig=e.contentConfig.map((n,r)=>(typeof a=="number"&&a===r||typeof a=="string"&&a===n.title?n.isDefault=true:n.isDefault=false,n)),new $t(e)},showView(a){this.getPanelView(a).showView();},updateAllSubscribe(){ee.updateAllSubscribe(),K.updateAllSubscribe(),ae.updateAllSubscribe();}},je={depthQueryShadowRootAllNode(a){let e=[];function t(n){let r=Array.from(n.querySelectorAll("*"));return r.forEach(s=>{if(s.classList&&s.classList.contains("pops-shadow-container"))return;let i=s.shadowRoot;i&&i instanceof ShadowRoot&&e.push({shadowRoot:i,childNode:t(i)});}),r}return t(a),e},ignoreStrRemove(a,e=false){let t=[];return t.length&&t.forEach(n=>{if(n!=null)if(e)n.innerHTML!=null&&(a=a.replaceAll(n.innerHTML,""));else {let r=n.innerText||n.textContent;r!=null&&(r=r.replaceAll(r,""));}}),a},getPageText(a=document.documentElement,e){let t=[];if(t.push(a?.textContent||a?.innerText||""),e){let n=this.depthQueryShadowRootAllNode(a);n.length&&n.forEach(r=>{let s=r.shadowRoot.textContent;s&&t.push(s);});}return t=t.filter(n=>n!==""),t},getPageHTML(a=document.documentElement,e){let t=[];if(t.push(a.innerHTML),e){let n=this.depthQueryShadowRootAllNode(a);n.length&&n.forEach(r=>{let s=r.shadowRoot.innerHTML;s&&t.push(s);});}return t=t.filter(n=>n!==""),t},getInputElementValue(a=document.documentElement,e){let t=[];if(Array.from(a.querySelectorAll("input")).forEach(n=>{t.push(n.value);}),e){let n=this.depthQueryShadowRootAllNode(a);n.length&&n.forEach(r=>{for(let s=0;s<r.childNode.length;s++){const i=r.childNode[s];i instanceof HTMLInputElement&&i.value&&t.push(i.value);}});}return t},getTextAreaElementValue(a=document.documentElement,e){let t=[];if(Array.from(a.querySelectorAll("textarea")).forEach(n=>{t.push(n.value);}),e){let n=this.depthQueryShadowRootAllNode(a);n.length&&n.forEach(r=>{for(let s=0;s<r.childNode.length;s++){const i=r.childNode[s];i instanceof HTMLTextAreaElement&&i.value&&t.push(i.value);}});}return t},getSelectContent(){let a={text:"",html:""},e=window.getSelection();if(e){a.text=e.toString();let t=b.createElement("div");if(!e.isCollapsed){const n=e.getRangeAt(0).cloneContents();t.appendChild(n),a.html=b.html(t);}}return a}},wa=`.whitesevPopNetDiskHistoryMatch .pops-confirm-content {\r
	display: flex;\r
	flex-direction: column;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content ul {\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content li {\r
	display: flex;\r
	flex-direction: column;\r
	justify-content: center;\r
	border-radius: 10px;\r
	box-shadow: 0 0.3px 0.6px rgb(0 0 0 / 6%), 0 0.7px 1.3px rgb(0 0 0 / 8%), 0 1.3px 2.5px rgb(0 0 0 / 10%),\r
		0 2.2px 4.5px rgb(0 0 0 / 12%), 0 4.2px 8.4px rgb(0 0 0 / 14%), 0 10px 20px rgb(0 0 0 / 20%);\r
	margin: 20px 10px;\r
	padding: 10px;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-search {\r
	/*height: 11%;*/\r
	flex: 0;\r
	padding: 5px 0px;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-table {\r
	/*height: calc(85% - 40px);*/\r
	overflow: auto;\r
	flex: 1;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-page {\r
	display: flex;\r
	justify-content: center;\r
	align-items: center;\r
	/*margin-top: 10px;*/\r
	flex: 0;\r
	padding: 5px 0px;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-search input {\r
	border: none;\r
	border-bottom: 1px solid #000000;\r
	padding: 0px 5px;\r
	line-height: normal;\r
	width: -moz-available;\r
	width: -webkit-fill-available;\r
	width: fill-available;\r
	margin: 5px 5px 0px 5px;\r
	background: none;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-search input:focus-visible {\r
	outline: none;\r
	border-bottom: 1px solid #0009ff;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link {\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link a {\r
	color: #ff4848;\r
	font-size: 0.8em;\r
	border: none;\r
	word-break: break-word;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link a[isvisited="true"] {\r
	color: #8b8888;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-icon {\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-icon .netdisk-icon-img {\r
	width: 28px;\r
	height: 28px;\r
	min-width: 28px;\r
	min-height: 28px;\r
	font-size: 0.8em;\r
	border-radius: 10px;\r
	box-shadow: 0 0.3px 0.6px rgb(0 0 0 / 6%), 0 0.7px 1.3px rgb(0 0 0 / 8%), 0 1.3px 2.5px rgb(0 0 0 / 10%),\r
		0 2.2px 4.5px rgb(0 0 0 / 12%), 0 4.2px 8.4px rgb(0 0 0 / 14%), 0 10px 20px rgb(0 0 0 / 20%);\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-url {\r
	color: #000;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-top-url {\r
	color: #000;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-functions button.btn-delete {\r
	background: #263cf3;\r
	color: #fff;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-functions button.btn-delete:active {\r
	background: #6e7be8;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-icon,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-url,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-top-url,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-add-time,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-update-time,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-url-title,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-functions {\r
	display: flex;\r
	margin: 5px 0px;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-icon p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-url p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-top-url p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-add-time p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-update-time p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-url-title p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-functions p {\r
	min-width: 80px;\r
	max-width: 80px;\r
	align-self: center;\r
}\r
`,ut={storageKey:"netDiskHistoryMatch",isSetOtherEvent:false,dataPaging:void 0,show(){let a=this.getStorageData(),e="",t=this;a=this.orderNetDiskHistoryMatchData(a),e=`
        <div class="netdiskrecord-search">
            <input type="text" placeholder="搜索链接/网址/网址标题，按下回车进行搜索（可正则）">
        </div>
        <div class="netdiskrecord-table">
			<ul></ul>
		</div>
        <div class="netdiskrecord-page">

        </div>`,x.Alias.historyAlias=G.confirm({title:{text:"历史匹配记录",position:"center"},content:{text:e,html:true},btn:{reverse:true,position:"space-between",close:{callback(n){n.close(),x.Alias.historyAlias=void 0;}},ok:{enable:false,callback(n){n.close(),x.Alias.historyAlias=void 0;}},cancel:{enable:true,text:"关闭",callback(n){n.close(),x.Alias.historyAlias=void 0;}},other:{enable:true,text:`清空所有(${a.length})`,type:"xiaomi-primary",callback:()=>{G.confirm({title:{text:"删除",position:"center"},content:{text:"确定清空所有的记录？",html:false},btn:{ok:{enable:true,callback(n){t.clearStorageData(),t.clearLinkElements(),t.clearPageNavigator(),n.close();let r=x.Alias.historyAlias.$shadowRoot.querySelector(".netdiskrecord-page"),s=x.Alias.historyAlias.$shadowRoot.querySelector(".pops-confirm-btn-other");b.html(r,""),b.text(s,b.text(s).replace(/[\d]+/gi,"0"));}},cancel:{text:"取消",enable:true}}});}}},mask:{clickCallBack(n){n(),x.Alias.historyAlias=null;}},class:"whitesevPopNetDiskHistoryMatch",style:wa},x.popsStyle.historyMatchView),this.addLinkElements(a.slice(0,9)),this.setDataPaging(a),this.setEvent(x.Alias.historyAlias.$shadowRoot),this.setSearchEvent(),rt.setRightClickMenu(x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch"),".netdiskrecord-link a",true);},getLinkContainer(){return x.Alias.historyAlias.$shadowRoot.querySelector(".netdiskrecord-table ul")},addLinkElements(a){Array.isArray(a)||(a=[a]);let e=document.createDocumentFragment();for(let n=0;n<a.length;n++){let r=a[n],s=this.createLinkItemElementInfo(r);e.appendChild(s.$liItemContainer);}this.getLinkContainer().appendChild(e);},createLinkItemElementInfo(a){let e=L.handleLinkShow({ruleKeyName:a.ruleKeyName,ruleIndex:a.ruleIndex,shareCode:a.shareCode,accessCode:a.accessCode,matchText:a.matchText}),t=b.createElement("li",{innerHTML:`
			<div class="netdiskrecord-link">
				<p>链接</p>
				<a  href="javascript:;" isvisited="false">${e}</a>
			</div>
			<div class="netdiskrecord-icon">
				<p>网盘</p>
				<div class="netdisk-icon-img"></div>
			</div>
			<div class="netdiskrecord-url">
				<p>网址</p>
				<a href="${a.url}" target="_blank">${a.url}</a>
			</div>
			<div class="netdiskrecord-url-title">
				<p>网址标题</p>
				${a.title}
			</div>
			<div class="netdiskrecord-add-time">
				<p>记录时间</p>
				${d.formatTime(a.addTime)}
			</div>
			<div class="netdiskrecord-update-time">
				<p>更新时间</p>
				${d.formatTime(a.updateTime)}
			</div>
			<div class="netdiskrecord-functions">
				<p>功能</p>
				<button class="btn-delete" type="button">删除</button>
			</div>
			`}),n=t.querySelector(".netdiskrecord-link"),r=n.querySelector("a"),s=t.querySelector(".netdiskrecord-icon"),i=t.querySelector(".netdisk-icon-img"),l=t.querySelector(".netdiskrecord-url"),o=t.querySelector(".netdiskrecord-url-title"),c=t.querySelector(".netdiskrecord-add-time"),u=t.querySelector(".netdiskrecord-update-time"),p=t.querySelector(".netdiskrecord-functions"),h=p.querySelector(".btn-delete");if(ce.handleElementAttributeRuleInfo({ruleKeyName:a.ruleKeyName,ruleIndex:a.ruleIndex,shareCode:a.shareCode,accessCode:a.accessCode},r),i.style.cssText=`background: url(${x.src.icon[a.ruleKeyName]}) no-repeat;background-size:100%`,a.url!==a.topURL){let m=b.createElement("div",{className:"netdiskrecord-top-url",innerHTML:`
				<p>Top网址</p>
				<a href="${a.topURL}" target="_blank">${a.topURL}</a>
				`});b.after(l,m);}return h.setAttribute("data-json",JSON.stringify(a)),Reflect.set(h,"data-json",a),{$liItemContainer:t,$link:n,$linkAnchor:r,$icon:s,$iconImg:i,$url:l,$urlTitle:o,$addTime:c,$updateTime:u,$features:p,$featuresBtnDelete:h,html:t.outerHTML}},clearLinkElements(){let a=this.getLinkContainer();b.empty(a);},clearPageNavigator(){b.remove(x.Alias.historyAlias.$shadowRoot.querySelectorAll(".netdiskrecord-page > *"));},setEvent(a){let e=this;x.view.setNetDiskUrlClickEvent(a,".netdiskrecord-link a"),b.on(a,"click",".netdiskrecord-functions button.btn-delete",function(t){let n=a.querySelector(".pops-confirm-btn-other"),r=G.loading({parent:e.getLinkContainer(),content:{text:"删除中..."},only:true,addIndexCSS:false}),s=t.target,i=s.getAttribute("data-json");s.closest("li")?.remove(),e.deleteStorageData(i),r?.close();let l=b.text(n),o=l.match(/[\d]+/gi),c=parseInt(o[o.length-1]);c--,l=l.replace(/[\d]+/gi,c.toString()),b.text(n,l);let u=e.getStorageData();u=e.orderNetDiskHistoryMatchData(u),e.dataPaging.refresh(u),e.pageChangeCallBack(u,e.dataPaging.CONFIG.currentPage);});},pageChangeCallBack(a,e){let t=(e-1)*10,n=a.slice(t,t+9);this.clearLinkElements(),this.addLinkElements(n);},setDataPaging(a){let e=this,t=new Yt({data:a,pageCount:10,pageStep:B.isPhone()?2:4,currentPage:1,pageChangeCallBack:function(n){e.pageChangeCallBack(a,n);}});this.dataPaging=t,t.addCSS(x.Alias.historyAlias.$shadowRoot),t.append(x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-page"));},setSearchEvent(){let a=false,e,t=this;function n(){if(a)return;a=true,e=G.loading({parent:t.getLinkContainer(),content:{text:"搜索中..."},only:true,addIndexCSS:false});let r=x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-search input").value.trim(),s=t.getStorageData();if(s=t.orderNetDiskHistoryMatchData(s),r===""){t.clearLinkElements(),t.clearPageNavigator(),t.addLinkElements(s.slice(0,9)),e?.close(),a=false,t.setDataPaging(s);return}g.info("历史匹配记录-搜索："+r);let i=s.filter(l=>{let o=L.handleLinkShow({ruleKeyName:l.ruleKeyName,ruleIndex:l.ruleIndex,shareCode:l.shareCode,accessCode:l.accessCode,matchText:l.matchText,showToast:false});o||g.info(l);let c=d.stringToRegular(r,"i");if(typeof o=="string"&&o.match(c)||l.shareCode.match(c)||l.url.match(c)||l.topURL.match(c)||l.title.match(c))return  true});t.clearLinkElements(),t.clearPageNavigator(),t.addLinkElements(i),e?.close(),e=void 0,a=false;}b.listenKeyboard(x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-search input"),"keypress",r=>{r==="Enter"&&n();});},orderNetDiskHistoryMatchData(a){let e=y.historyMatch["netdisk-history-match-ordering-rule"].value,t=e.indexOf("降序")!==-1,n=e.indexOf("记录时间")!==-1?"addTime":"updateTime";return d.sortListByProperty(a,r=>r[n],t),a},queryAccessCode(a,e,t){let n=this.getStorageData();for(let r=0;r<n.length;r++){const s=n[r];if(s.ruleKeyName===a&&s.shareCode===e)return t&&d.isNotNull(s.accessCode),s.accessCode}},syncAccessCode(a,e,t,n){if(y.historyMatch.saveMatchNetDisk.value){if(ut.changeMatchedDataAccessCode(a,e,t,n))return g.success("已成功同步访问码至历史匹配记录"),true;g.error("同步访问码至历史匹配记录失败");}return  false},changeMatchedDataAccessCode(a,e,t,n){let r=this.getStorageData(),s=false;for(let i=0;i<r.length;i++){const l=r[i];l.ruleKeyName===a&&String(l.ruleIndex)===String(e)&&l.shareCode===t&&(s=true,r[i].accessCode=n,r[i].updateTime=Date.now());}return s&&this.saveStorageData(r),s},changeMatchedData(a,e,t,n,r){if(!y.historyMatch.saveMatchNetDisk.value)return  false;let s=this.getStorageData(),i=false;for(let l=0;l<s.length;l++){const o=s[l];if(o.ruleKeyName===a&&t.startsWith(o.shareCode)&&o.ruleIndex===e&&(y.historyMatch["netdisk-history-match-merge-same-link"].value||o.url===window.location.href&&o.topURL===top.window.location.href)){i=true;let c=false;if(r.trim()!==""&&o.matchText!==r&&(c=true,g.success("匹配历史记录 -> 设置新的matchText",[r]),s[l].matchText=r),d.isNotNull(n)&&o.accessCode!==n&&(c=true,g.success("匹配历史记录 -> 修改accessCode"),s[l].accessCode=n),c){s[l].updateTime=Date.now(),s[l].title&&(s[l].title=document.title),y.historyMatch["netdisk-history-match-merge-same-link"].value&&(s[l].url=window.location.href,s[l].topURL=top.window.location.href);break}}}if(!i){i=true,g.success("匹配历史记录 -> 增加新的");let l=Date.now();s=[...s,{url:window.location.href,topURL:top.window.location.href,ruleKeyName:a,ruleIndex:e,shareCode:t,accessCode:n,addTime:l,updateTime:l,title:document.title||top.document.title,matchText:r}];}return this.saveStorageData(s),true},checkAndRepairLocalData(){let a=0,e=re(this.storageKey);if(Array.isArray(e))for(let t=0;t<e.length;t++){let n=false;const r=e[t];typeof r.matchText!="string"&&(r.matchText="",n=true),typeof r.ruleKeyName!="string"&&typeof r.netDiskName=="string"&&(r.ruleKeyName=r.netDiskName,delete r.netDiskName,n=true),typeof r.ruleIndex!="number"&&typeof r.netDiskIndex=="number"&&(r.ruleIndex=r.netDiskIndex,delete r.netDiskIndex,n=true),n&&a++;}else e=[];return this.saveStorageData(e),{count:e.length,repairCount:a}},getStorageData(){let a=re(this.storageKey,[]);return a==null&&(a=[],this.saveStorageData(a)),a},saveStorageData(a){de(this.storageKey,a);},deleteStorageData(a){let e=false,t=this.getStorageData();for(let n=0;n<t.length;n++)if(JSON.stringify(t[n])===a){g.success("删除 ===> ",t[n]),t.splice(n,1),e=true;break}return e&&this.saveStorageData(t),e},clearStorageData(){this.saveStorageData([]);}},tt={addHost(a){let e=this.getList();e.includes(a)||e.push(a),this.updateList(e);},findHost(a){return this.getList().findIndex(n=>n===a)!==-1},removeHost(a){let e=this.getList(),t=false,n=e.findIndex(r=>r===a);return n!==-1&&(t=true,e.splice(n,1),this.updateList(e)),t},getList(){let a=re(U.neverTipWorkerInitErrorKey,[]);return Array.isArray(a)||(a=[a]),a},updateList(a){de(U.neverTipWorkerInitErrorKey,a);}},ka={$data:{ajaxHooker:null},execMatch(a){y.match.toBeMatchedXhrHookResponseText.value&&(this.$data.ajaxHooker||(this.$data.ajaxHooker=d.ajaxHooker(),this.$data.ajaxHooker.hook(e=>{e.response=t=>{typeof t.responseText=="string"&&U.postMessage({...a,textList:[t.responseText],from:"Xhr"});};})));}},U={isHandleMatch:false,workerInitError:null,neverTipWorkerInitErrorKey:"never-toast-worker-error",delayNotMatchCount:0,postMessageType:"worker-init-error",dispatchMonitorDOMChange:false,blobUrl:"",GM_matchWorker:void 0,init(){this.listenWorkerInitErrorDialog(),this.initWorkerBlobUrl(),this.initWorker(),this.monitorDOMChange();},initWorkerBlobUrl(){const a=`
        (() => {
            function ${U.handleRegularMatch.toString()}

            function ${U.uniqueArr}
            
            this.addEventListener(
            "message",
            function (event) {
                const data = event.data;
                let matchedList = [];
                ${U.handleRegularMatch.name}(data,(matchData)=>{
                	matchedList.push(matchData);
					data.textList = matchData.textList;
                })
                matchedList = ${U.uniqueArr.name}(matchedList);
                this.postMessage({
					options: data,
					msg: "Match End",
					data: matchedList,
					startTime: data.startTime,
					endTime: Date.now(),
                });
            },
            {
                capture: true,
            }
            );
        })();
  		`;let e=new Blob([a],{type:"application/javascript"}),t=globalThis.URL.createObjectURL(e);globalThis.trustedTypes&&typeof globalThis.trustedTypes.createPolicy=="function"&&(t=globalThis.trustedTypes.createPolicy("workerPolicy",{createScriptURL:r=>r}).createScriptURL(t)),U.blobUrl=t;},handleRegularMatch(a,e){const t=Object.keys(a.matchedRuleOption),n=[];for(let r of a.textList){for(let s=0;s<a.characterMapping.length;s++){const i=a.characterMapping[s];try{typeof i.searchValue=="string"?r=r.replaceAll(i.searchValue,i.replaceValue):r=r.replace(i.searchValue,i.replaceValue);}catch{}}n.push(r);}for(const r of t){const s=a.matchedRuleOption[r];for(let i=0;i<s.length;i++){const l=s[i];let o=[];if(a.matchTextRange.includes("innerText")&&o.push(new RegExp(l.link_innerText,"gi")),a.matchTextRange.includes("innerHTML")&&o.push(new RegExp(l.link_innerHTML,"gi")),!a.matchTextRange.length)throw console.error(a),new TypeError("未设置匹配范围");if(!o.length)throw new TypeError("未知的匹配范围: "+a.matchTextRange);for(let c=0;c<o.length;c++){const u=o[c];for(let p=0;p<n.length;p++){let m=n[p].match(u);m&&m.length&&e({ruleKeyName:r,ruleIndex:i,data:m,textList:n});}}}}},uniqueArr(a){return a.filter((e,t,n)=>t===n.findIndex(r=>JSON.stringify(r)===JSON.stringify(e)))},initWorker(){try{U.GM_matchWorker=new Worker(U.blobUrl),U.GM_matchWorker.onmessage=U.onMessage,U.GM_matchWorker.onerror=U.onError,g.info(`Worker Blob Link ===> ${U.blobUrl}`);}catch(a){this.workerInitError=a,U.GM_matchWorker={postMessage(e){return new Promise((t,n)=>{let r=[];try{U.handleRegularMatch(e,s=>{r.push(s),e.textList=s.textList;});}catch(s){U.onError(s);}finally{r=U.uniqueArr(r),U.onMessage(new MessageEvent("message",{data:{options:e,msg:"Match End",data:r,startTime:e.startTime,endTime:Date.now()}})),t(null);}})}};}finally{globalThis.URL.revokeObjectURL(U.blobUrl),U.blobUrl="";}},listenWorkerInitErrorDialog(){if(!J.isTopWindow())return;const a=this;b.on(window,"message",e=>{let t=e.data;if(typeof t=="object"&&t?.type===this.postMessageType){let n=t.data;a.registerWorkerInitErrorNeverTipToast(n.hostname),G.confirm({title:{text:"Worker Init Error",position:"center"},content:{text:`
							<div style="padding: 10px;gap: 10px;display: flex;flex-direction: column;">
								<p>链接：${n.url}</p>
								<p>来源：${J.isTopWindow()?"top":"iframe"}</p>
								<p>原因：初始化Worker失败，可能页面使用了Content-Security-Policy策略，执行匹配时如果页面的内容过大会导致页面卡死，请使用Menu模式进行匹配或者使用CSP插件禁用CSP策略（不建议）。</p>
								<p>
									错误信息：
									<span style="color: red;">${n.error}</span>
								</p>
							</div>
							`,html:true},btn:{merge:true,position:"space-between",ok:{text:"添加网站规则",callback(r,s){let i=ye.getTemplateData();i.name="手动匹配："+n.hostname,i.url=`^http(s|):\\/\\/${n.hostname}\\/`,i.data[y.features["netdisk-match-mode"].KEY]="Menu";let l=new $t({title(){return "规则管理器"},contentConfig:[ye.getRulePanelViewOption(i)]});l.showEditView(l.option.contentConfig[0].ruleOption,void 0,false,i,void 0,void 0,void 0,()=>{f.success("添加成功");});}},cancel:{text:"网站规则",callback(r,s){Je.showView("网站规则");}},other:{enable:true,text:"不再提示",type:"xiaomi-primary",callback(r,s){G.confirm({title:{text:"提示",position:"center"},content:{text:`确定不再弹出该提示？（仅针对域名：${n.hostname}）`},btn:{ok:{callback(i,l){tt.addHost(n.hostname),i.close();}}}},{PC:{width:"400px",height:"200px"},Mobile:{width:"80vw",height:"200px"}});}}}},{PC:{width:"550px",height:"350px"},Mobile:{width:"88vw",height:"500px"}});}});},dispatchWorkerInitErrorDialog(){top?.postMessage({type:this.postMessageType,data:{url:window.location.href,hostname:window.location.hostname,error:this.workerInitError}},"*");},registerWorkerInitErrorNeverTipToast(a){let e="💀 Worker初始化失败",t=()=>tt.findHost(a)?e+"（已设置不再提示）":e,n={key:"workerInitErrorNeverTipToast-"+a,text:t(),autoReload:false,isStoreValue:false,showText:t,callback:()=>{tt.findHost(a)?confirm("是否允许弹出Worker初始化失败的弹窗提示？")&&(tt.removeHost(a)?f.success("删除成功"):f.error("删除失败"),ze.update(n)):this.dispatchWorkerInitErrorDialog();}};ze.update(n);},postMessage(a,e){U.GM_matchWorker.postMessage(a,e);},onMessage(a){const e=a.data;e.data.length,(e.options.from==="PasteText"||e.options.from==="ShortCut-Select-Content")&&x.matchPasteText.workerMatchEndCallBack(e),e.options.from.startsWith("FirstLoad")&&U.delayNotMatchCount++,U.successCallBack(e);},onError(a){U.errorCallBack(a);},successCallBack(a){if(!a.data.length){U.matchingEndCallBack();return}const e=[];for(const n of a.data){L.$match.matchedInfoRuleKey.add(n.ruleKeyName);let r=new Set;n.data.forEach(s=>{r.add(s);}),r.forEach(s=>{let i=L.handleLink({ruleKeyName:n.ruleKeyName,ruleIndex:n.ruleIndex,matchText:s});i&&e.push({shareCode:i.shareCode,accessCode:i.accessCode,ruleKeyName:n.ruleKeyName,ruleIndex:n.ruleIndex,matchText:s});});}let t=e.filter((n,r,s)=>s.findIndex(l=>l.accessCode===n.accessCode&&l.ruleIndex===n.ruleIndex&&l.ruleKeyName===n.ruleKeyName&&l.shareCode===n.shareCode)===r);if(t.forEach(n=>{L.$match.tempMatchedInfo.has(n.ruleKeyName)&&L.$match.tempMatchedInfo.get(n.ruleKeyName).set(n.shareCode,n);}),t.forEach(n=>{let{shareCode:r,accessCode:s,ruleKeyName:i,ruleIndex:l,matchText:o}=n;const u=L.$rule.rule.find(m=>m.setting.key===i).rule[l];let p=false;if(L.$match.blackMatchedInfo.forEach((m,w)=>{if(w!==n.ruleKeyName)return;m.has(r)&&(p=true,g.warn(`匹配到黑名单分享码，已过滤：${r}`,JSON.stringify(n)));}),p)return;if(u.shareCodeExcludeRegular&&Array.isArray(u.shareCodeExcludeRegular))for(const m of u.shareCodeExcludeRegular){let w=L.$match.matchedInfo.get(m),k=L.$match.tempMatchedInfo.get(m);if(w.startsWith(r)||k.startsWith(r)){g.warn(`${i}：该分享码【${r}】与已匹配到该分享码的规则【${m}】冲突`);return}}const h=L.$match.matchedInfo.get(i);if(L.$data.isMatchedLink=true,h.startsWith(r)){let m=h.getStartsWith(r);if(typeof m.isForceAccessCode=="boolean"&&m.isForceAccessCode||d.isNotNull(m.accessCode)||d.isNull(s))return;h.set(r,L.createLinkStorageInst(s,l,false,o)),x.view.changeLinkView(i,l,r,s,o),g.info(`该匹配项无密码，设置密码 ${i} ${l}: ${r}  ===> ${s}`);}else {if(d.isNull(s)&&y.accessCode.allowQueryHistoryMatchingAccessCode.value){let m=ut.queryAccessCode(i,r,true);m&&(g.info("历史匹配记录 ==> 查询到访问码："+m),s=m);}h.set(r,L.createLinkStorageInst(s,l,false,o)),x.isMatchedNetDiskIconMap.add(i),x.view.addLinkView(i,l,r,s,o),g.success(`添加链接 ${i} ${l}: ${r}  ===> ${s}`);}}),Object.keys(L.$match.tempMatchedInfo.getItems()).forEach(n=>{L.$match.tempMatchedInfo.get(n).clear();}),L.$data.isMatchedLink)switch(y.features["netdisk-behavior-mode"].value){case "suspension_smallwindow".toLowerCase():se.mode.current_suspension_smallwindow_mode.value==="suspension"?x.suspension.init():x.view.show();break;case "suspension_window".toLowerCase():x.suspension.init();break;case "smallwindow".toLowerCase():x.view.show();break;default:g.error("未知的行为模式："+y.features["netdisk-behavior-mode"].value);}U.matchingEndCallBack();},errorCallBack(a){U.matchingEndCallBack(true),g.error("Worker Error",a);},matchingEndCallBack(a){if(a)U.isHandleMatch=false,U.delayNotMatchCount>0&&(U.delayNotMatchCount=0,U.dispatchMonitorDOMChange=true);else {const e=parseFloat(y.match.delaytime.value.toString())*1e3;setTimeout(()=>{U.matchingEndCallBack(true);},e);}},monitorDOMChange(){const a=y.match.isAddedNodesToMatch.value,e=y.match.readClipboard.value,t=y.match.pageMatchRange.value;let n=true,r=true,s=true,i=y.match.depthQueryWithShadowRoot.value;const l={},o=ct.getMappingData();L.$rule.rule.forEach(h=>{let m=h.setting.key;Y.function.enable(m)&&(Reflect.has(l,m)?l[m]=[...l[m],...h.rule]:Reflect.set(l,m,h.rule));});async function c(h){if(U.isHandleMatch){U.delayNotMatchCount++;return}if(a&&h&&h.length){let k=false;for(let C=0;C<h.length;C++){const A=h[C];if(A.addedNodes&&A.addedNodes instanceof NodeList&&A.addedNodes.length){k=true;break}}if(!k)return}U.isHandleMatch=true;const m=Date.now();if(e)try{let k=await d.getClipboardInfo();k.error!=null&&(L.$data.clipboardText=k.content);}catch{}typeof L.$data.clipboardText!="string"&&(L.$data.clipboardText="");const w=[];if(d.isNotNull(L.$data.clipboardText)){let k=L.$data.clipboardText;w.push(k);}if(y.match.allowMatchLocationHref.value){let k=ne.getDecodeComponentUrl();w.push(k);}if(n&&(n=false,w.length)){U.postMessage({characterMapping:o,textList:w,matchTextRange:t,matchedRuleOption:l,startTime:m,from:"FirstLoad-DOMChange"});return}if(t.includes("innerText")){let k=je.getPageText(document.documentElement,i);if(w.push(...k),r){r=false,U.postMessage({characterMapping:o,textList:w,matchTextRange:t,matchedRuleOption:l,startTime:m,from:"FirstLoad-Text-DOMChange"});return}}if(t.includes("innerHTML")){let k=je.getPageHTML(document.documentElement,i);if(w.push(...k),s){s=false,U.postMessage({characterMapping:o,textList:w,matchTextRange:t,matchedRuleOption:l,startTime:m,from:"FirstLoad-HTML-DOMChange"});return}}if(y.match.toBeMatchedWithInputElementValue.value){let k=je.getInputElementValue(document.documentElement,i);w.push(...k);}if(y.match.toBeMatchedTextAreaElementValue.value){let k=je.getTextAreaElementValue(document.documentElement,i);w.push(...k);}U.postMessage({characterMapping:o,textList:w,matchTextRange:t,matchedRuleOption:l,startTime:m,from:"DOMChange"});}let u=U.dispatchMonitorDOMChange;Object.defineProperty(U,"dispatchMonitorDOMChange",{set:function(h){if(u=h,h){let m=qt("html");c([{addedNodes:m,attributeName:null,attributeNamespace:null,nextSibling:null,oldValue:null,previousSibling:null,removedNodes:m,target:m[0],type:"attributes"}]);}},get:function(){return u}});let p=y.features["netdisk-match-mode"].value;if(p!=="Menu"){let h=re(this.neverTipWorkerInitErrorKey,[]);if(Array.isArray(h)||(h=[h]),this.workerInitError!=null){g.error("初始化Worker失败，可能页面使用了Content-Security-Policy策略，使用代替函数，该函数执行匹配时如果页面的内容过大会导致页面卡死",this.workerInitError);let m=h.find(w=>w===window.location.hostname);m?this.registerWorkerInitErrorNeverTipToast(m):this.dispatchWorkerInitErrorDialog();}}ka.execMatch({characterMapping:o,matchTextRange:t,matchedRuleOption:l,startTime:Date.now()}),p==="MutationObserver"?(d.mutationObserver(document.documentElement,{callback:c,config:{childList:y.match["mutationObserver-childList"].value,characterData:y.match["mutationObserver-characterData"].value,subtree:y.match["mutationObserver-subtree"].value}}),this.dispatchMonitorDOMChange=true):p==="Menu"?ze.add({key:"performPageTextMatchingManually_"+window.location.href,text:"点击执行文本匹配"+(J.isTopWindow()?"":"（iframe）"),autoReload:false,isStoreValue:false,showText(h){return h},callback:()=>{this.dispatchMonitorDOMChange=true;}}):g.error("未知匹配模式："+p);}},At={$el:{$select:null,$log:null,$matchText:null,$button:null},reset(){Object.keys(this.$el).forEach(a=>{Reflect.deleteProperty(this.$el,a);});},setLog(a,...e){let t="";e.forEach(r=>{t!==""&&(t+=`
`),typeof r!="string"?t+=JSON.stringify(r,void 0,4):t+=r;});let n=b.createElement("p",{innerText:t},{"data-tag":a});b.append(this.$el.$log,n);},clearLog(){b.empty(this.$el.$log);},showUI(a){if(this.reset(),d.isNull(a.regexp)){f.error("请先配置regexp");return}let e=this,n=le.parseRule([a])[0].rule,r=G.confirm({title:{text:`调试规则 ${a.key}`,position:"center"},content:{text:`
                    <div class="custom-rule-container">
                        <textarea class="custom-rule-match-text" placeholder="请输入需要测试匹配的字符串"></textarea>
                        <div class="custom-rule-input-container">
                        <select class="custom-rule-select-regexp"></select>
                        <button class="custom-rule-run-match-button" type="button" data-type="primary" data-icon="" data-righticon="false">
                            <span>执行</span>
                        </button>
                        </div>
                    </div>
                    <div class="custom-rule-match-log">
                        <div>匹配日志↓</div>
                        <div class="custom-rule-match-log-container"></div>
                    </div>
                    `,html:true},btn:{ok:{enable:false}},style:`
                .custom-rule-container{
                    display: flex;
                    align-items: center;
                }
                .custom-rule-select-regexp{
                    width: 100%;
                    height: 32px;
                    line-height: normal;
                    border: 1px solid rgb(184, 184, 184, var(--pops-bd-opacity));
                    border-radius: 5px;
                    text-align: center;
                    outline: 0;
                    background: rgb(255, 255, 255, var(--pops-bg-opacity));
                    box-shadow: none;
                }
                .custom-rule-input-container{
                    display: flex;
                    flex-wrap: wrap;
                    justify-content: center;
                    margin: 5px;
                    width: 30%;
                }
                .custom-rule-select-regexp-item{

                }
                button.custom-rule-run-match-button{
                    margin-top: 5px;
                }
                textarea.custom-rule-match-text{
                    width: 100%;
                    min-height: 70px;
                    outline: none;
                    margin: 0px;
                    background-image: none;
                    background-color: transparent;
                    display: inline-block;
                    resize: vertical;
                    padding: 5px;
                    line-height: normal;
                    box-sizing: border-box;
                    border: 1px solid rgb(220, 223, 230);
                    appearance: none;
                }
                .custom-rule-match-log{

                }
                .custom-rule-match-log-container{
                    padding: 5px;
                    background: rgb(229, 229, 229);
                }
                .custom-rule-match-log-container p{
                    margin: 2px 0px;
                    border-bottom: 1px solid #000000;
                }
                .custom-rule-match-log-container p:last-child{
                    border-bottom: 0px;
                    margin-bottom: 0px;
                }
                .custom-rule-match-log-container p[data-tag]{
                	padding: 10px 0px;
                }
                .custom-rule-match-log-container p[data-tag="info"]{

                }
                .custom-rule-match-log-container p[data-tag="success"]{
                    color: green;
                }
                .custom-rule-match-log-container p[data-tag="warn"]{
                    color: yellow;
                }
                .custom-rule-match-log-container p[data-tag="error"]{
                    color: red;
                }
                `},x.popsStyle.customRuleDebugView);this.$el.$select=r.$shadowRoot.querySelector(".custom-rule-select-regexp"),this.$el.$matchText=r.$shadowRoot.querySelector(".custom-rule-match-text"),this.$el.$log=r.$shadowRoot.querySelector(".custom-rule-match-log-container"),this.$el.$button=r.$shadowRoot.querySelector(".custom-rule-run-match-button"),n.forEach((l,o)=>{this.$el.$select.appendChild(b.createElement("option",{className:"custom-rule-select-regexp-item",innerText:"regexp下标:"+o,"data-value":l}));});function s(l){Array.isArray(l.msg)?e.setLog(l.status?"info":"error",...l.msg):e.setLog(l.status?"info":"error",l.msg),l.status||e.setLog("error","执行完毕");}function i(){try{if(d.isNull(e.$el.$matchText.value)){f.error("请先输入待匹配的字符串");return}e.clearLog();let l=a.key,o=e.$el.$select.selectedIndex,c=e.$el.$select.options[o]["data-value"];g.info("当前选中的规则: ",c);let u={};u[a.key]=[c];let p=[];if(U.handleRegularMatch({characterMapping:ct.getMappingData(),matchedRuleOption:u,textList:[e.$el.$matchText.value],matchTextRange:["innerText","innerHTML"],startTime:Date.now(),from:"Debug"},h=>{p.push(...h.data);}),!p.length){e.setLog("error","未成功匹配到数据");return}p=U.uniqueArr(p),e.setLog("info","成功匹配到的数据 ==> ",p),p.forEach((h,m)=>{e.setLog("success","当前处理的字符串: "+h),e.setLog("success","当前执行: 对shareCode进行处理获取");let w=L.handleShareCode({ruleKeyName:l,ruleIndex:o,matchText:h,debugConfig:{matchText:h,config:c,logCallBack:s}});if(d.isNull(w))return;e.setLog("info"," "),e.setLog("info","================分割线================"),e.setLog("info"," "),e.setLog("success","当前执行: 对accessCode进行处理获取");let k=L.handleAccessCode({ruleKeyName:l,ruleIndex:o,matchText:h,debugConfig:{matchText:h,config:c,logCallBack:s}});e.setLog("info"," "),e.setLog("info","================分割线================"),e.setLog("info"," "),e.setLog("success","当前执行: 对uiLinkShow进行处理获取");let C=L.handleLinkShow({ruleKeyName:l,ruleIndex:o,shareCode:w,accessCode:k,matchText:h,debugConfig:{matchText:h,config:c,logCallBack:s}});e.setLog("info"," "),e.setLog("info","================分割线================"),e.setLog("info"," "),e.setLog("success","当前执行: 对blank进行处理获取");let A=X.getBlankUrl({ruleKeyName:l,ruleIndex:o,shareCode:w,accessCode:k,debugConfig:{matchText:h,config:c,logCallBack:s}});e.setLog("info"," "),e.setLog("info","================分割线================"),e.setLog("info"," "),e.setLog("success","当前执行: 对copyUrl进行处理获取");let $=X.getCopyUrlInfo({ruleKeyName:l,ruleIndex:o,shareCode:w,accessCode:k,debugConfig:{matchText:h,config:c,logCallBack:s}});e.setLog("success","执行完毕");});}catch(l){g.error(l),e.setLog(l.toString());}}b.on(e.$el.$button,"click",void 0,i);}},St=`.pops[type-value="confirm"] .pops-confirm-content {\r
	overflow: hidden;\r
}\r
/* textarea美化 */\r
.pops.whitesevPopNetDiskCustomRules[type-value="confirm"] .pops-confirm-content textarea {\r
	width: 100%;\r
	height: 100%;\r
	border: none;\r
	outline: none;\r
	padding: 0;\r
	margin: 0;\r
	-webkit-appearance: none;\r
	-moz-appearance: none;\r
	appearance: none;\r
	background-image: none;\r
	background-color: transparent;\r
\r
	display: inline-block;\r
	resize: vertical;\r
	padding: 5px 15px;\r
	line-height: normal;\r
	box-sizing: border-box;\r
	border: 1px solid #dcdfe6;\r
	transition: border-color 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);\r
	appearance: none;\r
	resize: none;\r
}\r
/* 获得焦点 */\r
.pops.whitesevPopNetDiskCustomRules[type-value="confirm"] .pops-confirm-content textarea:focus {\r
	outline: none;\r
	border-color: #3677f0;\r
}\r
/* 提示文字 */\r
.pops.whitesevPopNetDiskCustomRules[type-value="confirm"] .pops-confirm-content textarea::placeholder {\r
	color: #c0c4cc;\r
}\r
/* 鼠标hover */\r
.pops.whitesevPopNetDiskCustomRules[type-value="confirm"] .pops-confirm-content textarea:hover {\r
	border-color: #c0c4cc;\r
}\r
`,$e={show(a,e,t){let n="添加";a&&(n="编辑"),n+="链接识别规则";let r=null;function s(u,p){let h=r.value.trim(),m=le.parseRuleStrToRule(h);if(m.success){let w=m.data;if(a)if(le.updateRule(e,w))f.success("更新成功");else {f.error("更新失败");return}else le.addRule(w),f.success("添加成功");t?.(w);}else f.error(m.msg);}function i(u){let p=r.value.trim(),h=le.parseRuleStrToRule(p);if(h.success){let m=h.data;At.showUI(m);}else f.error(h.msg);}function l(u){try{let p=JSON.parse(r.value),h=le.getFormatRule(p);r.value=h,f.success("格式化成功");}catch(p){g.error(p),f.error(p.message,{timeout:3500,isHTML:true});}}r=G.confirm({title:{text:n,position:"center"},content:{text:'<textarea class="netdisk-custom-rules" placeholder="请输入规则配置"></textarea>',html:true},btn:{merge:true,mergeReverse:false,reverse:false,position:"space-between",ok:{text:"保存",callback:(u,p)=>{s();}},cancel:{text:"调试",callback:(u,p)=>{i();}},other:{enable:true,text:"格式化",type:"xiaomi-primary",callback:(u,p)=>{l();}}},class:"whitesevPopNetDiskCustomRules",style:St},x.popsStyle.customRulesView).$shadowRoot.querySelector("textarea");let c;a?c=le.getRule(e):c=le.getTemplateRule(),r.value=le.getFormatRule(c);},showSubscribe(a,e,t){let n="编辑订阅的链接识别规则",r=null;function s(u,p){let h=r.value.trim(),m=le.parseRuleStrToRule(h);if(m.success){let w=m.data;if(ee.updateSubscribeRule(a,w))f.success("更新成功");else {f.error("更新失败");return}t?.(w);}else f.error(m.msg);}function i(u){let p=r.value.trim(),h=le.parseRuleStrToRule(p);if(h.success){let m=h.data;At.showUI(m);}else f.error(h.msg);}function l(u){try{let p=JSON.parse(r.value),h=le.getFormatRule(p);r.value=h,f.success("格式化成功");}catch(p){g.error(p),f.error(p.message,{isHTML:true,timeout:3500});}}r=G.confirm({title:{text:n,position:"center"},content:{text:'<textarea class="netdisk-custom-rules" placeholder="请输入规则配置"></textarea>',html:true},btn:{merge:true,mergeReverse:false,reverse:false,position:"space-between",ok:{text:"保存",callback:(u,p)=>{s();}},cancel:{text:"调试",callback:(u,p)=>{i();}},other:{enable:true,text:"格式化",type:"xiaomi-primary",callback:(u,p)=>{l();}}},class:"whitesevPopNetDiskCustomRules",style:St},x.popsStyle.customRulesView).$shadowRoot.querySelector("textarea");let c;c=ee.getSubscribeRule(a,e),r.value=le.getFormatRule(c);}},ya=`<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\r
	<path\r
		d="M510.1056 674.2528c-89.1904 0-161.6896-72.5504-161.6896-161.6896s72.5504-161.6896 161.6896-161.6896 161.6896 72.5504 161.6896 161.6896-72.4992 161.6896-161.6896 161.6896z m0-251.7504c-49.664 0-90.0096 40.3968-90.0096 90.0096s40.3968 90.0096 90.0096 90.0096 90.0096-40.3968 90.0096-90.0096-40.3456-90.0096-90.0096-90.0096z"></path>\r
	<path\r
		d="M510.1056 957.5424c-36.1984 0-72.3968-4.4544-107.5712-13.1584a35.88096 35.88096 0 0 1-27.1872-36.352c0.0512-1.2288 0.1024-2.4576 0.1024-3.6864 0-49.664-40.3968-90.0608-90.0608-90.0608-17.2544 0-34.048 4.9152-48.5376 14.2336a35.86048 35.86048 0 0 1-45.0048-5.12c-53.2992-54.5792-91.8528-122.0608-111.5136-195.2256a35.7888 35.7888 0 0 1 19.3024-41.6768c31.3856-14.848 51.6608-46.7968 51.6608-81.4592 0-33.8944-18.7904-64.6144-48.9984-80.128a35.8656 35.8656 0 0 1-17.92-42.3424c20.5824-67.5328 57.7536-130.0992 107.3664-180.9408 11.8784-12.1856 30.72-14.336 45.0048-5.12 14.4896 9.3184 31.2832 14.2336 48.5888 14.2336 49.664 0 90.0608-40.3968 90.0608-90.0096 0-1.28-0.0512-2.5088-0.1024-3.7376a35.82464 35.82464 0 0 1 27.1872-36.3008c72.2944-17.9712 149.504-17.408 221.9008 1.792 16.0768 4.2496 27.136 19.0464 26.624 35.6864l-0.0512 2.6112c0 49.664 40.3968 90.0096 90.0096 90.0096 16.128 0 31.9488-4.352 45.7728-12.4928a35.87072 35.87072 0 0 1 44.1344 5.9904c48.4864 50.432 84.7872 112.2816 104.96 178.8416 5.0176 16.4864-2.4064 34.1504-17.6128 42.1376a89.8048 89.8048 0 0 0-48.2816 79.7696c0 34.3552 20.0192 66.2016 50.944 81.152a35.80928 35.80928 0 0 1 19.0464 41.5232c-19.2512 72.0896-56.9856 138.8544-109.1072 193.0752a35.79904 35.79904 0 0 1-44.0832 5.9904c-13.824-8.192-29.6448-12.4928-45.7216-12.4928-49.664 0-90.0096 40.3968-90.0096 90.0608l0.0512 2.6112a35.8912 35.8912 0 0 1-26.624 35.6864 445.69088 445.69088 0 0 1-114.3296 14.8992z m-64.768-77.3632a375.53664 375.53664 0 0 0 135.936-1.1776c12.1856-77.2096 79.1552-136.3968 159.744-136.3968 18.8416 0 37.4784 3.2768 55.04 9.6768a374.58944 374.58944 0 0 0 66.9184-117.9136c-40.0384-30.208-64.7168-78.2336-64.7168-129.3312 0-49.7152 22.5792-95.744 60.416-126.0544a374.74304 374.74304 0 0 0-62.5664-106.1376 161.34144 161.34144 0 0 1-55.1424 9.6768c-80.5376 0-147.5584-59.1872-159.744-136.3968a376.76032 376.76032 0 0 0-135.936-1.2288C433.664 222.6176 366.3872 282.4704 285.44 282.4704c-20.6336 0-40.9088-3.9424-59.8528-11.4688a375.0912 375.0912 0 0 0-63.8464 107.264c38.4 30.3104 61.2864 76.5952 61.2864 126.7712 0 51.5584-24.9856 99.84-65.5872 129.9968a373.74464 373.74464 0 0 0 68.1984 119.04c18.8928-7.5264 39.168-11.4688 59.8016-11.4688 80.9472 0 148.224 59.8528 159.8976 137.5744z"></path>\r
</svg>\r
`,Ca=`<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\r
	<path\r
		d="M511.998 64C264.574 64 64 264.574 64 511.998S264.574 960 511.998 960 960 759.422 960 511.998 759.422 64 511.998 64z m353.851 597.438c-82.215 194.648-306.657 285.794-501.306 203.579S78.749 558.36 160.964 363.711 467.621 77.917 662.27 160.132c168.009 70.963 262.57 250.652 225.926 429.313a383.995 383.995 0 0 1-22.347 71.993z"></path>\r
	<path\r
		d="M543.311 498.639V256.121c0-17.657-14.314-31.97-31.97-31.97s-31.97 14.314-31.97 31.97v269.005l201.481 201.481c12.485 12.485 32.728 12.485 45.213 0s12.485-32.728 0-45.213L543.311 498.639z"></path>\r
</svg>\r
`,xa=`<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\r
	<path\r
		d="M761.948797 511.939185c0-16.541632-13.500891-30.042523-30.042523-30.042523H542.042395v-189.742249c0-16.541632-13.379261-30.042523-30.042523-30.042523-16.541632 0-30.042523 13.500891-30.042523 30.042523v189.863879H292.09347c-16.541632 0-30.042523 13.500891-30.042523 30.042523 0 8.270816 3.40563 15.811854 8.757335 21.285188 5.473334 5.473334 12.892743 8.757335 21.285188 8.757335h189.863879v189.863879c0 8.270816 3.40563 15.811854 8.757335 21.285188 5.473334 5.473334 12.892743 8.757335 21.285188 8.757335 16.541632 0 30.042523-13.500891 30.042523-30.042523V541.981708h189.863879c16.541632 0 30.042523-13.379261 30.042523-30.042523z m0 0"></path>\r
	<path\r
		d="M780.436504 511.939185c0-17.757928-14.473928-32.231857-32.231857-32.231856H544.353358V275.85604c0-17.757928-14.473928-32.231857-32.231856-32.231857s-32.231857 14.473928-32.231857 32.231857v203.972918H275.916727C258.158799 479.828958 243.684871 494.302886 243.684871 512.060815c0 8.878964 3.648889 17.028151 9.487112 22.866374 5.838223 5.838223 13.86578 9.487112 22.866374 9.487112h203.972918v203.972918c0 8.878964 3.648889 17.028151 9.487113 22.866374 5.838223 5.838223 13.86578 9.487112 22.866373 9.487113 17.757928 0 32.231857-14.473928 32.231857-32.231857V544.292671h203.972918c17.514669 0 31.866968-14.473928 31.866968-32.353486z m0 0"></path>\r
	<path\r
		d="M829.93977 928.034208H194.181604C140.29967 928.034208 96.512997 884.247535 96.512997 830.487231V193.512769c0-53.760304 43.786673-97.546977 97.546977-97.546977H829.93977c53.760304 0 97.546977 43.786673 97.546977 97.546977v636.974462c0.12163 53.760304-43.665043 97.546977-97.546977 97.546977zM194.181604 156.780615C173.869453 156.780615 157.327821 173.322247 157.327821 193.512769v636.974462C157.327821 850.677753 173.869453 867.219385 194.181604 867.219385H829.93977c20.312151 0 36.732153-16.541632 36.732154-36.732154V193.512769c0-20.312151-16.541632-36.732153-36.732154-36.732154H194.181604z"></path>\r
</svg>\r
`,va=`<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\r
	<path\r
		d="M560.104 574.25c0.625-0.64 1.182-1.2 1.67-1.683 24.773-24.465 55.547-42.364 89.471-51.779 1.014-0.281 2.241-0.603 3.682-0.965a16 16 0 0 1 13.64 2.823l1.477 1.134 25.485 19.554h22.942l15.46-11.862 11.457-8.791a16 16 0 0 1 13.692-2.81c3.65 0.93 6.585 1.734 8.803 2.412a206.001 206.001 0 0 1 14.852 5.167 205.45 205.45 0 0 1 69.482 45.108c0.491 0.485 1.05 1.049 1.68 1.692a16 16 0 0 1 4.412 13.355l-0.529 3.863-3.935 28.758 11.471 19.547L892.89 651.5l3.15 1.34a16 16 0 0 1 9.166 10.48c0.38 1.385 0.695 2.575 0.942 3.57A198.992 198.992 0 0 1 912 714.91c0 18.075-2.424 35.85-7.152 52.976-0.204 0.74-0.452 1.6-0.745 2.584a16 16 0 0 1-8.956 10.114l-1.606 0.699-28.225 12.274-11.471 19.547 2.152 24.3 0.645 7.282a16 16 0 0 1-4.654 12.755 179.21 179.21 0 0 1-4.143 4.013A205.62 205.62 0 0 1 762.876 909c-1.373 0.382-3.109 0.83-5.206 1.345a16 16 0 0 1-12.839-2.331l-4.217-2.883-22.143-15.135H695.53l-23.053 15.757-3.288 2.248a16 16 0 0 1-12.864 2.324c-3.02-0.745-5.463-1.389-7.331-1.93a205.604 205.604 0 0 1-83.28-47.352 173.687 173.687 0 0 1-3.705-3.6 16 16 0 0 1-4.65-12.751c0.252-2.85 0.458-5.184 0.62-7.001l2.177-24.587-11.471-19.547-28.313-12.313-1.5-0.652a16 16 0 0 1-8.957-10.116 163.909 163.909 0 0 1-1.291-4.546c-4.38-16.522-6.623-33.632-6.623-51.02 0-17.065 2.16-33.866 6.384-50.11 0.042-0.158 0.193-0.697 0.454-1.615a16 16 0 0 1 9.128-10.347l1.675-0.713 29.043-12.352 11.471-19.547a317416336.627 317416336.627 0 0 0-4.464-32.62 16 16 0 0 1 4.413-13.357z m58.693 51.865l-32.6 57.431-26.86 10.457A155.784 155.784 0 0 0 558 714.416c0 8.177 0.634 16.258 1.884 24.192l26.314 10.244 32.599 57.43-4.232 27.01c11.838 9.538 25.036 17.206 39.159 22.708l20.677-17.064h65.198L760.276 856c14.123-5.502 27.321-13.17 39.16-22.709l-4.233-27.008 32.6-57.431 26.313-10.244A155.435 155.435 0 0 0 856 714.416c0-6.882-0.45-13.696-1.337-20.413l-26.86-10.457-32.6-57.431 4.728-30.173A148.3 148.3 0 0 0 763.181 574L739.6 593.462h-65.198L650.819 574a148.3 148.3 0 0 0-36.75 21.942l4.728 30.173zM707.1 802.289c-48.228 0-87.324-39.096-87.324-87.324s39.096-87.324 87.324-87.324 87.325 39.096 87.325 87.324-39.097 87.324-87.325 87.324z m0-56.938c17.768 0 32.172-14.404 32.172-32.172 0-17.768-14.404-32.172-32.172-32.172-17.768 0-32.172 14.404-32.172 32.172 0 17.768 14.404 32.172 32.172 32.172zM256 348v-56a8 8 0 0 1 8-8h432a8 8 0 0 1 8 8v56a8 8 0 0 1-8 8H264a8 8 0 0 1-8-8z m0 192v-56a8 8 0 0 1 8-8h176a8 8 0 0 1 8 8v56a8 8 0 0 1-8 8H264a8 8 0 0 1-8-8z m0 192v-56a8 8 0 0 1 8-8h176a8 8 0 0 1 8 8v56a8 8 0 0 1-8 8H264a8 8 0 0 1-8-8z m584-548H184v656h288a8 8 0 0 1 8 8v56a8 8 0 0 1-8 8H144c-17.673 0-32-14.327-32-32V144c0-17.673 14.327-32 32-32h736c17.673 0 32 14.327 32 32v328a8 8 0 0 1-8 8h-56a8 8 0 0 1-8-8V184z"></path>\r
</svg>\r
`,Aa=`<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\r
	<path\r
		d="M648.6016 128c0-18.7904 15.2576-34.048 34.048-34.048H896c18.7904 0 34.048 15.2576 34.048 34.048v213.3504a34.048 34.048 0 1 1-68.096 0V162.048h-179.3024a34.048 34.048 0 0 1-34.048-34.048zM93.952 128c0-18.7904 15.2576-34.048 34.048-34.048h213.3504a34.048 34.048 0 1 1 0 68.096H162.048v179.3024a34.048 34.048 0 1 1-68.096 0V128zM896 648.6016c18.7904 0 34.048 15.2576 34.048 34.048V896a34.048 34.048 0 0 1-34.048 34.048h-213.3504a34.048 34.048 0 0 1 0-68.096h179.3024v-179.3024c0-18.7904 15.2576-34.048 34.048-34.048zM128 648.6016c18.7904 0 34.048 15.2576 34.048 34.048v179.3024h179.3024a34.048 34.048 0 1 1 0 68.096H128a34.048 34.048 0 0 1-34.048-34.048v-213.3504c0-18.7904 15.2576-34.048 34.048-34.048zM322.3552 358.4c0-18.8416 15.3088-34.1504 34.1504-34.1504h310.9888c18.8416 0 34.1504 15.3088 34.1504 34.1504v58.3168a34.1504 34.1504 0 0 1-68.2496 0v-24.1664H390.6048v24.1664a34.1504 34.1504 0 0 1-68.2496 0V358.4zM438.9888 708.2496c0-18.8416 15.3088-34.0992 34.1504-34.0992h77.7216a34.0992 34.0992 0 1 1 0 68.2496H473.1392a34.0992 34.0992 0 0 1-34.1504-34.1504z"></path>\r
	<path\r
		d="M512 363.1616c18.8416 0 34.0992 15.2576 34.0992 34.0992v310.9888a34.0992 34.0992 0 1 1-68.1984 0V397.312c0-18.8416 15.2576-34.0992 34.0992-34.0992z"></path>\r
</svg>\r
`,Sa=`<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\r
	<path\r
		d="M563.2 672c-6.4-6.4 0 0 0 0L448 793.6c-57.6 57.6-153.6 57.6-211.2 0-57.6-57.6-64-147.2 0-211.2l121.6-121.6-6.4-6.4-38.4-32-6.4-6.4-121.6 121.6C108.8 614.4 108.8 755.2 192 832s217.6 83.2 300.8 0l121.6-121.6-6.4-6.4-44.8-32z m38.4-294.4c6.4 0 6.4 0 0 0l38.4 38.4 6.4 6.4-230.4 230.4-38.4-51.2 224-224zM531.2 192c83.2-83.2 217.6-83.2 300.8 0 83.2 83.2 83.2 217.6 0 300.8l-121.6 121.6-44.8-44.8 128-128c44.8-44.8 51.2-147.2-6.4-204.8-57.6-57.6-160-57.6-204.8-6.4l-128 128v-6.4l-38.4-38.4-6.4-6.4L531.2 192z"></path>\r
</svg>\r
`,_t=`<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\r
	<path\r
		d="M892 928.1H134c-19.9 0-36-16.1-36-36v-758c0-19.9 16.1-36 36-36h314.1c19.9 0 36 16.1 36 36s-16.1 36-36 36H170v686h686V579.6c0-19.9 16.1-36 36-36s36 16.1 36 36v312.5c0 19.9-16.1 36-36 36z"></path>\r
	<path\r
		d="M927.9 131.6v-0.5c-0.1-1.7-0.4-3.3-0.7-4.9 0-0.1 0-0.2-0.1-0.3-0.4-1.7-0.9-3.3-1.5-4.9v-0.1c-0.6-1.6-1.4-3.1-2.2-4.6 0-0.1-0.1-0.1-0.1-0.2-0.8-1.4-1.7-2.8-2.7-4.1-0.1-0.1-0.2-0.3-0.3-0.4-0.5-0.6-0.9-1.1-1.4-1.7 0-0.1-0.1-0.1-0.1-0.2-0.5-0.6-1-1.1-1.6-1.6l-0.4-0.4c-0.5-0.5-1.1-1-1.6-1.5l-0.1-0.1c-0.6-0.5-1.2-1-1.9-1.4-0.1-0.1-0.3-0.2-0.4-0.3-1.4-1-2.8-1.8-4.3-2.6l-0.1-0.1c-1.6-0.8-3.2-1.5-4.9-2-1.6-0.5-3.3-1-5-1.2-0.1 0-0.2 0-0.3-0.1l-2.4-0.3h-0.3c-0.7-0.1-1.3-0.1-2-0.1H640.1c-19.9 0-36 16.1-36 36s16.1 36 36 36h165L487.6 487.6c-14.1 14.1-14.1 36.9 0 50.9 7 7 16.2 10.5 25.5 10.5 9.2 0 18.4-3.5 25.5-10.5L856 221v162.8c0 19.9 16.1 36 36 36s36-16.1 36-36V134.1c0-0.8 0-1.7-0.1-2.5z"></path>\r
</svg>\r
`,_a=`<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\r
	<path\r
		d="M288 384v-74.666667c0-123.722667 100.266667-224 224-224s224 100.224 224 224v74.666667h10.677333C811.445333 384 864 436.597333 864 501.333333v320c0 64.821333-52.469333 117.333333-117.322667 117.333334H277.333333C212.554667 938.666667 160 886.069333 160 821.333333V501.333333c0-64.821333 52.469333-117.333333 117.322667-117.333333H288z m64 0h320v-74.666667c0-88.426667-71.605333-160-160-160-88.384 0-160 71.626667-160 160v74.666667zM224 501.333333v320c0 29.397333 23.914667 53.333333 53.322667 53.333334H746.666667A53.269333 53.269333 0 0 0 800 821.333333V501.333333c0-29.397333-23.914667-53.333333-53.322667-53.333333H277.333333A53.269333 53.269333 0 0 0 224 501.333333z"></path>\r
</svg>\r
`,Ra=`<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\r
	<path\r
		d="M826.92 857.397H197.08c-33.667 0-60.953-27.287-60.953-60.953V349.46c0-33.666 27.286-60.952 60.952-60.952h121.905v-60.952c0-33.666 27.286-60.953 60.953-60.953h243.809c33.666 0 60.952 27.287 60.952 60.953v60.952H826.921c33.666 0 60.952 27.286 60.952 60.952v446.984c0 33.666-27.286 60.953-60.952 60.953zM644.064 247.873c0-22.43-18.204-40.635-40.634-40.635H400.254c-22.43 0-40.635 18.205-40.635 40.635v40.635h284.444v-40.635z m203.175 121.905c0-22.43-18.204-40.635-40.635-40.635H217.397c-22.43 0-40.635 18.204-40.635 40.635v162.54h304.762v-50.794c0-16.823 13.653-30.476 30.476-30.476s30.476 13.653 30.476 30.476v50.793h304.762v-162.54z m0 203.174H542.476v10.16c0 16.842-13.653 30.475-30.476 30.475s-30.476-13.633-30.476-30.476v-10.159H176.762v203.175c0 22.43 18.204 40.635 40.635 40.635h589.206c22.43 0 40.635-18.205 40.635-40.635V572.952z"></path>\r
</svg>\r
`,rt={setGlobalRightClickMenu(a){x.view.registerContextMenu(a,void 0,[{text:"设置",icon:ya,callback(){g.info("右键菜单-打开-"+this.text),dt.show();}},{text:"历史匹配记录",icon:Ca,callback(){g.info("右键菜单-打开-"+this.text),x.netDiskHistoryMatch.show();}},{text:"添加链接识别规则",icon:xa,callback(){g.info("右键菜单-打开-"+this.text),$e.show(false);}},{text:"规则管理器",icon:va,callback(){g.info("右键菜单-打开-"+this.text),Je.showView();}},{text:"主动识别文本",icon:Aa,callback(){g.info("右键菜单-打开-"+this.text),x.matchPasteText.show();}}]);},setRightClickMenu(a,e,t){let n=[{text:"链接",icon:Sa,callback(r,s,i,l){return  false},item:[{text:"复制",icon:"documentCopy",callback:function(r,s,i,l){let o=l;const{ruleKeyName:c,ruleIndex:u,shareCode:p,accessCode:h}=ce.praseElementAttributeRuleInfo(o);Ce.copy(c,u,p,h);}},{text:"打开",icon:_t,callback:function(r,s,i,l){let o=l;const{ruleKeyName:c,ruleIndex:u,shareCode:p,accessCode:h}=ce.praseElementAttributeRuleInfo(o);let m=X.getBlankUrl({ruleKeyName:c,ruleIndex:u,shareCode:p,accessCode:h});Ce.openBlankUrl(m,c,u,p,h);}},{text:"后台打开",icon:_t,callback:function(r,s,i,l){let o=l;const{ruleKeyName:c,ruleIndex:u,shareCode:p,accessCode:h}=ce.praseElementAttributeRuleInfo(o);let m=X.getBlankUrl({ruleKeyName:c,ruleIndex:u,shareCode:p,accessCode:h});Ce.openBlankUrl(m,c,u,p,h,true);}}]},{text:"密码",icon:_a,callback:function(r,s,i){return  false},item:[{text:"复制",icon:"documentCopy",callback(r,s,i,l){let o=l;const{ruleKeyName:c,ruleIndex:u,shareCode:p,accessCode:h}=ce.praseElementAttributeRuleInfo(o);if(h==null||typeof h=="string"&&h.trim()===""){f.warning("无访问码");return}d.setClip(h).then(m=>{m?f.success("已复制"):f.error("执行复制失败",{consoleLogContent:true});}).catch(()=>{f.error("执行复制失败",{consoleLogContent:true});});}},{text:"修改",icon:"edit",callback:function(r,s,i,l){let o=l;const{ruleKeyName:c,ruleIndex:u,shareCode:p,accessCode:h}=ce.praseElementAttributeRuleInfo(o);x.newAccessCodeView(this.text,c,u,p,h,m=>{if(t)if(m.isUpdatedMatchedDict){let w=new Date().getTime(),k=o.closest("li").querySelector(".netdiskrecord-update-time");b.text(k,d.formatTime(w)),b.attr(o,"data-accesscode",m.accessCode),f.success(`
												<div style="text-align: left;">旧: ${h}</div>
												<div style="text-align: left;">新: ${m.accessCode}</div>`,{isHTML:true});}else f.error("修改失败");else b.attr(o,"data-accesscode",m.accessCode),m.isUpdatedMatchedDict?f.success(`
												<div style="text-align: left;">旧: ${h}</div>
												<div style="text-align: left;">新: ${m.accessCode}</div>`,{isHTML:true}):m.isFindInMatchedDict?f.error("修改访问码失败"):f.error("修改访问码失败，因为当前已匹配字典中未找到对应的访问码");});}}]},{text:"其它",icon:Ra,callback(r,s,i,l){return  false},item:[{text:"复制全部",icon:"documentCopy",callback(r,s,i,l){let c=l.closest(".netdisk-url-box-all"),u=[];c.querySelectorAll(e).forEach(p=>{const{ruleKeyName:h,ruleIndex:m,shareCode:w,accessCode:k}=ce.praseElementAttributeRuleInfo(p);let C=X.getCopyUrlInfo({ruleKeyName:h,ruleIndex:m,shareCode:w,accessCode:k});u.push(C);}),d.setClip(u.join(`
`)).then(p=>{p?f.success("成功复制全部"):f.error("复制全部失败");}).catch(()=>{f.error("复制全部失败");});}}]}];t||n[2].item.push({text:"删除当前",icon:"delete",callback:function(r,s,i,l){let o=l,c=o.closest(".netdisk-url-box");const{ruleKeyName:u,ruleIndex:p,shareCode:h,accessCode:m}=ce.praseElementAttributeRuleInfo(o);let w=false;L.$match.matchedInfo.forEach((k,C)=>{C===u&&k.forEach((A,$)=>{$===h&&(w=true,k.delete($),g.info("删除：",C,JSON.stringify(A)));});}),L.$match.matchedInfoRuleKey.clear(),L.$match.matchedInfo.forEach((k,C)=>{k.length&&L.$match.matchedInfoRuleKey.add(C);}),w?c.remove():f.error("发生意外情况，未在已匹配到的信息中到对应的网盘信息");}},{text:"删除所有",icon:"delete",callback:function(r,s,i,l){let o=l,c=o.closest(".netdisk-url-box-all");const{ruleKeyName:u,ruleIndex:p,shareCode:h,accessCode:m}=ce.praseElementAttributeRuleInfo(o);L.$match.matchedInfo.forEach((w,k)=>{w.clear();}),L.$match.matchedInfoRuleKey.clear(),b.html(c,"");}}),x.view.registerContextMenu(a,e,n);}},ce={show(){x.Alias.uiLinkAlias==null?(this.createView(),this.initViewEvent()):x.Alias.uiLinkAlias.show();},createView(){const a={view:{"netdisl-small-window-shrink-status":Me("netdisl-small-window-shrink-status",false),"netdisk-ui-small-window-position":Me("netdisk-ui-small-window-position",null)}},e='<div class="netdisk-url-box-all"></div>';if(y.features["netdisk-behavior-mode"].value.toLowerCase().includes("smallwindow")){x.Alias.uiLinkAlias=G.alert({title:{text:"网盘",position:"center"},content:{text:e,html:true},btn:{ok:{enable:false},close:{callback(l){y.features["netdisk-behavior-mode"].value.toLowerCase().includes("suspension")?(se.mode.current_suspension_smallwindow_mode.value="suspension",l.hide(),x.suspension.init()):(x.Alias.uiLinkAlias=void 0,l.close());}}},mask:{enable:false},animation:"",beforeAppendToPageCallBack(l,o){let c=l.querySelector(".pops-header-control"),u=l.querySelector(".pops-alert-title"),p=l.querySelector(".pops-alert-content"),h=b.createElement("button",{className:"pops-header-control",innerHTML:`
                                <i class="pops-icon">
									<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
										<path fill="currentColor" d="M290.816 774.144h167.936c12.288 0 20.48 8.192 20.48 20.48s-8.192 20.48-20.48 20.48h-219.136c-12.288 0-20.48-8.192-20.48-20.48v-2.048-206.848c0-12.288 8.192-20.48 20.48-20.48s20.48 8.192 20.48 20.48v163.84l210.944-198.656c8.192-8.192 20.48-8.192 28.672 0s8.192 20.48 0 28.672l-208.896 194.56z m462.848-524.288h-167.936c-12.288 0-20.48-8.192-20.48-20.48s8.192-20.48 20.48-20.48h219.136c12.288 0 20.48 8.192 20.48 20.48v208.896c0 12.288-8.192 20.48-20.48 20.48s-20.48-8.192-20.48-20.48v-163.84l-210.944 198.656c-8.192 8.192-20.48 8.192-28.672 0s-8.192-20.48 0-28.672l208.896-194.56z m188.416 323.584c0 12.288-8.192 20.48-20.48 20.48s-20.48-8.192-20.48-20.48v-389.12c0-34.816-26.624-61.44-61.44-61.44h-655.36c-34.816 0-61.44 26.624-61.44 61.44v655.36c0 34.816 26.624 61.44 61.44 61.44h655.36c34.816 0 61.44-26.624 61.44-61.44v-94.208c0-12.288 8.192-20.48 20.48-20.48s20.48 8.192 20.48 20.48v94.208c0 57.344-45.056 102.4-102.4 102.4h-655.36c-57.344 0-102.4-45.056-102.4-102.4v-655.36c0-57.344 45.056-102.4 102.4-102.4h655.36c57.344 0 102.4 45.056 102.4 102.4v389.12z">
										</path>
									</svg>
                                </i>
                                `},{type:"button","data-type":"launch","data-header":true}),m=b.createElement("button",{className:"pops-header-control",innerHTML:`
                                <i class="pops-icon">
									<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
										<path fill="currentColor" d="M618.496 425.984h167.936c12.288 0 20.48 8.192 20.48 20.48s-8.192 20.48-20.48 20.48h-219.136c-12.288 0-20.48-8.192-20.48-20.48v-2.048-206.848c0-12.288 8.192-20.48 20.48-20.48s20.48 8.192 20.48 20.48v163.84l210.944-198.656c8.192-8.192 20.48-8.192 28.672 0s8.192 20.48 0 28.672l-208.896 194.56z m-192.512 172.032h-167.936c-12.288 0-20.48-8.192-20.48-20.48s8.192-20.48 20.48-20.48h219.136c12.288 0 20.48 8.192 20.48 20.48v208.896c0 12.288-8.192 20.48-20.48 20.48s-20.48-8.192-20.48-20.48v-163.84l-210.944 198.656c-8.192 8.192-20.48 8.192-28.672 0s-8.192-20.48 0-28.672l208.896-194.56z m516.096-24.576c0 12.288-8.192 20.48-20.48 20.48s-20.48-8.192-20.48-20.48v-389.12c0-34.816-26.624-61.44-61.44-61.44h-655.36c-34.816 0-61.44 26.624-61.44 61.44v655.36c0 34.816 26.624 61.44 61.44 61.44h655.36c34.816 0 61.44-26.624 61.44-61.44v-94.208c0-12.288 8.192-20.48 20.48-20.48s20.48 8.192 20.48 20.48v94.208c0 57.344-45.056 102.4-102.4 102.4h-655.36c-57.344 0-102.4-45.056-102.4-102.4v-655.36c0-57.344 45.056-102.4 102.4-102.4h655.36c57.344 0 102.4 45.056 102.4 102.4v389.12z">
										</path>
									</svg>
                                </i>
                                `},{type:"button","data-type":"shrink","data-header":true});b.before(c,h),b.before(c,m),b.on(h,"click",function(){b.addClass(h,"pops-hide-important"),b.removeClass(m,"pops-hide-important"),b.removeClass(u,"pops-no-border-important"),b.removeClass(p,"pops-hide-important"),a.view["netdisl-small-window-shrink-status"].value=false;},{capture:true}),b.on(m,"click",function(){b.removeClass(h,"pops-hide-important"),b.addClass(m,"pops-hide-important"),b.addClass(u,"pops-no-border-important"),b.addClass(p,"pops-hide-important"),a.view["netdisl-small-window-shrink-status"].value=true;},{capture:true}),a.view["netdisl-small-window-shrink-status"].value?m.click():h.click();},dragMoveCallBack(l,o,c){a.view["netdisk-ui-small-window-position"].value={left:o,top:c};},class:"whitesevPop",style:`
                    ${vt}

                    .pops {
                        --container-title-height: 35px;
                        --content-max-height: ${y.smallWindow["netdisk-ui-small-window-max-height"].value}px;
                        --netdisk-line-space: 8px;
                        --netdisk-icon-size: 24px;
                    }
                    .pops[type-value="alert"]{
                        transform: none;
                    }
                    .pops {
                        max-height: var(--content-max-height);
                    }
                    .pops[type-value=alert] .pops-alert-content{
                        max-height: calc(var(--content-max-height) - var(--container-title-height) - var(--container-bottom-btn-height));
                    }
                    .pops-header-controls button.pops-header-control[type][data-header]{
                        padding: 0px 5px;
                    }
                    .netdisk-url-div{
                        padding: 0px;
                    }
                    .netdisk-icon .netdisk-icon-img{
                        width: var(--netdisk-icon-size);
                        height: var(--netdisk-icon-size);
                        min-width: var(--netdisk-icon-size);
                        min-height: var(--netdisk-icon-size);
                        margin: 0px var(--netdisk-line-space);
                    }
                    .netdisk-status{
                        margin-right: var(--netdisk-line-space);
                    }
                    .netdisk-url{
                        padding: 2px 0px;
                    }
                    `},x.popsStyle.mainViewSmallWindow);let s=a.view["netdisk-ui-small-window-position"].value,i=x.Alias.uiLinkAlias.popsElement;if(s){let l=b.width(i,true),o=b.height(i,true),c=b.width(window),u=b.height(window);const{transformLeft:p,transformTop:h}=b.getTransform(i);let m=c-l+p,w=u-o+h,k=0+p,C=0+h;s.top>w?s.top=w:s.top<C&&(s.top=C),s.left>m?s.left=m:s.left<k&&(s.left=k),i.style.transitionDuration="0s",i.style.left=s.left+"px",i.style.top=s.top+"px",setTimeout(()=>{i.style.transitionDuration="0s";},300);}}else x.Alias.uiLinkAlias=G.alert({title:{text:"网盘",position:"center"},content:{text:e,html:true},btn:{ok:{enable:false},close:{callback(s){x.Alias.uiLinkAlias=void 0,s.close();}}},mask:{clickCallBack(s){s(),x.Alias.uiLinkAlias=void 0;}},class:"whitesevPop",style:`
                    ${vt}

                    .pops {
                        max-height: 60vh;
                    }
					@media screen and (max-width: 600px) {
						.pops {
                       		max-height: 50vh;
                    	}
					}
                    `},x.popsStyle.mainView);let t=x.Alias.uiLinkAlias.$shadowRoot.querySelector(".netdisk-url-box-all"),n=[];x.isMatchedNetDiskIconMap.forEach(s=>{let i=L.$match.matchedInfo.get(s),l=document.createDocumentFragment();i.forEach((o,c)=>{let u=L.handleLinkShow({ruleKeyName:s,ruleIndex:o.ruleIndex,shareCode:c,accessCode:o.accessCode,matchText:o.matchText,showToast:false});if(!u)return;let p=this.createViewBoxElementInfo(x.src.icon[s],s,o.ruleIndex,c,o.accessCode,u);n.push({$urlBox:p.$urlBox,ruleKeyName:s,ruleIndex:o.ruleIndex,shareCode:c,accessCode:o.accessCode}),l.appendChild(p.$urlBox);}),t.appendChild(l);});let r=y.smallWindow["netdisk-link-view-z-index"].value;r>0&&b.css(x.Alias.uiLinkAlias.popsElement,{"z-index":r}),oe.check(n);},initViewEvent(){rt.setRightClickMenu(x.Alias.uiLinkAlias.$shadowRoot,".whitesevPop .netdisk-url a"),this.registerIconGotoPagePosition(x.Alias.uiLinkAlias.$shadowRoot),this.setNetDiskUrlClickEvent(x.Alias.uiLinkAlias.$shadowRoot,".netdisk-url a"),rt.setGlobalRightClickMenu(x.Alias.uiLinkAlias.$shadowRoot.querySelector(".pops .pops-alert-title > p"));},createElementAttributeRuleInfoJSON(a){return {"data-rule-key":a.ruleKeyName,"data-rule-index":a.ruleIndex,"data-sharecode":a.shareCode,"data-accesscode":a.accessCode}},praseElementAttributeRuleInfo(a){let e={ruleKeyName:a.getAttribute("data-rule-key"),ruleIndex:parseInt(a.getAttribute("data-rule-index")),shareCode:a.getAttribute("data-sharecode"),accessCode:a.getAttribute("data-accesscode")};return isNaN(e.ruleIndex)&&(g.warn("元素上的 ruleIndex 的值是NaN，调整为默认值0",a),e.ruleIndex=0),e},handleElementAttributeRuleInfo(a,e){let t=this.createElementAttributeRuleInfoJSON(a);for(const n in t){const r=t[n];Array.isArray(e)?e.forEach(s=>{s.setAttribute(n,r.toString());}):e.setAttribute(n,r.toString());}},createViewBoxElementInfo(a,e,t,n,r,s){let i=b.createElement("div",{className:"netdisk-url-box",innerHTML:`
			<div class="netdisk-url-div">
                <div class="netdisk-icon">
                    <div class="netdisk-icon-img"></div>
                </div>
                <div class="netdisk-status"></div>
                <div class="netdisk-url">
                    <a  class="netdisk-link" href="javascript:;" isvisited="false"></a>
                </div>
            </div>
			`});const{$urlDiv:l,$icon:o,$iconImg:c,$checkValidStatus:u,$url:p,$link:h}=this.parseViewBoxElementInfo(i);return c.style.cssText=`background: url(${a}) no-repeat;background-size: 100%;`,b.html(h,s),this.handleElementAttributeRuleInfo({ruleKeyName:e,ruleIndex:t,shareCode:n,accessCode:r},[c,h]),L.$rule.rule.forEach(m=>{m.setting.key===e&&typeof m.afterRenderUrlBox=="function"&&m.afterRenderUrlBox({$viewBox:i,$urlDiv:l,$url:p,$link:h,ruleKeyName:e,ruleIndex:t,shareCode:n,accessCode:r});}),{$urlBox:i,$urlDiv:l,$icon:o,$iconImg:c,$checkValidStatus:u,$url:p,$link:h}},parseViewBoxElementInfo(a){let e=a.matches(".netdisk-url-box")?a:a.closest(".netdisk-url-box"),t=e.querySelector(".netdisk-url-div"),n=e.querySelector(".netdisk-icon"),r=e.querySelector(".netdisk-icon-img"),s=e.querySelector(".netdisk-status"),i=e.querySelector(".netdisk-url"),l=e.querySelector(".netdisk-link");return {$urlBox:e,$urlDiv:t,$icon:n,$iconImg:r,$checkValidStatus:s,$url:i,$link:l}},setNetDiskUrlClickEvent(a,e){b.on(a,"click",e,t=>{let n=t.target;n.setAttribute("isvisited","true");const r=ce.praseElementAttributeRuleInfo(n);t.ctrlKey?this.netDiskUrlClickEvent({data:r,clickMode:"openBlank",$click:n}):this.netDiskUrlClickEvent({data:r,$click:n});}),b.on(a,"auxclick",e,(t,n)=>{if(t.button!==1)return;d.preventEvent(t),n.setAttribute("isvisited","true");const r=ce.praseElementAttributeRuleInfo(n);let s=X.getBlankUrl({ruleKeyName:r.ruleKeyName,ruleIndex:r.ruleIndex,shareCode:r.shareCode,accessCode:r.accessCode});Ce.openBlankUrl(s,r.ruleKeyName,r.ruleIndex,r.shareCode,r.accessCode,true);});},netDiskUrlClickEvent(a){const{ruleKeyName:e,ruleIndex:t,shareCode:n,accessCode:r}=a.data;let s=a.clickMode??Y.function.linkClickMode(a.data.ruleKeyName),i=()=>{if(a.$click){let l=a.$click.closest(".pops");if(l){let o=l.querySelector('.pops-header-control[type="close"]');o&&o.click();}}};if(s==="copy"||s==="copy-closePopup")Ce.copy(e,t,n,r),s==="copy-closePopup"&&i();else if(s==="openBlank"||s==="openBlank-closePopup"){let l=X.getBlankUrl({ruleKeyName:e,ruleIndex:t,shareCode:n,accessCode:r});q.isForwardBlankLink(e)?Ce.openBlankWithScheme(e,t,n,r):Ce.openBlankUrl(l,e,t,n,r),s==="openBlank-closePopup"&&i();}else s==="parseFile"||s==="parseFile-closePopup"?Ce.parseFile(e,t,n,r).then(()=>{s==="parseFile-closePopup"&&i();}):(g.error("未知点击动作："+s),f.error("未知点击动作："+s));},registerContextMenu(a,e,t=[],n="whitesevSuspensionContextMenu"){let r=[];t.forEach(i=>{r.push({text:i.text,callback:i.callback,icon:i?.icon??"",iconIsLoading:i?.iconIsLoading??false,item:i?.item??null});});let s={target:a,targetSelector:e,data:r,isAnimation:false,className:n,only:true,chileMenuLeftOrRightDistance:-3,childMenuTopOrBottomDistance:-5};G.rightClickMenu(s);},addLinkView(a,e,t,n,r){if(x.netDiskHistoryMatch.changeMatchedData(a,e,t,n,r),!x.Alias.uiLinkAlias)return;g.info(a,e,t,n);let s=x.src.icon[a],i=L.handleLinkShow({ruleKeyName:a,ruleIndex:e,shareCode:t,accessCode:n,matchText:r});if(!i)return;let l=this.createViewBoxElementInfo(s,a,e,t,n,i);oe.check({$urlBox:l.$urlBox,ruleKeyName:a,ruleIndex:e,shareCode:t,accessCode:n});},changeLinkView(a,e,t,n,r){if(x.netDiskHistoryMatch.changeMatchedData(a,e,t,n,r),!x.Alias.uiLinkAlias)return;let s=L.handleLinkShow({ruleKeyName:a,ruleIndex:e,shareCode:t,accessCode:n,matchText:r});if(!s)return;let i=x.Alias.uiLinkAlias.popsElement.querySelector(`.netdisk-url a[data-sharecode='${t}'][data-rule-index='${e}']`);g.info("修改网盘链接视图"),g.info(i),i.setAttribute("data-accesscode",n),b.html(i,s);},registerIconGotoPagePosition(a){let e,t,n;b.on(a,"click",".whitesevPop .netdisk-icon .netdisk-icon-img",(r,s)=>{let l=s.getAttribute("data-sharecode");if(y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode"].value){if(typeof l!="string"){f.error("获取data-sharecode属性失败");return}if(n==null?n=l:n!==l&&(g.info(`上一个搜索：${n}，切换至：${l}`),e=void 0,t=void 0,n=l),e==null&&(e=d.findElementsWithText(document.documentElement,l),t=e.next()),t?.value)if(g.success("定位元素",t),t.value.nodeType===Node.ELEMENT_NODE&&t.value.getClientRects().length){if(t.value.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode-with-select"].value){let o=t.value.innerText||t.value.textContent,c,u,p;if(o.includes(l)){let h=Array.from(t.value.childNodes).filter(m=>m.nodeType===Node.TEXT_NODE);for(const m of h)if(m.textContent.includes(l)){c=m,u=m.textContent.indexOf(l),p=u+l.length;break}}try{d.selectElementText(t.value,c,u,p);}catch(h){g.error(h),d.selectElementText(t.value);}}}else if(t.value.nodeType===Node.TEXT_NODE&&t.value.parentElement.getClientRects().length)if(y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode-with-select"].value){let o=t.value.textContent||t.value.nodeValue,c=t.value,u=o.indexOf(l),p=u+l.length;try{d.selectElementText(t.value,c,u,p);}catch(m){g.error(m),d.selectElementText(t.value.parentElement);}let h=globalThis.getSelection();if(h.rangeCount>0){let w=h.getRangeAt(0).getBoundingClientRect(),k=globalThis.scrollY,C=w.top+k-globalThis.innerHeight/2;globalThis.scrollTo({behavior:"smooth",top:C});}else t.value.parentElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"});}else try{let o=new Range;o.selectNodeContents(t.value);let c=o.getBoundingClientRect(),u=globalThis.scrollY,p=c.top+u-globalThis.innerHeight/2;globalThis.scrollTo({behavior:"smooth",top:p});}catch(o){g.error(o),t.value.parentElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"});}else {g.error("无法定位该元素位置",t.value);const o=(t.value.nodeName||t.value.localName||t.value.tagName).toLowerCase();f.error(`无法定位该元素位置，类型：${Ke.escapeHtml("<")}${o}${Ke.escapeHtml(">")}`,{isHTML:true});}if(t=e.next(),t.done){if(!y.smallIconNavgiator["pops-netdisk-icon-click-event-loop-find-sharecode"].value){f.info("已经定位至最后一个元素了");return}e=void 0,t=void 0;}}});}};class Da extends be{async init(e){super.init(e);let{ruleIndex:t,shareCode:n,accessCode:r}=e,s="chengtong";if(t!==3){g.warn("解析站暂时只支持单文件解析，非单文件链接的点击动作为新标签页打开"),ce.netDiskUrlClickEvent({data:{ruleKeyName:s,ruleIndex:t,shareCode:n,accessCode:r},clickMode:"openBlank"});return}let i=re("chengtong-parse-file-api-host");if(d.isNull(i)){f.error("请先配置文件解析接口地址");return}i.endsWith("/")||(i+="/");let l=i+"?file="+n;d.isNotNull(r)&&(l+="&pass="+r),window.open(l,"_blank");}}const it={async parseFileMetaInfo(a){const e=await M.get("https://whatslink.info/api/v1/link?url="+a,{headers:{Referer:"https://whatslink.info/"},allowInterceptConfig:false});let t=d.toJSON(e.data.responseText);if(!e.status){if(typeof t.error=="string"&&t.error.trim()!==""){f.error(t.error);return}f.error("请求失败");return}return t},showFileMetaInfoDialog(a){G.alert({title:{text:"元数据信息",position:"center"},content:{text:`
						<div class="wrapper">
							<div class="title">Summary</div>
							<div class="content">
								<div>Resource Name: ${a.name}</div>
								<div>Number of Files: ${a.count}</div>
								<div>Total File Size: ${d.formatByteToSize(a.size)}</div>
								<div>File Type: ${a.type.toLowerCase()}</div>
							</div>
						</div>
						${Array.isArray(a.screenshots)?`
							<div class="wrapper">
								<div class="title">Screenshots</div>
								<div class="content">
									<div class="image-list">
										${a.screenshots.map(e=>`
											<div class="img">
												<img src="${e.screenshot}" alt="img">
											</div>
										`).join("")}
										
									</div>
								</div>
							</div>
						`:""}
						`,html:true},btn:{ok:{enable:false}},width:j.setting.width,height:"auto",style:`
                .pops-alert-content{
                    padding: 0 15px;
                }
                .wrapper{
                    border: 1px solid #2c3e50;
                    margin: 24px 0;
                    max-width: 100%;
                }
                .wrapper .title{
                    font-size: 18px;
                    font-weight: 700;
                    padding: 8px 24px;
                    border-bottom: 1px solid #2c3e50;
                }
                .wrapper .content{
                    padding: 24px;
                }
                .wrapper .image-list{
                    display: flex;
                    max-width: 100%;
                    overflow-x: auto;
                    overflow-y: hidden;
                    gap: 12px;
                }
                .wrapper .image-list .img{
                    flex-shrink: 0;
                    height: 120px;
                    width: 160px;
                }
                .wrapper .image-list img{
                    height: 100%;
                    width: 100%;
                    cursor: pointer;
                }
            `});}};class Na extends be{async init(e){super.init(e);let{ruleIndex:t,shareCode:n,accessCode:r}=e,s=X.getBlankUrl({ruleKeyName:"ed2k",ruleIndex:t,shareCode:n,accessCode:r}),i=f.loading("正在请求Api中..."),l=await it.parseFileMetaInfo(s);i.close(),l&&it.showFileMetaInfoDialog(l);}}class Ia extends be{errorCode={UnAuthorized:"请先登录坚果云账号"};async init(e){super.init(e);let{ruleIndex:t,shareCode:n,accessCode:r}=e;const s=this;let i=await s.getRequestDownloadParams();if(i)if(i.isdir){let l=f.loading("正在遍历多文件信息..."),o=await s.getFolderInfo(i.hash);if(!o){l.close();return}let c=s.parseMoreFile(o,i.hash,i.name);l.close(),x.staticView.moreFile("坚果云文件解析",c);}else {let l=d.formatByteToSize(i.size),o=await s.getFileLink(i.hash,i.name);if(!o)return;q.isForwardDownloadLink("jianguoyun")&&(o=q.parseDataToSchemeUri("jianguoyun",o)),g.info(o),x.staticView.oneFile({title:"坚果云盘单文件直链",fileName:i.name,fileSize:l,downloadUrl:o});}}parseMoreFile(e,t="",n=""){const r=this;g.info("解析多文件信息",e);let s=[];return e.forEach(i=>{let l=i.relPath;l.startsWith("/")&&(l=l.replace(/^\//,"")),s.push({fileName:l,fileSize:i.size,fileType:"",createTime:i.mtime,latestTime:i.mtime,isFolder:false,index:0,async clickEvent(){f.info("正在获取下载链接...");let o=await r.getDirLink(t,l,i.relPath);if(o)return f.success("获取成功！"),q.isForwardDownloadLink("jianguoyun")&&(o=q.parseDataToSchemeUri("jianguoyun",o)),g.info(o),{autoDownload:true,mode:"aBlank",url:o}}});}),s}async getRequestDownloadParams(){const e=this;g.info("获取hash值"),f.info("正在获取请求信息");let t=/var[\s]*PageInfo[\s]*=[\s]*{([\s\S]+)};/i;new FormData().append("pd",e.accessCode);let r={url:`https://www.jianguoyun.com/p/${e.shareCode}`,data:e.accessCode===""?void 0:`pd=${e.accessCode}`,responseType:"html",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Agent":d.getRandomPCUA(),Referer:`https://www.jianguoyun.com/p/${e.shareCode}`}},s;if(e.accessCode===""?s=await M.get(r):s=await M.post(r),!s.status)return;let i=s.data;g.info("请求信息"),g.info(i);let l=i.responseText.match(t);if(l){let o=l[l.length-1];o=`({${o}})`,o=window.eval(o),g.info(o);let c=o.name,u=o.size,p=o.hash,h=o.needsPassword,m=o.owner,w=o.isdir,k=o.errorCode;if(c=decodeURIComponent(c),g.success("是否是文件夹 ===> "+w),g.success("hash ===> "+p),g.success("name ===> "+c),g.success("size ===> "+u),h&&(e.accessCode==null||e.accessCode==="")){f.error("密码不正确!"),x.newAccessCodeView("密码缺失","jianguoyun",e.ruleIndex,e.shareCode,e.accessCode,C=>{e.init({ruleIndex:e.ruleIndex,shareCode:e.shareCode,accessCode:C.accessCode});});return}if(k==="AuthenticationFailed"){f.error("密码错误"),x.newAccessCodeView(void 0,"jianguoyun",e.ruleIndex,e.shareCode,e.accessCode,C=>{e.init({ruleIndex:e.ruleIndex,shareCode:e.shareCode,accessCode:C.accessCode});});return}if(p===""||p==null){g.error("hash为空，可能文件被撤销分享了"),f.error("文件分享已被撤销");return}if(u==null&&w==false){g.error("无size，可能文件被删除了"),f.error(`“${c}”文件已被拥有者（“${m}”）删除`);return}else return {name:c,hash:p,size:u,needsPassword:h,owner:m,isdir:w}}else i.responseText.match("对不起，找不到您指定的文件。")?(g.error("啊噢！ (404) 对不起，找不到您指定的文件。"),f.error("坚果云: 对不起，找不到您指定的文件。")):i.responseText.match("对不起，您的某些输入不正确。")?(g.error("可能该链接不需要访问码或者访问码有问题"),x.newAccessCodeView(void 0,"jianguoyun",e.ruleIndex,e.shareCode,e.accessCode,o=>{e.init({ruleIndex:e.ruleIndex,shareCode:e.shareCode,accessCode:o.accessCode});})):(g.error("获取PageInfo失败"),f.error("坚果云: 获取PageInfo失败"));}async getFileLink(e="",t=""){const n=this;t=encodeURIComponent(t);let r=await M.get({url:`https://www.jianguoyun.com/d/ajax/fileops/pubFileLink?k=${e}&name=${t}&wm=false${n.accessCode===""?"":"&pd="+n.accessCode}&forwin=1&_=${new Date().getTime()}`,responseType:"json",headers:{"User-Agent":d.getRandomPCUA()},allowInterceptConfig:false});if(!r.status){if(d.isNotNull(r.data?.responseText)){let l=d.toJSON(r.data.responseText);g.error("坚果云",l),l.errorCode==="UnAuthorized"?n.gotoLogin():f.error(l.detailMsg);}else f.error("请求异常");return}let s=r.data;g.info("请求信息",s);let i=d.toJSON(s.responseText);if(g.info("解析JSON",i),i.hasOwnProperty("errorCode")){f.error("坚果云: "+i.detailMsg);return}else {if(i.hasOwnProperty("url"))return i.url;f.error("坚果云: 处理下载链接异常");}}async getDirLink(e="",t="",n="/"){const r=this;t=encodeURIComponent(t);let s=await M.get({url:`https://www.jianguoyun.com/d/ajax/dirops/pubDIRLink?k=${e}&dn=${t}&p=${n}&forwin=1&_=${new Date().getTime()}`,responseType:"json",headers:{"User-Agent":d.getRandomPCUA()},allowInterceptConfig:false});if(!s.status){if(d.isNotNull(s.data?.responseText)){let o=d.toJSON(s.data.responseText);g.error("坚果云",o),o.errorCode==="UnAuthorized"?r.gotoLogin():f.error(o.detailMsg);}else f.error("请求异常");return}let i=s.data;g.info("请求信息",i);let l=d.toJSON(i.responseText);if(g.info(l),l.hasOwnProperty("errorCode")){f.error("坚果云: "+l.detailMsg);return}else {if(l.hasOwnProperty("url"))return l.url;f.error("坚果云: 处理下载链接异常");}}async getFolderInfo(e=""){let t=await M.get({url:`https://www.jianguoyun.com/d/ajax/dirops/pubDIRBrowse?hash=${e}&relPath=%2F&_=${Date.now()}`,responseType:"json",headers:{"User-Agent":d.getRandomPCUA()}});if(!t.status)return;let n=t.data;g.info("请求信息",n);let r=d.toJSON(n.responseText);if(g.info(r),"objects"in r)return r.objects;f.error("坚果云: 处理多文件信息异常");}gotoLogin(){G.confirm({title:{text:"提示",position:"center"},content:{text:"解析失败，原因：当前尚未登录坚果云，是否前往登录？"},btn:{reverse:true,position:"end",ok:{text:"前往",callback:function(e){window.open("https://www.jianguoyun.com/d/login#from=https%3A%2F%2Fwww.jianguoyun.com%2F","_blank");}}}},x.popsStyle.jianGuoYunLoginTip);}}const ge={DEFAULT_HOST_NAME:"www.lanzout.com",MENU_KEY:"lanzou-host-name",get hostname(){return F(this.MENU_KEY,this.DEFAULT_HOST_NAME).value}};let Ta=a=>(a=a.replace(/\/\/.+/gi,""),a=a.replace(/\/\*[\s\S\n]+\*\//gi,""),a);class Ma extends be{router={root(e=""){return e.startsWith("/")&&(e=e.replace(/^\//,"")),`https://${ge.hostname}/${e}`},root_tp(e=""){return e.startsWith("/")&&(e=e.replace(/^\//,"")),`https://${ge.hostname}/tp/${e}`},root_s(e=""){return e.startsWith("/")&&(e=e.replace(/^\//,"")),`https://${ge.hostname}/s/${e}`}};regexp={unicode:{match:/[%\u4e00-\u9fa5]+/g,tip:"中文链接",isUnicode:false},noFile:{match:/div>来晚啦...文件取消分享了<\/div>/g,tip:"来晚啦...文件取消分享了"},noExists:{match:/div>文件不存在，或已删除<\/div>/g,tip:"文件不存在，或已删除"},linkInValid:{match:/div>文件链接失效，请获取新链接<\/div>/g,tip:"文件链接失效，请获取新链接"},needVipToShare:{match:/class="fbox">非会员.+请先开通会员/gi,tip:"该链接为非会员用户分享的文件，目前无法下载"},moreFile:{match:/<span id=\"filemore\" onclick=\"more\(\);\">/g},sign:{match:/var[\s]*(posign|postsign|vidksek|skdklds)[\s]*=[\s]*'(.+?)';/},fileName:{match:/<title>(.*)<\/title>/},fileSize:{match:/<span class=\"mtt\">\((.*)\)<\/span>/},loadDownHost:{match:/var[\s]*(vkjxld)[\s]*=[\s]*'(.+?)'/i},loadDown:{match:/var[\s]*(loaddown|oreferr|spototo|domianload|hyggid)[\s]*=[\s]*'(.+?)'/i},appleDown:{match:/var[\s]*appitem[\s]*=[\s]*'(.+?)'/i},uploadTime:{match:/mt2\"\>时间:<\/span>(.+?)[\s]*<span/i}};async init(e){super.init(e);let{ruleIndex:t,shareCode:n,accessCode:r}=e;this.regexp.unicode.isUnicode=!!n.match(this.regexp.unicode.match);let s=t===1?this.router.root_s(n):this.router.root(n),i=await this.getPageInfo(s);if(i)if(this.isMoreFile(i)){g.info("多文件");let l=f.loading("正在解析多文件中，请稍后..."),o=await this.parseFiles(n,r);if(!o){l.close();return}let c=this.getFolderInfo(this.transformFileInfoToInfoList(n,r,o),0);l.close(),g.info("递归完毕"),x.staticView.moreFile("蓝奏云文件解析",c);}else {g.info("单文件");let l=await this.getFileDownloadInfo(n,r,i);l&&x.staticView.oneFile({title:"蓝奏云单文件直链",fileName:l.fileName,fileSize:l.fileSize,downloadUrl:l.downloadUrl,fileUploadTime:l.fileUploadTime});}}transformFileInfoToInfoList(e,t,n){return [...n.folders.map(r=>({isFolder:true,fileName:r.folderName,fileSize:0,createTime:"",latestTime:"",shareCode:r.shareCode,accessCode:r.accessCode})),...(n.infos||[]).map(r=>({isFolder:false,fileName:r.name_all,fileSize:r.size,createTime:r.time,latestTime:r.time,shareCode:r.id,accessCode:t}))].filter(r=>r!=null)}getFolderInfo(e,t){const n=this;let r=[],s=[],i=[];return e.forEach(l=>{l.isFolder?s.push({fileName:l.fileName,fileSize:0,fileType:"",createTime:l.createTime,latestTime:l.latestTime,isFolder:true,index:t,clickEvent:async()=>{let o=await this.parseFiles(l.shareCode,l.accessCode);return o?n.getFolderInfo(this.transformFileInfoToInfoList(this.shareCode,this.accessCode,o),t+1):[]}}):i.push({fileName:l.fileName,fileSize:l.fileSize,fileType:"",createTime:l.createTime,latestTime:l.latestTime,isFolder:false,index:t,clickEvent:async()=>{let o=this.ruleIndex===1?this.router.root_s(l.shareCode):this.router.root(l.shareCode),c=await this.getPageInfo(o);if(!c)return;let u=await this.getFileDownloadInfo(l.shareCode,l.accessCode,c);if(u)return {url:u.downloadUrl,autoDownload:true,mode:"aBlank"}}});}),s.sort((l,o)=>l.fileName.localeCompare(o.fileName)),i.sort((l,o)=>l.fileName.localeCompare(o.fileName)),r=r.concat(s),r=r.concat(i),r}async getFileDownloadInfo(e,t,n){let r,s=b.parseHTML(n.responseText,true,true),i=Ta(n.responseText),l=s.querySelector('iframe[class^="ifr"]')||s.querySelector('iframe[class^="n_downlink"]');if(l){let o=l.getAttribute("src");g.error("该链接需要重新通过iframe地址访问获取信息",o),f.info("正在请求下载信息");let c=s.querySelector("body div.d > div")?.innerText||s.querySelector("#filenajax")?.innerText||s.querySelector("title")?.textContent?.replace(/ - 蓝奏云$/i,""),u=i.match(/文件大小：<\/span>(.+?)<br>/i)||s.querySelector("div.n_box div.n_file div.n_filesize")?.innerText||s.querySelector(".d2 table tr td .fileinfo:nth-child(1) .fileinforight")?.innerText,p=i.match(/上传时间：<\/span>(.+?)<br>/i)||s.querySelector("#file[class=''] .n_file_info span.n_file_infos")?.innerText||s.querySelector(".d2 table tr td .fileinfo:nth-child(3) .fileinforight")?.innerText||s.querySelector("#file[class='filter'] .n_file_info span.n_file_infos")?.innerText;u?(Array.isArray(u)&&(u=u[u.length-1]),typeof u=="string"&&(u=u.replaceAll("大小：",""))):g.error("解析文件大小信息失败"),p?(Array.isArray(p)&&(p=p[p.length-1]),p.toString().toLowerCase().startsWith("android")&&(g.error("解析出的文件上传时间信息是Android/xxxx开头"),p=void 0)):g.error("解析文件上传时间信息失败");let h=await this.getLinkByIframe(e,t,o,{fileName:c,fileSize:u,fileUploadTime:p});if(!h)return;r={fileName:c,fileSize:u,downloadUrl:h,fileUploadTime:p};}else {g.warn("该页面不是使用iframe获取链接，使用其它方式解析");let o=i.match(/'sign':'(.+?)',/i)||i.match(this.regexp.sign.match),c="",u="",p=i.match(this.regexp.fileName.match),h=p?p[p.length-1].trim():"",m=i.match(this.regexp.fileSize.match)||i.match(/<div class="n_filesize">大小：(.+?)<\/div>/i),w=m?m[m.length-1].trim():"",k=i.match(this.regexp.uploadTime.match)||i.match(/<span class="n_file_infos">(.+?)<\/span>/i),C=k?k[k.length-1].trim():"",A=i.match(/[\s]+url[\s]+:[\s]+'\/ajaxm.php\?file=([0-9]+)',/i)||i.match(/\/\/url[\s]+:[\s]+'\/ajaxm.php\?file=([0-9]+)',/i),$=A?A[A.length-1]:"1";if(o){u=o[o.length-1],g.info(`获取Sign: ${u}`),d.isNotNull(t)?(g.info("传入参数=>有密码"),c=t):g.info("传入参数=>无密码");let R=await this.getKNDS(),I=await M.post({url:this.router.root("ajaxm.php?file="+$),responseType:"json",headers:{accept:"application/json, text/javascript, */*","Content-Type":"application/x-www-form-urlencoded","User-Agent":d.getRandomAndroidUA(),Origin:"https://"+ge.hostname,Referer:this.router.root(e)},data:`action=downprocess&sign=${u}&p=${c}&kd=${R}`});if(!I.status)return;let v=I.data;g.info(v);let _=d.toJSON(v.responseText),S=`${_.dom}/file/${_.url}`;if(typeof _.url=="string"&&(_.url.startsWith("http")||_.url.startsWith(_.dom))&&(S=_.url),_.zt,"密码不正确".indexOf(_.inf)!=-1){f.error("密码不正确!");let N=await new Promise(P=>{x.newAccessCodeView(void 0,"lanzou",this.ruleIndex,e,t,Z=>{P({accessCode:Z.accessCode});},()=>{P(void 0);});});if(!N)return;t=N.accessCode;let T=this.ruleIndex===1?this.router.root_s(e):this.router.root(e),E=await this.getPageInfo(T);return E?await this.getFileDownloadInfo(e,t,E):void 0}else h=_.inf?_.inf:h;r={fileName:h,fileSize:w,fileUploadTime:C,downloadUrl:S};}else {let R=i.match(this.regexp.loadDownHost.match),I=i.match(this.regexp.loadDown.match),v=i.match(this.regexp.appleDown.match),_=v[v.length-1];if(d.isNull(I)&&(I=i.match(/var[\s]*(cppat)[\s]*=[\s]*'(.+?)'/i)),d.isNull(R)&&_&&(_=_[_.length-1],R=[_],I=[""],g.success("多文件-当前链接猜测为苹果的文件",_)),d.isNull(R)){f.error("蓝奏云直链：获取sign的域名失败，请反馈开发者",{timeout:3500});return}if(d.isNull(I)){f.error("蓝奏云直链：获取sign失败，请反馈开发者",{timeout:3500});return}let S=`${R[R.length-1]}${I[I.length-1]}`;r={fileName:h,fileSize:w,fileUploadTime:C,downloadUrl:S};}}return r&&q.isForwardDownloadLink("lanzou")&&(r.downloadUrl=q.parseDataToSchemeUri("lanzou",r.downloadUrl)),r}async getPageInfo(e){let t=await M.get({url:e,headers:{Accept:"*/*","User-Agent":d.getRandomPCUA(),Referer:e},allowInterceptConfig:false});if(!t.status){if(g.error(t),t.type==="ontimeout"){f.error("请求超时");return}if(d.isNull(t.data.responseText)){f.error("请求异常");return}this.checkPageCode(t.data)&&f.error("请求失败，未知情况");return}let n=t.data.responseText;if(d.isNull(n)){g.error(t),f.error("获取网页内容为空");return}if(!this.checkPageCode(t.data)){g.error(t);return}return t.data}checkPageCode(e){let t=e.responseText;return t.match(this.regexp.noFile.match)?(f.error(this.regexp.noFile.tip),false):t.match(this.regexp.noExists.match)?(f.error(this.regexp.noExists.tip),false):t.match(this.regexp.needVipToShare.match)?(f.error(this.regexp.needVipToShare.tip),false):t.match(this.regexp.linkInValid.match)?(f.error(this.regexp.linkInValid.tip),false):true}isMoreFile(e){return e.responseText.match(this.regexp.moreFile.match)?(g.info("该链接为多文件"),true):(g.info("该链接为单文件"),false)}async parseFiles(e,t){let n=this.ruleIndex===1?this.router.root_s(e):this.router.root(e),r=await this.getPageInfo(n);if(!r)return;let s=r.responseText,i=b.parseHTML(s,true,true),l=Array.from(i.querySelectorAll("#folder a.mlink[href]")).map(_=>{let S=_.href,T=new URL(S).pathname.match(/^\/([0-9a-zA-Z]{5,})/);if(T==null)return;let E=T[T.length-1],Z=_.querySelector(".filename")?.firstChild?.textContent||"";return {url:S,shareCode:E,accessCode:t,folderName:Z}}).filter(_=>_!=null),o,c=s.match(/\'fid\':(.+?),/)[1].replaceAll("'",""),u=s.match(/\'uid\':(.+?),/)[1].replaceAll("'",""),p=1,h=s.match(/\'t\':(.+?),/)[1],m=new RegExp(h+`[\\s]*=[\\s]*('|")(.+?)('|");`),w=s.match(m)[2],k=s.match(/\'k\':(.+?),/)[1],C=new RegExp(k+`[\\s]*=[\\s]*('|")(.+?)('|");`),A=s.match(C)[2],$=e.match(this.regexp.unicode.match)?1:2,R=await this.fileMoreAjax(e,t,{lx:$,fid:c,uid:u,pg:p,t:w,k:A,pwd:t}),I;if(R){g.info("json_data：",R);const{zt:_,info:S,text:N}=R;if(_!==1)if(_===4)I=N;else if(S?.includes("密码不正确")){f.error("密码不正确!");let T=await new Promise(E=>{x.newAccessCodeView(void 0,"lanzou",this.ruleIndex,e,t,P=>{E({accssCode:P.accessCode});},()=>{E(void 0);});});return T?await this.parseFiles(e,T.accssCode):void 0}else S?.includes("没有了")?I="没有文件了":I="未知错误";Array.isArray(N)&&(o=N);}typeof I=="string"&&g.error(I);let v={folders:l,infos:o};return g.info(v),v}async getLinkByIframe(e,t,n,r){g.info(n,r);let s=this.router.root(n),i=await M.get({url:s,headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","User-Agent":d.getRandomPCUA(),Referer:this.router.root(e)}});if(!i.status)return;let l=i.data;g.info(l);let o=l.responseText,c=o.match(/'websignkey'[\s]*:[\s]*'(.+?)'/i)||o.match(/var[\s]*aihidcms[\s]*=[\s]*'(.*)';/i),u=o.match(/var[\s]*ciucjdsdc[\s]*=[\s]*'(.*)';/i),p=o.match(/var[\s]*ajaxdata[\s]*=[\s]*'(.+)';/i),h=o.match(/'sign':[\s]*'(.+)',/i)||o.match(/var[\s]*wp_sign[\s]*=[\s]*'(.*)';/i),m=o.match(/[^\/\/]url[\s]*:[\s]*'(.+?)'[\s]*,/i)||o.match(/url[\s]*:[\s]*'(.+?)'[\s]*,/),w="ajaxm.php",k="",C="",A="",$="",R=await this.getKNDS();if(m?w=m[m.length-1]:f.error("提取ajaxm.php的具体参数失败，使用默认的"+w),c)k=c[c.length-1];else {f.error("ajaxm.php请求参数 websignkey 获取失败");return}if(u)C=u[u.length-1];else {f.error("ajaxm.php请求参数 websign 获取失败");return}if(p)A=p[p.length-1];else {f.error("ajaxm.php请求参数 signs 获取失败");return}if(h)$=h[h.length-1];else {f.error("ajaxm.php请求参数 sign 获取失败");return}let I={action:"downprocess",signs:A,sign:$,websign:C,websignkey:k,kd:R,ves:1};g.success("请求的路径参数："+w),g.success(["ajaxm.php的请求参数-> ",I]);let v=await M.post(this.router.root(w),{data:d.toSearchParamsStr(I),headers:{Accept:"application/json, text/javascript, */*","Content-Type":"application/x-www-form-urlencoded",Referer:this.router.root(e),"User-Agent":d.getRandomPCUA()}});if(!v.status)return;let _=v.data;g.info(_);let S=d.toJSON(_.responseText),N=`${S.dom}/file/${S.url}`;if(S.zt,await M.get("https://down-load.lanrar.com/file/kdns.js",{allowInterceptConfig:false}),(await M.get("https://boce.lanosso.com/file/kdns2.js",{allowInterceptConfig:false})).status?g.info("测试killdns2成功，不改变原downloadUrl"):(N+="&lanosso",g.info("测试killdns2失败使用参数 lanosso")),g.success("直链",N),"密码不正确".indexOf(S.inf)!=-1)f.error("密码不正确!"),x.newAccessCodeView(void 0,"lanzou",this.ruleIndex,e,t,E=>{this.init({ruleIndex:this.ruleIndex,shareCode:e,accessCode:E.accessCode});});else return r.fileName=d.isNotNull(S.inf)?S.inf:r.fileName,g.info(N),N}async getKNDS(){let e=await M.get("https://down-load.lanrar.com/file/kdns.js",{allowInterceptConfig:false});return e.status&&d.isNotNull(e.data.responseText)?1:0}async fileMoreAjax(e,t,n){let r=d.toFormData({rep:0,up:1,ls:1,...n}),s=this.router.root("filemoreajax.php"),i=await M.post({url:this.router.root("filemoreajax.php"),responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","User-Agent":d.getRandomAndroidUA(),Referer:s},data:r});if(!i.status)return;let l=i.data;return g.info(l),d.toJSON(l.responseText)}}const at={LanZouDiskApp:"lanZouY-disk-app",EncryptList:["Y","y","0","Z","z","N","n","M","I","6","m","W","w","1","X","x","L","l","K","7","k","i","U","u","2","V","v","J","j","8","G","g","F","S","s","3","T","t","H","h","f","E","e","D","Q","q","4","R","r","9","d","a","C","c","B","O","o","5","P","p","b","A"],decodeChar(a){for(let e=0;e<this.EncryptList.length;e++)if(a==this.EncryptList[e])return e;return  -1},idEncrypt(a){let e=1,t=0;if(a!=""&&a.length>4){let n;a=a.substring(3,a.length-1);for(let r=0;r<a.length;r++)n=a.charAt(a.length-r-1),t+=this.decodeChar(n)*e,e*=62;}return t},encrypt(a){const e=Pe.enc.Utf8.parse(this.LanZouDiskApp),t=Pe.enc.Utf8.parse(a);return Pe.AES.encrypt(t,e,{mode:Pe.mode.ECB,padding:Pe.pad.Pkcs7})},encryptHex(a){return this.encrypt(a,this.LanZouDiskApp).ciphertext.toString().toUpperCase()}};class $a extends be{$data={devType:6,devModel:"Chrome",extra:2,type:0,offset:1,limit:60};uuid=void 0;userId=void 0;shareCodeId=void 0;async init(e){super.init(e);let{ruleIndex:t,shareCode:n,accessCode:r}=e;this.shareCodeId=this.getDecodeShareCodeId(n),this.uuid=this.getEncodeUUID();let s=await this.recommendList(this.$data.devType,this.$data.devModel,this.uuid,this.$data.extra,this.getEncodeTimeStamp(),this.shareCode,this.$data.type,this.$data.offset,this.$data.limit);if(s&&s.list.length){if(s.list[0]?.map?.userId)this.userId=s.list[0]?.map?.userId;else {f.error("解析获取【userId】为空");return}if(s.list[0].folderIds==null){g.success("该链接是 单文件");let i=s.list[0].fileList[0],o=await this.parseFolderInfo(s.list[0].fileList,0)[0].clickEvent();if(o&&!Array.isArray(o)){let c=o.url;q.isForwardDownloadLink("lanzouyx")&&(c=q.parseDataToSchemeUri("lanzouyx",c)),x.staticView.oneFile({title:"蓝奏云优享单文件直链",fileName:i.fileName,fileSize:i.fileSize*1024,downloadUrl:c,fileUploadTime:d.formatToTimeStamp(i.updTime),fileLatestTime:d.formatToTimeStamp(i.updTime)});}}else {g.success("该链接是 多文件"),f.info("正在递归文件");let i=f.loading("正在解析多文件中，请稍后..."),l=this.parseFolderInfo(s.list[0].fileList,0);i.close(),g.info("递归完毕"),x.staticView.moreFile("蓝奏云优享解析",l);}}}parseFolderInfo(e,t){const n=this;let r=[],s=[],i=[];return e.forEach(l=>{l.fileType===2?s.push({fileName:l.folderName,fileSize:0,fileType:"",createTime:new Date(l.updTime).getTime(),latestTime:new Date(l.updTime).getTime(),isFolder:true,index:t,async clickEvent(o,c){let u=n.getEncodeTimeStamp(),p=l.folderId,h=await n.getFolderInfo(n.$data.devType,n.$data.devModel,n.uuid,n.$data.extra,u,n.shareCode,p,n.$data.offset,n.$data.limit);return h&&h.list?n.parseFolderInfo(h.list,t+1):[]}}):i.push({fileName:l.fileName,fileSize:l.fileSize*1024,fileType:"",createTime:new Date(l.updTime).getTime(),latestTime:new Date(l.updTime).getTime(),isFolder:false,index:t,async clickEvent(){let o=l.fileId,c=l.userId||n.userId,u=n.uuid;if(d.isNull(c)){f.error("获取【userId】为空");return}if(d.isNull(u)){f.error("获取【uuid】为空");return}let p=await n.getDownloadFileUrl(...n.getDownloadFileParams(o,c,u));if(p)return q.isForwardDownloadLink("lanzouyx")&&(p=q.parseDataToSchemeUri("lanzouyx",p)),{url:p,autoDownload:true,mode:"aBlank"}}});}),s.sort((l,o)=>l.fileName.localeCompare(o.fileName)),i.sort((l,o)=>l.fileName.localeCompare(o.fileName)),r=r.concat(s),r=r.concat(i),r}async recommendList(e=this.$data.devType,t=this.$data.devModel,n="",r=this.$data.extra,s="",i="",l=this.$data.type,o=this.$data.offset,c=this.$data.limit){let u=await M.post(`https://api.ilanzou.com/unproved/recommend/list?${d.toSearchParamsStr({devType:e,devModel:t,uuid:n,extra:r,timestamp:s,shareId:i,code:this.accessCode,type:l,offset:o,limit:c})}`,{headers:{Accept:"application/json, text/plain, */*",Origin:"https://www.ilanzou.com",Referer:"https://www.ilanzou.com/","Sec-Fetch-Site":"same-site",Host:"api.ilanzou.com","User-Agent":d.getRandomPCUA()},responseType:"json"});if(!u.status)return;let p=d.toJSON(u.data.responseText);if(g.success("获取链接信息：",p),p.code!==200){f.error("请求链接信息失败");return}if(!p.list.length){f.error("获取链接信息为空");return}return p}async getFolderInfo(e=this.$data.devType,t=this.$data.devModel,n="",r=this.$data.extra,s="",i="",l="",o=this.$data.offset,c=this.$data.limit){let u=await M.post(`https://api.ilanzou.com/unproved/share/list?${d.toSearchParamsStr({devType:e,devModel:t,uuid:n,extra:r,timestamp:s,shareId:i,code:this.accessCode,folderId:l,offset:o,limit:c})}`,{headers:{Accept:"application/json, text/plain, */*",Origin:"https://www.ilanzou.com",Referer:"https://www.ilanzou.com/","Sec-Fetch-Site":"same-site",Host:"api.ilanzou.com","User-Agent":d.getRandomPCUA()}});if(!u.status)return;let p=d.toJSON(u.data.responseText);if(g.success("获取文件列表信息：",p),p.code===200)return p;f.error(p.msg);}async getDownloadFileUrl(e="",t=1,n=this.$data.devType,r="",s="",i="",l=this.shareCode){return `https://api.ilanzou.com/unproved/file/redirect?${d.toSearchParamsStr({downloadId:e,enable:t,devType:n,uuid:r,timestamp:s,auth:i,shareId:l})}`}getEncodeUUID(e=21){return ((n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((r,s)=>(s&=63,r+=s<36?s.toString(36):s<62?(s-26).toString(36).toUpperCase():s>62?"-":"_",r),""))(e)}getDecodeShareCodeId(e){return at.idEncrypt(e)}getEncodeTimeStamp(e=Date.now()){return at.encryptHex(e)}getDownloadFileParams(e,t="",n){const r=this;let s=Date.now(),i=at.encryptHex(e+"|"+t),l=1,o=r.getEncodeTimeStamp(s),c=at.encryptHex(e+"|"+s);return [i,l,r.$data.devType,n,o,c,r.shareCode]}gotoLogin(){G.confirm({title:{position:"center",text:"蓝奏云优享"},content:{text:"必须先在【蓝奏云优享】进行登录，然后登录成功后刷新获取必备的下载参数【uuid】和【userId】。",html:false},btn:{reverse:true,position:"end",ok:{text:"前往",enable:true,callback(){window.open("https://www.ilanzou.com","_blank");}}}},x.popsStyle.tianYiYunLoginTip);}}class Ea extends be{async init(e){super.init(e);let{ruleIndex:t,shareCode:n,accessCode:r}=e,s=X.getBlankUrl({ruleKeyName:"magnet",ruleIndex:t,shareCode:n,accessCode:r}),i=f.loading("正在请求Api中..."),l=await it.parseFileMetaInfo(s);i.close(),l&&it.showFileMetaInfoDialog(l);}}const Lt={isSupport_GM_download(){try{return typeof bt=="function"}catch(a){return console.error(a),false}}};class La extends be{panelList=[];panelContent="";OK_CODE="0000";async init(e){super.init(e);let{ruleIndex:t,shareCode:n,accessCode:r}=e;this.panelList=[],this.panelContent="";let s=await this.checkLinkValidity(this.shareCode,this.accessCode);if(s)if(s.isFolder){f.info("正在递归文件");let i=f.loading("正在解析多文件中，请稍后..."),l=await this.getShareFolder(s.data.guid);if(!l){i.close();return}let o=await this.getShareFiles(s.data.guid);if(!o){i.close();return}let c=this.getFolderInfo(s.data.guid,l,o,0);i.close(),g.info("递归完毕"),x.staticView.moreFile("奶牛快传文件解析",c);}else {let i;if(s.zipDownload?i=await this.getZipFileDownloadUrl(this.shareCode,s.guid,s.fileName):i=await this.getDownloadUrl(this.shareCode,s.guid,s.id),!i)return;q.isForwardDownloadLink("nainiu")&&(i=q.parseDataToSchemeUri("nainiu",i)),x.staticView.oneFile({title:"奶牛快传单文件直链",fileName:s.fileName,fileType:s.fileType,fileSize:s.fileSize,downloadUrl:i,fileUploadTime:s.fileUploadTime,fileLatestTime:s.fileLatestTime,clickCallBack:l=>{this.downloadFile(s.fileName,i);}});}}async checkLinkValidity(e,t){const n=this;let r=await n.getShareByUniqueUrl(e);if(!r)return  false;let s=r.code,i=r.message;if(s!==n.OK_CODE)return f.error(i),false;{let l=r.data.needPassword,o=r.data.zipDownload;return l&&d.isNull(t)?(f.error("密码缺失!"),x.newAccessCodeView("密码缺失","nainiu",n.ruleIndex,n.shareCode,n.accessCode,c=>{n.init({ruleIndex:n.ruleIndex,shareCode:n.shareCode,accessCode:c.accessCode});}),false):o?(f.success("该链接为zip单文件"),{zipDownload:o,guid:r.data.guid,fileSize:d.formatByteToSize(r.data.firstFolder.size),fileName:r.data.firstFolder.title,fileUploadTime:d.formatTime(r.data.firstFolder.created_at),fileLatestTime:d.formatTime(r.data.firstFolder.updated_at)}):r.data.firstFile==null?(f.success("该链接为文件夹类型"),{isFolder:true,guid:r.data.guid,firstFolder:r.data.firstFolder,data:r.data}):{zipDownload:o,guid:r.data.guid,id:r.data.firstFile.id,fileSize:d.formatByteToSize(r.data.firstFile.file_info.size),fileName:r.data.firstFile.file_info.title,fileType:r.data.firstFile.file_info.format,fileUploadTime:d.formatTime(r.data.firstFile.created_at),fileLatestTime:d.formatTime(r.data.firstFile.updated_at)}}}getFolderInfo(e,t,n,r=0){const s=this;let i=[],l=[],o=[];return t.forEach(c=>{i.push({fileName:c.title,fileSize:0,fileType:"",createTime:c.created_at,latestTime:c.updated_at,isFolder:true,index:r,async clickEvent(){if(!c.child_folder_count&&!c.content_count)return [];let u=await s.getShareFolder(e,c.id);if(!u)return [];let p=await s.getShareFiles(e,c.id);return p?s.getFolderInfo(e,u,p,r+1):[]}});}),n.forEach(c=>{let u=c.file_info.title,p=c.file_info.format??"";p&&(u=u+"."+p),i.push({fileName:u,fileSize:c.file_info.size,fileType:p,createTime:c.created_at,latestTime:c.updated_at,isFolder:false,index:r,async clickEvent(){let h=await s.getDownloadUrl(s.shareCode,e,c.id);h&&(q.isForwardDownloadLink("nainiu")&&(h=q.parseDataToSchemeUri("nainiu",h)),s.downloadFile(u,h));}});}),l.sort((c,u)=>c.fileName.localeCompare(u.fileName)),o.sort((c,u)=>c.fileName.localeCompare(u.fileName)),i=i.concat(l),i=i.concat(o),g.info("getFolderInfo",i),i}async parseMoreFile(e,t){}async getShareFolder(e,t="",n=0,r=100){const s=this;let i=await M.get(`https://cowtransfer.com/core/api/transfer/share/folders?transferGuid=${e}&folderId=${t}&page=${n}&size=${r}`,{headers:{Accept:"application/json","User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/"}});if(g.success(i),!i.status)return;let l=d.toJSON(i.data.responseText);if(l.code!==s.OK_CODE){f.error(l.message);return}let o=l.data.folders;if(!Array.isArray(o)){f.error("data.folders不是数组");return}return o}async getShareFiles(e,t="",n=0,r=20,s=false){const i=this;let l=await M.get(`https://cowtransfer.com/core/api/transfer/share/files?transferGuid=${e}&folderId=${t}&page=${n}&size=${r}&subContent=${s}`,{headers:{Accept:"application/json","User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/"}});if(g.success(l),!l.status)return;let o=d.toJSON(l.data.responseText);if(o.code!==i.OK_CODE){f.error(o.message);return}let c=o.data.files;if(!Array.isArray(c)){f.error("data.files不是数组");return}return c}async getShareByUniqueUrl(e){let t=`https://cowtransfer.com/core/api/transfer/share?uniqueUrl=${e}`,n=await M.get({url:t,headers:{"User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/s/"+e}});if(g.info(n),!n.status)return;let r=n.data,s=d.toJSON(r.responseText);return g.info("转换的JSON",s),s}async getDownloadUrl(e,t="",n=""){const r=this;let s=`https://cowtransfer.com/core/api/transfer/share/download?transferGuid=${t}&fileId=${n}`,i=await M.get({url:s,headers:{"User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/s/"+e}});if(g.info(i),!i.status)return;let l=i.data,o=d.toJSON(l.responseText);if(g.info("转换的JSON",o),o.code===r.OK_CODE)return o.data.downloadUrl;f.error(`奶牛快传-获取直链：${o.message}`);}async getZipFileDownloadUrl(e,t="",n=""){const r=this;let s=`https://cowtransfer.com/core/api/transfer/share/download?transferGuid=${t}&title=${n}`,i=await M.get({url:s,headers:{"User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/s/"+e}});if(g.info(i),!i.status)return;let l=i.data,o=d.toJSON(l.responseText);if(g.info("转换的JSON",o),o.code===r.OK_CODE)return o.data.downloadUrl;f.error(`奶牛快传-获取直链：${o.message}`);}async downloadFile(e,t){if(g.info("下载文件：",e,t),window.location.hostname==="cowtransfer.com"){window.open(t,"_blank");return}if(!Lt.isSupport_GM_download()){f.error("当前脚本环境不支持API 【GM_download】");return}f.info(`调用【GM_download】下载：${e}`);let n=null,r=false,s=false,i=f.loading("下载中...",{showClose:true,onClose(){!r&&typeof n=="function"&&n();}}),l=bt({url:t,name:e,headers:{Referer:"https://cowtransfer.com/s/"+this.shareCode},onload(){r=true,i.close(),f.success(`下载 ${e} 已完成`,{consoleLogContent:true});},onprogress(o){if(typeof o=="object"&&"loaded"in o&&"total"in o&&!s){let u=(o.loaded/o.total*100).toFixed(2);i.setText(`下载中...${u}%`),o.loaded===o.total&&(s=true);}},onerror(o){i.close(),g.error("下载失败error👉",o),typeof o=="object"&&o.error?f.error(`下载 ${e} 失败或已取消 原因：${o.error}`,{timeout:6e3,consoleLogContent:true}):f.error(`下载 ${e} 失败或已取消`,{consoleLogContent:true});},ontimeout(){i.close(),f.error(`下载 ${e} 请求超时`,{consoleLogContent:true});}});typeof l=="object"&&l!=null&&"abort"in l&&(n=l.abort);}}class Fa extends be{shareId=void 0;shareMode=1;code={ShareNotFoundFlatDir:"抱歉，该文件的分享平铺目录未找到",ShareNotFound:"抱歉，您访问的页面地址有误，或者该页面不存在。",ShareAuditNotPass:"抱歉，该内容审核不通过",FileNotFound:"抱歉，文件不存在",ShareExpiredError:"抱歉，您访问的页面地址有误，或者该页面不存在",ShareAuditWaiting:"抱歉，该链接处于审核中",ShareInfoNotFound:"抱歉，您访问的页面地址有误，或者该页面不存在",FileTooLarge:"抱歉，文件太大，不支持下载",InvalidSessionKey:"天翼云PC端Cookie未生成，是否前去登录？<br />&nbsp;&nbsp;&nbsp;&nbsp;(注意,需要当前浏览器的UA切换成PC且在登录后要等待进入个人云空间后生成Cookie，不是手机端浏览的个人云空间，那样生成的Cookie无法使用)"};async init(e){super.init(e);let{ruleIndex:t,shareCode:n,accessCode:r}=e,s=await this.getShareInfoByCodeV2(n);if(s){if(g.info("解析的JSON信息",s),s.needAccessCode&&d.isNull(this.accessCode)){f.error("密码不正确!"),x.newAccessCodeView(void 0,"tianyiyun",this.ruleIndex,this.shareCode,this.accessCode,i=>{this.init({ruleIndex:this.ruleIndex,shareCode:this.shareCode,accessCode:i.accessCode});});return}if("shareId"in s)this.shareId=s.shareId;else {let i=await this.getShareId(n,r);i&&(this.shareId=i);}if("shareMode"in s&&(this.shareMode=s.shareMode),this.shareId!=null)if(s.isFolder){f.info("正在递归文件");let i=f.loading("正在解析多文件中，请稍后..."),l=s.fileId,o=await this.listShareDir(n,r,void 0,void 0,l,l,void 0,this.shareId,void 0,void 0,void 0);if(!o){i.close();return}let c=this.getFolderInfo(n,r,o,0);i.close(),g.info("递归完毕"),x.staticView.moreFile("天翼云文件解析",c);return}else {let i=await this.getDownloadUrl(this.shareCode,this.accessCode,s.fileId,this.shareId);i&&(q.isForwardDownloadLink("tianyiyun")&&(i=q.parseDataToSchemeUri("tianyiyun",i)),x.staticView.oneFile({title:"天翼云单文件直链",fileName:s.fileName,fileSize:d.formatByteToSize(s.fileSize),downloadUrl:i,fileUploadTime:s.fileCreateDate,fileLatestTime:s.fileLastOpTime}));}}}async getUserBriefInfo(e){const t=this;let n=await M.get("https://cloud.189.cn/api/portal/v2/getUserBriefInfo.action",{headers:{Accept:"application/json;charset=UTF-8",Referer:"https://cloud.189.cn/web/share?code="+e,"User-Agent":d.getRandomPCUA()},allowInterceptConfig:false});if(g.info(n),!n.status){let s=d.toJSON(n.data.responseText);s.res_code in t.code?f.error(t.code[s.res_code]):f.error("请求异常");return}let r=d.toJSON(n.data.responseText);if(r.res_code===0)return r}async getShareInfoByCodeV2(e){const t=this;let n=await M.post({url:"https://cloud.189.cn/api/open/share/getShareInfoByCodeV2.action",data:`shareCode=${e}`,headers:{Accept:"application/json;charset=UTF-8","Content-Type":"application/x-www-form-urlencoded","User-Agent":d.getRandomPCUA(),"Sign-Type":1,Referer:"https://cloud.189.cn/web/share?code="+e,Origin:"https://cloud.189.cn"},allowInterceptConfig:false});if(!n.status){let i=d.toJSON(n.data.responseText);g.error("获取下载参数失败的JSON信息",i),i.res_code in t.code?f.error(t.code[i.res_code]):f.error(i.res_message);return}let r=n.data;g.info(r);let s=d.toJSON(r.responseText);if(s.res_code==0)return s;t.code.hasOwnProperty(s.res_code)?f.error(t.code[s.res_code]):f.error("获取FileId失败");}async getShareId(e,t){let n=await M.get({url:`https://cloud.189.cn/api/open/share/checkAccessCode.action?shareCode=${e}&accessCode=${t}`,headers:{Accept:"application/json;charset=UTF-8","Cache-Control":"no-cache","User-Agent":d.getRandomPCUA(),"Sign-Type":1,Referer:`https://cloud.189.cn/web/share?code=${e}`},responseType:"json"});if(!n.status)return;let r=n.data;g.info(r);let s=d.toJSON(r.responseText);if(s.res_code===0&&"shareId"in s)return s.shareId;f.error("获取shareId失败"),g.info(s);}getNoCacheValue(){let e="";for(let t=0;t<17;t++)e+=d.getRandomValue(1,9);return "0."+e}async getDownloadUrl(e,t,n,r){const s=this;let i=await M.get({url:`https://cloud.189.cn/api/open/file/getFileDownloadUrl.action?fileId=${n}&dt=1&shareId=${r}`,headers:{Accept:"application/json;charset=UTF-8","Cache-Control":"no-cache","User-Agent":d.getRandomPCUA(),Referer:`https://cloud.189.cn/web/share?code=${e}`,"Sign-Type":1},responseType:"json",allowInterceptConfig:false});if(g.info(i),!i.status){let c=d.toJSON(i.data.responseText);c.errorCode==="InvalidSessionKey"?s.gotoLogin(s.code.InvalidSessionKey):c.res_code in s.code?f.error(s.code[c.res_code]):f.error("请求异常");return}let l=i.data,o=d.toJSON(l.responseText);if(g.info(o),o.res_code===0)return o.fileDownloadUrl;o.res_code==="InvalidSessionKey"||o.errorCode==="InvalidSessionKey"?s.gotoLogin(s.code.InvalidSessionKey):s.code.hasOwnProperty(o.res_code)?f.error(s.code[o.res_code]):(f.error("请求失败"),g.error(l));}gotoLogin(e=""){G.confirm({title:{position:"center",text:"天翼云"},content:{text:e,html:false},btn:{reverse:true,position:"end",ok:{text:"前往",enable:true,callback(){window.open("https://cloud.189.cn/api/portal/loginUrl.action?redirectURL=https://cloud.189.cn/web/main","_blank");}}}},x.popsStyle.tianYiYunLoginTip);}async listShareDir(e,t,n=1,r=60,s,i,l=true,o,c=5,u="lastOpTime",p=true){const h=this,m={pageNum:n,pageSize:r,fileId:s,shareDirFileId:i,isFolder:l,shareId:o,shareMode:this.shareMode,iconOption:c,orderBy:u,descending:p,accessCode:t};let w=await M.get(`https://cloud.189.cn/api/open/share/listShareDir.action?${d.toSearchParamsStr(m)}`,{headers:{Accept:"application/json;charset=UTF-8",Referer:`https://cloud.189.cn/web/share?code=${e}`,"Sign-Type":1,"User-Agent":d.getRandomPCUA()},responseType:"json",allowInterceptConfig:false});if(!w.status){let A=d.toJSON(w.data.responseText);g.error("解析文件夹信息失败",A),A.res_code in h.code?f.error(h.code[A.res_code]):"res_message"in A?f.error(A.res_message):f.error("解析文件夹信息失败");return}let k=w.data;g.info(k);let C=d.toJSON(k.responseText);if(C.res_code==0)return C.fileListAO;h.code.hasOwnProperty(C.res_code)?f.error(h.code[C.res_code]):f.error("获取FileId失败");}getFolderInfo(e,t,n,r=0){const s=this;let i=[],l=[],o=[];return n.folderList.forEach(c=>{i.push({fileName:c.name,fileSize:0,fileType:"",createTime:d.formatToTimeStamp(c.createDate),latestTime:d.formatToTimeStamp(c.lastOpTime),isFolder:true,index:r,async clickEvent(){let u=await s.listShareDir(e,t,1,100,c.id,c.id,void 0,s.shareId,void 0,void 0,void 0);return u?s.getFolderInfo(e,t,u,r+1):[]}});}),n.fileList.forEach(c=>{i.push({fileName:c.name,fileSize:c.size,fileType:"",createTime:d.formatToTimeStamp(c.createDate),latestTime:d.formatToTimeStamp(c.lastOpTime),isFolder:false,index:r,async clickEvent(){let u=await s.getDownloadUrl(e,t,c.id,s.shareId);if(u)return q.isForwardDownloadLink("tianyiyun")&&(u=q.parseDataToSchemeUri("tianyiyun",u)),{autoDownload:true,mode:"aBlank",url:u}}});}),l.sort((c,u)=>c.fileName.localeCompare(u.fileName)),o.sort((c,u)=>c.fileName.localeCompare(u.fileName)),i=i.concat(l),i=i.concat(o),g.info("getFolderInfo",i),i}}class Oa extends be{async init(e){super.init(e);let{ruleIndex:t,shareCode:n,accessCode:r}=e;if(f.info("检查是否已登录UC网盘"),!await this.isLogin()){this.gotoLogin("检测到尚未登录UC网盘，是否前去登录？<br />&nbsp;&nbsp;&nbsp;&nbsp;(注意,需要当前浏览器的UA切换成PC才有登录选项)");return}let i=await this.getStoken(this.shareCode,this.accessCode);if(!i)return;let l=await this.getDetail(this.shareCode,this.accessCode,i);if(!l){f.error("UC网盘：获取detail失败");return}if(l.length===1&&l[0].dir==false&&l[0].file_type===1){let o=l[0],c=await this.getDownload(this.shareCode,i,o.fid,o.share_fid_token);if(!c)return;if(!c[0].download_url){f.error("获取download_url失败");return}x.staticView.oneFile({title:"UC网盘单文件直链",fileName:c[0].file_name,fileSize:d.formatByteToSize(c[0].size),downloadUrl:c[0].download_url,fileUploadTime:d.formatTime(c[0].created_at),fileLatestTime:d.formatTime(c[0].last_update_at),clickCallBack:()=>{this.downloadFile(c[0].file_name,c[0].download_url);}});}else {f.info("正在递归文件");let o=f.loading("正在解析多文件中，请稍后..."),c=this.getFolderInfo(l,i,0);o.close(),g.info("递归完毕"),x.staticView.moreFile("UC网盘文件解析",c);return}}async isLogin(){let e=await M.get("https://drive.uc.cn/",{headers:{"User-Agent":d.getRandomPCUA()}});if(g.success("判断是否已登录UC网盘",e),!!e.status)return e.data.finalUrl==="https://drive.uc.cn/list"?"已登录":false}downloadFile(e,t){if(g.info("调用【GM_download】下载：",arguments),window.location.hostname==="drive.uc.cn"){window.open(t,"_blank");return}if(!Lt.isSupport_GM_download()){f.error("当前脚本环境不支持API 【GM_download】");return}f.info(`调用【GM_download】下载：${e}`);let n=null,r=false,s=false,i=f.loading("下载中...",{showClose:true,onClose(){!r&&typeof n=="function"&&n();}}),l=bt({url:t,name:e,headers:{Referer:"https://drive.uc.cn/"},onload(){r=true,i.close(),f.success(`下载 ${e} 已完成`,{consoleLogContent:true});},onprogress(o){if(typeof o=="object"&&"loaded"in o&&"total"in o&&!s){let u=(o.loaded/o.total*100).toFixed(2);i.setText(`下载中...${u}%`),o.loaded===o.total&&(s=true);}},onerror(o){i.close(),g.error("下载失败error👉",o),typeof o=="object"&&o.error?f.error(`下载 ${e} 失败或已取消 原因：${o.error}`,{timeout:6e3,consoleLogContent:true}):f.error(`下载 ${e} 失败或已取消`,{consoleLogContent:true});},ontimeout(){i.close(),f.error(`下载 ${e} 请求超时`,{consoleLogContent:true});}});typeof l=="object"&&l!=null&&"abort"in l&&(n=l.abort);}gotoLogin(e=""){G.confirm({title:{position:"center",text:"UC网盘"},content:{text:e,html:false},btn:{reverse:true,position:"end",ok:{text:"前往",enable:true,callback(){window.open("https://drive.uc.cn","_blank");}}}},x.popsStyle.tianYiYunLoginTip);}async getStoken(e,t){let n=await M.post("https://pc-api.uc.cn/1/clouddrive/share/sharepage/token?entry=ft&fr=pc&pr=UCBrowser",{data:JSON.stringify({share_for_transfer:true,passcode:t,pwd_id:e}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8","User-Agent":d.getRandomPCUA(),Origin:"https://drive.uc.cn",Referer:"https://drive.uc.cn/"},allowInterceptConfig:false});if(!n.status){let s=d.toJSON(n.data.responseText);g.error("获取stoken失败JSON信息",s),"message"in s?f.error(s.message):f.error("请求异常，获取stoken失败");return}let r=d.toJSON(n.data.responseText);if(g.info("获取stoken：",r),r.code!==0){g.error("获取stoken失败",r),f.error("获取stoken失败");return}return r.data.stoken}async getDetail(e,t,n,r=0,s=0,i=1,l=50,o=0,c=0,u=1){let p=await M.get(`https://pc-api.uc.cn/1/clouddrive/transfer_share/detail?pr=UCBrowser&fr=h5&pwd_id=${e}&__t=${new Date().getTime()}&passcode=${t}&stoken=${encodeURIComponent(n)}&pdir_fid=${r}&force=${s}&_page=${i}&_size=${l}&_fetch_banner=${o}&_fetch_share=${c}&_fetch_total=${u}&_sort=${encodeURIComponent("file_type:asc,file_name:asc")}`,{headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomPCUA(),Origin:"https://drive.uc.cn",Referer:"https://drive.uc.cn/"}});if(!p.status)return;let h=d.toJSON(p.data.responseText);if(g.info("获取detail：",h),h.code!==0){g.error("获取detail失败",h),f.error("获取detail失败");return}let m=h.metadata;return m&&m._total&&m._total>m._size?await this.getDetail(e,t,n,r,s,i,m._total,o,c,u):h.data.list}async getDownload(e,t,n,r){let s=await M.post("https://pc-api.uc.cn/1/clouddrive/file/download?entry=ft&fr=pc&pr=UCBrowser",{data:JSON.stringify({fids:[n],pwd_id:e,stoken:t,fids_token:[r]}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8","User-Agent":d.getRandomPCUA(),Origin:"https://drive.uc.cn",Referer:"https://drive.uc.cn/"}});if(!s.status)return;let i=d.toJSON(s.data.responseText);if(g.info("获取download：",i),i.code!==0){g.error("获取download失败",i),f.error("获取download失败");return}if(i.data.length===0){g.error("获取download detail失败",i),f.error("获取download detail失败失败");return}return i.data}getFolderInfo(e,t,n=0){const r=this;let s=[],i=[],l=[];return e.forEach(o=>{o.dir==false&&o.file_type===1?l.push({fileName:o.file_name,fileSize:o.size,fileType:"",createTime:o.created_at,latestTime:o.updated_at,isFolder:false,index:n,async clickEvent(){let c="",u=await r.getDownload(r.shareCode,t,o.fid,o.share_fid_token);if(u&&u.length?c=u[0].download_url:c="",o.ban)f.error("文件已被禁止下载");else {let p=c;if(q.isForwardDownloadLink("uc")&&(p=q.parseDataToSchemeUri("uc",p)),p===c)r.downloadFile(o.file_name,c);else return {autoDownload:true,mode:"aBlank",url:c}}}}):i.push({fileName:o.file_name,fileSize:o.size,fileType:"",createTime:o.created_at,latestTime:o.updated_at,isFolder:true,index:n,async clickEvent(){if(o.include_items===0)return g.success("里面没有文件"),[];let c=await r.getDetail(r.shareCode,r.accessCode,t,o.fid);return c?r.getFolderInfo(c,t,n+1):[]}});}),i.sort((o,c)=>o.fileName.localeCompare(c.fileName)),l.sort((o,c)=>o.fileName.localeCompare(c.fileName)),s=s.concat(i),s=s.concat(l),g.info("getFilesInfoByRec",s),s}}class Ua extends be{token=void 0;code={1004:"no token",1008:"您没有权限访问",1013:"糟糕，此任务已过期销毁，下次要记得续期",1066:"对方设置的下载 / 预览次数已用完",1088:"糟糕，您访问的页面不存在"};async init(e){super.init(e);let{ruleIndex:t,shareCode:n,accessCode:r}=e;if(f.info("正在请求直链中..."),!await this.getWssToken())return;let i=await this.getPid();i&&await this.getFileNList(i.bid,i.pid);}async getWssToken(){const e=this;let t=await M.post("https://www.wenshushu.cn/ap/login/anonymous",{responseType:"json",data:JSON.stringify({dev_info:"{}"}),headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomAndroidUA(),Referer:"https://www.wenshushu.cn/f/"+e.shareCode}});if(g.success(t),!t.status)return;let n=d.toJSON(t.data.responseText);if(n.code===0)return e.token=n.data.token,n.data.token;n.code in e.code?f.error(e.code[n.code]):f.error("获取wss失败");}async getPid(){const e=this;let t=await M.post({url:"https://www.wenshushu.cn/ap/task/mgrtask",responseType:"json",data:JSON.stringify({tid:e.shareCode,password:"",ufileid:""}),headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomAndroidUA(),Referer:"https://www.wenshushu.cn/f/"+e.shareCode,"x-token":e.token}});if(g.success(t),!t.status)return;let n=t.data,r=d.toJSON(n.responseText);if(r.code===0)return {bid:r.data.boxid,pid:r.data.ufileid};r.code in e.code?f.error(e.code[r.code]):f.error("获取pid失败");}async getFileNList(e,t){const n=this;let r=await M.post("https://www.wenshushu.cn/ap/ufile/nlist",{responseType:"json",data:JSON.stringify({start:0,sort:{name:"asc"},bid:e,pid:t,options:{uploader:"true"},size:50}),headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomAndroidUA(),Referer:"https://www.wenshushu.cn/f/"+n.shareCode,"x-token":n.token}});if(g.success(r),!r.status)return;let s=r.data,i=d.toJSON(s.responseText);i.code===0?i.data.fileList[0].type===2?(f.error("该链接为多层级文件嵌套，跳转"),Ce.openBlankUrl(X.getBlankUrl({ruleKeyName:"wenshushu",ruleIndex:n.ruleIndex,shareCode:n.shareCode,accessCode:n.accessCode}),"wenshushu",n.ruleIndex,n.shareCode,n.accessCode)):await n.getDownloadUrl(i.data.fileList[0]):i.code in n.code?f.error(n.code[i.code]):f.error("获取文件信息失败");}async getDownloadUrl(e){const t=this;let n=e.fname,r=d.formatByteToSize(e.size),s=await M.post("https://www.wenshushu.cn/ap/dl/sign",{responseType:"json",data:JSON.stringify({ufileid:e.fid,consumeCode:0}),headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomAndroidUA(),Referer:"https://www.wenshushu.cn/f/"+t.shareCode,"x-token":t.token}});if(!s.status)return;g.success(s);let i=s.data,l=d.toJSON(i.responseText);if(l.code==0){let o=l.data.url;o===""?f.error("对方的分享流量不足"):(q.isForwardDownloadLink("wenshushu")&&(o=q.parseDataToSchemeUri("wenshushu",o)),x.staticView.oneFile({title:"文叔叔单文件直链",fileName:n,fileSize:r,downloadUrl:o}));}else l.data in t.code?f.error(t.code[l.data]):f.error("获取下载链接失败");}}const st={rule:{baidu:fa,lanzou:Ma,lanzouyx:$a,tianyiyun:Fa,wenshushu:Ua,_123pan:pa,jianguoyun:Ia,nainiu:La,uc:Oa,aliyun:ha,chengtong:Da,magnet:Ea,ed2k:Na}},qe={replaceText(a,e,t){if(Array.isArray(e))for(const n of e)a=this.replaceText(a,n,t);else typeof e=="string"?a=a.replaceAll(e,t):a=a.replace(e,t);return a}},X={getBlankUrl(a){let e=a.debugConfig?.config??L.$rule.ruleOption[a.ruleKeyName][a.ruleIndex],t=e.blank;if(a.shareCode&&(t=ne.replaceParam(t,{shareCode:a.shareCode}),a.debugConfig?.logCallBack?.({status:true,msg:["正则: blank","作用: 用于点击跳转的链接","备注: 对shareCode进行参数替换",`结果: ${t}`]})),a.accessCode&&a.accessCode!==""?(t=ne.replaceParam(t,{accessCode:a.accessCode}),a.debugConfig?.logCallBack?.({status:true,msg:["正则: blank","作用: 用于点击跳转的链接","备注: 对accessCode进行参数替换",`结果: ${t}`]})):(t=qe.replaceText(t,L.$extraRule.noAccessCodeRegExp,""),a.debugConfig?.logCallBack?.({status:true,msg:["正则: 内置的noAccessCodeRegExp","作用: 因accessCode为空，使用该正则去除不需要的字符串",`结果: ${t}`]})),e.paramMatch){let n=L.$match.matchedInfo.get(a.ruleKeyName).get(a.shareCode),s=(a.debugConfig?.matchText||n.matchText).match(e.paramMatch),i={};if(s)for(let l=0;l<s.length;l++)i[`$${l}`]=s[l];t=ne.replaceParam(t,i),a.debugConfig?.logCallBack?.({status:true,msg:["正则: paramMatch","作用: 用于对matchText进行提取需要的关键内容，替换关键字：{#$1#}、{#$2#}...","参数: "+JSON.stringify(i,void 0,4),`结果: ${t}`]});}return t},getCopyUrlInfo(a){let e=a.debugConfig?.config??L.$rule.ruleOption[a.ruleKeyName][a.ruleIndex],t=e.copyUrl;if(a.shareCode&&(t=ne.replaceParam(t,{shareCode:a.shareCode}),a.debugConfig?.logCallBack?.({status:true,msg:["正则: copyUrl","作用: 用于复制到剪贴板的链接","备注: 对shareCode进行参数替换",`结果: ${t}`]})),a.accessCode&&a.accessCode!==""?(t=ne.replaceParam(t,{accessCode:a.accessCode}),a.debugConfig?.logCallBack?.({status:true,msg:["正则: copyUrl","作用: 用于复制到剪贴板的链接","备注: 对accessCode进行参数替换",`结果: ${t}`]})):(t=qe.replaceText(t,L.$extraRule.noAccessCodeRegExp,""),a.debugConfig?.logCallBack?.({status:true,msg:["正则: 内置的noAccessCodeRegExp","作用: 因accessCode为空，使用该正则去除不需要的字符串",`结果: ${t}`]})),e.paramMatch){let n=L.$match.matchedInfo.get(a.ruleKeyName).get(a.shareCode),s=(a.debugConfig?.matchText||n.matchText).match(e.paramMatch),i={};if(s)for(let l=0;l<s.length;l++)i[`$${l}`]=s[l];t=ne.replaceParam(t,i),a.debugConfig?.logCallBack?.({status:true,msg:["正则: paramMatch","作用: 用于对matchText进行提取需要的关键内容，替换关键字：{#$1#}、{#$2#}...","参数: "+JSON.stringify(i,void 0,4),`结果: ${t}`]});}return a.debugConfig?.logCallBack?.({status:true,msg:"处理完毕的copyUrl: "+t}),t}},Ce={copy(a,e,t,n,r="已复制"){d.setClip(X.getCopyUrlInfo({ruleKeyName:a,ruleIndex:e,shareCode:t,accessCode:n})).then(s=>{s?f.success(r):f.error("执行复制失败",{consoleLogContent:true});}).catch(()=>{f.error("执行复制失败",{consoleLogContent:true});});},async parseFile(a,e,t,n){if(g.success("链接解析：",[...arguments]),st.rule[a]){let r=new st.rule[a];const s={ruleIndex:e,shareCode:t,accessCode:n??""};r.ruleIndex=s.ruleIndex,r.shareCode=s.shareCode,r.accessCode=s.accessCode,g.info(["文件解析：",s]),await r.init(s);}else g.error(`${a} 未配置解析函数`,[a,e,t,n]),f.error("该链接未配置解析函数");},openBlankUrl(a,e,t,n,r,s=false){g.success(`新标签页打开${s?"（后台打开）":""}`,[...arguments]),We.$data.enable&&We.addValue({url:a,ruleKeyName:e,ruleIndex:t,shareCode:n,accessCode:r,time:Date.now()}),q.isForwardBlankLink(e)&&(a=q.parseDataToSchemeUri(e,a)),He("meta[name='referrer']")?.setAttribute("content","no-referrer");let i=()=>{if(s)Vt(a,{active:false});else try{let l=window.open(a,"_blank");l&&l.focus();}catch(l){g.error(l,a);let o=b.createElement("a");o.setAttribute("href",a),o.setAttribute("target","_blank"),o.click(),o.remove();}};d.isNotNull(r)&&Y.linkClickMode_openBlank.openBlankWithCopyAccessCode(e)?d.setClip(r).then(()=>{i();}):i();},openBlankWithScheme(a,e,t,n){g.success("scheme新标签页打开",[...arguments]);let r=X.getBlankUrl({ruleKeyName:a,ruleIndex:e,shareCode:t,accessCode:n});r=q.parseDataToSchemeUri(a,r),window.open(r,"_blank");}},D={loading:{code:1,msg:"验证中...",setIcon(a){b.html(a,B.config.iconSVG.loading);},setView(a,e,t){oe.setViewCheckValid(a,"loading",t??this.msg),this.setIcon(a);}},success:{code:200,msg:"有效",setIcon(a){b.html(a,`
				<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
					<path
					fill="currentColor"
					d="M874.119618 149.859922A510.816461 510.816461 0 0 0 511.997 0.00208a509.910462 509.910462 0 0 0-362.119618 149.857842c-199.817789 199.679789-199.817789 524.581447 0 724.260236a509.969462 509.969462 0 0 0 362.119618 149.857842A508.872463 508.872463 0 0 0 874.119618 874.120158c199.836789-199.679789 199.836789-524.581447 0-724.260236zM814.94268 378.210681L470.999043 744.132295a15.359984 15.359984 0 0 1-5.887994 4.095996c-1.751998 1.180999-2.913997 2.362998-5.276994 2.913997a34.499964 34.499964 0 0 1-13.469986 2.914997 45.547952 45.547952 0 0 1-12.897986-2.303998l-4.095996-2.363997a45.291952 45.291952 0 0 1-7.009992-4.095996l-196.902793-193.789796a34.126964 34.126964 0 0 1-10.555989-25.186973c0-9.37399 3.583996-18.74698 9.98399-25.186974a36.429962 36.429962 0 0 1 50.372947 0l169.98382 167.423824L763.389735 330.220732a37.059961 37.059961 0 0 1 50.371947-1.732998 33.647965 33.647965 0 0 1 11.165988 25.186973 35.544963 35.544963 0 0 1-9.98399 24.575974v-0.04z m0 0"></path>
				</svg>
				`);},setView(a,e,t){oe.setViewCheckValid(a,"success",t??this.msg),this.setIcon(a),oe.setViewAgainCheckClickEvent(a,e);}},networkError:{code:-404,msg:"网络异常",setIcon(a){b.html(a,`
				<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
					<path
					fill="currentColor"
					d="M511.808 692.224c-18.048 0-35.136 3.968-50.432 11.392-25.472 12.416-46.528 33.92-57.792 60.032-5.632 14.144-9.024 29.504-9.024 45.952 0 65.152 52.672 117.824 117.248 117.824 65.28 0 117.952-52.672 117.952-117.824 0-64.64-52.672-117.376-117.952-117.376z m0 178.496c-33.408 0-60.608-27.712-60.608-61.12 0-33.472 27.2-60.672 60.608-60.672s61.248 27.2 61.248 60.672c0 33.472-27.776 61.12-61.248 61.12zM286.784 661.632c3.968 3.392 8.512 5.632 12.992 5.632L438.08 523.328c-60.032 14.72-114.432 49.344-155.328 98.624-9.536 11.84-7.872 30.08 4.032 39.68zM622.912 534.656l-43.008 45.312c45.312 13.056 86.72 40.256 117.376 78.208 5.632 6.784 13.568 10.24 22.08 10.24 6.272 0 12.416-2.24 18.176-6.784 11.904-9.6 13.568-27.84 3.392-39.68-31.808-39.104-72.704-69.12-118.016-87.296zM511.808 391.168c17.024 0 33.408 1.216 49.856 3.456l47.68-49.856c-31.744-6.848-64.064-10.24-97.536-10.24-142.784 0-277.12 63.488-367.232 174.656-10.24 11.904-8.576 30.08 3.904 39.68 5.12 4.48 11.328 6.784 18.176 6.784 7.936 0 15.872-3.968 21.568-10.816 79.872-97.536 197.76-153.664 323.584-153.664zM751.616 400.32l-40.256 41.92c47.04 24.96 89.536 60.032 124.096 102.592 10.24 12.48 27.84 14.208 40.256 3.968 11.968-9.6 13.632-27.84 3.968-39.68-36.16-44.8-79.872-81.088-128.064-108.8zM705.152 244.928l42.56-44.672c-73.664-28.992-153.6-44.224-235.904-44.224-196.672 0-380.864 87.872-505.6 239.744-9.6 12.48-7.872 30.08 3.968 40.256 5.632 3.968 11.904 6.208 18.112 6.208 7.936 0 16.448-3.392 22.144-10.176C163.84 292.608 332.096 212.672 511.808 212.672c66.944 0 132.16 10.752 193.344 32.256zM1017.472 395.776c-40.192-49.92-87.296-92.416-139.456-126.976l-39.68 41.344C889.408 343.04 935.36 383.808 973.888 432c9.6 11.904 27.776 13.568 39.68 3.968 11.84-10.176 14.144-27.712 3.904-40.192zM937.408 104.512c-11.328-10.944-29.312-10.496-40.064 0.832L179.008 854.72c-10.816 11.328-10.496 29.248 0.896 40.064 5.44 5.312 12.48 7.872 19.584 7.872 7.488 0 14.848-2.88 20.416-8.704L938.24 144.576c10.88-11.328 10.496-29.248-0.832-40.064z"></path>
				</svg>
				`);},setView(a,e,t){oe.setViewCheckValid(a,"error",t??this.msg),this.setIcon(a),oe.setViewAgainCheckClickEvent(a,e);}},verify:{code:-405,msg:"触发安全验证",setIcon(a){b.html(a,`
				<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
					<path 
						fill="currentColor"
						d="M514.389 1005.60899999c-269.967 0-489.59499999-219.642-489.595-489.59499999S244.42199999 26.405 514.389 26.405 1003.984 246.047 1003.984 516s-219.62800001 489.60899999-489.595 489.60900001z m0-938.24399999C267.00400001 67.365 65.754 268.615 65.754 516s201.264 448.63499999 448.635 448.635S963.024 763.385 963.024 516 761.774 67.365 514.389 67.365z" p-id="9895"></path><path d="M245.993 621.56800001c41.014-8.138 86.112-18.03600001 135.264-29.71000001-0.355 14.145-0.177 26.69199999 0.532 37.65499999-40.318 8.493-82.93 18.92400001-127.836 31.29400001l-7.959-39.23900001z m78.506-261.50200001l-12.206 145.872h53.57500001l13.78999998-178.763H259.249v-36.073h160.727l-16.438 214.821h33.423c-2.471 74.61499999-4.779 135.973-6.895 184.06100002-1.065 53.754-24.399 80.623-70.01399999 80.62299998-19.101 0-41.547-0.53200001-67.36500001-1.598-1.775-13.079-4.06799999-27.047-6.895-41.902 25.46300001 3.181 48.087 4.779 67.898 4.779 24.753 0 37.834-15.033 39.253-45.084 2.11599999-38.898 3.891-87.163 5.31099998-144.807H270.951l16.971-181.945h36.577z m309.248-98.659l-10.076 16.971c42.789 76.03500001 95.833 131.373 159.13 166.025-11.318 14.145-20.685 26.528-28.112 37.13699999-62.231-45.971-112.981-101.30799999-152.235-166.02499998-36.073 64.006-86.466 121.474-151.17000001 172.38699999-6.363-9.18799999-15.21-20.33-26.52799998-33.423 70.369-48.797 124.30000001-113.158 161.77799999-193.086h47.213zM441.194 718.111h191.488c25.46300001-62.942 48.087-128.723 67.89800001-197.318l40.31799999 12.725c-20.862 63.297-42.96699999 124.832-66.301 184.593h93.361v36.60499999H441.19300001v-36.60499999z m27.047-169.73900001l37.137-11.67399999c17.32599998 50.217 31.82600002 94.945 43.5 134.198l-39.253 13.258c-11.674-45.261-25.46300001-90.522-41.383-135.78200001z m27.06099999-91.76399999h218.53500001v36.605H495.30200001v-36.605z m64.17100001 67.885l37.655-10.076c14.854 53.043 27.047 99.369 36.605 138.977l-38.72099999 11.141c-10.254-48.797-22.091-95.477-35.53900001-140.04300001z">
					</path>
				</svg>
				`);},setView(a,e,t){oe.setViewCheckValid(a,"verify",t??this.msg),this.setIcon(a),oe.setViewAgainCheckClickEvent(a,e);}},failed:{code:0,msg:"已失效",setIcon(a){b.html(a,`
				<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
					<path
						fill="currentColor"
						d="M549.044706 512l166.189176-166.249412a26.383059 26.383059 0 0 0 0-36.98447 26.383059 26.383059 0 0 0-37.044706 0L512 475.015529l-166.249412-166.249411a26.383059 26.383059 0 0 0-36.98447 0 26.383059 26.383059 0 0 0 0 37.044706L475.015529 512l-166.249411 166.249412a26.383059 26.383059 0 0 0 0 36.98447 26.383059 26.383059 0 0 0 37.044706 0L512 548.984471l166.249412 166.249411a26.383059 26.383059 0 0 0 36.98447 0 26.383059 26.383059 0 0 0 0-37.044706L548.984471 512zM512 1024a512 512 0 1 1 0-1024 512 512 0 0 1 0 1024z"></path>
				</svg>
				`);},setView(a,e,t){oe.setViewCheckValid(a,"failed",t??this.msg),this.setIcon(a),oe.setViewAgainCheckClickEvent(a,e);}},needAccessCode:{code:201,msg:"需要提取码",setIcon(a){b.html(a,`
				<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
					<path
					fill="currentColor"
					d="M757.810429 373.751333 325.645708 373.751333l0-83.895759c0-103.694687 81.507362-184.922686 185.559183-184.922686 78.121242 0 146.053424 46.74565 173.062568 119.090329 3.865028 10.352789 15.384385 15.609513 25.742291 11.746532 10.351766-3.866051 15.609513-15.390525 11.744485-25.742291C688.844707 121.877815 606.198405 64.918545 511.204891 64.918545c-61.918211 0-119.246895 23.662933-161.423483 66.63156-41.3692 42.142819-64.151066 98.363262-64.151066 158.305469l0 83.895759-20.007683 0c-60.774155 0-110.042255 49.267077-110.042255 110.042255l0 366.139981c0 60.774155 49.267077 110.042255 110.042255 110.042255l492.187769 0c60.775178 0 110.042255-49.267077 110.042255-110.042255L867.852684 483.793588C867.852684 423.01841 818.585607 373.751333 757.810429 373.751333zM827.837318 849.933569c0 38.674834-31.352055 70.02689-70.02689 70.02689L265.62266 919.960459c-38.674834 0-70.02689-31.352055-70.02689-70.02689L195.59577 483.793588c0-38.674834 31.352055-70.02689 70.02689-70.02689l492.187769 0c38.674834 0 70.02689 31.352055 70.02689 70.02689L827.837318 849.933569z"></path>
					<path
					fill="currentColor"
					d="M509.715981 583.832002c-11.048637 0-20.007683 8.959046-20.007683 20.007683l0 110.042255c0 11.048637 8.958022 20.007683 20.007683 20.007683s20.007683-8.958022 20.007683-20.007683L529.723663 603.839685C529.723663 592.790024 520.765641 583.832002 509.715981 583.832002z"></path>
				</svg>
				`);},setView(a,e,t){oe.setViewCheckValid(a,"needAccessCode",t??this.msg),this.setIcon(a),oe.setViewAgainCheckClickEvent(a,e);}},partialViolation:{code:202,msg:"存在部分违规文件",setIcon(a){b.html(a,`
				<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
					<path 
					fill="currentColor"
					d="M954.963 810.267L543.112 96.919c-14.07-24.37-49.245-24.37-63.315 0L67.945 810.267c-14.07 24.37 3.518 54.832 31.657 54.832h823.703c28.141 0 45.728-30.463 31.658-54.832zM476.699 306.55c0-19.115 15.64-34.755 34.755-34.755 19.115 0 34.755 15.64 34.755 34.755v281.817c0 19.115-15.64 34.755-34.755 34.755-19.115 0-34.755-15.64-34.755-34.755V306.55z m34.755 445.293c-23.198 0-42.004-18.806-42.004-42.004s18.806-42.004 42.004-42.004c23.198 0 42.004 18.806 42.004 42.004s-18.806 42.004-42.004 42.004z"></path>
				</svg>`);},setView(a,e,t){oe.setViewCheckValid(a,"partial-violation",t??this.msg),this.setIcon(a);}},unknown:{code:-200,msg:"未知检查情况",setIcon(a){b.html(a,`
				<svg viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg">
					<path
					fill="currentColor"
					d="M512.473172 1023.995242A511.814852 511.814852 0 0 1 313.545134 40.351073a512.244696 512.244696 0 0 1 398.855715 943.658633 508.815937 508.815937 0 0 1-199.927677 39.985536z m0-943.658634C274.559237 80.336608 80.629391 274.266455 80.629391 512.18039s193.929846 431.843781 431.843781 431.843781 431.843781-193.929846 431.843781-431.843781S751.386745 80.336608 512.473172 80.336608z"></path>
					<path
					fill="currentColor"
					d="M506.475342 716.10662a39.985535 39.985535 0 0 1-39.985536-39.985535v-76.972156c0-79.971071 64.976495-144.947566 144.947566-144.947565a77.971794 77.971794 0 0 0 0-155.943588H445.4974a56.979388 56.979388 0 0 0-56.979387 56.979388 39.985535 39.985535 0 0 1-79.971071 0c0-74.972879 60.977941-136.950458 136.950458-136.950459h164.940333c86.968539 0 157.942864 70.974325 157.942865 157.942865s-69.974687 157.942864-157.942865 157.942864a64.976495 64.976495 0 0 0-64.976494 64.976495v76.972156a39.985535 39.985535 0 0 1-38.985897 39.985535zM505.475703 742.097218a48.982281 48.982281 0 1 0 48.982281 48.982281 48.982281 48.982281 0 0 0-48.982281-48.982281z"></path>
				</svg>
				`);},setView(a,e,t){oe.setViewCheckValid(a,"unknown",t??this.msg),this.setIcon(a),oe.setViewAgainCheckClickEvent(a,e);}}},Pa={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=X.getBlankUrl({ruleKeyName:"baidu",ruleIndex:e,shareCode:t,accessCode:n}),s=await M.get(r,{headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36",Host:"pan.baidu.com",Referer:`https://pan.baidu.com/share/init?surl=${t}&pwd=${n}`,"sec-ch-ua":'"Chromium";v="134", "Not:A-Brand";v="24", "Google Chrome";v="134"',Origin:"https://pan.baidu.com"},...ie}),i=s.data.responseText,l=s.data.finalUrl;return typeof l=="string"&&new URL(l).hostname!=="pan.baidu.com"?{...D.verify,msg:`<a href='${l}' target='_blank' style="color: red;">触发百度安全验证</a>`,data:s}:!s.status&&d.isNull(i)?{...D.networkError,data:s}:s.data.finalUrl.includes("404.html")?{...D.networkError,data:s}:i.includes("过期时间：")?{...D.success,data:s}:i.includes("输入提取")?{...D.needAccessCode,data:s}:i.includes("不存在")||i.includes("已失效")?{...D.failed,data:s}:{...D.unknown,data:s}}},Va={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=X.getBlankUrl({ruleKeyName:"lanzou",ruleIndex:e,shareCode:t,accessCode:n}),s=new URL(r),i=await M.get(r,{headers:{"User-Agent":d.getRandomPCUA(),Host:s.hostname,Origin:s.origin,Referer:r},...ie});if(!i.status&&i.type==="ontimeout")return {...D.networkError,data:i};let l=i.data.responseText;return d.isNull(l)?{...D.failed,data:i,tipMsg:"响应数据为空"}:l.includes("输入密码")?{...D.needAccessCode,data:i}:l.includes("来晚啦")||l.includes("不存在")||l.includes("div>文件链接失效，请获取新链接</div>")?{...D.failed,data:i}:i.status?{...D.success,data:i}:{...D.unknown,data:i,tipMsg:i.msg}}},Ba={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=new st.rule.lanzouyx;r.shareCodeId=r.getDecodeShareCodeId(t);let s=r.getEncodeTimeStamp(),i=r.getEncodeUUID(),l=await M.post(`https://api.ilanzou.com/unproved/recommend/list?${d.toSearchParamsStr({devType:r.$data.devType,devModel:r.$data.devModel,uuid:i,extra:r.$data.extra,timestamp:s,code:n,shareId:t,type:r.$data.type,offset:r.$data.offset,limit:r.$data.limit})}`,{headers:{Accept:"application/json, text/plain, */*",Origin:"https://www.ilanzou.com",Referer:"https://www.ilanzou.com/","Sec-Fetch-Site":"same-site",Host:"api.ilanzou.com","User-Agent":d.getRandomPCUA()},responseType:"json",...ie});if(!l.status)return {...D.networkError,data:l};let o=d.toJSON(l.data.responseText);return g.success("获取链接信息：",o),o.code!==200?{...D.networkError,data:o}:o.list.length?{...D.success,data:o}:{...D.failed,data:o}}},za={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=await M.post("https://api.cloud.189.cn/open/share/getShareInfoByCodeV2.action",{data:`shareCode=${t}`,headers:{Accept:"application/json;charset=UTF-8","Content-Type":"application/x-www-form-urlencoded","User-Agent":d.getRandomPCUA(),"Sign-Type":1,Referer:"https://cloud.189.cn/web/share?code="+t,Origin:"https://cloud.189.cn"},...ie}),s=r.data.responseText;return !r.status&&d.isNull(s)?{...D.networkError,data:r}:s.includes("ShareInfoNotFound")||s.includes("ShareNotFound")||s.includes("FileNotFound")||s.includes("ShareAuditWaiting")||s.includes("ShareExpiredError")||s.includes("ShareAuditNotPass")?{...D.failed,data:r}:s.includes("needAccessCode")?{...D.needAccessCode,data:r}:{...D.success,data:r}}},Ha={async init(a){const{shareCode:e}=a;let t=await M.post("https://api.aliyundrive.com/adrive/v3/share_link/get_share_by_anonymous?share_id="+e,{data:JSON.stringify({share_id:e}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","User-Agent":d.getRandomPCUA(),Referer:"https://www.aliyundrive.com/",Origin:"https://www.aliyundrive.com"},...ie}),n=d.toJSON(t.data.responseText);return !t.status&&d.isNull(n)?{...D.networkError,data:t}:n.code==="ParamFlowException"||n.code==="NotFound.ShareLink"||n.code==="ShareLink.Cancelled"?{...D.failed,data:n}:n.file_count===0||n.file_infos?.length===0?{...D.failed,data:n}:{...D.success,data:n}}},Ga={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=await M.post("https://www.wenshushu.cn/ap/task/mgrtask",{data:JSON.stringify({tid:t}),headers:{"Content-Type":"application/json","User-Agent":d.getRandomPCUA(),"x-token":"wss:7pmakczzw6i",Host:"www.wenshushu.cn",Origin:"https://www.wenshushu.cn",Referer:X.getBlankUrl({ruleKeyName:"wenshushu",ruleIndex:e,shareCode:t,accessCode:n})},responseType:"json",...ie});if(!r.status&&d.isNull(r.data.responseText))return {...D.networkError,data:r};let s=d.toJSON(r.data.responseText);return s.code!==0?{...D.failed,data:s}:{...D.success,data:s}}},ja={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=await M.get(`https://cowtransfer.com/core/api/transfer/share?uniqueUrl=${t}`,{headers:{"User-Agent":d.getRandomPCUA(),Host:"cowtransfer.com",Origin:"https://cowtransfer.com",Referer:"https://cowtransfer.com/"},...ie});if(!r.status&&d.isNull(r.data.responseText))return {...D.networkError,data:r};let s=d.toJSON(r.data.responseText);return s.code!="0000"?{...D.failed,data:s}:s.data.needPassword&&s.data.needPassword?{...D.needAccessCode,data:s}:{...D.success,data:s}}},qa={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=await M.get("https://www.123pan.com/api/share/info?shareKey="+t,{headers:{"User-Agent":d.getRandomPCUA(),Host:"www.123pan.com",Origin:"https://www.123pan.com",Referer:"https://www.123pan.com/"},responseType:"json",...ie});if(!r.status&&d.isNull(r.data.responseText))return {...D.networkError,data:r};let s=d.toJSON(r.data.responseText);return r.data.responseText.includes("分享页面不存在")||s.code!==0?{...D.failed,data:s}:s.data.HasPwd?{...D.needAccessCode,data:s}:{...D.success,data:s}}},Za={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=X.getBlankUrl({ruleKeyName:"weiyun",ruleIndex:e,shareCode:t,accessCode:n}),s=await M.get(r,{headers:{"User-Agent":d.getRandomPCUA(),Host:"share.weiyun.com",Origin:"https://share.weiyun.com",Referer:r},...ie});if(!s.status&&d.isNull(s.data.responseText))return {...D.networkError,data:s};let i=s.data.responseText;return i.includes("已删除")||i.includes("已被删除")||i.includes("已经删除")||i.includes("违反相关法规")||i.includes("已过期")||i.includes("目录无效")?{...D.failed,data:s}:i.includes('"need_pwd":1')||i.includes('"pwd":"')&&!i.includes('"pwd":""')?{...D.needAccessCode,data:s}:{...D.success,data:s}}},Ka={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=await M.post("https://xluser-ssl.xunlei.com/v1/shield/captcha/init",{data:JSON.stringify({client_id:"Xqp0kJBXWhwaTpB6",device_id:"925b7631473a13716b791d7f28289cad",action:"get:/drive/v1/share",meta:{package_name:"pan.xunlei.com",client_version:"1.45.0",captcha_sign:"1.fe2108ad808a74c9ac0243309242726c",timestamp:"1645241033384"}}),headers:{"User-Agent":d.getRandomPCUA(),Host:"pan.xunlei.com",Referer:X.getBlankUrl({ruleKeyName:"xunlei",ruleIndex:e,shareCode:t,accessCode:n}),Origin:"https://pan.xunlei.com"},...ie});if(!r.status&&d.isNull(r.data.responseText))return {...D.networkError,data:r};let i=d.toJSON(r.data.responseText).captcha_token,l=await M.get("https://api-pan.xunlei.com/drive/v1/share?share_id="+t,{headers:{"User-Agent":d.getRandomPCUA(),Host:"pan.xunlei.com",Referer:X.getBlankUrl({ruleKeyName:"xunlei",ruleIndex:e,shareCode:t,accessCode:n}),Origin:"https://pan.xunlei.com","x-captcha-token":i,"x-client-id":"Xqp0kJBXWhwaTpB6","x-device-id":"925b7631473a13716b791d7f28289cad"},...ie});if(!l.status&&d.isNull(l.data.responseText))return {...D.networkError,data:[r,l]};let o=l.data.responseText;return o.includes("NOT_FOUND")||o.includes("SENSITIVE_RESOURCE")||o.includes("EXPIRED")||o.includes("DELETED")?{...D.failed,data:l}:o.includes("PASS_CODE_EMPTY")?{...D.needAccessCode,data:l}:{...D.success,data:l}}},Wa={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=X.getBlankUrl({ruleKeyName:"chengtong",ruleIndex:e,shareCode:t,accessCode:n}),s=new URL(r),i=s.pathname.split("/")[1].trim(),l="";if(s.pathname==="/"&&s.hash.startsWith("#/d/")&&(i="d"),i==="f"||i==="file")l=`https://webapi.ctfile.com/getfile.php?path=${i}&f=${t}&passcode=${n}&token=0&r=${Math.random()}&ref=`;else if(i==="d"||i==="dir")l=`https://webapi.ctfile.com/getdir.php?path=${i}&d=${t}&folder_id=&passcode=${n}&token=0&r=${Math.random()}&ref=`;else return g.warn("未知path",[e,t,n]),{...D.unknown,data:null};let o=await M.get(l,{headers:{Host:"webapi.ctfile.com",Origin:"https://url95.ctfile.com",Referer:r,Accept:"application/json, text/javascript, */*; q=0.01","User-Agent":d.getRandomPCUA()},...ie}),c=o.data.responseText;if(!o.status&&d.isNull(c))return {...D.networkError,data:o};let u=d.toJSON(c);return u.code===200?{...D.success,data:u}:u.code===401?{...D.needAccessCode,data:u}:u.code===404||u.code===503||u.code===504?{...D.failed,data:u}:{...D.unknown,data:u}}},Ya={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=await M.post("https://drive.quark.cn/1/clouddrive/share/sharepage/token?pr=ucpro&fr=pc",{data:JSON.stringify({pwd_id:t,passcode:""}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8","User-Agent":d.getRandomPCUA(),Origin:"https://pan.quark.cn",Referer:X.getBlankUrl({ruleKeyName:"kuake",ruleIndex:e,shareCode:t,accessCode:n})},...ie});if(!r.status&&d.isNull(r.data.responseText))return {...D.networkError,data:r};let s=d.toJSON(r.data.responseText);if(s.message.includes("需要提取码"))return {...D.needAccessCode,data:s};if(s.message.includes("ok")){let i=s.data.stoken,l={pwd_id:t,stoken:i,_fetch_share:1,__t:Date.now()},o=await M.get(`https://drive-h.quark.cn/1/clouddrive/share/sharepage/detail?${d.toSearchParamsStr(l)}`,{headers:{Accept:"application/json, text/plain, */*",Origin:"https://pan.quark.cn",Referer:"https://pan.quark.cn/","User-Agent":d.getRandomPCUA()},...ie});if(!o.status||d.isNull(o.data.responseText))return {...D.networkError,data:o};let c=d.toJSON(o.data.responseText);return c.data.share.status==1?c.data.share.partial_violation?{...D.partialViolation,data:[s,c]}:{...D.success,data:[s,c]}:{...D.failed,data:[s,c]}}else return {...D.failed,data:s}}},Ja={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=X.getBlankUrl({ruleKeyName:"jianguoyun",ruleIndex:e,shareCode:t,accessCode:n}),s=await M.get(r,{headers:{"User-Agent":d.getRandomPCUA(),Host:"www.jianguoyun.com",Referer:X.getBlankUrl({ruleKeyName:"jianguoyun",ruleIndex:e,shareCode:t,accessCode:n}),Origin:"https://www.jianguoyun.com"},...ie}),i=s.data.responseText;return !s.status&&d.isNull(i)?{...D.networkError,data:s}:i.includes("<h1>啊噢！")?{...D.failed,data:s}:{...D.success,data:s}}},Xa={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=X.getBlankUrl({ruleKeyName:"onedrive",ruleIndex:e,shareCode:t,accessCode:n}),s=new URL(r),i=await M.get(r,{headers:{"User-Agent":d.getRandomPCUA(),Host:s.hostname,Referer:r,Origin:s.origin},...ie});if(!i.status){let o=i.data?.status?.toString();return o==="429"?{...D.networkError,data:i}:o==="404"?{...D.failed,data:i}:{...D.networkError,data:i}}let l=i.data.responseText;if(d.isNotNull(l))try{let c=b.parseHTML(l,!0,!0).querySelector("title");if(c&&b.html(c).includes("错误"))return {...D.failed,data:i}}catch{}return {...D.success,data:i}}},Qa={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=await M.get("https://drive.uc.cn/s/"+t,{headers:{"User-Agent":d.getRandomAndroidUA(),Host:"drive.uc.cn",Referer:X.getBlankUrl({ruleKeyName:"uc",ruleIndex:e,shareCode:t,accessCode:n}),Origin:"https://drive.uc.cn"},...ie}),s=r.data.responseText;if(!r.status&&d.isNull(s))return {...D.networkError,data:r};let i=b.parseHTML(s,true,true);if(i.querySelector(".h5-page-main")){let l=i.querySelector(".h5-page-main"),o=l.textContent||l.innerText;return o.includes("失效")||o.includes("不存在")||o.includes("违规")||o.includes("删除")?{...D.failed,data:r}:{...D.unknown,data:r}}else return i.querySelector(".main-body .input-wrap input")?{...D.needAccessCode,data:r}:{...D.success,data:r}}},en={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r=await M.get(`https://webapi.115.com/share/snap?share_code=${t}&offset=0&limit=20&receive_code=&cid=`,{headers:{Accept:"application/json, text/javascript, */*;","User-Agent":d.getRandomPCUA(),Host:"webapi.115.com",Referer:"https://115.com/",Origin:"https://115.com"},...ie});if(!r.status)return d.isNull(r.data.responseText)?{...D.failed,data:r}:{...D.networkError,data:r};let s=d.toJSON(r.data.responseText);if(s.state)return {...D.success,data:s};if(typeof s.error=="string"){if(s.error.includes("访问码"))return {...D.needAccessCode,data:s};if(s.error.includes("链接")||s.error.includes("分享已取消"))return {...D.failed,data:s}}return {...D.unknown,data:s}}},tn={async init(a){const{ruleIndex:e,shareCode:t,accessCode:n}=a;let r="https://www.yunpan.com/lk/surl_"+t,s=await M.get(r,{headers:{"User-Agent":d.getRandomPCUA()},responseType:"json",...ie});if(!s.status&&d.isNull(s.data.responseText))return {...D.networkError,data:s};let l=b.parseHTML(s.data.responseText,true,true).querySelector(".page-error .error-msg");if(l){let o=b.text(l);return o.includes("分享链接已失效")?{...D.failed,data:s}:{...D.unknown,data:s,tipMsg:o}}return {...D.success,data:s}}},an={baidu:Pa,lanzou:Va,lanzouyx:Ba,tianyiyun:za,aliyun:Ha,wenshushu:Ga,nainiu:ja,_123pan:qa,weiyun:Za,xunlei:Ka,_115pan:en,chengtong:Wa,kuake:Ya,jianguoyun:Ja,onedrive:Xa,uc:Qa,"360yunpan":tn},ie={allowInterceptConfig:false,onerror(){},ontimeout(){}},oe={$data:{subscribeMap:new Map,subscribeMapConsuming:new Map},get status(){return D},ruleCheckValidFunction:an,async check(a){Array.isArray(a)||(a=[a]);for(const t of a){const{ruleKeyName:n}=t;this.$data.subscribeMap.has(n)||this.$data.subscribeMap.set(n,[]),this.$data.subscribeMap.get(n).push(t);}await(async()=>{let t=[];for(const[n,r]of this.$data.subscribeMap.entries())t.push(new Promise(async s=>{if(this.$data.subscribeMapConsuming.get(n)){s(null);return}let l=async()=>{for(let o=0;o<r.length;o++)try{const c=r[o];await this.checkLinkValidity(c,!0),await d.sleep(250),r.splice(o,1),o--;}catch(c){g.error(c);}this.$data.subscribeMap.get(n).length&&await l();};await l(),this.$data.subscribeMapConsuming.delete(n),s(null);}));await Promise.all(t);})();},async checkLinkValidity(a,e){const{$checkValidStatus:t}=ce.parseViewBoxElementInfo(a.$urlBox);if(this.isViewCheckValid(t)&&!e)return;this.setCheckStatusElementToolTip(a);let n=a.ruleKeyName;if(!Y.function.checkLinkValidity(n)){g.error("未开启checkLinkValidity功能",a);return}let r=this.ruleCheckValidFunction[a.ruleKeyName];if(!r||r&&typeof r.init!="function"){g.error("没有配置该网盘的校验有效性",a);return}D.loading.setView(t,a);let s=await r.init({ruleIndex:a.ruleIndex,shareCode:a.shareCode,accessCode:a.accessCode});if(!s){g.error("该验证函数的返回值不是有效值",[s,a]);return}s.setView(t,a,s.tipMsg),s.data&&Reflect.set(t,"data-httpx-response",s.data);},setViewAgainCheckClickEvent(a,e){b.on(a,"click",void 0,()=>{const{$urlBox:t,$link:n}=ce.parseViewBoxElementInfo(a),r=ce.praseElementAttributeRuleInfo(n);let s={$urlBox:t,ruleKeyName:r.ruleKeyName,ruleIndex:r.ruleIndex,shareCode:r.shareCode,accessCode:r.accessCode};this.checkLinkValidity(s,true);},{once:true});},isViewCheckValid(a){return !(!a.hasAttribute("data-check-valid")||a.getAttribute("data-check-valid")==="error")},setViewCheckValid(a,e,t){a.setAttribute("data-check-valid",e),a.setAttribute("data-msg",t),Reflect.set(a,"data-msg",t);},removeViewCheckValid(a){a.removeAttribute("data-check-valid"),a.removeAttribute("data-msg"),Reflect.deleteProperty(a,"data-msg");},isStatusSuccess(a){return Math.floor(a.code/100)===2},getStatusName(a){for(const e of Object.keys(D)){let t=D[e];if(a.code===t.code)return e}},setCheckStatusElementToolTip(a){if(!Y.function.checkLinlValidityHoverTip(a.ruleKeyName))return;function e(){const{$checkValidStatus:r}=ce.parseViewBoxElementInfo(a.$urlBox);return r}let t=e();if(t.hasAttribute("data-pops-tooltip"))return;t.setAttribute("data-pops-tooltip","true");let n=r=>{let s=Reflect.get(r,"data-msg"),i=r.getAttribute("data-msg");return s??i};B.tooltip({target:t,className:"github-tooltip",isFixed:true,content(){return n(t)},showBeforeCallBack(){let r=n(t);if(r==null||typeof r=="string"&&r.trim()==="")return  false},zIndex(){let r=d.getMaxZIndex(10),s=B.config.InstanceUtils.getPopsMaxZIndex(10).zIndex;return d.getMaxValue(r,s)+100}});}},nn={requiredFileMap:new Map,async file(a,e){if(d.isNull(a))return g.error("NetDiskRequire.file的参数path为空",a),false;if(this.requiredFileMap.has(a))return g.warn("NetDiskRequire.file的参数path已引入过",a),true;let t=await M.get(a,e);if(!t.status)return  false;let n=t.data.responseText,r=this.requiredFileMap.get(a);return this.requiredFileMap.set(a,r++),g.info("加载js文件",a),he.eval(`
		let exports = void 0;
		let module = void 0;
		let define = void 0;
		`+n),await d.sleep(300),true}},Ft=a=>({"matchRange-text-before":Y.matchRange_text.before(a).toString(),"matchRange-text-after":Y.matchRange_text.after(a).toString()}),Ot=a=>({"matchRange-html-before":Y.matchRange_html.before(a).toString(),"matchRange-html-after":Y.matchRange_html.after(a).toString()}),Le=new Fe("userRule"),Ue=new Fe("userRuleBindContext"),le={$data:{STORAGE_KEY:"rule",EXPORT_CONFIG_KEY:"rule-export-config",__userRule:null,get userRule(){return this.__userRule==null&&(this.__userRule=new d.Dictionary),this.__userRule}},init(){let a=re("userRule");Array.isArray(a)&&(mt("userRule"),this.setRule(a));let e=this.parseRule(this.getAllRule()),t=this.parseRule(ee.getAllSubscribeRule());e=e.concat(t),e.forEach(n=>{this.$data.userRule.set(n.setting.key,n);});},parseRuleStrToRule(a){function e(n){return typeof n.link_innerText!="string"?{success:false,msg:"regexp缺失的键名: link_innerText，类型: string"}:typeof n.link_innerHTML!="string"?{success:false,msg:"regexp缺失的键名: link_innerHTML，类型: string"}:typeof n.shareCode!="string"?{success:false,msg:"regexp缺失的键名: shareCode，类型: string"}:typeof n.shareCodeNeedRemoveStr!="string"&&!Array.isArray(n.shareCodeNeedRemoveStr)?{success:false,msg:"regexp缺失的键名: shareCodeNeedRemoveStr，类型: string|string[]"}:typeof n.uiLinkShow!="string"?{success:false,msg:"regexp缺失的键名: uiLinkShow，类型: string"}:typeof n.blank!="string"?{success:false,msg:"regexp缺失的键名: blank，类型: string"}:typeof n.copyUrl!="string"?{success:false,msg:"regexp缺失的键名: copyUrl，类型: string"}:typeof n.accessCode=="string"&&typeof n.checkAccessCode!="string"?{success:false,msg:"regexp设置了accessCode但是没有设置checkAccessCode"}:typeof n.accessCode!="string"&&typeof n.checkAccessCode=="string"?{success:false,msg:"regexp设置了checkAccessCode但是没有设置accessCode"}:{success:true,msg:"校验rule成功"}}function t(n){return typeof n.name!="string"?{success:false,msg:"setting缺失的键名: name，类型: string"}:typeof n.enable!="boolean"?{success:false,msg:"setting缺失的键名: enable，类型: boolean"}:{success:true,msg:"校验setting成功"}}try{let n=typeof a=="string"?d.toJSON(a):a;if(g.info("解析出的规则对象：",n),typeof n!="object")return {success:!1,msg:"该规则不是object类型"};if(Object.keys(n).length===0)return {success:!1,msg:"该规则为空"};if(typeof n.key!="string")return {success:!1,msg:"缺失的键名: key，类型: string"};if(typeof n.regexp!="object")return {success:!1,msg:"缺失的键名: regexp，类型: object|Arrany"};if(typeof n.setting!="object")return {success:!1,msg:"缺失的键名: setting，类型: object"};if(Array.isArray(n.regexp))for(const s of n.regexp){let i=e(s);if(!i.success)return i}else {let s=e(n.regexp);if(!s.success)return s}let r=t(n.setting);return r.success?{success:!0,msg:"解析成功",data:n}:r}catch(n){return g.error(n),{success:false,msg:n.message}}},getBindContext(a){return {rule:a,NetDiskRequire:nn,CryptoJS:Pe,httpx:M,utils:d,DOMUtils:b,window,unsafeWindow:he,NetDiskCheckLinkValidity:oe,NetDiskCheckLinkValidityStatus:D,log:g,Qmsg:f,pops:B,setValue:Ue.set.bind(Ue),getValue:Ue.get.bind(Ue),deleteValue:Ue.delete.bind(Ue)}},parseRule(a){function e(n,r,s){let{shareCode:i,shareCodeNeedRemoveStr:l,shareCodeNotMatch:o,checkAccessCode:c,accessCode:u,acceesCodeNotMatch:p,accessCodeNeedRemoveStr:h,paramMatch:m,...w}=s,k={...w};if(k.link_innerText=ne.replaceParam(k.link_innerText,Ft(n)),k.link_innerHTML=ne.replaceParam(k.link_innerText,Ot(n)),typeof i=="string"&&(k.shareCode=new RegExp(i,"ig")),l&&(typeof l=="string"&&(l=[l]),Array.isArray(l))){k.shareCodeNeedRemoveStr=[];for(const C of l)if(typeof C=="string"){const A=new RegExp(C,"ig");k.shareCodeNeedRemoveStr.push(A);}}if(o&&(typeof o=="string"&&(o=[o]),Array.isArray(o))){k.shareCodeNotMatch=[];for(const C of o)if(typeof C=="string"){const A=new RegExp(C,"ig");k.shareCodeNotMatch.push(A);}}if(typeof c=="string"&&(k.checkAccessCode=new RegExp(c,"ig")),typeof u=="string"&&(k.accessCode=new RegExp(u,"ig")),p&&(typeof p=="string"&&(p=[p]),Array.isArray(p))){k.acceesCodeNotMatch=[];for(const C of p)if(typeof C=="string"){const A=new RegExp(C,"ig");k.acceesCodeNotMatch.push(A);}}if(h&&(typeof h=="string"&&(h=[h]),Array.isArray(h))){k.accessCodeNeedRemoveStr=[];for(const C of h)if(typeof C=="string"){const A=new RegExp(C,"ig");k.accessCodeNeedRemoveStr.push(A);}}return typeof m=="string"&&(k.paramMatch=new RegExp(m,"i")),k}let t=[];for(const n of a){let r={subscribeUUID:n.subscribeUUID,rule:[],setting:{name:n.setting.name,key:n.key,configurationInterface:{matchRange_text:{},matchRange_html:{},function:{},linkClickMode_openBlank:{},schemeUri:{},ownFormList:[]}},isUserRule:true,afterRenderUrlBox:void 0};const s=n.regexp,i=n.key;if(Array.isArray(s)?s.forEach(c=>{r.rule.push(e(i,n,c));}):r.rule.push(e(i,n,s)),n.setting){if(this.initDefaultValue(V.function.enable(i),!!n.setting.enable),r.setting.configurationInterface.function.enable=!!n.setting.enable,typeof n.setting.isBlank=="boolean"&&(this.initDefaultValue(V.function.linkClickMode(i),"openBlank"),r.setting.configurationInterface.function.linkClickMode={openBlank:{default:true,enable:true}}),typeof n.setting.linkClickMode=="object"){let c=d.assign(ne.getDefaultLinkClickMode(),n.setting.linkClickMode||{}),u=null,p=[];const h=Object.keys(c);for(const m of h){let w=c[m];w.enable&&(w.default&&(u=m),p.push({value:m,text:w.text}));}u==null&&(u=p[0].value),this.initDefaultValue(V.function.linkClickMode(i),u);}typeof n.setting.openBlankWithCopyAccessCode=="boolean"&&(this.initDefaultValue(V.linkClickMode_openBlank.openBlankWithCopyAccessCode(i),!!n.setting.openBlankWithCopyAccessCode),r.setting.configurationInterface.linkClickMode_openBlank.openBlankWithCopyAccessCode=!!n.setting.openBlankWithCopyAccessCode),typeof n.setting.openBlankAutoFilleAccessCode=="boolean"&&(this.initDefaultValue(V.linkClickMode_openBlank.openBlankAutoFilleAccessCode(i),!!n.setting.openBlankAutoFilleAccessCode),r.setting.configurationInterface.linkClickMode_openBlank.openBlankAutoFilleAccessCode=!!n.setting.openBlankAutoFilleAccessCode),typeof n.setting.checkLinkValidity=="boolean"&&(this.initDefaultValue(V.function.checkLinkValidity(i),!!n.setting.checkLinkValidity),r.setting.configurationInterface.function.checkLinkValidity=!!n.setting.checkLinkValidity),typeof n.setting.checkLinkValidityHoverTip=="boolean"&&this.initDefaultValue(V.function.checkLinkValidityHoverTip(i),!!n.setting.checkLinkValidityHoverTip),typeof n.setting.isForward=="boolean"&&(this.initDefaultValue(V.schemeUri.enable(i),!!n.setting.isForward),r.setting.configurationInterface.schemeUri.enable=!!n.setting.isForward),typeof n.setting.schemeUri=="string"&&(this.initDefaultValue(V.schemeUri.uri(i),n.setting.schemeUri),r.setting.configurationInterface.schemeUri.uri=n.setting.schemeUri),typeof n.setting.innerTextAccessCodeBeforeMaxRange=="number"&&(this.initDefaultValue(V.matchRange_text.before(i),n.setting.innerTextAccessCodeBeforeMaxRange),r.setting.configurationInterface.matchRange_text.before=n.setting.innerTextAccessCodeBeforeMaxRange),typeof n.setting.innerTextAccessCodeAfterMaxRange=="number"&&(this.initDefaultValue(V.matchRange_text.after(i),n.setting.innerTextAccessCodeAfterMaxRange),r.setting.configurationInterface.matchRange_text.after=n.setting.innerTextAccessCodeAfterMaxRange),typeof n.setting.innerHTMLAccessCodeBeforeMaxRange=="number"&&(this.initDefaultValue(V.matchRange_html.before(i),n.setting.innerHTMLAccessCodeBeforeMaxRange),r.setting.configurationInterface.matchRange_html.before=n.setting.innerHTMLAccessCodeBeforeMaxRange),typeof n.setting.innerHTMLAccessCodeAfterMaxRange=="number"&&(this.initDefaultValue(V.matchRange_html.after(i),n.setting.innerHTMLAccessCodeAfterMaxRange),r.setting.configurationInterface.matchRange_html.after=n.setting.innerHTMLAccessCodeAfterMaxRange);}if(typeof n.icon=="string"){let c=n.icon;x.src.addIcon(i,c);}const l=Object.getPrototypeOf(async function(){}).constructor;if(typeof n.checkLinkValidityFunction=="string")try{let c=this.getBindContext(n);Reflect.set(oe.ruleCheckValidFunction,i,{init:new l("netDiskInfo",n.checkLinkValidityFunction).bind(c)});}catch(c){g.error(c);}if(typeof n.AuthorizationFunction=="string")try{let c=this.getBindContext(n);Reflect.deleteProperty(c,"NetDiskCheckLinkValidity"),yt.netDisk[i]=new l(n.AuthorizationFunction).bind(c);}catch(c){g.error(c);}if(typeof n.AutoFillAccessCodeFunction=="string")try{let c=this.getBindContext(n);Reflect.deleteProperty(c,"NetDiskCheckLinkValidity"),We.netDisk[i]=new l("netDiskInfo",n.AutoFillAccessCodeFunction).bind(c);}catch(c){g.error(c);}if(typeof n.parseFunction=="string")try{let c=this.getBindContext(n);Reflect.deleteProperty(c,"NetDiskCheckLinkValidity"),Reflect.set(st.rule,i,new l(n.parseFunction).bind(c));}catch(c){g.error(c);}if(typeof n.afterRenderUrlBox=="string")try{let c=this.getBindContext(n);Reflect.deleteProperty(c,"NetDiskCheckLinkValidity"),r.afterRenderUrlBox=new l("option",n.afterRenderUrlBox).bind(c);}catch(c){g.error(c);}let o=t.find(c=>c.setting.key===r.setting.key);o?o.rule=o.rule.concat(r.rule):t.push(r);}return t},getNetDiskRuleConfig(){return this.$data.userRule.values()},initDefaultValue(a,e){re(a)==null&&de(a,e);},getTemplateRule(){return {key:"规则名",icon:"图标链接字符串或图片的base64字符串",regexp:[{link_innerText:"",link_innerHTML:"",shareCode:"",shareCodeNeedRemoveStr:"",uiLinkShow:"",blank:"",copyUrl:""}],setting:{name:"设置界面的名字",enable:true,linkClickMode:"openBlank",openBlankWithCopyAccessCode:true}}},getRulePanelViewOption(a){const e=this;let t=()=>a??this.getTemplateRule(),n={id:"user-rule",title:"链接识别",headerTitle:"链接识别规则",subscribe:{enable:true,data(){return ee.getAllSubscribe()},getData:r=>ee.getSubscribe(r.uuid)??r,getDataItemName(r){return `
						<style>
							.subscribe-rule-title-info-wrapper{
								display: flex;
								flex-direction: column;
								gap: 4px;
							}
							.subscribe-rule-title-info-wrapper .rule-name-text{
								white-space: nowrap;
								text-overflow: ellipsis;
								overflow: hidden;
								font-weight: 600;
								font-size: 16px;
								line-height: 24px;
							}
							.subscribe-rule-title-info-wrapper .subscribe-rule-small-span-text{
								font-size: 14px;
								line-height: 16px;
								white-space: pre-wrap;
							}
						</style>
						<div class="subscribe-rule-title-info-wrapper">
							<div class="rule-name-text" style="white-space: nowrap;text-overflow: ellipsis;overflow: hidden;font-size: 16px;font-weight: 600;line-height: 24px;">${r.data.title||r.subscribeData.title||r.data.url}</div>
								<div class="subscribe-rule-small-span-text">${r.subscribeData.ruleData.length} 条规则，更新于：${d.formatTime(r.data.latestUpdateTime,"yyyy年MM月dd日 HH:mm:ss")}${typeof r.data.updateFailedTime=="number"?`，<span style="color: red;">更新失败于：${d.formatTime(r.data.updateFailedTime,"yyyy年MM月dd日 HH:mm:ss")}</span>`:""}</div>
								${r.subscribeData.homePage?`<a href="${r.subscribeData.homePage}" class="subscribe-rule-small-span-text" target="_blank" style="color:#67b279;">转到主页</a>`:""}
								<a href="${r.data.url}" class="subscribe-rule-small-span-text" target="_blank" style="color:#67b279;">订阅地址</a>
						</div>`},addData:r=>ee.addSubscribe(r),updateData:r=>ee.updateSubscribe(r),deleteData:r=>ee.deleteSubscribe(r),btnControls:{add:{enable:true},filter:{enable:true,title:"过滤订阅",option:[{name:"过滤【已启用】的订阅",filterCallBack(r){return r.data.enable}},{name:"过滤【未启用】的订阅",filterCallBack(r){return !r.data.enable}}]},clearAll:{enable:true,callback:()=>{ee.deleteAllSubscribe();}},ruleEnable:{enable:true,getEnable(r){return r.data.enable},async callback(r,s){r.data.enable=s,ee.updateSubscribe(r);}},ruleEdit:{enable:true,callback:r=>{let s=r.ruleData.uuid;return r.enterDeepMenu({headerTitle:r.ruleData.data.title||r.ruleData.subscribeData.title||r.ruleData.data.url,data(){return ee.getSubscribe(s)?.subscribeData?.ruleData??r.ruleData.subscribeData.ruleData},getData(i){return ee.getSubscribeRule(s,i.key)??i},getDataItemName(i){return i.setting.name},addData(i){return  true},updateData(i){return ee.updateSubscribeRule(s,i)},deleteData(i){return ee.deleteSubscribeRule(s,i)},btnControls:{filter:{enable:true,option:[{name:"过滤【已启用】的规则",filterCallBack(i){return i.setting.enable}},{name:"过滤【未启用】的规则",filterCallBack(i){return !i.setting.enable}}]},clearAll:{enable:true,callback:()=>{ee.clearSubscribe(s);}},ruleEdit:{enable:true,callback(i){return $e.showSubscribe(s,i.ruleData.key,async l=>{let o=await i.context.updateRuleItemElement(i.option,i.subscribeOption,l,i.$ruleItem,i.$section);i.$ruleItem=o;}),false}},ruleDelete:{enable:true,deleteCallBack(i){return ee.deleteSubscribeRule(s,i)}}}}),false}},ruleDelete:{enable:true,deleteCallBack:r=>ee.deleteSubscribe(r)},import:{enable:true,callback(r){ee.importSubscribe(()=>{r();});}},export:{enable:true,callback(){ee.exportSubscribe(Se+"-网站规则-订阅.json");}}},getSubscribeInfo:ee.getSubscribeInfo.bind(ee)},ruleOption:{btnControls:{add:{enable:true,callback(r){return $e.show(false,void 0,s=>{this.updateRuleContaienrElement(n.ruleOption,void 0,r.$section);}),false}},filter:{enable:true,title:"过滤规则",option:[{name:"过滤【已启用】的规则",filterCallBack(r){return r.setting.enable}},{name:"过滤【未启用】的规则",filterCallBack(r){return !r.setting.enable}}]},clearAll:{enable:true,callback:()=>{e.clearRule();}},import:{enable:true,callback:r=>{e.importRule(()=>{r();});}},export:{enable:true,callback:()=>{e.exportRule(Se+"-链接识别规则.json",Se+"-链接识别规则-订阅模式.json");}},ruleEdit:{enable:true,callback(r){return $e.show(true,r.ruleData.key,async s=>{let i=await r.context.updateRuleItemElement(r.option,r.subscribeOption,s,r.$ruleItem,r.$section);r.$ruleItem=i;}),false}},ruleDelete:{enable:true,deleteCallBack:r=>e.deleteRule(r.key)}},data:()=>this.getAllRule(),getAddData:()=>t(),getData:r=>this.getAllRule().find(l=>l.key===r.key)??r,getDataItemName:r=>r.setting.name,updateData:r=>this.updateRule(r.key,r),deleteData:r=>this.deleteRule(r.key)}};return n},addRule(a){let e=this.getAllRule();e.push(a),this.setRule(e);},setRule(a){a=Array.isArray(a)?a:[a],Le.set(this.$data.STORAGE_KEY,a);},updateRule(a,e){let t=this.getAllRule(),n=t.findIndex(r=>r.key===a);return n!==-1?(t.splice(n,1,e),this.setRule(t),true):false},deleteRule(a){let e=this.getAllRule(),t=e.findIndex(n=>n.key===a);return t!==-1?(e.splice(t,1),this.setRule(e),true):false},clearRule(){Le.delete(this.$data.STORAGE_KEY);},getAllRule(){return Le.get(this.$data.STORAGE_KEY,[])},getRule(a){return this.getAllRule().find(t=>t.key===a)},getFormatRule(a){return JSON.stringify(a||this.getAllRule(),void 0,4)},exportRule(a="rule.json",e="rule-subscribe.json"){let t=G.alert({title:{text:"请选择导出方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="only-export-rule-list">导出规则</div>
                    <div class="btn-control" data-mode="export-to-subscribe">导出订阅规则</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(i,l){i.close();}}},mask:{enable:true},drag:true,width:j.info.width,height:j.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),n=t.$shadowRoot.querySelector(".btn-control[data-mode='only-export-rule-list']"),r=t.$shadowRoot.querySelector(".btn-control[data-mode='export-to-subscribe']"),s=(i,l)=>{let o=new Blob([JSON.stringify(l,null,4)]),c=window.URL.createObjectURL(o),u=document.createElement("a");u.href=c,u.download=i,u.click(),setTimeout(()=>{window.URL.revokeObjectURL(c);},1500);};b.on(n,"click",i=>{d.preventEvent(i);try{let l=this.getAllRule();if(l.length===0){f.warning("规则为空，无需导出");return}s(a,l),t.close();}catch(l){f.error(l.toString(),{consoleLogContent:true});}}),b.on(r,"click",i=>{d.preventEvent(i);const l=this;t.close();try{if(this.getAllRule().length===0){f.warning("规则为空，无需导出");return}let c=B.config.PanelHandlerComponents(),u=function(v){return {get(_,S){return v[_]??S},set(_,S){v[_]=S,Le.set(l.$data.EXPORT_CONFIG_KEY,v);}}},p=()=>{let v=Le.get(this.$data.EXPORT_CONFIG_KEY,{});if(v?.title===""||v.title==null){f.error("订阅标题不能为空");return}if(v.version==null){f.error("版本号不能为空");return}else v.version=Number(v.version);v.homePage==null&&(v.homePage=void 0),v.lastModified=Date.now(),v.ruleData=this.getAllRule(),s(e,v),h.close();},h=G.alert({title:{text:"请填写导出配置",position:"center"},content:{text:`
							
						`,html:!0},btn:{ok:{enable:!0,text:"导出",callback(v,_){p();}},close:{enable:!0,callback(v,_){v.close();}}},mask:{enable:!0},drag:!0,width:j.info.width,height:j.info.height,style:`
						${B.config.cssText.panelCSS}

						.pops-alert-content li{
							list-style-type: none;
							display: flex;
							align-items: center;
							justify-content: space-between;
							margin: 10px;
						}
					`}),m=h.$shadowRoot.querySelector(".pops-alert-content"),w=Le.get(this.$data.EXPORT_CONFIG_KEY,{}),k=W("订阅标题","title","","",void 0,"");Reflect.set(k.props,O,u(w));let C=c.createSectionContainerItem_input(k),A=W("版本号","version","","",void 0,"",!1);Reflect.set(A.props,O,u(w));let $=c.createSectionContainerItem_input(A),R=W("主页地址","homePage","","",void 0,"选填");Reflect.set(R.props,O,u(w));let I=c.createSectionContainerItem_input(R);b.append(m,C),b.append(m,$),b.append(m,I);}catch(o){f.error(o.toString(),{consoleLogContent:true});}});},importRule(a){let e=G.alert({title:{text:"请选择导入方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="local">本地导入</div>
                    <div class="btn-control" data-mode="network">网络导入</div>
                    <div class="btn-control" data-mode="clipboard">剪贴板导入</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(l,o){l.close();}}},mask:{enable:true},drag:true,width:j.info.width,height:j.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),t=e.$shadowRoot.querySelector(".btn-control[data-mode='local']"),n=e.$shadowRoot.querySelector(".btn-control[data-mode='network']"),r=e.$shadowRoot.querySelector(".btn-control[data-mode='clipboard']"),s=l=>{let o=this.getAllRule(),c=[];for(let u=0;u<l.length;u++){const p=l[u];o.findIndex(m=>m.key===p.key)!==-1||c.push(p);}o=o.concat(c),c.length?(Le.set(this.$data.STORAGE_KEY,o),g.info(["新增的规则：",c]),f.success(`共 ${l.length} 条规则，新增 ${c.length} 条`)):f.error("未新增规则，请删除旧规则再重新导入"),a?.();},i=l=>new Promise(o=>{let c=d.toJSON(l);if(Array.isArray(c)){if(!c.length){f.error("导入失败，解析出的数据为空",{consoleLogContent:true}),o(false);return}}else c=[c];let u=[];for(let h=0;h<c.length;h++){const m=c[h];let w=this.parseRuleStrToRule(m);if(!w.success){if(c.length===1){f.error(w.msg,{timeout:4e3});return}continue}w.data&&u.push(w.data);}let p=c.length-u.length;p>0&&(p===c.length?f.error("所有规则均未通过规则检查，请检查规则",{timeout:4e3}):f.warning(`检测到有 ${p}条未通过规则检查的规则，已忽略`,{timeout:4e3})),u.length&&(s(u),o(true));});b.on(t,"click",l=>{d.preventEvent(l),e.close();let o=b.createElement("input",{type:"file",accept:".json"});b.on(o,["propertychange","input"],c=>{if(!o.files?.length)return;let u=o.files[0],p=new FileReader;p.onload=()=>{i(p.result);},p.readAsText(u,"UTF-8");}),o.click();}),b.on(n,"click",l=>{d.preventEvent(l),e.close();let o=G.prompt({title:{text:"网络导入",position:"center"},content:{text:"",placeholder:"请填写URL",focus:true},btn:{close:{enable:true,callback(p,h){p.close();}},ok:{text:"导入",callback:async(p,h)=>{let m=p.text;if(d.isNull(m)){f.error("请填入完整的url");return}let w=f.loading("正在获取配置..."),k=await M.get(m,{allowInterceptConfig:false});if(w.close(),!k.status){g.error(k),f.error("获取配置失败",{consoleLogContent:true});return}await i(k.data.responseText)&&p.close();}},cancel:{enable:false}},mask:{enable:true},drag:true,width:j.info.width,height:"auto"}),c=o.$shadowRoot.querySelector("input"),u=o.$shadowRoot.querySelector(".pops-prompt-btn-ok");b.on(c,["input","propertychange"],p=>{b.val(c)===""?b.attr(u,"disabled","true"):b.removeAttr(u,"disabled");}),b.listenKeyboard(c,"keydown",(p,h,m)=>{p==="Enter"&&m.length===0&&b.val(c)!==""&&d.dispatchEvent(u,"click");}),d.dispatchEvent(c,"input");}),b.on(r,"click",async l=>{d.preventEvent(l),e.close();let o=await d.getClipboardInfo();if(o.error!=null){f.error(o.error.toString());return}if(o.content.trim()===""){f.warning("获取到的剪贴板内容为空");return}await i(o.content);});}},rn={rule:[{link_innerText:"pan.baidu.com/s/[0-9a-zA-Z-_]{6,24}([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码|\\?pwd=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"pan.baidu.com/s/[0-9a-zA-Z-_]{6,24}([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码|\\?pwd=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/pan\.baidu\.com\/s\/([0-9a-zA-Z-_]+)/gi,shareCodeNeedRemoveStr:/pan\.baidu\.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码|pwd=)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"pan.baidu.com/s/{#shareCode#}?pwd={#accessCode#}",blank:"https://pan.baidu.com/s/{#shareCode#}?pwd={#accessCode#}",copyUrl:"https://pan.baidu.com/s/{#shareCode#}?pwd={#accessCode#}"},{link_innerText:"pan.baidu.com/(share|wap)/init\\?surl=[0-9a-zA-Z-_]{5,24}([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码|&pwd=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"pan.baidu.com/(share|wap)/init\\?surl=[0-9a-zA-Z-_]{5,24}([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码|&pwd=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/pan\.baidu\.com\/(share|wap)\/init\?surl=([0-9a-zA-Z-_]+)/gi,shareCodeNeedRemoveStr:/pan\.baidu\.com\/(share|wap)\/init\?surl=/gi,checkAccessCode:/(密码|访问码|提取码|&pwd=)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"pan.baidu.com/share/init?surl={#shareCode#}&pwd={#accessCode#}",blank:"https://pan.baidu.com/share/init?surl={#shareCode#}&pwd={#accessCode#}",copyUrl:"https://pan.baidu.com/share/init?surl={#shareCode#}&pwd={#accessCode#}"}],setting:{name:"百度网盘",key:"baidu",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:true,uri:""}}}},sn=()=>({rule:[{link_innerText:"(lanzou[a-z]{0,1}|lan[a-z]{2}).com/(tp/|u/|)([0-9a-zA-Z_-]{5,22}|[%0-9a-zA-Z]{4,90}|[\\u4e00-\\u9fa5]{3,20})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{3,6}|)",link_innerHTML:"(lanzou[a-z]{0,1}|lan[a-z]{2}).com/(tp/|u/|)([0-9a-zA-Z_-]{5,22}|[%0-9a-zA-Z]{4,90}|[\\u4e00-\\u9fa5]{3,20})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{3,6}|)",shareCode:/(lanzou[a-z]{0,1}|lan[a-z]{2}).com\/(tp\/|u\/|)([0-9a-zA-Z_\-]{5,22}|[%0-9a-zA-Z]{4,90}|[\u4e00-\u9fa5]{3,20})/gi,shareCodeNeedRemoveStr:/(lanzou[a-z]{0,1}|lan[a-z]{2}).com\/(tp\/|u\/|)/gi,shareCodeExcludeRegular:["lanzouyx"],checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{3,})/gi,uiLinkShow:`${ge.hostname}/{#shareCode#} 提取码: {#accessCode#}`,blank:`https://${ge.hostname}/{#shareCode#}`,copyUrl:`https://${ge.hostname}/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"(lanzou[a-z]{0,1}|lan[a-z]{2}).com/s/([0-9a-zA-Z_-]{5,22}|[%0-9a-zA-Z]{4,90}|[\\u4e00-\\u9fa5]{3,20})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{3,6}|)",link_innerHTML:"(lanzou[a-z]{0,1}|lan[a-z]{2}).com/s/([0-9a-zA-Z_-]{5,22}|[%0-9a-zA-Z]{4,90}|[\\u4e00-\\u9fa5]{3,20})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{3,6}|)",shareCode:/(lanzou[a-z]{0,1}|lan[a-z]{2}).com\/s\/([0-9a-zA-Z_\-]{5,22}|[%0-9a-zA-Z]{4,90}|[\u4e00-\u9fa5]{3,20})/gi,shareCodeNeedRemoveStr:/(lanzou[a-z]{0,1}|lan[a-z]{2}).com\/s\//gi,shareCodeExcludeRegular:["lanzouyx"],checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{3,})/gi,uiLinkShow:`${ge.hostname}/s/{#shareCode#} 提取码: {#accessCode#}`,blank:`https://${ge.hostname}/s/{#shareCode#}`,copyUrl:`https://${ge.hostname}/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"蓝奏云",key:"lanzou",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:false,isForwardBlankLink:false,uri:""},ownFormList:[{text:"其它配置",type:"forms",forms:[W("蓝奏云域名",ge.MENU_KEY,ge.DEFAULT_HOST_NAME,"",void 0,`例如：${ge.DEFAULT_HOST_NAME}`)]}]}}}),on={rule:[{link_innerText:"ilanzou.com/s/([a-zA-Z0-9_-]{5,22})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码|\\?code=)[\\s\\S]{0,{#matchRange-text-after#}}[a-zA-Z0-9]{3,6}|)",link_innerHTML:"ilanzou.com/s/([a-zA-Z0-9_-]{5,22})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码|\\?code=)[\\s\\S]{0,{#matchRange-html-after#}}[a-zA-Z0-9]{3,6}|)",shareCode:/ilanzou.com\/s\/([a-zA-Z0-9_\-]{5,22})/gi,shareCodeNeedRemoveStr:/ilanzou.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码|\?code=)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{3,})/gi,uiLinkShow:"www.ilanzou.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.ilanzou.com/s/{#shareCode#}?code={#accessCode#}",copyUrl:"https://www.ilanzou.com/s/{#shareCode#}?code={#accessCode#}"}],setting:{name:"蓝奏云优享",key:"lanzouyx",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:false,isForwardBlankLink:false,uri:""}}}},ln={rule:[{link_innerText:"(cloud.189.cn/web/share\\?code=([0-9a-zA-Z_-]){8,14}|cloud.189.cn/t/([a-zA-Z0-9_-]{8,14}))([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"(cloud.189.cn/web/share\\?code=([0-9a-zA-Z_-]){8,14}|cloud.189.cn/t/([a-zA-Z0-9_-]{8,14}))([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/cloud.189.cn\/web\/share\?code=([0-9a-zA-Z_\-]){8,14}|cloud.189.cn\/t\/([a-zA-Z0-9_\-]{8,14})/gi,shareCodeNeedRemoveStr:/cloud\.189\.cn\/t\/|cloud.189.cn\/web\/share\?code=/gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"cloud.189.cn/t/{#shareCode#} 提取码: {#accessCode#}",blank:"https://cloud.189.cn/t/{#shareCode#}",copyUrl:`https://cloud.189.cn/t/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"天翼云",key:"tianyiyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:false,isForwardBlankLink:false,uri:""}}}},cn={rule:[{link_innerText:"caiyun.139.com/m/i\\?([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"caiyun.139.com/m/i\\?([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/caiyun\.139\.com\/m\/i\?([a-zA-Z0-9_\-]{8,14})/gi,shareCodeNeedRemoveStr:/caiyun\.139\.com\/m\/i\?/gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"caiyun.139.com/m/i?{#shareCode#} 提取码: {#accessCode#}",blank:"https://caiyun.139.com/m/i?{#shareCode#}",copyUrl:`https://caiyun.139.com/m/i?{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"caiyun.139.com/w/i/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"caiyun.139.com/w/i/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/caiyun\.139\.com\/w\/i\/([a-zA-Z0-9_\-]{8,14})/gi,shareCodeNeedRemoveStr:/caiyun\.139\.com\/w\/i\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"caiyun.139.com/w/i/{#shareCode#} 提取码: {#accessCode#}",blank:"https://caiyun.139.com/w/i/{#shareCode#}",copyUrl:`https://caiyun.139.com/w/i/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"yun.139.com/link/w/i/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"yun.139.com/link/w/i/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/yun\.139\.com\/link\/w\/i\/([a-zA-Z0-9_\-]{8,14})/gi,shareCodeNeedRemoveStr:/yun\.139\.com\/link\/w\/i\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"yun.139.com/link/w/i/{#shareCode#} 提取码: {#accessCode#}",blank:"https://yun.139.com/link/w/i/{#shareCode#}",copyUrl:`https://yun.139.com/link/w/i/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"中国移动云盘",key:"hecaiyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}}},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:false,uri:""}}}},un={rule:[{link_innerText:"aliyundrive.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"aliyundrive.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/aliyundrive\.com\/s\/([a-zA-Z0-9_\-]{8,14})/g,shareCodeNeedRemoveStr:/aliyundrive\.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"aliyundrive.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.aliyundrive.com/s/{#shareCode#}",copyUrl:`https://www.aliyundrive.com/s/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"aliyundrive.com/t/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"aliyundrive.com/t/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/aliyundrive\.com\/t\/([a-zA-Z0-9_\-]{8,14})/g,shareCodeNeedRemoveStr:/aliyundrive\.com\/t\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"aliyundrive.com/t/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.aliyundrive.com/t/{#shareCode#}",copyUrl:`https://www.aliyundrive.com/t/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"alipan.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"alipan.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/alipan\.com\/s\/([a-zA-Z0-9_\-]{8,14})/g,shareCodeNeedRemoveStr:/alipan\.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"alipan.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.alipan.com/s/{#shareCode#}",copyUrl:`https://www.alipan.com/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"阿里云",key:"aliyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:true,isForwardBlankLink:true,uri:""}}}},dn={rule:[{link_innerText:"(wenshushu.cn|wss.ink|ws28.cn|wss1.cn|ws59.cn|wss.cc)/f/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"(wenshushu.cn|wss.ink|ws28.cn|wss1.cn|ws59.cn|wss.cc)/f/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/(wenshushu.cn|wss.ink|ws28.cn|wss1.cn|ws59.cn|wss.cc)\/f\/([a-zA-Z0-9_-]{8,14})/gi,shareCodeNeedRemoveStr:/(wenshushu.cn|wss.ink|ws28.cn|wss1.cn|ws59.cn|wss.cc)\/f\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/[0-9a-zA-Z]{4}/gi,uiLinkShow:"www.wenshushu.cn/f/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.wenshushu.cn/f/{#shareCode#}",copyUrl:`https://www.wenshushu.cn/f/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"wenshushu.cn/k/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"wenshushu.cn/k/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/wenshushu.cn\/k\/([a-zA-Z0-9_-]{8,14})/gi,shareCodeNeedRemoveStr:/wenshushu.cn\/k\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/[0-9a-zA-Z]{4}/gi,uiLinkShow:"www.wenshushu.cn/k/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.wenshushu.cn/k/{#shareCode#}",copyUrl:`https://www.wenshushu.cn/k/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"文叔叔",key:"wenshushu",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:true,isForwardBlankLink:true,uri:""}}}},pn={rule:[{link_innerText:"cowtransfer.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"cowtransfer.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/cowtransfer.com\/s\/([a-zA-Z0-9_\-]{8,14})/gi,shareCodeNeedRemoveStr:/cowtransfer\.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"cowtransfer.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://cowtransfer.com/s/{#shareCode#}",copyUrl:`https://cowtransfer.com/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"奶牛",key:"nainiu",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:true,isForwardBlankLink:true,uri:""}}}},hn={rule:[{link_innerText:"weiyun.com/[0-9a-zA-Z-_]{7,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"weiyun.com/[0-9a-zA-Z-_]{7,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/weiyun.com\/([0-9a-zA-Z\-_]{7,24})/gi,shareCodeNeedRemoveStr:/weiyun.com\//gi,shareCodeNotMatch:/^(ftn_handler)/,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"share.weiyun.com/{#shareCode#} 提取码: {#accessCode#}",blank:"https://share.weiyun.com/{#shareCode#}",copyUrl:`https://share.weiyun.com/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"微云",key:"weiyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:true,uri:""}}}},fn={rule:[{link_innerText:"xunlei.com/s/[0-9a-zA-Z-_]{8,30}([\\s\\S]{0,{#matchRange-text-before#}}(\\?pwd=|访问码|提取码|密码|)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"xunlei.com/s/[0-9a-zA-Z-_]{8,30}([\\s\\S]{0,{#matchRange-html-before#}}(\\?pwd=|访问码|提取码|密码|)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/xunlei.com\/s\/([0-9a-zA-Z\-_]{8,30})/gi,shareCodeNeedRemoveStr:/xunlei.com\/s\//gi,checkAccessCode:/(\?pwd=|提取码|密码|访问码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"pan.xunlei.com/s/{#shareCode#}?pwd={#accessCode#} 提取码: {#accessCode#}",blank:"https://pan.xunlei.com/s/{#shareCode#}?pwd={#accessCode#}",copyUrl:"https://pan.xunlei.com/s/{#shareCode#}?pwd={#accessCode#}"}],setting:{name:"迅雷云盘",key:"xunlei",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:true,uri:""}}}},gn={rule:[{link_innerText:"(pan.jc-box.com|download.jamcz.com|545c.com)/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(pan.jc-box.com|download.jamcz.com|545c.com)/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/(pan.jc-box.com|download.jamcz.com|545c.com)\/d\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(pan.jc-box.com|download.jamcz.com|545c.com)\/d\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,paramMatch:/([a-zA-Z0-9\.]+)\/d\//i,uiLinkShow:"{#$1#}/d/{#shareCode#} 提取码: {#accessCode#}",blank:"https://{#$1#}/d/{#shareCode#}?p={#accessCode#}",copyUrl:`https://{#$1#}/d/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"ct.ghpym.com(/|/#/)d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"ct.ghpym.com(/|/#/)d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/ct.ghpym.com(\/|\/#\/)d\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/ct.ghpym.com(\/|\/#\/)d\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,paramMatch:/([a-zA-Z0-9\.]+)(\/|\/#\/)d\//i,uiLinkShow:"{#$1#}{#$2#}d/{#shareCode#} 提取码: {#accessCode#}",blank:"http://{#$1#}{#$2#}d/{#shareCode#}?p={#accessCode#}",copyUrl:`http://{#$1#}{#$2#}d/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"ctfile.com/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"ctfile.com/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/ctfile.com\/d\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/ctfile.com\/d\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"url95.ctfile.com/d/{#shareCode#} 提取码: {#accessCode#}",blank:"https://url95.ctfile.com/d/{#shareCode#}?p={#accessCode#}",copyUrl:`https://url95.ctfile.com/d/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"(2k.us|u062.com|545c.com|t00y.com|tc5.us)/file/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(2k.us|u062.com|545c.com|t00y.com|tc5.us)/file/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/(2k.us|u062.com|545c.com|t00y.com|tc5.us)\/file\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(2k.us|u062.com|545c.com|t00y.com|tc5.us)\/file\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"u062.com/file/{#shareCode#} 提取码: {#accessCode#}",blank:"https://u062.com/file/{#shareCode#}?p={#accessCode#}",copyUrl:`https://u062.com/file/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"(pan.jc-box.com|545c.com|down.jc-box.com|download.cx05.cc|download.jamcz.com|download.macenjoy.co)/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(pan.jc-box.com|545c.com|down.jc-box.com|download.cx05.cc|download.jamcz.com|download.macenjoy.co)/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/(pan.jc-box.com|545c.com|down.jc-box.com|download.cx05.cc|download.jamcz.com|download.macenjoy.co)\/f\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(pan.jc-box.com|545c.com|down.jc-box.com|download.cx05.cc|download.jamcz.com|download.macenjoy.co)\/f\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,paramMatch:/([0-9a-zA-Z\.]+)\/f\//i,uiLinkShow:"{#$1#}/f/{#shareCode#} 提取码: {#accessCode#}",blank:"http://{#$1#}/f/{#shareCode#}?p={#accessCode#}",copyUrl:`http://{#$1#}/f/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"url[0-9]{2}.com/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"url[0-9]{2}.com/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/url[0-9]{2}.com\/f\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/url[0-9]{2}.com\/f\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,paramMatch:/([0-9a-zA-Z\.]+)\/f\//i,uiLinkShow:"{#$1#}/f/{#shareCode#} 提取码: {#accessCode#}",blank:"http://{#$1#}/f/{#shareCode#}?p={#accessCode#}",copyUrl:`http://{#$1#}/f/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"(ctfile.com|089u.com)/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(ctfile.com|089u.com)/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/(ctfile.com|089u.com)\/f\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(ctfile.com|089u.com)\/f\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"url95.ctfile.com/f/{#shareCode#} 提取码: {#accessCode#}",blank:"https://url95.ctfile.com/f/{#shareCode#}?p={#accessCode#}",copyUrl:`https://url95.ctfile.com/f/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"(089u.com|474b.com)/dir/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(089u.com|474b.com)/dir/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{6}|)",shareCode:/(089u.com|474b.com)\/dir\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(089u.com|474b.com)\/dir\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{6})/gi,uiLinkShow:"089u.com/dir/{#shareCode#} 提取码: {#accessCode#}",blank:"https://089u.com/dir/{#shareCode#}?p={#accessCode#}",copyUrl:`https://089u.com/dir/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`}],setting:{name:"城通网盘",key:"chengtong",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:true,uri:""},ownFormList:[{type:"forms",text:"文件解析配置",forms:[W("<a target='_blank' href='https://github.com/qinlili23333/ctfileGet/'>解析站</a>","chengtong-parse-file-api-host","https://ctfile.qinlili.bid","解析站配置，暂时只支持file，非file为新标签页打开",void 0,"")]}]}}},mn={rule:[{link_innerText:"quark.cn/s/[0-9a-zA-Z-_]{8,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"quark.cn/s/[0-9a-zA-Z-_]{8,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/quark.cn\/s\/([0-9a-zA-Z\-_]{8,24})/gi,shareCodeNeedRemoveStr:/quark.cn\/s\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"quark.cn/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://pan.quark.cn/s/{#shareCode#}",copyUrl:`https://pan.quark.cn/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"夸克网盘",key:"kuake",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:true,uri:""}}}},bn={rule:[{link_innerText:"magnet:\\?xt=urn:btih:[0-9a-fA-F]{32,40}",link_innerHTML:"magnet:\\?xt=urn:btih:[0-9a-fA-F]{32,40}",shareCode:/magnet:\?xt=urn:btih:([0-9a-fA-F]{32,40})/gi,shareCodeNeedRemoveStr:/magnet:\?xt=urn:btih:/gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"magnet:?xt=urn:btih:{#shareCode#}",blank:"magnet:?xt=urn:btih:{#shareCode#}",copyUrl:"magnet:?xt=urn:btih:{#shareCode#}"}],setting:{name:"BT磁力",key:"magnet",configurationInterface:{function:{enable:true,linkClickMode:{openBlank:{default:true},"openBlank-closePopup":{enable:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}}},schemeUri:{enable:false,isForwardBlankLink:true,uri:""}}}},wn={rule:[{link_innerText:"jianguoyun.com/p/[0-9a-zA-Z-_]{16,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]+|)",link_innerHTML:"jianguoyun.com/p/[0-9a-zA-Z-_]{16,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]+|)",shareCode:/jianguoyun.com\/p\/([0-9a-zA-Z\-_]{16,24})/gi,shareCodeNeedRemoveStr:/jianguoyun.com\/p\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{3,6})/gi,uiLinkShow:"jianguoyun.com/p/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.jianguoyun.com/p/{#shareCode#}",copyUrl:`https://www.jianguoyun.com/p/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"坚果云",key:"jianguoyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:false,isForwardBlankLink:false,uri:""}}}},kn={rule:[{link_innerText:"[0-9a-zA-Z-_]+.sharepoint.com/[0-9a-zA-Z-_:]+/[0-9a-zA-Z-_:]+/personal/[0-9a-zA-Z-_]+/[0-9a-zA-Z-_]+([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=\\?e=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]+|)",link_innerHTML:"[0-9a-zA-Z-_]+.sharepoint.com/[0-9a-zA-Z-_:]+/[0-9a-zA-Z-_:]+/personal/[0-9a-zA-Z-_]+/[0-9a-zA-Z-_]+([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=\\?e=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]+|)",shareCode:/[0-9a-zA-Z-_]+\/[0-9a-zA-Z-_:]+\/[0-9a-zA-Z-_:]+\/personal\/[0-9a-zA-Z-_]+\/([0-9a-zA-Z\-_]+)/gi,shareCodeNeedRemoveStr:/[0-9a-zA-Z-_]+\/[0-9a-zA-Z-_:]+\/[0-9a-zA-Z-_:]+\/personal\/[0-9a-zA-Z-_]+\//gi,checkAccessCode:/(提取码|密码|访问码|\?password=|\?e=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,8})/gi,paramMatch:/([0-9a-zA-Z-_]+).sharepoint.com\/([0-9a-zA-Z-_:]+)\/([0-9a-zA-Z-_:]+)\/personal\/([0-9a-zA-Z-_]+)\/([0-9a-zA-Z-_]+)/i,uiLinkShow:"{#$1#}.sharepoint.com/{#$2#}/{#$3#}/personal/{#$4#}/{#shareCode#} 提取码: {#accessCode#}",blank:"https://{#$1#}.sharepoint.com/{#$2#}/{#$3#}/personal/{#$4#}/{#shareCode#}?e={#accessCode#}",copyUrl:`https://{#$1#}.sharepoint.com/{#$2#}/{#$3#}/personal/{#$4#}/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"OneDrive",key:"onedrive",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:false,uri:""}}}},yn={rule:[{link_innerText:"(drive|fast).uc.cn/s/[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]+|)",link_innerHTML:"(drive|fast).uc.cn/s/[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]+|)",shareCode:/(drive|fast).uc.cn\/s\/([0-9a-zA-Z]{8,24})/gi,shareCodeNeedRemoveStr:/(drive|fast).uc.cn\/s\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]+)/gi,uiLinkShow:"drive.uc.cn/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://drive.uc.cn/s/{#shareCode#}",copyUrl:`https://drive.uc.cn/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"UC网盘",key:"uc",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:false,isForwardBlankLink:false,uri:""}}}},ke=function(a,e,t,n,r,s,i,l,o,c){let u={text:a,type:"slider",description:l,attributes:{},props:{},getValue(){return this.props[O].get(e,t)},getToolTipContent(p){return typeof i=="function"?i(p):`${p}`},callback(p,h){if(typeof s=="function"&&s(p,h))return;this.props[O].set(e,h);},min:n,max:r,step:o};return Reflect.set(u.attributes,ue,e),Reflect.set(u.attributes,me,t),Ge.initComponentsStorageApi("slider",u,{get(p,h){return J.getValue(p,h)},set(p,h){J.setValue(p,h);}}),u},De=function(a,e,t,n,r,s,i){let l=[];typeof n=="function"?l=n():l=n;let o={text:a,type:"select",description:s,attributes:{},props:{},getValue(){return this.props[O].get(e,t)},callback(c,u,p){let h=u;g.info(`选择：${p}`),this.props[O].set(e,h);},data:l};return Reflect.set(o.attributes,ue,e),Reflect.set(o.attributes,me,t),Ge.initComponentsStorageApi("select",o,{get(c,u){return J.getValue(c,u)},set(c,u){J.setValue(c,u);}}),o},Cn={rule:[{link_innerText:"(115.com|115cdn.com|anxia.com)/s/[0-9a-zA-Z-_]{8,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"(115.com|115cdn.com|anxia.com)/s/[0-9a-zA-Z-_]{8,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/(115.com|115cdn.com|anxia.com)\/s\/([0-9a-zA-Z\-_]{8,24})/gi,shareCodeNeedRemoveStr:/(115.com|115cdn.com|anxia.com)\/s\//gi,checkAccessCode:/(提取码|密码|\?password=|访问码)[\s\S]+/gi,accessCode:/(提取码|密码|\?password=|访问码)([0-9a-zA-Z]{4})/i,paramMatch:/(115.com|115cdn.com|anxia.com)/i,uiLinkShow:"{#$1#}/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://{#$1#}/s/{#shareCode#}",copyUrl:`https://{#$1#}/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"115网盘",key:"_115pan",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:true,uri:""}}}},xn={rule:[{link_innerText:"ed2k://\\|file\\|[^\\|]+\\|\\d+\\|[a-fA-F0-9]{32}\\|",link_innerHTML:"ed2k://\\|file\\|[^\\|]+\\|\\d+\\|[a-fA-F0-9]{32}\\|",shareCode:/ed2k:\/\/\\|file\\|[^\\|]+\\|\\d+\\|([a-fA-F0-9]{32})\|/gi,shareCodeNeedRemoveStr:/ /gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4})/gi,paramMatch:/ed2k:\/\/\|file\|([^\|]+)\|(\d+)\|([a-fA-F0-9]{32})\|/i,uiLinkShow:"ed2k://|file|{#$1#}|{#$2#}|{#$3#}|/",blank:"ed2k://|file|{#$1#}|{#$2#}|{#$3#}|/",copyUrl:"ed2k://|file|{#$1#}|{#$2#}|{#$3#}|/"}],setting:{name:"ed2k",key:"ed2k",configurationInterface:{function:{enable:true,linkClickMode:{openBlank:{default:true},"openBlank-closePopup":{enable:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}}},schemeUri:{enable:false,isForwardBlankLink:true,uri:""}}}},vn={rule:[{link_innerText:"[0-9a-z]+.(link.yunpan.com|link.yunpan.360.cn)/lk/surl_[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]+|)",link_innerHTML:"[0-9a-z]+.(link.yunpan.com|link.yunpan.360.cn)/lk/surl_[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]+|)",shareCode:/(link.yunpan.com|link.yunpan.360.cn)\/lk\/surl_([0-9a-zA-Z]{8,24})/gi,shareCodeNeedRemoveStr:/(link.yunpan.com|link.yunpan.360.cn)\/lk\/surl_/gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]+)/gi,paramMatch:/([0-9a-z]+).(link.yunpan.com|link.yunpan.360.cn)\/lk\//i,uiLinkShow:"https://{#$1#}.{#$2#}/lk/surl_{#shareCode#} 提取码: {#accessCode#}",blank:"https://{#$1#}.{#$2#}/lk/surl_{#shareCode#}",copyUrl:`https://{#$1#}.{#$2#}/lk/surl_{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"(yunpan.360.cn|www.yunpan.com)/lk/surl_[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]+|)",link_innerHTML:"(yunpan.360.cn|www.yunpan.com)/lk/surl_[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]+|)",shareCode:/(yunpan.360.cn|www.yunpan.com)\/lk\/surl_([0-9a-zA-Z]{8,24})/gi,shareCodeNeedRemoveStr:/(yunpan.360.cn|www.yunpan.com)\/lk\/surl_/gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]+)/gi,paramMatch:/(yunpan.360.cn|www.yunpan.com)/i,uiLinkShow:"https://{#$1#}/lk/surl_{#shareCode#} 提取码: {#accessCode#}",blank:"https://{#$1#}/lk/surl_{#shareCode#}",copyUrl:`https://{#$1#}/lk/surl_{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"360AI云盘",key:"360yunpan",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:false,isForwardBlankLink:false,uri:""}}}},Ye={dataKey:"ruleData",$data:{ruleContent:[]},init(){this.initRule();},initRule(){let a=[rn,sn,on,ln,cn,un,dn,pn,Tt,hn,fn,Cn,gn,mn,bn,xn,wn,kn,yn,vn],e=le.getNetDiskRuleConfig();[...a,...e].forEach(t=>{if(typeof t=="function"&&(t=t()),typeof t.setting.key!="string")throw new Error("规则未设置key");if(t.rule==null)throw new Error("规则未设置rule");const n=t.setting.key,r=t.setting.name,s=t.rule;if(Reflect.has(L.$rule.ruleOption,n)){let c=L.$rule.ruleOption[n];t.isUserRule?c=[...s,...c]:c=[...c,...s];let u=L.$rule.rule.find(p=>p.setting.key===n);u.rule=c;}else Reflect.set(L.$rule.ruleOption,n,t.rule),L.$rule.rule.push(t);Reflect.set(L.$rule.ruleSetting,n,t.setting),t.rule=this.parseRuleMatchRule(t);let i=this.parseRuleSetting(t),l=t.setting.name;x.src.hasIcon(n)&&(l=`
					<div class="netdisk-aside-icon" style="background-image: url(${x.src.icon[n]});"></div>
					<div class="netdisk-aside-text">${r}</div>`);let o=r;t.isUserRule&&(o+=`
					<div 
						class="netdisk-custom-rule-edit" 
						data-key="${n}" 
						data-type="${t.setting.name}"
						${typeof t.subscribeUUID=="string"?`data-subscribe-uuid="${t.subscribeUUID}"`:""}"
						
					>${B.config.iconSVG.edit}</div>`,o+=`
					<div
						class="netdisk-custom-rule-delete"
						data-key="${n}"
						data-type="${t.setting.name}"
						${typeof t.subscribeUUID=="string"?`data-subscribe-uuid="${t.subscribeUUID}"`:""}"
					>${B.config.iconSVG.delete}</div>`),this.$data.ruleContent.push({id:"netdisk-panel-config-"+n,title:l,headerTitle:o,attributes:{"data-key":n},forms:i,afterRender:c=>{c.$asideLiElement.setAttribute("data-function-enable",Y.function.enable(n,true).toString());}});});},parseRuleMatchRule(a){let e=a.rule,t=[],n=a.setting.key;for(let r=0;r<e.length;r++){const s=e[r];typeof s.link_innerText=="string"&&(s.link_innerText=ne.replaceParam(s.link_innerText,Ft(n))),typeof s.link_innerHTML=="string"&&(s.link_innerHTML=ne.replaceParam(s.link_innerHTML,Ot(n))),t.push(s);}return t},parseRuleSetting(a){let e=[];const t=a.setting.configurationInterface,n=a.setting.key;if(t==null)return [];if(t.function){let r=[];if("enable"in t.function){let s=typeof t.function.enable=="boolean"?t.function.enable:false;r.push(H("启用",V.function.enable(n),s,(i,l)=>{const o="data-function-enable";let p=i.target.getRootNode().querySelector(`.pops-panel-aside li[data-key="${n}"]`);p&&p.setAttribute(o,l.toString());},"开启可允许匹配该规则")),t.function.enable=Y.function.enable(n);}if("linkClickMode"in t.function){let s=d.assign(ne.getDefaultLinkClickMode(),t.function.linkClickMode||{}),i=null,l=[];const o=Object.keys(s);for(const c of o){let u=s[c];u.enable&&(u.default&&(i=c),l.push({value:c,text:u.text}));}i==null&&(i=l[0].value),r.push(De("点击动作",V.function.linkClickMode(n),i,l,void 0,"点击匹配到的链接的执行的动作"));for(const c in t.function.linkClickMode){const u=t.function.linkClickMode[c];c===Y.function.linkClickMode(n)?u.default=true:u.default=false;}}if("checkLinkValidity"in t.function){const s=typeof t.function.checkLinkValidity=="boolean"?t.function.checkLinkValidity:true;r.push(H("验证链接有效性",V.function.checkLinkValidity(n),s,void 0,"自动请求链接，判断该链接是否有效，在大/小窗内显示验证结果图标")),t.function.checkLinkValidity=Y.function.checkLinkValidity(n);}if("checkLinkValidityHoverTip"in t.function){const s=typeof t.function.checkLinkValidityHoverTip=="boolean"?t.function.checkLinkValidityHoverTip:true;r.push(H("验证链接有效性-悬停提示",V.function.checkLinkValidityHoverTip(n),s,void 0,"当鼠标悬停在验证结果图标上时会显示相关验证信息"));}r.length&&e.push({text:"功能",type:"forms",forms:r});}if(t.linkClickMode_openBlank){let r=[];if("openBlankAutoFilleAccessCode"in t.linkClickMode_openBlank){const s=typeof t.linkClickMode_openBlank.openBlankAutoFilleAccessCode=="boolean"?t.linkClickMode_openBlank.openBlankAutoFilleAccessCode:true;r.push(H("自动填充访问码",V.linkClickMode_openBlank.openBlankAutoFilleAccessCode(n),s,void 0,"当点击动作是【新标签页打开】时且存在访问码，那就会自动填充访问码")),t.linkClickMode_openBlank.openBlankAutoFilleAccessCode=Y.linkClickMode_openBlank.openBlankAutoFilleAccessCode(n);}if("openBlankWithCopyAccessCode"in t.linkClickMode_openBlank){const s=typeof t.linkClickMode_openBlank.openBlankWithCopyAccessCode=="boolean"?t.linkClickMode_openBlank.openBlankWithCopyAccessCode:false;r.push(H("跳转时复制访问码",V.linkClickMode_openBlank.openBlankWithCopyAccessCode(n),s,void 0,"当点击动作是【新标签页打开】时且存在访问码，那就会复制访问码到剪贴板")),t.linkClickMode_openBlank.openBlankWithCopyAccessCode=Y.linkClickMode_openBlank.openBlankWithCopyAccessCode(n);}r.length&&e.push({text:"点击动作-新标签页打开",type:"forms",forms:r});}if(t.schemeUri){const r=[];if("enable"in t.schemeUri){const s=typeof t.schemeUri.enable=="boolean"?t.schemeUri.enable:false;r.push(H("启用",V.schemeUri.enable(n),s,void 0,"开启后可进行scheme uri转发")),t.schemeUri.enable=Y.schemeUri.enable(n);}if("isForwardBlankLink"in t.schemeUri){const s=typeof t.schemeUri.isForwardBlankLink=="boolean"?t.schemeUri.isForwardBlankLink:false;r.push(H("转发新标签页链接",V.schemeUri.isForwardBlankLink(n),s,void 0,"对新标签页打开的链接进行scheme转换")),t.schemeUri.isForwardBlankLink=Y.schemeUri.isForwardBlankLink(n);}if("isForwardLinearChain"in t.schemeUri){const s=typeof t.schemeUri.isForwardLinearChain=="boolean"?t.schemeUri.isForwardLinearChain:false;r.push(H("转发直链",V.schemeUri.isForwardLinearChain(n),s,void 0,"对解析的直链进行scheme转换")),t.schemeUri.isForwardLinearChain=Y.schemeUri.isForwardLinearChain(n);}if("uri"in t.schemeUri){const s=typeof t.schemeUri.uri=="string"?t.schemeUri.uri:"";r.push(W("Uri链接",V.schemeUri.uri(n),s,"自定义的Scheme的Uri链接",void 0,"jumpwsv://go?package=xx&activity=xx&intentAction=xx&intentData=xx&intentExtra=xx")),t.schemeUri.uri=Y.schemeUri.uri(n);}r.length&&e.push({text:"Scheme Uri转发",type:"forms",isFold:true,forms:r});}if(t.matchRange_text){let r=[];if("before"in t.matchRange_text){const s=typeof t.matchRange_text.before=="number"?t.matchRange_text.before:0;r.push(ke("间隔前",V.matchRange_text.before(n),s,0,100,void 0,void 0,"提取码间隔前的字符长度")),t.matchRange_text.before=Y.matchRange_text.before(n);}if("after"in t.matchRange_text){const s=typeof t.matchRange_text.after=="number"?t.matchRange_text.after:0;r.push(ke("间隔后",V.matchRange_text.after(n),s,0,100,void 0,void 0,"提取码间隔后的字符长度")),t.matchRange_text.after=Y.matchRange_text.after(n);}r.length&&e.push({text:"提取码文本匹配Text",type:"forms",forms:r});}if(t.matchRange_html){let r=[];if("before"in t.matchRange_html){const s=typeof t.matchRange_html.before=="number"?t.matchRange_html.before:0;r.push(ke("间隔前",V.matchRange_html.before(n),s,0,100,void 0,void 0,"提取码间隔前的字符长度")),t.matchRange_html.before=Y.matchRange_html.before(n);}if("after"in t.matchRange_html){const s=typeof t.matchRange_html.after=="number"?t.matchRange_html.after:0;r.push(ke("间隔后",V.matchRange_html.after(n),s,0,100,void 0,void 0,"提取码间隔后的字符长度")),t.matchRange_html.after=Y.matchRange_html.after(n);}r.length&&e.push({text:"提取码文本匹配HTML",type:"forms",forms:r});}return t.ownFormList&&e.push(...t.ownFormList),e},getRulePanelContent(){return this.$data.ruleContent}},ft=`div[class^="netdisk-custom-rule-"] {\r
	display: flex;\r
	align-items: center;\r
	margin-left: 10px;\r
	cursor: pointer;\r
}\r
div[class^="netdisk-custom-rule-"] svg,\r
div[class^="netdisk-custom-rule-"] svg {\r
	width: 1.2em;\r
	height: 1.2em;\r
}\r
/* 控件被禁用的颜色 */\r
aside.pops-panel-aside li[data-key][data-function-enable="false"] {\r
	color: #a8abb2;\r
	filter: grayscale(100%);\r
}\r
/* 左侧网盘图标 */\r
aside.pops-panel-aside .netdisk-aside-icon {\r
	width: 20px;\r
	height: 20px;\r
	background-size: 100% 100%;\r
	background-repeat: no-repeat;\r
}\r
/* 设置间隔 */\r
aside.pops-panel-aside ul li {\r
	gap: 4px;\r
}\r
\r
/* mobile模式 */\r
@media screen and (max-width: 600px) {\r
	/* 隐藏左侧网盘图标 */\r
	aside.pops-panel-aside .netdisk-aside-text {\r
		display: none;\r
	}\r
}\r
`,dt={show(){if(x.Alias.settingAlias){f.error("设置界面已存在");return}let a=Ye.getRulePanelContent(),e=[...Ne.getConfig(0),...a,...Ne.getDefaultBottomContentConfig()],t=G.panel({title:{text:`${Be?.script?.name||Se}-设置`,position:"center"},content:e,btn:{close:{enable:true,callback(n){n.close(),x.Alias.settingAlias=void 0;}}},mask:{clickCallBack(n){n(),x.Alias.settingAlias=void 0;}},class:"whitesevPopSetting",style:ft},x.popsStyle.settingView);J.registerConfigSearch({$panel:t,content:e,searchDialogStyle:`
			/* 网盘图标 */
			.netdisk-aside-icon {
				width: 20px;
				height: 20px;
				background-size: 100% 100%;
				background-repeat: no-repeat;
				margin: 0px 4px;
			}
		`}),x.Alias.settingAlias=t,this.setRuleHeaderControlsClickEvent(t.$shadowRoot);},setRuleHeaderControlsClickEvent(a){b.on(a,"click",".netdisk-custom-rule-edit",function(e){let t=e.target,n=t.getAttribute("data-key");t.getAttribute("data-type");let r=t.getAttribute("data-subscribe-uuid");typeof r=="string"&&r.trim()!==""?$e.showSubscribe(r,n,function(s){le.updateRule(n,s);}):$e.show(true,n);}),b.on(a,"click",".netdisk-custom-rule-delete",function(e){let t=e.target,n=t.getAttribute("data-key"),r=t.getAttribute("data-type"),s=t.getAttribute("data-subscribe-uuid");G.alert({title:{text:"提示",position:"center"},content:{text:`确定删除规则 ${r}(${n}) 吗？`},btn:{ok:{callback(i){let l;if(typeof s=="string"&&s.trim()!==""?l=ee.deleteSubscribeRule(s,n):l=le.deleteRule(n),l){let o=x.Alias.settingAlias.$shadowRoot.querySelector(`.pops-panel-aside > ul > li[data-key="${n}"]`),c=o.previousElementSibling,u=o.nextElementSibling;c?c.click():u&&u.click(),o?.remove(),f.success("删除成功"),i.close();}else f.error("删除规则失败");}}}});});}},An=`.whitesevSuspension {\r
	top: 0;\r
	position: fixed;\r
	right: 10px;\r
	border-radius: 12px;\r
}\r
.whitesevSuspension .whitesevSuspensionMain {\r
	background: #fff;\r
	border: 1px solid #f2f2f2;\r
	box-shadow: 0 0 15px #e4e4e4;\r
	box-sizing: border-box;\r
	border-radius: inherit;\r
	height: inherit;\r
	width: inherit;\r
}\r
.whitesevSuspension .whitesevSuspensionFloor {\r
	border-bottom: 1px solid #f2f2f2;\r
	position: relative;\r
	box-sizing: border-box;\r
	border-radius: inherit;\r
	height: inherit;\r
	width: inherit;\r
}\r
.whitesevSuspension .whitesevSuspensionFloor .netdisk {\r
	background-position: center center;\r
	background-size: 115% 115%;\r
	background-repeat: no-repeat;\r
	display: flex;\r
	align-items: center;\r
	justify-content: center;\r
	border-radius: inherit;\r
	height: inherit;\r
	width: inherit;\r
}\r
.whitesevSuspension .whitesevSuspensionFloor .netdisk:hover {\r
	transition: all 300ms linear;\r
	background-color: #e4e4e4;\r
	transform: scale(1.1);\r
}\r
.whitesevPop-content p[pop] {\r
	height: 100%;\r
}\r
`,se={position:{suspensionX:Me("suspensionX",z.width(window)-50),suspensionY:Me("suspensionY",(z.height(window)-50)/2),suspensionMaxX:Me("susponsionMax-x",z.width(window)-50),suspensionMaxY:Me("suspensionMax-y",z.height(window)-50),isRight:Me("isRight",false)},mode:{current_suspension_smallwindow_mode:Me("current_suspension_smallwindow_mode","suspension")}},Ze={$el:{$suspension:null,$suspensionZIndexStyle:null},$data:{isShow:false,isInitAllEvent:false,isSwitchBackground:false},init(){this.$data.isShow||(this.$data.isShow=true,this.createElement(),this.updateZIndex(),this.updatePosition(true)),this.$data.isInitAllEvent||(this.$data.isInitAllEvent=true,this.setAllEvent(),this.setResizeEventListener()),this.changeBackground(),this.show();},show(){z.css(this.$el.$suspension,{display:""});},hide(){z.css(this.$el.$suspension,{display:"none"});},createElement(){y.suspension.size.value<15&&(y.suspension.size.value=15),y.suspension.size.value>250&&(y.suspension.size.value=250),y.suspension.opacity.value<.1&&(y.suspension.opacity.value=.1),y.suspension.opacity.value>1&&(y.suspension.opacity.value=1);let a=z.createElement("div",{className:"whitesev-suspension-shadow-container"}),e=a.attachShadow({mode:"open"});this.$el.$suspension=z.createElement("div",{id:"whitesevSuspensionId",className:"whitesevSuspension",innerHTML:`
					<style type="text/css">${An}</style>
					<style type="text/css" data-z-index></style>
					<div class="whitesevSuspensionMain">
						<div class="whitesevSuspensionFloor">
							<div class="netdisk"></div>
						</div>
					</div>
                `},{style:`
                    width: ${y.suspension.size.value}px;
                    height: ${y.suspension.size.value}px;
                    opacity: ${y.suspension.opacity.value}
                `}),this.$el.$suspensionZIndexStyle=this.$el.$suspension.querySelector("style[data-z-index]"),e.appendChild(this.$el.$suspension),(document.body||document.documentElement).appendChild(a);},setAllEvent(){let a=this,e=x.suspension.$el.$suspension,t=new jt(e),n,r=false,s=false,i=0,l=0;t.on("pan",function(o){if(!r){r=true;let c=e.getBoundingClientRect();i=o.x-c.left,l=o.y-c.top,z.css(e,{cursor:"move",transition:"none"});}if(o.phase==="start"&&a.updateZIndex(),o.phase==="move"){let c=z.width(window)-y.suspension.size.value,u=z.height(window)-y.suspension.size.value,p=o.x-i,h=o.y-l;p=p>c?c:p,h=h>u?u:h,p=p<0?0:p,h=h<0?0:h,Ze.savePosition({x:p,y:h}),z.css(e,{left:p+"px",top:h+"px"});}if(o.phase==="end"){r=false,z.css(e,{cursor:"auto"});let c=parseInt(z.css(e,"left"));if(y.suspension["suspended-button-adsorption-edge"].value){let u=0;c>=z.width(window)/2?(u=z.width(window)-y.suspension.size.value,J.isTopWindow()&&(se.position.isRight.value=true)):J.isTopWindow()&&(se.position.isRight.value=false),Ze.savePosition({x:u}),z.css(e,{left:u+"px"});}z.css(e,{transition:"left 300ms ease 0s"}),a.updateZIndex();}}),t.on("tap",function(o){clearTimeout(n),n=void 0,s?(s=false,dt.show()):(n=setTimeout(()=>{s=false,y.features["netdisk-behavior-mode"].value.includes("smallwindow")&&(se.mode.current_suspension_smallwindow_mode.value="smallwindow",x.suspension.hide()),x.view.show();},200),s=true);}),rt.setGlobalRightClickMenu(e);},setResizeEventListener(){z.on(globalThis,"resize",()=>{let a=document.activeElement;if(d.isPhone()){if(["input","textarea"].includes(a.localName))return;if(a.hasAttribute("contenteditable")&&a.getAttribute("contenteditable")==="true"||a.closest("[contenteditable='true']"))return;if(!document.hasFocus())return}this.updatePosition(false);});},savePosition(a){J.isTopWindow()&&a!=null&&(typeof a.x=="number"&&(se.position.suspensionX.value=a.x),typeof a.y=="number"&&(se.position.suspensionY.value=a.y),se.position.suspensionMaxX.value=se.position.suspensionMaxX.default,se.position.suspensionMaxY.value=se.position.suspensionMaxY.default);},updatePosition(a){const e=z.width(window)-y.suspension.size.value,t=z.height(window)-y.suspension.size.value,n=se.position.suspensionMaxX.value,r=se.position.suspensionMaxY.value;se.position.suspensionMaxX.default=e,se.position.suspensionMaxY.default=t;let s=se.position.suspensionX.value,i=se.position.suspensionY.value;if(e!==n){let l=s/n;s=e*l;}if(t!==r){let l=i/r;i=t*l;}s>e?s=e:s<0&&(s=0),i>t?i=t:i<0&&(i=0),y.suspension["suspended-button-adsorption-edge"].value&&(se.position.isRight.value?s=e:s=0),a&&Ze.savePosition({x:s,y:i}),z.css(x.suspension.$el.$suspension,{left:s+"px",top:i+"px"});},updateZIndex(){let a=y.suspension["suspended-z-index"].value;a<=0&&(a=d.getMaxValue(4e4,d.getMaxZIndex(10))),z.html(this.$el.$suspensionZIndexStyle,`
			#whitesevSuspensionId{
				z-index: ${a};
			}
			`);},changeBackground(){if(this.$data.isSwitchBackground)return;function a(){let i=[];return x.isMatchedNetDiskIconMap.forEach(l=>{i=[...i,x.src.icon[l]];}),i}function e(i,l){t=a(),z.fadeOut(s,i,function(){n++,n=n<t.length?n:0,l=t[n],z.css(s,{"background-image":`url(${l})`}),z.fadeIn(s,i,function(){setTimeout(()=>{e(parseInt(y.suspension["randbg-time"].value.toString()),l);},parseInt(y.suspension["randbg-show-time"].value.toString()));});});}let t=[],n=0;t=a();let r=t[n],s=x.suspension.$el.$suspension.querySelector(".whitesevSuspension .netdisk");z.css(s,{"background-image":`url(${r})`}),!(t.length<2||y.suspension["randbg-time"].value<=0)&&(this.$data.isSwitchBackground=true,e(parseInt(y.suspension["randbg-time"].value.toString().toString()),r));}},Rt=`.pops-folder-list .list-name-text {\r
	max-width: 300px;\r
}\r
.netdisk-static-link-onefile .pops-folder-list .list-name-text {\r
	max-width: 220px;\r
}\r
.netdisk-static-link-onefile .pops-mobile-folder-content .pops-folder-list .list-name-text {\r
	max-width: unset;\r
}\r
`,Sn={oneFile(a){g.success("成功获取单文件直链",a),G.folder({title:{text:a.title},folder:[{fileName:a.fileName,fileSize:a.fileSize,fileType:a.fileType??"",createTime:a.fileUploadTime||a.fileLatestTime,latestTime:a.fileLatestTime||a.fileUploadTime,isFolder:false,index:0,async clickEvent(){if(typeof a.clickCallBack=="function")a.clickCallBack(a);else return {autoDownload:true,mode:"aBlank",url:a.downloadUrl}}}],btn:{ok:{text:"下载",callback(){typeof a.clickCallBack=="function"?a.clickCallBack(a):window.open(a.downloadUrl,"_blank");}}},class:"netdisk-static-link-onefile",style:Rt},x.popsStyle.oneFileStaticView);},moreFile(a,e=[]){g.success("文件解析信息",e),G.folder({title:{text:a},folder:e,btn:{ok:{enable:false},cancel:{enable:true}},style:Rt},x.popsStyle.moreFileStaticView);}},_n=function(a="密码错误",e="",t,n,r,s=()=>{},i){const l=G.prompt({title:{text:a,position:"center",html:false},btn:{reverse:true,position:"end",cancel:{text:"取消",callback(o,c){l.close(),i?.();}},close:{callback(o,c){o.close(),i?.();}},ok:{callback:o=>{let c=o.text.replace(/[\s]*/gi,""),u=L.handleLinkShow({ruleKeyName:e,ruleIndex:t,shareCode:n,accessCode:c});if(!u)return;let p=`.netdisk-url a[data-rule-key='${e}'][data-sharecode='${n}']`,h=`.netdiskrecord-link a[data-rule-key='${e}'][data-sharecode='${n}']`,m=x.Alias.uiLinkAlias?.$shadowRoot?.querySelector(p),w=x.Alias.historyAlias?.$shadowRoot?.querySelector(h);m&&(m.setAttribute("data-accesscode",c),b.html(m,u)),w&&(w.setAttribute("data-accesscode",c),b.html(w,u)),g.info(`${e} 重新输入的密码：${c}`);let k={isFindInMatchedDict:false,isUpdatedMatchedDict:false,isUpdatedHistoryMatched:false,accessCode:c},C=L.$match.matchedInfo.get(e);if(C.has(n)){k.isFindInMatchedDict=true,k.isUpdatedMatchedDict=true;let A=C.get(n);C.set(n,L.createLinkStorageInst(c,t,true,A.matchText));}k.isUpdatedHistoryMatched=ut.syncAccessCode(e,t,n,c),s(k),o.close(),i?.();}}},content:{placeholder:"请重新输入密码",focus:true,select:true,text:r==null?"":typeof r=="string"?r:""},style:`
			input{
				font-size: larger;
			}
			`},x.popsStyle.inputNewAccessCodeView);b.listenKeyboard(l.$shadowRoot,"keypress",o=>{o==="Enter"&&l.$shadowRoot.querySelector(".pops-prompt-btn-ok").click();});},Rn=`.pops[type-value="confirm"] .pops-confirm-content {\r
	overflow: hidden;\r
}\r
.netdisk-match-paste-text {\r
	--textarea-bd-color: #dcdfe6;\r
	display: inline-block;\r
	resize: vertical;\r
	padding: 5px 15px;\r
	line-height: normal;\r
	box-sizing: border-box;\r
	color: #606266;\r
	border: 1px solid var(--textarea-bd-color);\r
	border-radius: 4px;\r
	transition: border-color 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);\r
	outline: none;\r
	margin: 0;\r
	-webkit-appearance: none;\r
	-moz-appearance: none;\r
	appearance: none;\r
	background: none;\r
	width: 100%;\r
	height: 100%;\r
	appearance: none;\r
	resize: none;\r
}\r
.netdisk-match-paste-text:hover {\r
	--textarea-bd-color: #c0c4cc;\r
}\r
.netdisk-match-paste-text:focus {\r
	--textarea-bd-color: #3677f0;\r
}\r
`,Dn={show(){let a=G.confirm({title:{text:"主动识别文本",position:"center"},content:{text:`
                    <textarea class="netdisk-match-paste-text"></textarea>
                    `,html:true},btn:{ok:{text:"识别",callback(){let e=a.popsElement?.querySelector(".netdisk-match-paste-text")?.value||"";e.trim()!==""&&(e=ne.replaceChinese(e),U.postMessage({characterMapping:[{searchValue:/[\u4e00-\u9fa5]/g,replaceValue:""}],textList:[e],matchTextRange:y.match.pageMatchRange.value,matchedRuleOption:L.$rule.ruleOption,startTime:Date.now(),from:"PasteText"}));}}},class:"whitesevPopNetDiskMatchPasteText",style:Rn},x.popsStyle.matchPasteTextView);a.popsElement.querySelector("textarea").focus();},workerMatchEndCallBack(a){a.data.length?f.success(`成功匹配${a.data.length}个，用时${Date.now()-a.startTime}ms`):f.error("未识别到链接");}},x={Alias:{uiLinkAlias:void 0,historyAlias:void 0,settingAlias:void 0},isMatchedNetDiskIconMap:new Set,defaultForbiddenScroll:false,popsStyle:Jt,src:{icon:{},hasIcon(a){return Reflect.has(this.icon,a)},addIcon(a,e){return this.hasIcon(a)?(g.warn("图标字典中已存在该icon："+a),false):Reflect.set(this.icon,a,e)}},suspension:Ze,view:ce,staticView:Sn,newAccessCodeView:_n,netDiskHistoryMatch:ut,matchPasteText:Dn},Dt=`/* 容器 */\r
.website-rule-container {\r
}\r
/* 每一条规则 */\r
.website-rule-item {\r
	display: flex;\r
	align-items: center;\r
	line-height: normal;\r
	font-size: 16px;\r
	padding: 4px 4px;\r
	gap: 6px;\r
}\r
/* 规则名 */\r
.website-rule-item .website-rule-name {\r
	flex: 1;\r
	white-space: nowrap;\r
	text-overflow: ellipsis;\r
	overflow: hidden;\r
}\r
/* 操作按钮 */\r
.website-rule-item .website-controls {\r
	display: flex;\r
	align-items: center;\r
	text-overflow: ellipsis;\r
	overflow: hidden;\r
	white-space: nowrap;\r
	gap: 8px;\r
	padding: 0px 4px;\r
}\r
/* 编辑和删除按钮 */\r
.website-rule-item .website-rule-edit,\r
.website-rule-item .website-rule-delete {\r
	width: 16px;\r
	height: 16px;\r
	cursor: pointer;\r
}\r
/* 启用按钮 */\r
.website-rule-item .website-rule-enable {\r
}\r
/* 编辑按钮 */\r
.website-rule-item .website-rule-edit {\r
}\r
/* 删除按钮 */\r
.website-rule-item .website-rule-delete {\r
}\r
`;function gt(a){if(a===null||typeof a!="object")return a;let e=Array.isArray(a)?[]:{};for(let t in a)a.hasOwnProperty(t)&&(e[t]=gt(a[t]));return e}const _e=new Fe("websiteRule"),ye={$data:{STORAGE_KEY:"rule",EXPORT_CONFIG_KEY:"rule-export-config",isShowEditView:false},init(){},getTemplateData(){return {uuid:d.generateUUID(),subscribeUUID:null,enable:true,name:"",url:"",data:{}}},getRulePanelViewOption(a){const e=this;let t=B.config.PanelHandlerComponents(),n=()=>a??this.getTemplateData(),r=function(i){return {get(l,o){return i[l]??o},set(l,o){i[l]=o;}}};return {id:"website-rule",title:"网站规则",subscribe:{enable:true,data(){return K.getAllSubscribe()},getData:i=>K.getSubscribe(i.uuid)??i,getDataItemName(i){return `
						<style>
							.subscribe-rule-title-info-wrapper{
								display: flex;
								flex-direction: column;
								gap: 4px;
							}
							.subscribe-rule-title-info-wrapper .rule-name-text{
								white-space: nowrap;
								text-overflow: ellipsis;
								overflow: hidden;
								font-weight: 600;
								font-size: 16px;
								line-height: 24px;
							}
							.subscribe-rule-title-info-wrapper .subscribe-rule-small-span-text{
								font-size: 14px;
								line-height: 16px;
								white-space: pre-wrap;
							}
						</style>
						<div class="subscribe-rule-title-info-wrapper">
							<div class="rule-name-text" style="white-space: nowrap;text-overflow: ellipsis;overflow: hidden;font-size: 16px;font-weight: 600;line-height: 24px;">${i.data.title||i.subscribeData.title||i.data.url}</div>
								<div class="subscribe-rule-small-span-text">${i.subscribeData.ruleData.length} 条规则，更新于：${d.formatTime(i.data.latestUpdateTime,"yyyy年MM月dd日 HH:mm:ss")}${typeof i.data.updateFailedTime=="number"?`，<span style="color: red;">更新失败于：${d.formatTime(i.data.updateFailedTime,"yyyy年MM月dd日 HH:mm:ss")}</span>`:""}</div>
								${i.subscribeData.homePage?`<a href="${i.subscribeData.homePage}" class="subscribe-rule-small-span-text" target="_blank" style="color:#67b279;">转到主页</a>`:""}
								<a href="${i.data.url}" class="subscribe-rule-small-span-text" target="_blank" style="color:#67b279;">订阅地址</a>
						</div>`},addData:i=>K.addSubscribe(i),updateData:i=>K.updateSubscribe(i),deleteData:i=>K.deleteSubscribe(i),btnControls:{add:{enable:true},filter:{enable:true,title:"过滤订阅",option:[{name:"过滤【已启用】的订阅",filterCallBack(i){return i.data.enable}},{name:"过滤【未启用】的订阅",filterCallBack(i){return !i.data.enable}}]},clearAll:{enable:true,callback:()=>{K.deleteAllSubscribe();}},ruleEnable:{enable:true,getEnable(i){return i.data.enable},async callback(i,l){i.data.enable=l,K.updateSubscribe(i);}},ruleEdit:{enable:true,callback:i=>{let l=i.ruleData.uuid;return i.enterDeepMenu({headerTitle:i.ruleData.data.title||i.ruleData.subscribeData.title||i.ruleData.data.url,data(){return K.getSubscribe(l)?.subscribeData?.ruleData??i.ruleData.subscribeData.ruleData},getData(o){return K.getSubscribeRule(l,o.uuid)??o},getDataItemName(o){return o.name??o.url},addData(o){return  true},updateData(o){return K.updateSubscribeRule(l,o)},deleteData(o){return K.deleteSubscribeRule(l,o)},btnControls:{filter:{enable:true,option:[{name:"过滤【已启用】的规则",filterCallBack(o){return o.data.enable}},{name:"过滤【未启用】的规则",filterCallBack(o){return !o.data.enable}}]},clearAll:{enable:true,callback:()=>{K.clearSubscribe(l);}},ruleEnable:{enable:true,getEnable(o){return o.enable},callback(o,c){o.data.enable=c,K.updateSubscribeRule(l,o);}},ruleEdit:{enable:true,getView:(o,c)=>{e.$data.isShowEditView=true,c||(o=n());function u(I){return {get(v,_){let S=K.getSubscribeRule(l,I);return Reflect.get(S.data,v)??_},set(v,_){let S=K.getSubscribeRule(l,I);Reflect.set(S.data,v,_),K.updateSubscribeRule(l,S);}}}let p=document.createDocumentFragment(),h=H("启用","enable",true);Reflect.set(h.props,O,r(o));let m=t.createSectionContainerItem_switch(h),w=W("规则名称","name","","",void 0,"必填");Reflect.set(w.props,O,r(o));let k=t.createSectionContainerItem_input(w),C=W("匹配网址","url","","",void 0,"必填，可正则");Reflect.set(C.props,O,r(o));let A=t.createSectionContainerItem_input(C),$=nt("覆盖设置","","自定义",void 0,false,false,"primary",I=>{d.preventEvent(I);let v=[...Ne.getConfig(0),...Ye.getRulePanelContent()],_=gt(v);function S(N){N.forEach(T=>{if(typeof T?.props=="object"&&Reflect.has(T.props,O)){let P=u(o.uuid);Reflect.set(T.props,O,P);}let E=T.forms;E&&Array.isArray(E)&&S(E);});}for(let N=0;N<_.length;N++){let T=_[N];if(!T.forms)continue;if(typeof T.afterRender=="function"&&T?.id.toString().startsWith("netdisk-panel-config-")&&(T.afterRender=P=>{let Z=Reflect.get(P.asideConfig.attributes,"data-key"),Q=V.function.enable(Z),te=K.getSubscribeRule(l,o.uuid);P.$asideLiElement.setAttribute("data-function-enable",te.data[Q]??true);}),typeof T.attributes=="object"&&T.forms!=null&&ue in T.attributes){let P=T.attributes[ue],Z=H("启用",Ve.features.customAccessCodeEnable(P),false,void 0,"启用后将允许执行下面的功能",void 0);Reflect.set(Z.props,O,u(o.uuid));let Q=W("自定义访问码",Ve.features.customAccessCode(P),"","让获取的到的链接的访问码都为自定义的访问码",void 0,"请输入自定义访问码",false,false);Reflect.set(Q.props,O,u(o.uuid));let te={text:"额外功能",type:"forms",forms:[Z,Q]};T.forms.length?T.forms.splice(1,0,te):T.forms.push(te);}let E=T.forms;E&&Array.isArray(E)&&S(E);}G.panel({title:{text:"覆盖设置",position:"center"},content:_,btn:{close:{enable:true,callback(N){N.close();}}},mask:{clickCallBack(N){N();}},only:false,class:"whitesevPopSetting",style:`
																${ft}
																
																${Dt}
						
						
																/* 隐藏顶部的图标 */
																.netdisk-custom-rule-edit,
																.netdisk-custom-rule-delete,
																/* 隐藏快捷键设置菜单，因为这个是全局唯一的 */
																.netdisk-panel-forms-shortcut-keys-deepMenu{
																	display: none !important;
																}`},x.popsStyle.settingView);},void 0),R=t.createSectionContainerItem_button($);return p.appendChild(m),p.appendChild(k),p.appendChild(A),p.appendChild(R),p},onsubmit:(o,c,u)=>{let p=o.querySelectorAll(".rule-form-ulist > li"),h=n();if(c){h.uuid=u.uuid;let w=this.getAllRule().find(k=>k.uuid===h.uuid);w&&(h.data=w.data);}return p.forEach(m=>{let w=Reflect.get(m,"__formConfig__"),k=Reflect.get(w,"attributes"),C=Reflect.get(m,O),A=Reflect.get(k,ue);if(A==null)return;let $=Reflect.get(k,me),R=C.get(A,$);Reflect.has(h,A)?Reflect.set(h,A,R):Reflect.has(h.data,A)?Reflect.set(h.data,A,R):g.error(`${A}不在数据中`);}),h.name==null||h.name.trim()===""?(f.error("规则名称不能为空"),{success:false,data:h}):h.url.trim()===""?(f.error("匹配网址不能为空"),{success:false,data:h}):c?{success:this.updateRule(h),data:h}:{success:this.addRule(h),data:h}}},ruleDelete:{enable:true,deleteCallBack(o){return K.deleteSubscribeRule(l,o)}}}}),false}},ruleDelete:{enable:true,deleteCallBack:i=>K.deleteSubscribe(i)},import:{enable:true,callback(i){K.importSubscribe(()=>{i();});}},export:{enable:true,callback(){K.exportSubscribe(Se+"-网站规则-订阅.json");}}},getSubscribeInfo:K.getSubscribeInfo.bind(K)},ruleOption:{btnControls:{add:{enable:true},filter:{enable:true,title:"过滤规则",option:[{name:"过滤【已启用】的规则",filterCallBack(i){return i.enable}},{name:"过滤【未启用】的规则",filterCallBack(i){return !i.enable}},{name:"过滤【在当前网址生效】的规则",filterCallBack(i){let l=new RegExp(i.url,"ig");return !!window.location.href.match(l)}}]},clearAll:{enable:true,callback:()=>{e.deleteAllRule();}},import:{enable:true,callback:i=>{e.importRule(()=>{i();});}},export:{enable:true,callback:()=>{e.exportRule(Se+"-网站规则.json",Se+"-网站规则-订阅模式.json");}},ruleEnable:{enable:true,getEnable(i){return i.enable},callback:(i,l)=>{i.enable=l,e.updateRule(i);}},ruleEdit:{enable:true,getView:(i,l)=>{e.$data.isShowEditView=true,l||(i=n());function o($){return {get(R,I){let v=e.getRule($)??n(),_=J.getValue(R,I);return (v&&Reflect.get(v.data,R))??_},set(R,I){let v=e.getRule($)??n();Reflect.set(v.data,R,I),e.updateRule(v);}}}let c=document.createDocumentFragment();l||(i=n());let u=H("启用","enable",true);Reflect.set(u.props,O,r(i));let p=t.createSectionContainerItem_switch(u),h=W("规则名称","name","","",void 0,"必填");Reflect.set(h.props,O,r(i));let m=t.createSectionContainerItem_input(h),w=W("匹配网址","url","","",void 0,"必填，可正则");Reflect.set(w.props,O,r(i));let k=t.createSectionContainerItem_input(w),C=nt("覆盖设置","","自定义",void 0,false,false,"primary",$=>{d.preventEvent($);let R=[...Ne.getConfig(0),...Ye.getRulePanelContent()],I=gt(R);function v(_){_.forEach(S=>{if(typeof S?.props=="object"&&Reflect.has(S.props,O)){let T=o(i.uuid);Reflect.set(S.props,O,T);}let N=S.forms;N&&Array.isArray(N)&&v(N);});}for(let _=0;_<I.length;_++){let S=I[_];if(!S.forms)continue;if(typeof S.afterRender=="function"&&S?.id.toString().startsWith("netdisk-panel-config-")&&(S.afterRender=T=>{let E=Reflect.get(T.asideConfig.attributes,"data-key"),P=V.function.enable(E);T.$asideLiElement.setAttribute("data-function-enable",l?ye.getRuleDataValue(i.uuid,P,true):i.data[P]??true);}),typeof S.attributes=="object"&&S.forms!=null&&ue in S.attributes){let T=S.attributes[ue],E=H("启用",Ve.features.customAccessCodeEnable(T),false,void 0,"启用后将允许执行下面的功能",void 0);Reflect.set(E.props,O,o(i.uuid));let P=W("自定义访问码",Ve.features.customAccessCode(T),"","让获取的到的链接的访问码都为自定义的访问码",void 0,"请输入自定义访问码",false,false);Reflect.set(P.props,O,o(i.uuid));let Z={text:"额外功能",type:"forms",forms:[E,P]};S.forms.length?S.forms.splice(1,0,Z):S.forms.push(Z);}let N=S.forms;N&&Array.isArray(N)&&v(N);}G.panel({title:{text:"覆盖设置",position:"center"},content:I,btn:{close:{enable:true,callback(_){_.close();}}},mask:{clickCallBack(_){_();}},only:false,class:"whitesevPopSetting",style:`
											${ft}
											
											${Dt}
	
	
											/* 隐藏顶部的图标 */
											.netdisk-custom-rule-edit,
											.netdisk-custom-rule-delete,
											/* 隐藏快捷键设置菜单，因为这个是全局唯一的 */
											.netdisk-panel-forms-shortcut-keys-deepMenu{
												display: none !important;
											}
											`},x.popsStyle.settingView);},void 0),A=t.createSectionContainerItem_button(C);return c.appendChild(p),c.appendChild(m),c.appendChild(k),c.appendChild(A),c},onsubmit:(i,l,o)=>{let c=i.querySelectorAll(".rule-form-ulist > li"),u=n();if(l){u.uuid=o.uuid;let h=this.getAllRule().find(m=>m.uuid===u.uuid);h&&(u.data=h.data);}return c.forEach(p=>{let h=Reflect.get(p,"__formConfig__"),m=Reflect.get(h,"attributes"),w=Reflect.get(p,O),k=Reflect.get(m,ue);if(k==null)return;let C=Reflect.get(m,me),A=w.get(k,C);Reflect.has(u,k)?Reflect.set(u,k,A):Reflect.has(u.data,k)?Reflect.set(u.data,k,A):g.error(`${k}不在数据中`);}),u.name==null||u.name.trim()===""?(f.error("规则名称不能为空"),{success:false,data:u}):u.url.trim()===""?(f.error("匹配网址不能为空"),{success:false,data:u}):l?{success:this.updateRule(u),data:u}:{success:this.addRule(u),data:u}}},ruleDelete:{enable:true,deleteCallBack:i=>e.deleteRule(i.uuid)}},data:()=>this.getAllRule(),getAddData:()=>n(),getData:i=>this.getAllRule().find(c=>c.uuid===i.uuid)??i,getDataItemName:i=>i.name??i.url,updateData:i=>this.updateRule(i),deleteData:i=>(e.$data.isShowEditView=false,this.deleteRule(i.uuid))}}},addRule(a){let e=this.getAllRule();return e.push(a),_e.set(this.$data.STORAGE_KEY,e),true},getRule(a){let e=this.getAllRule().find(n=>n.uuid===a);return e||K.getAllSubscribeRule().find(n=>n.uuid===a)},getRuleData(a){return typeof a=="string"?this.getRule(a).data:a.data},getRuleDataValue(a,e,t){let n=this.getRuleData(a);return (n&&Reflect.get(n,e))??t},updateRule(a){let e=this.getAllRule(),t=false;for(let n=0;n<e.length;n++)if(e[n].uuid===a.uuid){e[n]=a,t=true;break}return t?_e.set(this.$data.STORAGE_KEY,e):K.getAllSubscribeRule().find(r=>r.uuid===a.uuid)&&(t=K.updateSubscribeRule(a.subscribeUUID,a)),t},deleteRule(a){let e=this.getAllRule(),t=false,n=typeof a=="string"?a:a.uuid;for(let r=0;r<e.length;r++)if(e[r].uuid===n){e.splice(r,1),t=true;break}if(t)_e.set(this.$data.STORAGE_KEY,e);else {let r=K.getAllSubscribeRule().find(s=>s.uuid===n);r&&(t=K.deleteSubscribeRule(r.subscribeUUID,r));}return t},deleteAllRule(){_e.delete(this.$data.STORAGE_KEY);},getAllRule(){return _e.get(this.$data.STORAGE_KEY,[])},getUrlMatchedRule(a=true,e=window.location.href){let t=this.getAllRule(),n=K.getAllSubscribeRule(true);return t=t.concat(n),t.filter(s=>{if(a&&!s.enable)return  false;let i=new RegExp(s.url,"ig");return !!e.match(i)})},exportRule(a="rule.json",e="rule-subscribe.json"){let t=G.alert({title:{text:"请选择导出方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="only-export-rule-list">导出规则</div>
                    <div class="btn-control" data-mode="export-to-subscribe">导出订阅规则</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(i,l){i.close();}}},mask:{enable:true},drag:true,width:j.info.width,height:j.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),n=t.$shadowRoot.querySelector(".btn-control[data-mode='only-export-rule-list']"),r=t.$shadowRoot.querySelector(".btn-control[data-mode='export-to-subscribe']"),s=(i,l)=>{let o=new Blob([JSON.stringify(l,null,4)]),c=window.URL.createObjectURL(o),u=document.createElement("a");u.href=c,u.download=i,u.click(),setTimeout(()=>{window.URL.revokeObjectURL(c);},1500);};b.on(n,"click",i=>{d.preventEvent(i);try{let l=this.getAllRule();if(l.length===0){f.warning("规则为空，无需导出");return}s(a,l),t.close();}catch(l){f.error(l.toString(),{consoleLogContent:true});}}),b.on(r,"click",i=>{d.preventEvent(i);const l=this;t.close();try{if(this.getAllRule().length===0){f.warning("规则为空，无需导出");return}let c=B.config.PanelHandlerComponents(),u=function(v){return {get(_,S){return v[_]??S},set(_,S){v[_]=S,_e.set(l.$data.EXPORT_CONFIG_KEY,v);}}},p=()=>{let v=_e.get(this.$data.EXPORT_CONFIG_KEY,{});if(v?.title===""||v.title==null){f.error("订阅标题不能为空");return}if(v.version==null){f.error("版本号不能为空");return}else v.version=Number(v.version);v.homePage==null&&(v.homePage=void 0),v.lastModified=Date.now(),v.ruleData=this.getAllRule(),s(e,v),h.close();},h=G.alert({title:{text:"请填写导出配置",position:"center"},content:{text:`
							
						`,html:!0},btn:{ok:{enable:!0,text:"导出",callback(v,_){p();}},close:{enable:!0,callback(v,_){v.close();}}},mask:{enable:!0},drag:!0,width:j.info.width,height:j.info.height,style:`
						${B.config.cssText.panelCSS}

						.pops-alert-content li{
							list-style-type: none;
							display: flex;
							align-items: center;
							justify-content: space-between;
							margin: 10px;
						}
					`}),m=h.$shadowRoot.querySelector(".pops-alert-content"),w=_e.get(this.$data.EXPORT_CONFIG_KEY,{}),k=W("订阅标题","title","","",void 0,"");Reflect.set(k.props,O,u(w));let C=c.createSectionContainerItem_input(k),A=W("版本号","version","","",void 0,"",!1);Reflect.set(A.props,O,u(w));let $=c.createSectionContainerItem_input(A),R=W("主页地址","homePage","","",void 0,"选填");Reflect.set(R.props,O,u(w));let I=c.createSectionContainerItem_input(R);b.append(m,C),b.append(m,$),b.append(m,I);}catch(o){f.error(o.toString(),{consoleLogContent:true});}});},importRule(a){let e=G.alert({title:{text:"请选择导入方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="local">本地导入</div>
                    <div class="btn-control" data-mode="network">网络导入</div>
                    <div class="btn-control" data-mode="clipboard">剪贴板导入</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(l,o){l.close();}}},mask:{enable:true},drag:true,width:j.info.width,height:j.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),t=e.$shadowRoot.querySelector(".btn-control[data-mode='local']"),n=e.$shadowRoot.querySelector(".btn-control[data-mode='network']"),r=e.$shadowRoot.querySelector(".btn-control[data-mode='clipboard']"),s=l=>{let o=this.getAllRule(),c=[];for(let u=0;u<l.length;u++){const p=l[u];o.findIndex(m=>m.uuid===p.uuid)!==-1||c.push(p);}o=o.concat(c),_e.set(this.$data.STORAGE_KEY,o),f.success(`共 ${l.length} 条规则，新增 ${c.length} 条`),a?.();},i=l=>new Promise(o=>{let c=d.toJSON(l);if(!Array.isArray(c)){g.error(c),f.error("导入失败，格式不符合（不是数组）",{consoleLogContent:true}),o(false);return}if(!c.length){f.error("导入失败，解析出的数据为空",{consoleLogContent:true}),o(false);return}s(c),o(true);});b.on(t,"click",l=>{d.preventEvent(l),e.close();let o=b.createElement("input",{type:"file",accept:".json"});b.on(o,["propertychange","input"],c=>{if(!o.files?.length)return;let u=o.files[0],p=new FileReader;p.onload=()=>{i(p.result);},p.readAsText(u,"UTF-8");}),o.click();}),b.on(n,"click",l=>{d.preventEvent(l),e.close();let o=G.prompt({title:{text:"网络导入",position:"center"},content:{text:"",placeholder:"请填写URL",focus:true},btn:{close:{enable:true,callback(p,h){p.close();}},ok:{text:"导入",callback:async(p,h)=>{let m=p.text;if(d.isNull(m)){f.error("请填入完整的url");return}let w=f.loading("正在获取配置..."),k=await M.get(m,{allowInterceptConfig:false});if(w.close(),!k.status){g.error(k),f.error("获取配置失败",{consoleLogContent:true});return}await i(k.data.responseText)&&p.close();}},cancel:{enable:false}},mask:{enable:true},drag:true,width:j.info.width,height:"auto"}),c=o.$shadowRoot.querySelector("input"),u=o.$shadowRoot.querySelector(".pops-prompt-btn-ok");b.on(c,["input","propertychange"],p=>{b.val(c)===""?b.attr(u,"disabled","true"):b.removeAttr(u,"disabled");}),b.listenKeyboard(c,"keydown",(p,h,m)=>{p==="Enter"&&m.length===0&&b.val(c)!==""&&d.dispatchEvent(u,"click");}),d.dispatchEvent(c,"input");}),b.on(r,"click",async l=>{d.preventEvent(l),e.close();let o=await d.getClipboardInfo();if(o.error!=null){f.error(o.error.toString());return}if(o.content.trim()===""){f.warning("获取到的剪贴板内容为空");return}await i(o.content);});}},Nn=(a,e,t)=>{if(ye.$data.isShowEditView)return e;let r=ye.getUrlMatchedRule().find(s=>{let i=ye.getRuleData(s);return Reflect.has(i,a)});return r?Reflect.get(ye.getRuleData(r),a):e},In=function(a,e,t){return {KEY:a,default:e,get value(){let n=re(a,e);return typeof t=="function"?t(a,n,e):n},set value(n){de(a,n);}}},F=function(a,e){return In(a,e,Nn)},y={toast:{position:F("qmsg-config-position","top"),maxnums:F("qmsg-config-maxnums",3),showreverse:F("qmsg-config-showreverse",true)},pops:{popsAnimation:F("popsAnimation","pops-anim-fadein-zoom"),clickMaskToCloseDialog:F("clickMaskToCloseDialog",true),pcDrag:F("pcDrag",true),pcDragLimit:F("pcDragLimit",true),popsAcrylic:F("popsAcrylic",false)},popsFolder:{"pops-folder-sort-name":F("pops-folder-sort-name","fileName"),"pops-folder-sort-is-desc":F("pops-folder-sort-is-desc",false)},smallIconNavgiator:{"pops-netdisk-icon-click-event-find-sharecode":F("pops-netdisk-icon-click-event-find-sharecode",true),"pops-netdisk-icon-click-event-find-sharecode-with-select":F("pops-netdisk-icon-click-event-find-sharecode-with-select",true),"pops-netdisk-icon-click-event-loop-find-sharecode":F("pops-netdisk-icon-click-event-loop-find-sharecode",true)},suspension:{size:F("size",50),opacity:F("opacity",1),"randbg-time":F("randbg-time",1500),"randbg-show-time":F("randbg-show-time",1200),"suspended-button-adsorption-edge":F("suspended-button-adsorption-edge",false),"suspended-z-index":F("suspended-z-index",-1)},smallWindow:{"netdisk-ui-small-window-width":F("netdisk-ui-small-window-width",250),"netdisk-ui-small-window-max-height":F("netdisk-ui-small-window-max-height",200),"netdisk-link-view-z-index":F("netdisk-link-view-z-index",-1)},historyMatch:{saveMatchNetDisk:F("saveMatchNetDisk",false),"netdisk-history-match-ordering-rule":F("netdisk-history-match-ordering-rule","按 更新时间 - 降序"),"netdisk-history-match-merge-same-link":F("netdisk-history-match-merge-same-link",true)},match:{pageMatchRange:F("pageMatchRange",["innerText","innerHTML"]),depthQueryWithShadowRoot:F("depthQueryWithShadowRoot",false),readClipboard:F("readClipboard",false),allowMatchLocationHref:F("allowMatchLocationHref",true),toBeMatchedWithInputElementValue:F("to-be-matched-inputElementValue",false),toBeMatchedTextAreaElementValue:F("to-be-matched-textAreaElementValue",false),toBeMatchedXhrHookResponseText:F("to-be-matched-xhrHookResponseText",false),delaytime:F("delaytime",.8),isAddedNodesToMatch:F("isAddedNodesToMatch",false),"mutationObserver-childList":F("mutationObserver-childList",true),"mutationObserver-characterData":F("mutationObserver-characterData",true),"mutationObserver-subtree":F("mutationObserver-subtree",true)},features:{"netdisk-match-mode":F("netdisk-match-mode","MutationObserver"),"netdisk-behavior-mode":F("netdisk-behavior-mode","suspension_smallwindow"),autoFillAccessCode:F("autoFillAccessCode",true)},shareCode:{excludeIdenticalSharedCodesCoefficient:F("excludeIdenticalSharedCodesCoefficient",1),excludeIdenticalSharedCodes:F("excludeIdenticalSharedCodes",false)},accessCode:{allowQueryHistoryMatchingAccessCode:F("allowQueryHistoryMatchingAccessCode",true)}},L={$data:{isMatchedLink:false,clipboardText:""},$match:{matchedInfo:new Ae.Dictionary,blackMatchedInfo:new Ae.Dictionary,tempMatchedInfo:new Ae.Dictionary,matchedInfoRuleKey:new Set},$rule:{ruleOption:{},ruleSetting:{},rule:[]},$extraRule:{shareCodeNotMatchRegExpList:[/vipstyle|notexist|ajax|file|download|ptqrshow|xy-privacy/g,/comp|web|undefined|1125|unproved|console|account|favicon|setc/g],accessCodeNotMatchRegExpList:[/^(font|http)/gi],accessCodeNeedRemoveStr:["："," ",":",`
`,"提取码","密码","?password=","?pwd=","&pwd=","?p=","访问码"],noAccessCodeRegExp:[/( |提取码:|\n密码：)/gi,/{#accessCode#}/gi,/{#encodeURI-accessCode#}|{#encodeURIComponent-accessCode#}/gi,/{#decodeURI-accessCode#}|{#decodeURIComponent-accessCode#}/gi,/(\?pwd=|&pwd=|\?password=|\?p=)/gi]},init(){this.initLinkDict();},initLinkDict(){Object.keys(this.$rule.ruleOption).forEach(t=>{this.$match.matchedInfo.set(t,new d.Dictionary),this.$match.blackMatchedInfo.set(t,new d.Dictionary),this.$match.tempMatchedInfo.set(t,new d.Dictionary);});let a=ye.getUrlMatchedRule();a.length&&(g.info("成功命中网站规则 ==> ",a),ze.add({key:"matchedUrlRuleList",text:`🌏 命中网站规则 ${a.length} 条`,autoReload:false,isStoreValue:false,showText(t){return t},callback:()=>{g.info("当前网址："+self.location.href),J.isTopWindow()&&alert(`以下是命中的规则名：
`+a.map(t=>t.name).join(`
`));}}));let e=ct.getUrlMatchedRule();e.length&&(g.info("成功命中字符规则 ==> ",e),ze.add({key:"characterMapping",text:`🌏 命中字符规则 ${e.length} 条`,autoReload:false,isStoreValue:false,showText(t){return t},callback:()=>{g.info("当前网址："+self.location.href),J.isTopWindow()&&alert(`以下是命中的规则名：
`+e.map(t=>t.name).join(`
`));}}));},handleLink(a){let e=this.handleShareCode(a);if(d.isNull(e))return;let t=this.handleAccessCode(a);return t=this.handleAccessCodeByUserRule({...a,accessCode:t}),{shareCode:e,accessCode:t}},handleShareCode(a){let e=a?.debugConfig?.config??this.$rule.ruleOption[a.ruleKeyName][a.ruleIndex],t=a.matchText.match(e.shareCode)?.filter(s=>d.isNotNull(s));if(a.debugConfig?.logCallBack?.({status:true,msg:["正则: shareCode","作用: 获取shareCode","结果: ",JSON.stringify(t)]}),d.isNull(t)){a.debugConfig?.logCallBack?.({status:false,msg:"匹配shareCode为空"});return}let n=t[0];if(a.debugConfig?.logCallBack?.({status:true,msg:["取第一个值: "+n]}),e.shareCodeNeedRemoveStr){let s=e.shareCodeNeedRemoveStr;Array.isArray(s)||(s=[s]);for(const i of s)n=n.replace(i,"");s.length&&a.debugConfig?.logCallBack?.({status:true,msg:["正则: shareCodeNeedRemoveStr","作用: 删除ShareCode前面不需要的字符串",`结果: ${n}`]});}for(const s of L.$extraRule.shareCodeNotMatchRegExpList)if(n.match(s)){a.debugConfig?.logCallBack?.({status:false,msg:["正则: 内置的shareCodeNotMatchRegExpList","作用: 使用该正则判断提取到的shareCode是否正确","结果: true 该shareCode不是正确的"]});return}let r=e.shareCodeNotMatch;if(r!=null){Array.isArray(r)||(r=[r]);for(const s of r)if(n.match(s)){a.debugConfig?.logCallBack?.({status:false,msg:["正则: shareCodeNotMatch","作用: 用于判断提取到的shareCode是否是错误的shareCode","结果: true 该shareCode不是正确的"]});return}}if(n=decodeURI(n),a.debugConfig?.logCallBack?.({status:true,msg:["对shareCode进行解码: "+n]}),y.shareCode.excludeIdenticalSharedCodes.value&&d.isSameChars(n,y.shareCode.excludeIdenticalSharedCodesCoefficient.value)){a.debugConfig?.logCallBack?.({status:false,msg:["已开启【排除分享码】且该分享码命中该规则"]});return}if(n.endsWith("http")||n.endsWith("https")){a.debugConfig?.logCallBack?.({status:false,msg:["该分享码以http|https结尾"]});return}return a.debugConfig?.logCallBack?.({status:true,msg:"处理完毕的shareCode: "+n}),n},handleAccessCode(a){let e=a.debugConfig?.config??this.$rule.ruleOption[a.ruleKeyName][a.ruleIndex],t="";if(!e.checkAccessCode)return a.debugConfig?.logCallBack?.({status:true,msg:"因未配置规则checkAccessCode，默认accessCode的值为空"}),"";let n=a.matchText.match(e.checkAccessCode);if(a.debugConfig?.logCallBack?.({status:true,msg:["正则: checkAccessCode","作用: 用来判断link_innerText或者link_innerHTML匹配到的字符串中是否存在密码","结果: ",JSON.stringify(n)]}),n){let r=n[n.length-1];a.debugConfig?.logCallBack?.({status:true,msg:"取最后一个值: "+r});let s=r.match(e.accessCode)?.filter(i=>d.isNotNull(i));if(a.debugConfig?.logCallBack?.({status:true,msg:["正则: accessCode","作用: 用来提取link_innerText或者link_innerHTML匹配到的字符串中的密码","结果: ",JSON.stringify(s)]}),d.isNull(s))return a.debugConfig?.logCallBack?.({status:true,msg:"因↑匹配到的结果为空，默认accessCode的值为空"}),"";s.length&&(t=s[0],a.debugConfig?.logCallBack?.({status:true,msg:"取第一个值: "+t}));}if(d.isNotNull(t)){for(const i of L.$extraRule.accessCodeNotMatchRegExpList)if(t.match(i)){t="",a.debugConfig?.logCallBack?.({status:true,msg:["正则: 内置的accessCodeNotMatchRegExpList","作用: 使用该正则判断提取到的accessCode是否正确","结果: true 重置accessCode为空"]});break}let r=e.acceesCodeNotMatch;if(r){Array.isArray(r)||(r=[r]);for(const i of r)if(t.match(i)){t="",a.debugConfig?.logCallBack?.({status:true,msg:["正则: acceesCodeNotMatch","作用: 用于判断提取到的accessCode是否是错误的accessCode","结果: true 重置accessCode为空"]});break}}for(const i of L.$extraRule.accessCodeNeedRemoveStr)t=qe.replaceText(t,i,"");a.debugConfig?.logCallBack?.({status:true,msg:["正则: 内置的accessCodeNeedRemoveStr","作用: 用于处理提取到的accessCode删除部分不需要的字符串",`结果: ${t}`]});let s=e.accessCodeNeedRemoveStr;s&&(t=qe.replaceText(t,s,""),a.debugConfig?.logCallBack?.({status:true,msg:["正则: accessCodeNeedRemoveStr","作用: 用于处理提取到的accessCode删除部分不需要的字符串","结果: true 重置accessCode为空"]}));}return a.debugConfig?.logCallBack?.({status:true,msg:"处理完毕的accessCode: "+t}),t},handleAccessCodeByUserRule(a){let e=ye.getUrlMatchedRule(),t=a.accessCode;for(let n=0;n<e.length;n++){const r=e[n];let s=ye.getRuleData(r),i=Reflect.get(s,Ve.features.customAccessCode(a.ruleKeyName));if(Reflect.get(s,Ve.features.customAccessCodeEnable(a.ruleKeyName))&&typeof i=="string"){t=i;break}}return t},handleLinkShow(a){if(!(a.debugConfig?.config?true:this.checkHasRuleOption(a.ruleKeyName,a.ruleIndex))){g.error(`BUG: ${a.ruleKeyName}不存在，分析参数`,a),(a.showToast??true)&&f.error(`规则：${a.ruleKeyName}不存在`);return}let t=a.debugConfig?.config??L.$rule.ruleOption[a.ruleKeyName][a.ruleIndex],n=ne.replaceParam(t.uiLinkShow,{shareCode:a.shareCode});if(a.debugConfig?.logCallBack?.({status:true,msg:["正则: uiLinkShow","作用: 用于显示在弹窗中的字符串","备注: 对shareCode进行参数替换",`结果: ${n}`]}),typeof a.accessCode=="string"&&a.accessCode.trim()!=""?(n=ne.replaceParam(n,{accessCode:a.accessCode}),a.debugConfig?.logCallBack?.({status:true,msg:["正则: uiLinkShow","作用: 用于显示在弹窗中的字符串","备注: 对accessCode进行参数替换",`结果: ${n}`]})):(n=qe.replaceText(n,L.$extraRule.noAccessCodeRegExp,""),a.debugConfig?.logCallBack?.({status:true,msg:["正则: 内置的noAccessCodeRegExp","作用: 因accessCode为空，使用该正则去除不需要的字符串",`结果: ${n}`]})),t.paramMatch){let r=L.$match.matchedInfo.get(a.ruleKeyName).get(a.shareCode);if(a.matchText=a.matchText??r?.matchText,d.isNotNull(a.matchText)){let s=a.matchText.match(t.paramMatch),i={};if(s)for(let l=0;l<s.length;l++)i[`$${l}`]=s[l];n=ne.replaceParam(n,i),a.debugConfig?.logCallBack?.({status:true,msg:["正则: paramMatch","作用: 用于对matchText进行提取需要的关键内容，替换关键字：{#$1#}、{#$2#}...","参数: "+JSON.stringify(i,void 0,4),`结果: ${n}`]});}}return a.debugConfig?.logCallBack?.({status:true,msg:"处理完毕的uiLink: "+n}),n},createLinkStorageInst(a,e=0,t=false,n){return {accessCode:a,ruleIndex:e,isForceAccessCode:t,matchText:n}},checkHasRuleOption(a,e){let t=L.$rule.ruleOption?.[a];return !(!Array.isArray(t)||typeof e=="number"&&(e<0||t.length<=e))}};class Tn{key="short-cut";$data;isWaitPress=false;currentWaitEnterPressInstanceHandler=null;constructor(e){typeof e=="string"&&(this.key=e),this.$data={otherShortCutOptions:[]};}initConfig(e,t){this.hasOption(e)||this.setOption(e,t);}getStorageKey(){return this.key}getLocalAllOptions(){return re(this.key,[])}hasOption(e){return !!this.getLocalAllOptions().find(r=>r.key===e)}hasOptionValue(e){return this.hasOption(e)?this.getOption(e)?.value!=null:false}getOption(e,t){return this.getLocalAllOptions().find(s=>s.key===e)??t}setOption(e,t){let n=this.getLocalAllOptions(),r=n.findIndex(s=>s.key===e);r==-1?n.push({key:e,value:t}):Reflect.set(n[r],"value",t),de(this.key,n);}emptyOption(e){let t=false,n=this.getLocalAllOptions(),r=n.findIndex(s=>s.key===e);return r!==-1&&(n[r].value=null,t=true),de(this.key,n),t}deleteOption(e){let t=false,n=this.getLocalAllOptions(),r=n.findIndex(s=>s.key===e);return r!==-1&&(n.splice(r,1),t=true),de(this.key,n),t}translateKeyboardValueToButtonText(e){let t="";return e.ohterCodeList.forEach(n=>{t+=d.stringTitleToUpperCase(n,true)+" + ";}),t+=d.stringTitleToUpperCase(e.keyName),t}getShowText(e,t){if(this.hasOption(e)){let n=this.getOption(e);return n.value==null?t:this.translateKeyboardValueToButtonText(n.value)}else return t}async enterShortcutKeys(e){const t=this;return new Promise(n=>{this.isWaitPress=true;let r=b.listenKeyboard(window,"keyup",(s,i,l)=>{const o={keyName:s,keyValue:i,ohterCodeList:l};let c={};try{const u=JSON.stringify(o),p=this.getLocalAllOptions();Array.isArray(this.$data.otherShortCutOptions)&&p.push(...this.$data.otherShortCutOptions);for(let h=0;h<p.length;h++){let m=p[h];if(m.key===e)continue;const w=JSON.stringify(m.value);let k=!1;if(m.value!=null&&u===w&&(k=!0),k){c={status:!1,key:m.key,option:o};return}}this.setOption(e,o),c={status:!0,key:e,option:o};}catch(u){console.log(u),c={status:false,key:e,option:o};}finally{t.isWaitPress=false,r.removeListen(),t.currentWaitEnterPressInstanceHandler=null,n(c);}});t.currentWaitEnterPressInstanceHandler=null,t.currentWaitEnterPressInstanceHandler=()=>{t.isWaitPress=false,r.removeListen();};})}cancelEnterShortcutKeys(){typeof this.currentWaitEnterPressInstanceHandler=="function"&&this.currentWaitEnterPressInstanceHandler();}initGlobalKeyboardListener(e,t){let n=this.getLocalAllOptions();if(!n.length){g.warn("没有设置快捷键");return}const r=this;function s(o,c){b.listenKeyboard(o,"keydown",(u,p,h,m)=>{if(r.isWaitPress)return;t?.isPrevent&&d.preventEvent(m),n=r.getLocalAllOptions();let w=n.findIndex(k=>{let C=k.value,A={keyName:u,keyValue:p,ohterCodeList:h};if(JSON.stringify(C)===JSON.stringify(A))return k});if(w!=-1){let k=n[w];k.key in c&&(g.info(["调用快捷键",k]),c[k.key].callback());}},{capture:!!t?.capture});}let i={},l={};Object.keys(e).forEach(o=>{let c=e[o];(c.target==null||typeof c.target=="string"&&c.target==="")&&(c.target="window"),c.target==="window"?Reflect.set(i,o,c):Reflect.set(l,o,c);}),s(window,i),b.ready(()=>{Object.keys(l).forEach(async o=>{let c=l[o];if(typeof c.target=="string")d.waitNode(c.target,1e4).then(u=>{if(!u)return;let p={};Reflect.set(p,o,c),s(u,p);});else if(typeof c.target=="function"){let u=await c.target();if(u==null)return;let p={};Reflect.set(p,o,c),s(u,p);}else {let u={};Reflect.set(u,o,c),s(c.target,u);}});});}}const ve={shortCut:new Tn("GM_shortcut"),init(){this.shortCut.initGlobalKeyboardListener(this.getShortCutMap());},getShortCutMap(){return {"netdisk-keyboard-open-setting":{target:"window",callback:()=>{g.info("快捷键 ==> 【打开】⚙ 设置"),dt.show();}},"netdisk-keyboard-open-history-matching-records":{target:"window",callback:()=>{g.info("快捷键 ==> 【打开】⚙ 历史匹配记录"),x.netDiskHistoryMatch.show();}},"netdisk-keyboard-open-user-rule":{target:"window",callback:()=>{g.info("快捷键 ==> 【打开】⚙ 链接识别规则"),$e.show(false);}},"netdisk-keyboard-open-proactively-recognize-text":{target:"window",callback:()=>{g.info("快捷键 ==> 【打开】⚙ 主动识别文本"),x.matchPasteText.show();}},"netdisk-keyboard-performPageTextMatchingManually":{target:"window",callback(){g.info("快捷键 ==> 执行文本匹配"),U.dispatchMonitorDOMChange=true;}},"netdisk-keyboard-character-mapping":{target:"window",callback(){g.info("快捷键 ==> 【打开】⚙ 字符映射规则"),Je.showView("字符映射");}},"netdisk-keyboard-identifyTheSelectedContent":{target:"window",callback(){g.info("快捷键 ==> 识别选中内容");const{text:a,html:e}=je.getSelectContent();g.info("选中的内容信息：",[a,e]),U.postMessage({characterMapping:[],textList:[a,e],matchTextRange:y.match.pageMatchRange.value,matchedRuleOption:L.$rule.ruleOption,startTime:Date.now(),from:"ShortCut-Select-Content"});}}}}},Re=function(a,e,t,n,r,s="default",i){let l=r,o=()=>i.getShowText(t,l),c=nt(a,e,o,"keyboard",false,false,s,async u=>{let h=u.target.closest(".pops-panel-button")?.querySelector("span");if(i.isWaitPress){f.warning("请先执行当前的录入操作");return}if(i.hasOptionValue(t))i.emptyOption(t),f.success("清空快捷键");else {let m=f.loading("请按下快捷键...",{showClose:true,onClose(){i.cancelEnterShortcutKeys();}}),{status:w,option:k,key:C}=await i.enterShortcutKeys(t);m.close(),w?(g.success(["成功录入快捷键",k]),f.success("成功录入")):f.error(`快捷键 ${i.translateKeyboardValueToButtonText(k)} 已被 ${C} 占用`);}h.innerHTML=o();});return c.attributes={},Reflect.set(c.attributes,wt,()=>false),c},Mn=function(a,e,t,n,r,s,i="请至少选择一个选项",l,o){let c=[];typeof n=="function"?c=n():c=n;let u={text:a,type:"select-multiple",description:s,placeholder:i,attributes:{},props:{},getValue(){return this.props[O].get(e,t)},selectConfirmDialogDetails:l,callback(p){let h=this.props[O],m=[];p.forEach(w=>{m.push(w.value);}),g.info("多选-选择：",m),h.set(e,m);},data:c};return Reflect.set(u.attributes,ue,e),Reflect.set(u.attributes,me,t),Ge.initComponentsStorageApi("select-multiple",u,{get(p,h){return J.getValue(p,h)},set(p,h){J.setValue(p,h);}}),u},$n=()=>({id:"netdisk-panel-config-all-setting",title:"设置",headerTitle:"总设置",isDefault:true,forms:[{type:"forms",text:"",forms:[{type:"deepMenu",text:"Toast",forms:[{type:"forms",text:"",className:"netdisk-panel-forms-toast",forms:[De("位置",y.toast.position.KEY,y.toast.position.default,[{value:"topleft",text:"左上角"},{value:"top",text:"顶部"},{value:"topright",text:"右上角"},{value:"left",text:"左边"},{value:"center",text:"中间"},{value:"right",text:"右边"},{value:"bottomleft",text:"左下角"},{value:"bottom",text:"底部"},{value:"bottomright",text:"右下角"}],void 0,`Toast显示在九宫格的位置，默认: ${y.toast.position.default}`),De("同时最多显示的数量",y.toast.maxnums.KEY,y.toast.maxnums.default,[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"},{value:5,text:"5"}],void 0,`默认: ${y.toast.maxnums.default}`),H("逆序弹出",y.toast.showreverse.KEY,y.toast.showreverse.value,void 0,"默认是自上往下显示Toast，逆序则是自下往上显示Toast")]}]},{type:"deepMenu",text:"弹窗",forms:[{className:"netdisk-panel-forms-pops",type:"forms",text:"",forms:[De("动画",y.pops.popsAnimation.KEY,y.pops.popsAnimation.default,[{value:"",text:"无"},{value:"pops-anim-spread",text:"spread"},{value:"pops-anim-shake",text:"shake"},{value:"pops-anim-rolling-left",text:"rolling-left"},{value:"pops-anim-rolling-right",text:"rolling-right"},{value:"pops-anim-slide-top",text:"slide-top"},{value:"pops-anim-slide-bottom",text:"slide-bottom"},{value:"pops-anim-slide-left",text:"slide-left"},{value:"pops-anim-slide-right",text:"slide-right"},{value:"pops-anim-fadein",text:"fadein"},{value:"pops-anim-fadein-zoom",text:"fadein-zoom"},{value:"pops-anim-fadein-alert",text:"fadein-alert"},{value:"pops-anim-don",text:"don"},{value:"pops-anim-roll",text:"roll"},{value:"pops-anim-sandra",text:"sandra"},{value:"pops-anim-gather",text:"gather"}],void 0,`显示/关闭的动画效果，默认: ${y.pops.popsAnimation.default}`),H("点击弹窗遮罩层关闭弹窗",y.pops.clickMaskToCloseDialog.KEY,y.pops.clickMaskToCloseDialog.default,void 0,"点击遮罩层触发关闭弹窗事件"),H("窗口拖拽",y.pops.pcDrag.KEY,y.pops.pcDrag.default,void 0,"长按标题栏可拖拽移动弹窗"),H("限制拖拽距离",y.pops.pcDragLimit.KEY,y.pops.pcDragLimit.default,void 0,"只能在浏览器的可视窗口内拖动"),H("亚克力效果",y.pops.popsAcrylic.KEY,y.pops.popsAcrylic.default,void 0,"")]}]},{type:"deepMenu",text:"文件弹窗",forms:[{type:"forms",text:"",className:"netdisk-panel-forms-pops-folder",forms:[De("排序名",y.popsFolder["pops-folder-sort-name"].KEY,y.popsFolder["pops-folder-sort-name"].default,[{value:"fileName",text:"文件名"},{value:"latestTime",text:"修改时间"},{value:"fileSize",text:"大小"}],void 0,"当前的规则"),De("排序规则",y.popsFolder["pops-folder-sort-is-desc"].KEY,y.popsFolder["pops-folder-sort-is-desc"].default,[{value:false,text:"升序"},{value:true,text:"降序"}],void 0,"当前的规则")]}]},{type:"deepMenu",text:"悬浮按钮",forms:[{type:"forms",text:"",forms:[ke("大小",y.suspension.size.KEY,y.suspension.size.default,15,250,(a,e)=>{y.suspension.size.value=parseInt(e.toString()),x.suspension.$data.isShow&&(z.css(x.suspension.$el.$suspension,{width:y.suspension.size.value,height:y.suspension.size.value}),x.suspension.updatePosition(true));},a=>`${a}px`,"悬浮按钮的大小，默认: "+y.suspension.size.default),ke("透明度",y.suspension.opacity.KEY,y.suspension.opacity.default,.1,1,(a,e)=>{y.suspension.opacity.value=parseFloat(e.toString()),x.suspension.$data.isShow&&z.css(x.suspension.$el.$suspension,{opacity:y.suspension.opacity.value});},void 0,"值越小越透明，默认: "+y.suspension.opacity.default,.1),ke("背景轮播时间",y.suspension["randbg-time"].KEY,y.suspension["randbg-time"].default,0,1e4,void 0,a=>`${a}ms`,"淡入/淡出的时间，默认: "+y.suspension["randbg-time"].default+"ms",100),ke("背景显示时间",y.suspension["randbg-show-time"].KEY,y.suspension["randbg-show-time"].default,0,1e4,void 0,a=>`${a}ms`,"图标显示的持续时间，默认: 1200",100),H("吸附边缘",y.suspension["suspended-button-adsorption-edge"].KEY,y.suspension["suspended-button-adsorption-edge"].default,void 0,"移动悬浮按钮松开后自动吸附边缘",void 0,void 0,()=>{Ze.updatePosition(false);}),W("z-index",y.suspension["suspended-z-index"].KEY,y.suspension["suspended-z-index"].default,"值小于等于0则为动态获取z-index",(a,e,t)=>(y.suspension["suspended-z-index"].value=t,true),"",true)]}]},{type:"deepMenu",text:"大/小链接弹窗",forms:[{type:"forms",text:"小窗",className:"netdisk-panel-forms-small-window",forms:[ke("宽度",y.smallWindow["netdisk-ui-small-window-width"].KEY,y.smallWindow["netdisk-ui-small-window-width"].default,50,z.width(window),void 0,a=>`${a}px`,"设置小窗宽度(px)，默认: 250",1),ke("高度",y.smallWindow["netdisk-ui-small-window-max-height"].KEY,y.smallWindow["netdisk-ui-small-window-max-height"].default,50,z.height(window),void 0,a=>`${a}px`,"设置小窗最大高度(px)，默认: "+y.smallWindow["netdisk-ui-small-window-max-height"].default,1)]},{type:"forms",text:"",forms:[W("z-index",y.smallWindow["netdisk-link-view-z-index"].KEY,y.smallWindow["netdisk-link-view-z-index"].default,"值小于等于0则为动态获取z-index",(a,e,t)=>(y.smallWindow["netdisk-link-view-z-index"].value=t,true),"",true)]}]}]},{type:"forms",text:"",forms:[{type:"deepMenu",text:"功能",forms:[{type:"forms",text:"",className:"netdisk-panel-forms-function",forms:[De("匹配模式",y.features["netdisk-match-mode"].KEY,y.features["netdisk-match-mode"].default,[{text:"MutationObserver",value:"MutationObserver"},{text:"Menu",value:"Menu"}],void 0,"MutationObserver是自动监听并识别链接<br>Menu是手动点击油猴菜单进行识别"),De("行为模式",y.features["netdisk-behavior-mode"].KEY,y.features["netdisk-behavior-mode"].default,[{text:"悬浮按钮+小窗",value:"suspension_smallwindow"},{text:"悬浮按钮+大窗",value:"suspension_window"},{text:"小窗",value:"smallwindow"}],void 0,"匹配到链接时触发的UI执行"),H("自动填充访问码",y.features.autoFillAccessCode.KEY,y.features.autoFillAccessCode.default,void 0,"通过主动点击链接跳转时，会自动输入网盘访问码")]}]},{type:"deepMenu",text:"匹配设置",forms:[{type:"forms",text:"文本匹配范围",forms:[Mn("匹配规则类型",y.match.pageMatchRange.KEY,y.match.pageMatchRange.default,[{value:"innerText",text:"普通文本"},{value:"innerHTML",text:"超文本"}],void 0,"执行的文本匹配规则",void 0,{height:"auto"}),H("深入ShadowRoot获取匹配文本",y.match.depthQueryWithShadowRoot.KEY,y.match.depthQueryWithShadowRoot.default,void 0,"遍历ShadowRoot，获取匹配的内容"),H("匹配剪贴板",y.match.readClipboard.KEY,y.match.readClipboard.default,void 0,"Api兼容性查看：<a href='https://caniuse.com/mdn-api_permissions_permission_clipboard-read' target='_blank'>读取剪贴板权限申请</a>、<a href='https://caniuse.com/mdn-api_clipboard_readtext' target='_blank'>直接读取剪贴板</a>"),H("匹配当前URL",y.match.allowMatchLocationHref.KEY,y.match.allowMatchLocationHref.default,void 0,"提取<code>window.location.href</code>进行匹配"),H("匹配input标签的内容",y.match.toBeMatchedWithInputElementValue.KEY,y.match.toBeMatchedWithInputElementValue.default,void 0,"提取页面中的<code>&lt;input&gt;</code>的内容进行匹配"),H("匹配textarea标签的内容",y.match.toBeMatchedTextAreaElementValue.KEY,y.match.toBeMatchedTextAreaElementValue.default,void 0,"提取页面中的<code>&lt;textarea&gt;</code>的内容进行匹配"),H("匹配网络请求的内容",y.match.toBeMatchedXhrHookResponseText.KEY,y.match.toBeMatchedXhrHookResponseText.default,void 0,"劫持xhr请求并对请求的内容进行匹配，注意：该功能可能会导致页面的部分功能异常，请谨慎使用")]},{type:"forms",text:"MutationObserver观察器",forms:[ke("匹配间隔",y.match.delaytime.KEY,y.match.delaytime.default,0,5,void 0,a=>`${a}s`,"匹配文本完毕后的延迟xxx秒允许下一次匹配",.1),H("添加元素时进行匹配",y.match.isAddedNodesToMatch.KEY,y.match.isAddedNodesToMatch.default,void 0,"当监听到页面添加元素时才进行匹配文本"),H("观察器：childList",y.match["mutationObserver-childList"].KEY,y.match["mutationObserver-childList"].default,void 0,"子节点的变动（新增、删除或者更改）"),H("观察器：characterData",y.match["mutationObserver-characterData"].KEY,y.match["mutationObserver-characterData"].default,void 0,"节点内容或节点文本的变动"),H("观察器：subtree",y.match["mutationObserver-subtree"].KEY,y.match["mutationObserver-subtree"].default,void 0,"是否将观察器应用于该节点的所有后代节点")]}]},{type:"deepMenu",text:"网盘图标",forms:[{type:"forms",text:"",forms:[H("点击定位分享码",y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode"].KEY,y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode"].default,void 0,"自动滚动页面至包含分享码的元素"),H("选中分享码",y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode-with-select"].KEY,y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode-with-select"].default,void 0,"使用光标选中分享码/元素"),H("循环定位",y.smallIconNavgiator["pops-netdisk-icon-click-event-loop-find-sharecode"].KEY,y.smallIconNavgiator["pops-netdisk-icon-click-event-loop-find-sharecode"].default,void 0,"关闭则是每一个元素只定位一次")]}]},{type:"deepMenu",text:"历史匹配记录",forms:[{type:"forms",text:"",className:"netdisk-panel-history-match",forms:[H("保存匹配记录",y.historyMatch.saveMatchNetDisk.KEY,y.historyMatch.saveMatchNetDisk.default,void 0,"将匹配到的链接信息进行本地存储，可点击【油猴菜单-⚙ 历史匹配记录】进行查看"),H("合并相同链接",y.historyMatch["netdisk-history-match-merge-same-link"].KEY,y.historyMatch["netdisk-history-match-merge-same-link"].default,void 0,"将合并匹配到的相同链接，并更新它最后一次匹配到的更新时间、网址信息"),De("排序规则",y.historyMatch["netdisk-history-match-ordering-rule"].KEY,y.historyMatch["netdisk-history-match-ordering-rule"].default,[{value:"按 记录时间 - 升序",text:"按 记录时间 - 升序"},{value:"按 记录时间 - 降序",text:"按 记录时间 - 降序"},{value:"按 更新时间 - 升序",text:"按 更新时间 - 升序"},{value:"按 更新时间 - 降序",text:"按 更新时间 - 降序"}]),nt("修复存储记录","如果【匹配记录】弹窗打不开，可能是存储的数据缺失某些字段，可尝试点击此处进行修复","修复",void 0,void 0,false,"primary",a=>{d.preventEvent(a);try{const{count:e,repairCount:t}=x.netDiskHistoryMatch.checkAndRepairLocalData();t===0?f.info("不存在需要修复的数据"):f.success(`共计: ${e} 条，修复${t}条`);}catch(e){f.error("修复异常："+e.toString());}})]}]},{type:"deepMenu",text:"分享码",forms:[{type:"forms",text:"",className:"netdisk-panel-forms-share-code",forms:[H("排除分享码",y.shareCode.excludeIdenticalSharedCodes.KEY,y.shareCode.excludeIdenticalSharedCodes.default,void 0,"启用后会根据【相同系数】排除掉匹配到的分享码"),ke("相同系数",y.shareCode.excludeIdenticalSharedCodesCoefficient.KEY,y.shareCode.excludeIdenticalSharedCodesCoefficient.default,0,1,void 0,a=>a.toString(),"例如分享码: aaaaaaaabb，它的相同系数是0.8，设置相同系数≥0.8时会被排除",.01)]}]},{type:"deepMenu",text:"访问码",forms:[{className:"netdisk-panel-forms-access-code",text:"",type:"forms",forms:[H("允许查询历史匹配记录",y.accessCode.allowQueryHistoryMatchingAccessCode.KEY,y.accessCode.allowQueryHistoryMatchingAccessCode.default,void 0,"当访问码为空时，访问码将从历史匹配记录中查询，优先级：页面匹配 < 历史匹配记录 < 网站规则 < 黑名单")]}]},{type:"deepMenu",className:"netdisk-panel-forms-shortcut-keys-deepMenu",text:"快捷键",forms:[{className:"netdisk-panel-forms-shortcut-keys",text:"",type:"forms",forms:[Re("【打开】⚙ 设置","","netdisk-keyboard-open-setting",void 0,"暂无快捷键","default",ve.shortCut),Re("【打开】⚙ 历史匹配记录","","netdisk-keyboard-open-history-matching-records",void 0,"暂无快捷键","default",ve.shortCut),Re("【打开】⚙ 访问码规则","","netdisk-keyboard-open-accesscode-rule",void 0,"暂无快捷键","default",ve.shortCut),Re("【打开】⚙ 添加链接识别规则","","netdisk-keyboard-open-user-rule",void 0,"暂无快捷键","default",ve.shortCut),Re("【打开】⚙ 网站规则","","netdisk-keyboard-website-rule",void 0,"暂无快捷键","default",ve.shortCut),Re("【打开】⚙ 字符映射规则","","netdisk-keyboard-character-mapping",void 0,"暂无快捷键","default",ve.shortCut),Re("【打开】⚙ 识别文本","","netdisk-keyboard-open-proactively-recognize-text",void 0,"暂无快捷键","default",ve.shortCut),Re("执行文本匹配","","netdisk-keyboard-performPageTextMatchingManually",void 0,"暂无快捷键","default",ve.shortCut),Re("识别选中内容","","netdisk-keyboard-identifyTheSelectedContent",void 0,"暂无快捷键","default",ve.shortCut)]}]}]}]});try{let a;a=RESOURCE_ICON,Object.assign(x.src.icon,a);}catch(a){console.error("init NetDisk icon error",a);}["input","select-multiple","select","slider","switch","textarea"].forEach(a=>{Ge.setStorageApi(a,{get(e,t){return re(e,t)},set(e,t){de(e,t);}});});ye.init();le.init();Ye.init();Ne.addContentConfig([$n()]);Ne.addContentConfig(Ye.getRulePanelContent());let Ut=lt.getMenuOption(0);Ut.callback=()=>{dt.show();};lt.updateMenuOption(Ut);lt.addMenuOption([{key:"showNetDiskHistoryMatch",text:"⚙ 历史匹配记录",autoReload:false,isStoreValue:false,showText(a){return a},callback(){x.netDiskHistoryMatch.show();}},{key:"ruleManager",text:"⚙ 规则管理器",autoReload:false,isStoreValue:false,showText(a){return a},callback(){Je.showView();}},{key:"showUserRule",text:"⚙ 添加链接识别规则",autoReload:false,isStoreValue:false,showText(a){return a},callback(){$e.show(false);}},{key:"showMatchPasteText",text:"⚙ 识别文本",autoReload:false,isStoreValue:false,showText(a){return a},callback(){x.matchPasteText.show();}}]);J.init();L.init();ve.init();b.ready(()=>{We.init(),yt.init(),U.init(),Je.init();});

})(Qmsg, DOMUtils, Utils, pops, CryptoJS);