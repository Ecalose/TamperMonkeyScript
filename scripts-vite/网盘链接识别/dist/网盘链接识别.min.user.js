// ==UserScript==
// @name         网盘链接识别
// @namespace    https://greasyfork.org/zh-CN/scripts/445489
// @version      2025.5.31
// @author       WhiteSevs
// @description  识别网页中显示的网盘链接，目前包括百度网盘、蓝奏云、天翼云、中国移动云盘(原:和彩云)、阿里云、文叔叔、奶牛快传、123盘、腾讯微云、迅雷网盘、115网盘、夸克网盘、城通网盘(部分)、坚果云、UC网盘、BT磁力、360云盘，支持蓝奏云、天翼云(需登录)、123盘、奶牛、UC网盘(需登录)、坚果云(需登录)和阿里云盘(需登录，且限制在网盘页面解析)直链获取下载，页面动态监控加载的链接，可自定义规则来识别小众网盘/网赚网盘或其它自定义的链接。
// @license      GPL-3.0-only
// @icon         data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAACsJJREFUeF7tXW+IHdUVP2c2u8kHIQYL0TRIaK1SgrFFaZsvVkpAo6YR1LJpa9jUd++83SUpSrUNBFRCrVgxNOv+mTOvJBBNmtpamoQG9UNBKLHFDzEtFttKBdOYQENE/Lb75vZd2cVNum/uvXNnZt/MnoGQD+/c8+d3fu+c+2f2PgR+ljQCuKSj5+CBCbDEScAEYAIscQSWePhcAZgASxyBJR4+VwAmQHEIjIyM3DAzM/M1pdSXEfEWALgVANbkaPE0ABwhomdz1GmtSgixHxF3Wg8wC55HxPeVUu8DgP7/jRUrVvxpbGzsY/PQbBK5VwCd9Ha7vVkptRkA9L8yHiKisAxDczaklL8GgAfLsImIryql3gSAqBPnh3nazI0AjUZjbRAEjwLAI3k6aKtLKbUjjuODtvI+cs1m894kSY776Mg49hwAxHkSIRcCSCl10nXy12YMLI9hrxDR/XkoMukQQrQQ8WGTXIGfn0PEZ6IoGvO14U0AKeUJALjH15Ecxr9ARHn2464uCSEOI+K2HHz2VXGUiAZ9lHgRQEp5BgBu9nEgr7FBEGyZmprSZCz8EUIMIuKRwg3ZGfiAiK63E/1/qcwEkFJ+BAArsxrOedzLRPSdnHWmqgvD8EBntj5Ups0UWxeI6NosvmQigBDibUTckMVgAWNKXwHMxSClfBwAtgPA+gLiclX5GhHd6TrImQBhGO5RSu11MHQREY8nSXICEf/R399/bnx8/KLD+CUl2plf3BgEwa1JktyOiN8HgKscAHCuhE4EaDabQ0mSHLBxSCml5weHlFKHWq3WBZsxLHM5AlLKLwLAQwCwCwBWWeLzKBHts5S1fx9ASnkdALxluZPXIiJh6wTLpSMwPDx8U7vd/iEADFtgdTZJko2tVuushawTAZ4EgCdMSpVSW+M4PmaS48/dEZBSWuWgMznfR0R6X8b4WLUA228/Ig5GUXTUaJUFMiMghNiEiK+bFCxbtuxLExMT/zLJ2RLAhnmTRDRiMsif+yMQhuFupdTTaZoQcZfNTqEVAYQQf0TEO1IMXurr69s4OTn5rn94rMEGAYul+Ekiutuky0iAoaGhqwcGBi4ZFD1FRLpK8FMSAkKIHyHiz9PM2bQBIwGklPcBwO9SDH0CAF8hovdKip3NAECj0VgdBMHf05aHSqntcRwfSm0VJjSllD8DgJ90k1NKTcVxbLM8MZnizx0RkFL+BgC6noAi4nNRFD3mSwB96NH1xKnMc3hHfGovbnEoZdweNraAMAxPKaW+0Q1NRFwfRdE7tUe7BwOUUuqTWL3j2u0xHhIZCSCl1K8gdT1pIiKjjh7ErhYujY6OXjM9Pf3ftGBM+TEmT0qpfAzUAukeDsI3P0yAHk6ujWtMABuUaizDBKhxcm1CYwLYoFRjGSZAjZNrExoTwAalGsswAWqcXJvQmAA2KNVYhglQ4+TahMYEsEGpxjK1IYCU8vcAcJvlW8dVTqn+C9+3iGhrHkHUggCmIPIAqhd1mA5qbHw2YWeysehnAWVetGADaMkyzn/Jc6V/dSDAeQBYXTLwvWLOeF5vcrQOBEg9bjYBUPXPTSXaFB8TwIRQj3/OBDC8cNLj+fN2r+oEOE1EX/VBwVTCfHRXYWzBBDDmx7gKMNyF92PfO/pMBPAFKO9Zsyupio7PNz9GAuiAuyzVcrmZo2iA6k4A3/xYEUAb0Xfjtdvt+xBxlVLqeF538jEB8nmrOmt+rAngWvps5ZkA+RDAFu8r5XqBAP9J2f8/R0SfzxrcQuMWgXClxueKVS8QQB8CfbuL48fyOjSZ078IBCg1vsoRYHYSs+BuYN4rgDRbc8CVabMIW5UkwLyZ7O2zAbxR1MWPZVeAeZVH3y5eeHyVJYCr41nlF4sAWf0tetyizwGKDnCx9wHKjs/VHhPgCsR6oS+7JtFHngnABPDhT/XG8hzg8pxxBeAKUL1vsY/HXAG4AvCNJ/M4wC2AW4BPQa3eWG4B3AK4BXAL6F65eCOoelXdyWNuAdwCuAVwC+AWMIcALwN5GejUQisvzHMAngPwHIDnADwH4DlAFw7wPkDlu3x6ADwHyDgHCMPwLqXUJgCYDoLgpampqb9VkSt1JUDW/FgtA6WUvwSAH1yR8Bc7vxSmf9i4Uk8dCeCTHyMBDL8a9j0iOlwlBtSNAL75sSGA/v1Z/TPmCz3/JqIvMAEWDwEppVd+bAhQq3VzDSuAV36YABXfCvYlNBOACbC01s2+35jF6/YLW/aNhysAVwCuAPMRqNpWMFcAx5rsC5ijucLFfePhFsAtgFsAt4AUDviWmMJroKMBjsfxNJABc2RYyeK++VmKc4CevrfPlT9MAEfEZn+cqrR7CR3dcxZnAjhD9unl16XdS5jBPachTAAnuD4Tnr0Bvefu7XMNhwngiljN5JkANUuoazhMAFfEaia/6ATo7+//3Pj4+MWa4VqZcAwEOE9E16UFY7MPkLZu1ro3ENFfK4NYjRwVQtyIiO92CwkR34yiaKMvAY4BwJZuSpRSD8Rx/Nsa4VqZUMIw3KaUSnsr+1dEtM2LAEKIvYi4J4VlB6Mo2lEZ1GrkqBBiEhGbKSE9Q0S7vQggpfwuALyUouRikiTrW63WhRph2/OhSCn1q/qnAeCqlOp8dxzHJ70IMDIycsPMzMw/05QopR6L4/i5nketRg5KKZ8EgCfSQlq+fPnKsbGxj70IoAdLKf8AAJtTmHYmjuNbaoRvT4cyPDx8U7vdPgUAq1Ja86tRFN1lCsS4CtAKwjDcqZTab1DWIiJhMsif+yMgpZwAgGGDpqeISFeJ1MeKADZtQFtRSm2N41ivGvgpCAGb0t8p2ucA4DYi+tDkhhUBZtvA8wDwiFEh4mAURUdNcvy5OwJCiE2I+LrFSKtvv9ZjTYBGo7E2CALdd9ZaODDZ19f3i8nJya6bFBY6WGQeAmEY7lZKPW0BivW334kAs1VAVwBdCWyeSwCg5w2HOvcIvGczgGUuR6DRaKxGRH0Hw0OIuMEGH0TcFUXRmI2sMwFmSXACAO6xNQAAnyilXuysIv4cBMFfoih6x2HskhIdHR29Znp6eo1Saj0iPgAA30qb6S8AzlEiGnQBzboFzFcqpTwDADe7GCpIVm+EHCGiZwvSn6pWCLEfEXcuhu0FbH5ARNe7+pKJALOV4CMAWOlqsCB56sx4w4J0L6h29o2iB8u0mWLrAhFdm8WXzATQxoQQb9v2pizOuYxRSu2I4/igy5isss1m894kSY5nHZ/zuNeI6M6sOr0IoI2GYbhHKbU3qwM5jnulcyx9f476uqoSQrQQ8eEybBlsvOz7G8veBNAONpvNoSRJfgoAaxYRlBeIqJR+3DmHP9w5h089Zi0Yh7N6NUZE+3zt5EKA2TmBfvNE92G9HVw6EYIg2DI1NaVXKIU/QohBRDxSuKGFDexLkuT5VqulSeD95EaAOU+klJ8SQSn1TUS8w9tDOwXepdDOzGdSYRgeUEoNuY7LKH8SEU/29fWdnJiY0LeC5fbkToD5ng0NDV09MDCgSfB1AFiHiOuUUusAINOMtUvUpa8A5pH9cQDYDgDrc8sIgH6vQk+uzyRJcqa/v/9U3kmf72uhBMgRFFZVEAJMgIKArYpaJkBVMlWQn0yAgoCtilomQFUyVZCfTICCgK2KWiZAVTJVkJ9MgIKArYra/wGYigzMiqJYZwAAAABJRU5ErkJggg==
// @supportURL   https://github.com/WhiteSevs/TamperMonkeyScript/issues
// @match        *://*/*
// @require      https://fastly.jsdelivr.net/gh/WhiteSevs/TamperMonkeyScript@86be74b83fca4fa47521cded28377b35e1d7d2ac/lib/CoverUMD/index.js
// @require      https://fastly.jsdelivr.net/gh/WhiteSevs/TamperMonkeyScript@24bd283e67dd804f4e37aa3082b8dfd1fd00dc35/scripts-vite/%E7%BD%91%E7%9B%98%E9%93%BE%E6%8E%A5%E8%AF%86%E5%88%AB/%E7%BD%91%E7%9B%98%E9%93%BE%E6%8E%A5%E8%AF%86%E5%88%AB-%E5%9B%BE%E6%A0%87.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/utils@2.6.8/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/domutils@1.5.8/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/pops@2.0.10/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/qmsg@1.3.6/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/gh/WhiteSevs/TamperMonkeyScript@886625af68455365e426018ecb55419dd4ea6f30/lib/CryptoJS/index.js
// @connect      *
// @connect      lanzoub.com
// @connect      lanzouc.com
// @connect      lanzoue.com
// @connect      lanzouf.com
// @connect      lanzoug.com
// @connect      lanzouh.com
// @connect      lanzoui.com
// @connect      lanzouj.com
// @connect      lanzouk.com
// @connect      lanzoul.com
// @connect      lanzoum.com
// @connect      lanzouo.com
// @connect      lanzoup.com
// @connect      lanzouq.com
// @connect      lanzous.com
// @connect      lanzout.com
// @connect      lanzouu.com
// @connect      lanzouv.com
// @connect      lanzouw.com
// @connect      lanzoux.com
// @connect      lanzouy.com
// @connect      lanosso.com
// @connect      lanzn.com
// @connect      lanzog.com
// @connect      lanpw.com
// @connect      lanpv.com
// @connect      lanzv.com
// @connect      wwentua.com
// @connect      ilanzou.com
// @connect      189.cn
// @connect      123pan.com
// @connect      123pan.cn
// @connect      wenshushu.cn
// @connect      jianguoyun.com
// @connect      cowtransfer.com
// @connect      cowcs.com
// @connect      aliyundrive.com
// @connect      baidu.com
// @connect      139.com
// @connect      weiyun.com
// @connect      xunlei.com
// @connect      115.com
// @connect      quark.cn
// @connect      jianguoyun.com
// @connect      uc.cn
// @connect      ctfile.com
// @connect      sharepoint.com
// @connect      whatslink.info
// @connect      www.yunpan.com
// @connect      link.yunpan.com
// @grant        GM_deleteValue
// @grant        GM_download
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_openInTab
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-start
// ==/UserScript==

(function (m, W, Le, lt, Et) {
	'use strict';

	var $t=Object.defineProperty;var It=(n,r,t)=>r in n?$t(n,r,{enumerable:true,configurable:true,writable:true,value:t}):n[r]=t;var G=(n,r,t)=>It(n,typeof r!="symbol"?r+"":r,t);var ct=typeof GM_deleteValue<"u"?GM_deleteValue:void 0,ut=typeof GM_download<"u"?GM_download:void 0,ee=typeof GM_getValue<"u"?GM_getValue:void 0,Me=typeof GM_info<"u"?GM_info:void 0,Lt=typeof GM_openInTab<"u"?GM_openInTab:void 0,Ft=typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0,ie=typeof GM_setValue<"u"?GM_setValue:void 0,Ot=typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0,Ut=typeof GM_xmlhttpRequest<"u"?GM_xmlhttpRequest:void 0,he=typeof unsafeWindow<"u"?unsafeWindow:void 0,Pt=window;const Vt={$data:{get enable(){return te.getValue("httpx-use-cookie-enable")},get useDocumentCookie(){return te.getValue("httpx-use-document-cookie")},cookieRule:[]},fixCookieSplit(n){return d.isNotNull(n)&&!n.trim().endsWith(";")&&(n+=";"),n},concatCookie(n,r){return d.isNull(n)?r:(n=n.trim(),r=r.trim(),n=this.fixCookieSplit(n),r.startsWith(";")&&(r=r.substring(1)),n.concat(r))},handle(n){if(n.fetch||!this.$data.enable)return;let r="",t=n.url;t.startsWith("//")&&(t=window.location.protocol+t);let e=new URL(t);this.$data.useDocumentCookie&&e.hostname.endsWith(window.location.hostname.split(".").slice(-2).join("."))&&(r=this.concatCookie(r,document.cookie.trim()));for(let a=0;a<this.$data.cookieRule.length;a++){let i=this.$data.cookieRule[a];if(e.hostname.match(i.hostname)){let s=te.getValue(i.key);if(d.isNull(s))break;r=this.concatCookie(r,s);}}d.isNotNull(r)&&(n.headers&&n.headers.Cookie?n.headers.Cookie=this.concatCookie(n.headers.Cookie,r):n.headers.Cookie=r,f.info(["Httpx => 设置cookie:",n])),n.headers&&n.headers.Cookie!=null&&d.isNull(n.headers.Cookie)&&delete n.headers.Cookie;}},Ne="GM_Panel",vt="data-init",pe="data-key",ge="data-default-value",zt="data-init-more-value",F="data-storage-api",H=function(n,r,t,e,a,i){let s={text:n,type:"switch",description:a,attributes:{},props:{},getValue(){return !!this.props[F].get(r,t)},callback(l,o){let c=!!o;f.success(`${c?"开启":"关闭"} ${n}`),!(typeof e=="function"&&e(l,c))&&this.props[F].set(r,c);},afterAddToUListCallBack:i};return Reflect.set(s.attributes,pe,r),Reflect.set(s.attributes,ge,t),Reflect.set(s.props,F,{get(l,o){return ee(l,o)},set(l,o){ie(l,o);}}),s},J=function(n,r,t,e,a,i="",s,l){let o={text:n,type:"input",isNumber:!!s,isPassword:!!l,props:{},attributes:{},description:e,getValue(){return this.props[F].get(r,t)},callback(c,u,p){typeof a=="function"&&a(c,u,p)||this.props[F].set(r,u);},placeholder:i};return Reflect.set(o.attributes,pe,r),Reflect.set(o.attributes,ge,t),Reflect.set(o.props,F,{get(c,u){return ee(c,u)},set(c,u){ie(c,u);}}),o},Xe=function(n,r,t,e,a,i,s,l,o){return {text:n,type:"button",description:r,attributes:{},props:{},buttonIcon:e,buttonIsRightIcon:a,buttonIconIsLoading:i,buttonType:s,buttonText:t,callback(u){typeof l=="function"&&l(u);},afterAddToUListCallBack:o}},Q={getDefaultLinkClickMode(){return {copy:{default:false,enable:true,text:"复制到剪贴板"},"copy-closePopup":{default:false,enable:true,text:"复制到剪贴板 & 关闭弹窗"},openBlank:{default:false,enable:true,text:"新标签页打开"},"openBlank-closePopup":{default:false,enable:true,text:"新标签页打开 & 关闭弹窗"},parseFile:{default:false,enable:false,text:"文件解析"},"parseFile-closePopup":{default:false,enable:false,text:"文件解析 & 关闭弹窗"},own:{default:false,enable:false,text:"自定义动作"}}},replaceParam(n,r={}){return typeof n!="string"||Object.keys(r).forEach(t=>{let e=r[t];if(d.isNotNull(e)){try{n=n.replaceAll(`{#encodeURI-${t}#}`,encodeURI(e));}catch{f.error("encodeURI-替换的文本失败",[e]);}try{n=n.replaceAll(`{#encodeURIComponent-${t}#}`,encodeURIComponent(e));}catch{f.error("encodeURIComponent-替换的文本失败",[e]);}try{n=n.replaceAll(`{#decodeURI-${t}#}`,decodeURI(e));}catch{f.error("decodeURI-替换的文本失败",[e]);}try{n=n.replaceAll(`{#decodeURIComponent-${t}#}`,decodeURIComponent(e));}catch{f.error("encodeURIComponent-替换的文本失败",[e]);}n=n.replaceAll(`{#${t}#}`,e);}}),n},replaceChinese(n){return n.replace(/[\u4e00-\u9fa5]/g,"")},getDecodeComponentUrl(n=window.location.href){try{n=decodeURIComponent(n);}catch{}return n}},z={matchRange_text:{before:n=>`${n}-text-match-range-before`,after:n=>`${n}-text-match-range-after`},matchRange_html:{before:n=>`${n}-html-match-range-before`,after:n=>`${n}-html-match-range-after`},function:{enable:n=>`${n}-enable`,checkLinkValidity:n=>`${n}-check-link-valid`,checkLinkValidityHoverTip:n=>`${n}-check-link-valid-hover-tip`,linkClickMode:n=>`${n}-click-mode`},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:n=>`${n}-open-blank-auto-fill-accesscode`,openBlankWithCopyAccessCode:n=>`${n}-open-blank-with-copy-accesscode`},schemeUri:{enable:n=>`${n}-scheme-uri-enable`,isForwardLinearChain:n=>`${n}-scheme-uri-forward-linear-chain`,isForwardBlankLink:n=>`${n}-scheme-uri-forward-blank-link`,uri:n=>`${n}-scheme-uri-uri`}},Ee={features:{customAccessCodeEnable:n=>`${n}-custom-accesscode-enable`,customAccessCode:n=>`${n}-custom-accesscode`}},Fe={replaceText(n,r,t){if(Array.isArray(r))for(const e of r)n=n.replace(e,t);else n=n.replace(r,t);return n}},P={alert(n,r){return n=this.handleDetails(n,r),K.alert(n)},confirm(n,r){return n=this.handleDetails(n,r),K.confirm(n)},loading(n){return typeof n.animation>"u"&&(n.animation=y.pops.popsAnimation.value),typeof n.forbiddenScroll>"u"&&(n.forbiddenScroll=x.defaultForbiddenScroll),K.loading(n)},prompt(n,r){return n=this.handleDetails(n,r),K.prompt(n)},folder(n,r){return n=this.handleDetails(n,r),n.sort={name:y.popsFolder["pops-folder-sort-name"].value,isDesc:y.popsFolder["pops-folder-sort-is-desc"].value,callback(t,e,a,i){y.popsFolder["pops-folder-sort-name"].value=a,y.popsFolder["pops-folder-sort-is-desc"].value=i;}},K.folder(n)},panel(n,r){return n=this.handleDetails(n,r),K.panel(n)},rightClickMenu(n){return n=this.handleDetails(n),K.rightClickMenu(n)},handleDetails(n,r){if(n=Object.assign({animation:y.pops.popsAnimation.value,drag:y.pops.pcDrag.value,dragLimit:y.pops.pcDragLimit.value,forbiddenScroll:x.defaultForbiddenScroll},n),r!=null)if(K.isPhone()){let t=typeof r.Mobile.width=="function"?r.Mobile.width():r.Mobile.width,e=typeof r.Mobile.height=="function"?r.Mobile.height():r.Mobile.height;n.width=t,n.height=e;}else {let t=typeof r.PC.width=="function"?r.PC.width():r.PC.width,e=typeof r.PC.height=="function"?r.PC.height():r.PC.height;n.width=t,n.height=e;}if(n.mask==null&&(n.mask={}),typeof n.mask.enable!="boolean"&&(n.mask.enable=true),n.mask.clickEvent==null&&(n.mask.clickEvent={}),typeof n.mask.clickEvent.toClose!="boolean"&&(n.mask.clickEvent.toClose=y.pops.clickMaskToCloseDialog.value),y.pops.popsAcrylic.value){let t=`
            .pops {
                --acrylic-opacity: 0.7;
                --acrylic-color: rgba(232, 232, 232, var(--acrylic-opacity));
                --acrylic-blur: 30px;
                --acrylic-saturate: 125%;
                --pops-bg-opacity: var(--acrylic-opacity);
            }
            .pops {
                backdrop-filter: blur(var(--acrylic-blur)) saturate(var(--acrylic-saturate)) !important;
                background-color: var(--acrylic-color) !important;
            }
            .pops[type-value=panel]{
                --aside-bg-color: rgba(221, 221, 221, var(--acrylic-opacity));
				--pops-bg-color: #f2f2f2;
				--title-bg-color: var(--acrylic-color);
				--aside-bg-color: var(--acrylic-color);
				--container-item-bg-color: var(--acrylic-color);
            }
            `;typeof n.style=="string"?n.style+=t:n.style=t;}return n.zIndex=()=>{let e=d.getMaxZIndex(10),a=K.config.InstanceUtils.getPopsMaxZIndex(10).zIndex;return d.getMaxValue(99999,e,a)+10},n}},Z={setting:{get width(){return window.innerWidth<550?"88vw":"550px"},get height(){return window.innerHeight<450?"70vh":"450px"}},settingBig:{get width(){return window.innerWidth<800?"92vw":"800px"},get height(){return window.innerHeight<600?"80vh":"600px"}},info:{get width(){return "350px"},get height(){return "250px"}}};class Pe{constructor(r){G(this,"storageKey");if(Object.keys(this).forEach(t=>{typeof this[t]=="function"&&(this[t]=this[t].bind(this));}),typeof r=="string"){let t=r.trim();if(t=="")throw new Error("key参数不能为空字符串");this.storageKey=t;}else throw new Error("key参数类型错误，必须是字符串");this.getLocalValue();}getLocalValue(){let r=ee(this.storageKey);return r==null&&(r={},this.setLocalValue(r)),r}setLocalValue(r){ie(this.storageKey,r);}set(r,t){let e=this.getLocalValue();Reflect.set(e,r,t),this.setLocalValue(e);}get(r,t){let e=this.getLocalValue();return Reflect.get(e,r)??t}getAll(){return this.getLocalValue()}delete(r){let t=this.getLocalValue();Reflect.deleteProperty(t,r),this.setLocalValue(t);}has(r){let t=this.getLocalValue();return Reflect.has(t,r)}keys(){let r=this.getLocalValue();return Reflect.ownKeys(r)}values(){let r=this.getLocalValue();return Reflect.ownKeys(r).map(t=>Reflect.get(r,t))}clear(){ct(this.storageKey);}}let Ct=class{constructor(r){G(this,"option");G(this,"storageApi");this.option=r,this.storageApi=new Pe(r.STORAGE_API_KEY);}getAllSubscribe(){return this.storageApi.get(this.option.STORAGE_KEY,[])}getAllSubscribeRule(r=false){let t=this.getAllSubscribe(),e=[];for(let a=0;a<t.length;a++){const i=t[a];if(!(r&&!i.data.enable))for(let s=0;s<i.subscribeData.ruleData.length;s++){const l=i.subscribeData.ruleData[s];r&&!l.enable||(l.subscribeUUID=i.uuid,e.push(l));}}return e}getSubscribe(r){return this.getAllSubscribe().find(e=>e.uuid==r)}getSubscribeRule(r,t){let e=this.getSubscribe(r);if(e)return e.subscribeData.ruleData.find(i=>i.uuid===t)}deleteAllSubscribe(){this.storageApi.delete(this.option.STORAGE_KEY);}deleteSubscribe(r){let t=typeof r=="string"?r:r.uuid,e=this.getAllSubscribe(),a=e.findIndex(i=>i.uuid===t);return a!==-1&&(e.splice(a,1),this.storageApi.set(this.option.STORAGE_KEY,e)),a!==-1}clearSubscribe(r){let t=typeof r=="string"?r:r.uuid,e=this.getAllSubscribe(),a=e.findIndex(i=>i.uuid===t);return a!==-1?(e[a].subscribeData.ruleData=[],this.storageApi.set(this.option.STORAGE_KEY,e),true):false}addSubscribe(r){let t=false,e=this.getAllSubscribe();return e.findIndex(i=>i.uuid===r.uuid)===-1&&(e.push(r),t=true),t&&this.storageApi.set(this.option.STORAGE_KEY,e),t}updateSubscribe(r){let t=false,e=this.getAllSubscribe(),a=e.findIndex(i=>i.uuid===r.uuid);return a!==-1&&(e[a]=r,t=true),t&&this.storageApi.set(this.option.STORAGE_KEY,e),t}updateSubscribeRule(r,t){let e=false,a=this.getAllSubscribe(),i=a.find(s=>s.uuid===r);if(i){let s=i.subscribeData.ruleData.findIndex(l=>l.uuid===t.uuid);s!==-1&&(i.subscribeData.ruleData[s]=t,e=true);}return e&&this.storageApi.set(this.option.STORAGE_KEY,a),true}deleteSubscribeRule(r,t){let e=false,a=this.getAllSubscribe(),i=a.findIndex(s=>s.uuid===r);if(i!==-1){let l=a[i].subscribeData.ruleData.findIndex(o=>o.uuid===t.uuid);l!==-1&&(a[i].subscribeData.ruleData.splice(l,1),this.storageApi.set(this.option.STORAGE_KEY,a),e=true);}return e}async getSubscribeInfo(r){let t=await M.get(r,{allowInterceptConfig:false,timeout:1e4,headers:{"User-Agent":d.getRandomPCUA()}});if(!t.status)return f.error(t),{data:null,msg:"获取订阅信息失败"};let e=t.data.responseText,a=d.toJSON(e);return typeof a.title=="string"&&typeof a.version=="number"&&typeof a.lastModified=="number"&&Array.isArray(a.ruleData)?{data:{uuid:d.generateUUID(),subscribeData:a,data:{enable:true,url:r,latestUpdateTime:Date.now(),updateFailedTime:null}},msg:""}:(f.error(a),{data:null,msg:"订阅链接的内容格式不正确"})}async updateAllSubscribe(){let r=this.getAllSubscribe();for(let t=0;t<r.length;t++){const e=r[t];if(!e.data.enable||typeof e.data.updateFailedTime=="number"&&d.formatTime(e.data.updateFailedTime,"yyyyMMdd")===d.formatTime(Date.now(),"yyyyMMdd")||typeof e.data.latestUpdateTime=="number"&&d.formatTime(Date.now(),"yyyyMMdd")===d.formatTime(e.data.latestUpdateTime,"yyyyMMdd"))continue;let a=await this.getSubscribeInfo(e.data.url),i=false;if(a.data){let s=a.data;s.uuid=e.uuid,s.data=e.data,s.data.latestUpdateTime=Date.now();let l=s.data.title||s.subscribeData.title||s.data.url;e.data.updateFailedTime=null,i=this.updateSubscribe(s),i?f.success(`更新订阅成功：${l}`):f.error(`更新订阅失败：${l}`,e);}else f.error("更新订阅失败："+a.msg,e);i||(e.data.updateFailedTime=Date.now(),this.updateSubscribe(e));}}importSubscribe(r){let t=P.alert({title:{text:"请选择导入方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="local">本地导入</div>
                    <div class="btn-control" data-mode="network">网络导入</div>
                    <div class="btn-control" data-mode="clipboard">剪贴板导入</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(o,c){o.close();}}},mask:{enable:true},drag:true,width:Z.info.width,height:Z.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),e=t.$shadowRoot.querySelector(".btn-control[data-mode='local']"),a=t.$shadowRoot.querySelector(".btn-control[data-mode='network']"),i=t.$shadowRoot.querySelector(".btn-control[data-mode='clipboard']"),s=o=>{let c=this.getAllSubscribe(),u=[];for(let p=0;p<o.length;p++){const h=o[p];c.findIndex(k=>k.uuid===h.uuid)!==-1||u.push(h);}c=c.concat(u),this.storageApi.set(this.option.STORAGE_KEY,c),m.success(`共 ${o.length} 条订阅，新增 ${u.length} 条`),r==null||r();},l=o=>new Promise(c=>{let u=d.toJSON(o);if(!Array.isArray(u)){f.error(u),m.error("导入失败，格式不符合（不是数组）",{consoleLogContent:true}),c(false);return}if(!u.length){m.error("导入失败，解析出的数据为空",{consoleLogContent:true}),c(false);return}let p=u[0];if(!(typeof p.data=="object"&&p.data!=null&&typeof p.subscribeData=="object"&&p.subscribeData!=null&&typeof p.uuid=="string")){m.error("导入失败，解析的格式不符合",{consoleLogContent:true}),c(false);return}s(u),c(true);});b.on(e,"click",o=>{d.preventEvent(o),t.close();let c=b.createElement("input",{type:"file",accept:".json"});b.on(c,["propertychange","input"],u=>{var g;if(!((g=c.files)!=null&&g.length))return;let p=c.files[0],h=new FileReader;h.onload=()=>{l(h.result);},h.readAsText(p,"UTF-8");}),c.click();}),b.on(a,"click",o=>{d.preventEvent(o),t.close();let c=P.prompt({title:{text:"网络导入",position:"center"},content:{text:"",placeholder:"请填写URL",focus:true},btn:{close:{enable:true,callback(h,g){h.close();}},ok:{text:"导入",callback:async(h,g)=>{let k=h.text;if(d.isNull(k)){m.error("请填入完整的url");return}let w=m.loading("正在获取配置..."),D=await M.get(k,{allowInterceptConfig:false});if(w.close(),!D.status){f.error(D),m.error("获取配置失败",{consoleLogContent:true});return}await l(D.data.responseText)&&h.close();}},cancel:{enable:false}},mask:{enable:true},drag:true,width:Z.info.width,height:"auto"}),u=c.$shadowRoot.querySelector("input"),p=c.$shadowRoot.querySelector(".pops-prompt-btn-ok");b.on(u,["input","propertychange"],h=>{b.val(u)===""?b.attr(p,"disabled","true"):b.removeAttr(p,"disabled");}),b.listenKeyboard(u,"keydown",(h,g,k)=>{h==="Enter"&&k.length===0&&b.val(u)!==""&&d.dispatchEvent(p,"click");}),d.dispatchEvent(u,"input");}),b.on(i,"click",async o=>{d.preventEvent(o),t.close();let c=await d.getClipboardInfo();if(c.error!=null){m.error(c.error.toString());return}if(c.content.trim()===""){m.warning("获取到的剪贴板内容为空");return}await l(c.content);});}exportSubscribe(r="rule.json"){let t=P.alert({title:{text:"请选择导出方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="only-export-rule-list">导出订阅</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(i,s){i.close();}}},mask:{enable:true},drag:true,width:Z.info.width,height:Z.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),e=t.$shadowRoot.querySelector(".btn-control[data-mode='only-export-rule-list']"),a=(i,s)=>{let l=new Blob([JSON.stringify(s,null,4)]),o=window.URL.createObjectURL(l),c=document.createElement("a");c.href=o,c.download=i,c.click(),setTimeout(()=>{window.URL.revokeObjectURL(o);},1500);};b.on(e,"click",i=>{d.preventEvent(i);try{let s=this.getAllSubscribe();if(s.length===0){m.warning("订阅为空，无需导出");return}a(r,s),t.close();}catch(s){m.error(s.toString(),{consoleLogContent:true});}});}};const oe=new Ct({STORAGE_API_KEY:"character-mapping-rule",STORAGE_KEY:"character-mapping-subscribe-rule"}),nt=new Pe("character-mapping-rule"),et={$data:{STORAGE_KEY:"character-mapping",EXPORT_CONFIG_KEY:"rule-export-config"},getTemplateData(){return {uuid:d.generateUUID(),subscribeUUID:null,enable:true,name:"",data:{url:"",isRegExp:true,regExpFlag:"ig",searchValue:"",replaceValue:""},dynamicData:[]}},getRulePanelViewOption(n){const r=this;let t=K.config.panelHandleContentUtils(),e=()=>n??this.getTemplateData();function a(s){return {get(l,o){return s[l]??o},set(l,o){s[l]=o;}}}return {id:"netdisk-rule",title:"字符映射",headerTitle:"字符映射规则",subscribe:{enable:true,data(){return oe.getAllSubscribe()},getData:s=>oe.getSubscribe(s.uuid)??s,getDataItemName(s){return `
						<style>
							.subscribe-rule-title-info-wrapper{
								display: flex;
								flex-direction: column;
								gap: 4px;
							}
							.subscribe-rule-title-info-wrapper .rule-name-text{
								white-space: nowrap;
								text-overflow: ellipsis;
								overflow: hidden;
								font-weight: 600;
								font-size: 16px;
								line-height: 24px;
							}
							.subscribe-rule-title-info-wrapper .subscribe-rule-small-span-text{
								font-size: 14px;
								line-height: 16px;
								white-space: pre-wrap;
							}
						</style>
						<div class="subscribe-rule-title-info-wrapper">
							<div class="rule-name-text" style="white-space: nowrap;text-overflow: ellipsis;overflow: hidden;font-size: 16px;font-weight: 600;line-height: 24px;">${s.data.title||s.subscribeData.title||s.data.url}</div>
								<div class="subscribe-rule-small-span-text">${s.subscribeData.ruleData.length} 条规则，更新于：${d.formatTime(s.data.latestUpdateTime,"yyyy年MM月dd日 HH:mm:ss")}${typeof s.data.updateFailedTime=="number"?`，<span style="color: red;">更新失败于：${d.formatTime(s.data.updateFailedTime,"yyyy年MM月dd日 HH:mm:ss")}</span>`:""}</div>
								${s.subscribeData.homePage?`<a href="${s.subscribeData.homePage}" class="subscribe-rule-small-span-text" target="_blank" style="color:#67b279;">转到主页</a>`:""}
								<a href="${s.data.url}" class="subscribe-rule-small-span-text" target="_blank" style="color:#67b279;">订阅地址</a>
						</div>`},addData:s=>oe.addSubscribe(s),updateData:s=>oe.updateSubscribe(s),deleteData:s=>oe.deleteSubscribe(s),btnControls:{add:{enable:true},filter:{enable:true,title:"过滤订阅",option:[{name:"过滤【已启用】的订阅",filterCallBack(s){return s.data.enable}},{name:"过滤【未启用】的订阅",filterCallBack(s){return !s.data.enable}}]},clearAll:{enable:true,callback:()=>{oe.deleteAllSubscribe();}},ruleEnable:{enable:true,getEnable(s){return s.data.enable},async callback(s,l){s.data.enable=l,oe.updateSubscribe(s);}},ruleEdit:{enable:true,callback:s=>{let l=s.ruleData.uuid;return s.enterDeepMenu({headerTitle:s.ruleData.data.title||s.ruleData.subscribeData.title||s.ruleData.data.url,data(){var c;let o=oe.getSubscribe(l);return ((c=o==null?void 0:o.subscribeData)==null?void 0:c.ruleData)??s.ruleData.subscribeData.ruleData},getData(o){return oe.getSubscribeRule(l,o.uuid)??o},getDataItemName(o){return o.name??o.data.url},addData(o){return  true},updateData(o){return oe.updateSubscribeRule(l,o)},deleteData(o){return oe.deleteSubscribeRule(l,o)},btnControls:{filter:{enable:true,option:[{name:"过滤【已启用】的规则",filterCallBack(o){return o.enable}},{name:"过滤【未启用】的规则",filterCallBack(o){return !o.enable}}]},clearAll:{enable:true,callback:()=>{oe.clearSubscribe(l);}},ruleEnable:{enable:true,getEnable(o){return o.enable},callback(o,c){o.enable=c,oe.updateSubscribeRule(l,o);}},ruleEdit:{enable:true,getView:(o,c)=>{c||(o=e());let u=document.createDocumentFragment(),p=H("启用","enable",true);Reflect.set(p.props,F,a(o));let h=t.createSectionContainerItem_switch(p),g=J("规则名称","name","","",void 0,"必填");Reflect.set(g.props,F,a(o));let k=t.createSectionContainerItem_input(g),w=J("匹配网址","url","","",void 0,"必填，可正则");Reflect.set(w.props,F,a(o.data));let D=t.createSectionContainerItem_input(w),C=_=>{let $=this.getTemplateData(),E=J("字符规则","searchValue",$.data.searchValue,"",void 0,"必填，可正则");Reflect.set(E.props,F,a(_));let B=t.createSectionContainerItem_input(E),O=H("是否启用正则","isRegExp",$.data.isRegExp,void 0,"使用正则进行匹配字符规则");Reflect.set(O.props,F,a(o.data));let q=t.createSectionContainerItem_switch(O),U=J("正则标识符","regExpFlag",$.data.regExpFlag,"",void 0,"i:不区分大小写  g:全局");Reflect.set(U.props,F,a(o.data));let ne=t.createSectionContainerItem_input(U),se=J("映射为","replaceValue",$.data.replaceValue,"",void 0,"");Reflect.set(se.props,F,a(o.data));let fe=t.createSectionContainerItem_input(se);return {$data_searchValue:B,$data_isRegExp:q,$data_regExpFlag:ne,$data_replaceValue:fe}},N=b.createElement("div",{className:"rule-form-ulist-dynamic",innerHTML:`
									<div class="rule-form-ulist-dynamic__inner">

									</div>
									<div class="pops-panel-button pops-panel-button-no-icon">
										<button class="pops-panel-button_inner" type="default">
											<i class="pops-bottom-icon" is-loading="false"></i>
											<span class="pops-panel-button-text">添加额外属性</span>
										</button>
									</div>`}),S=N.querySelector(".rule-form-ulist-dynamic__inner"),T=N.querySelector(".pops-panel-button"),v=_=>{let $=this.getTemplateData();_=_??{searchValue:$.data.searchValue,isRegExp:$.data.isRegExp,regExpFlag:$.data.regExpFlag,replaceValue:$.data.replaceValue};let E=b.createElement("div",{className:"rule-form-ulist-dynamic__inner-container",innerHTML:`
										<div class="dynamic-control-delete">
											<div class="pops-panel-button pops-panel-button-no-icon">
												<button class="pops-panel-button_inner" type="danger">
													<i class="pops-bottom-icon" is-loading="false"></i>
													<span class="pops-panel-button-text">×</span>
												</button>
											</div>
										</div>
										<ul class="dynamic-forms">

										</ul>`}),B=E.querySelector(".dynamic-control-delete");b.on(B,"click",fe=>{if(d.preventEvent(fe),E.remove(),Array.isArray(o.dynamicData)){let Ce=o.dynamicData.findIndex(je=>je==_);Ce!==-1&&o.dynamicData.splice(Ce,1);}});let O=E.querySelector(".dynamic-forms"),{$data_searchValue:q,$data_isRegExp:U,$data_regExpFlag:ne,$data_replaceValue:se}=C(_);O.appendChild(q),O.appendChild(U),O.appendChild(ne),O.appendChild(se),S.appendChild(E);};if(b.on(T,"click",_=>{d.preventEvent(_),v();}),Array.isArray(o.dynamicData))for(let _=0;_<o.dynamicData.length;_++){const $=o.dynamicData[_];v($);}let R=C(o.data);return u.appendChild(h),u.appendChild(k),u.appendChild(D),u.appendChild(R.$data_searchValue),u.appendChild(R.$data_isRegExp),u.appendChild(R.$data_regExpFlag),u.appendChild(R.$data_replaceValue),u.appendChild(N),u},onsubmit:(o,c,u)=>{let p=o.querySelectorAll(".rule-form-ulist > li"),h=this.getTemplateData();return c&&(h.uuid=u.uuid),p.forEach(g=>{let k=Reflect.get(g,"__formConfig__"),w=Reflect.get(k,"attributes"),D=Reflect.get(g,F),C=Reflect.get(w,pe),N=Reflect.get(w,ge),S=D.get(C,N);Reflect.has(h,C)?Reflect.set(h,C,S):Reflect.has(h.data,C)?Reflect.set(h.data,C,S):f.error(`${C}不在数据中`);}),o.querySelectorAll(".rule-form-ulist-dynamic__inner-container").forEach(g=>{let k={};g.querySelectorAll(".dynamic-forms > li").forEach(w=>{let D=Reflect.get(w,"__formConfig__");if(!D)return;let C=Reflect.get(D,"attributes");if(!C)return;let N=Reflect.get(w,F),S=Reflect.get(C,pe),T=Reflect.get(C,ge),v=N.get(S,T);Reflect.set(k,S,v);}),h.dynamicData.push(k);}),h.name.trim()===""?(m.error("规则名称不能为空"),{success:false,data:h}):h.data.url.trim()===""?(m.error("匹配网址不能为空"),{success:false,data:h}):h.data.searchValue.trim()===""||Array.isArray(h.dynamicData)&&h.dynamicData.findIndex(g=>g.searchValue.trim()==="")!==-1?(m.error("字符规则不能为空"),{success:false,data:h}):c?{success:this.updateData(h),data:h}:{success:this.addData(h),data:h}}},ruleDelete:{enable:true,deleteCallBack(o){return oe.deleteSubscribeRule(l,o)}}}}),false}},ruleDelete:{enable:true,deleteCallBack:s=>oe.deleteSubscribe(s)},import:{enable:true,callback(s){oe.importSubscribe(()=>{s();});}},export:{enable:true,callback(){oe.exportSubscribe(ye+"-字典映射-订阅.json");}}},getSubscribeInfo:oe.getSubscribeInfo.bind(oe)},ruleOption:{btnControls:{add:{enable:true},filter:{enable:true,title:"过滤规则",option:[{name:"过滤【已启用】的规则",filterCallBack(s){return s.enable}},{name:"过滤【未启用】的规则",filterCallBack(s){return !s.enable}},{name:"过滤【在当前网址生效】的规则",filterCallBack(s){return !!window.location.href.match(s.data.url)}}]},clearAll:{enable:true,callback:()=>{r.clearData();}},import:{enable:true,callback:s=>{r.importRule(()=>{s();});}},export:{enable:true,callback:()=>{r.exportRule(ye+"-字符映射.json",ye+"-字符映射-订阅模式.json");}},ruleEnable:{enable:true,getEnable(s){return s.enable},callback:(s,l)=>{s.enable=l,r.updateData(s);}},ruleEdit:{enable:true,getView:(s,l)=>{let o=document.createDocumentFragment();l||(s=e());let c=H("启用","enable",true);Reflect.set(c.props,F,a(s));let u=t.createSectionContainerItem_switch(c),p=J("规则名称","name","","",void 0,"必填");Reflect.set(p.props,F,a(s));let h=t.createSectionContainerItem_input(p),g=J("匹配网址","url","","",void 0,"必填，可正则");Reflect.set(g.props,F,a(s.data));let k=t.createSectionContainerItem_input(g),w=v=>{let R=this.getTemplateData(),_=J("字符规则","searchValue",R.data.searchValue,"",void 0,"必填，可正则");Reflect.set(_.props,F,a(v));let $=t.createSectionContainerItem_input(_),E=H("是否启用正则","isRegExp",R.data.isRegExp,void 0,"使用正则进行匹配字符规则");Reflect.set(E.props,F,a(s.data));let B=t.createSectionContainerItem_switch(E),O=J("正则标识符","regExpFlag",R.data.regExpFlag,"",void 0,"i:不区分大小写  g:全局");Reflect.set(O.props,F,a(s.data));let q=t.createSectionContainerItem_input(O),U=J("映射为","replaceValue",R.data.replaceValue,"",void 0,"");Reflect.set(U.props,F,a(s.data));let ne=t.createSectionContainerItem_input(U);return {$data_searchValue:$,$data_isRegExp:B,$data_regExpFlag:q,$data_replaceValue:ne}},D=b.createElement("div",{className:"rule-form-ulist-dynamic",innerHTML:`
									<div class="rule-form-ulist-dynamic__inner">

									</div>
									<div class="pops-panel-button pops-panel-button-no-icon">
										<button class="pops-panel-button_inner" type="default">
											<i class="pops-bottom-icon" is-loading="false"></i>
											<span class="pops-panel-button-text">添加额外属性</span>
										</button>
									</div>`}),C=D.querySelector(".rule-form-ulist-dynamic__inner"),N=D.querySelector(".pops-panel-button"),S=v=>{let R=this.getTemplateData();v=v??{searchValue:R.data.searchValue,isRegExp:R.data.isRegExp,regExpFlag:R.data.regExpFlag,replaceValue:R.data.replaceValue};let _=b.createElement("div",{className:"rule-form-ulist-dynamic__inner-container",innerHTML:`
										<div class="dynamic-control-delete">
											<div class="pops-panel-button pops-panel-button-no-icon">
												<button class="pops-panel-button_inner" type="danger">
													<i class="pops-bottom-icon" is-loading="false"></i>
													<span class="pops-panel-button-text">×</span>
												</button>
											</div>
										</div>
										<ul class="dynamic-forms">

										</ul>`}),$=_.querySelector(".dynamic-control-delete");b.on($,"click",ne=>{if(d.preventEvent(ne),_.remove(),Array.isArray(s.dynamicData)){let se=s.dynamicData.findIndex(fe=>fe==v);se!==-1&&s.dynamicData.splice(se,1);}});let E=_.querySelector(".dynamic-forms"),{$data_searchValue:B,$data_isRegExp:O,$data_regExpFlag:q,$data_replaceValue:U}=w(v);E.appendChild(B),E.appendChild(O),E.appendChild(q),E.appendChild(U),C.appendChild(_);};if(b.on(N,"click",v=>{d.preventEvent(v),S();}),Array.isArray(s.dynamicData))for(let v=0;v<s.dynamicData.length;v++){const R=s.dynamicData[v];S(R);}let T=w(s.data);return o.appendChild(u),o.appendChild(h),o.appendChild(k),o.appendChild(T.$data_searchValue),o.appendChild(T.$data_isRegExp),o.appendChild(T.$data_regExpFlag),o.appendChild(T.$data_replaceValue),o.appendChild(D),o},onsubmit:(s,l,o)=>{let c=s.querySelectorAll(".rule-form-ulist > li"),u=this.getTemplateData();return l&&(u.uuid=o.uuid),c.forEach(p=>{let h=Reflect.get(p,"__formConfig__"),g=Reflect.get(h,"attributes"),k=Reflect.get(p,F),w=Reflect.get(g,pe),D=Reflect.get(g,ge),C=k.get(w,D);Reflect.has(u,w)?Reflect.set(u,w,C):Reflect.has(u.data,w)?Reflect.set(u.data,w,C):f.error(`${w}不在数据中`);}),s.querySelectorAll(".rule-form-ulist-dynamic__inner-container").forEach(p=>{let h={};p.querySelectorAll(".dynamic-forms > li").forEach(g=>{let k=Reflect.get(g,"__formConfig__");if(!k)return;let w=Reflect.get(k,"attributes");if(!w)return;let D=Reflect.get(g,F),C=Reflect.get(w,pe),N=Reflect.get(w,ge),S=D.get(C,N);Reflect.set(h,C,S);}),u.dynamicData.push(h);}),u.name.trim()===""?(m.error("规则名称不能为空"),{success:false,data:u}):u.data.url.trim()===""?(m.error("匹配网址不能为空"),{success:false,data:u}):u.data.searchValue.trim()===""||Array.isArray(u.dynamicData)&&u.dynamicData.findIndex(p=>p.searchValue.trim()==="")!==-1?(m.error("字符规则不能为空"),{success:false,data:u}):l?{success:this.updateData(u),data:u}:{success:this.addData(u),data:u}}},ruleDelete:{enable:true,deleteCallBack:s=>r.deleteData(s)}},data:()=>this.getData(),getAddData:()=>e(),getData:s=>this.getData().find(c=>c.uuid===s.uuid)??s,getDataItemName:s=>s.name??s.data.url,updateData:s=>this.updateData(s),deleteData:s=>this.deleteData(s)}}},getUrlMatchedRule(n=true,r=window.location.href){let t=this.getData(),e=oe.getAllSubscribeRule(n);return t=t.concat(e),t.filter(a=>{if(!(n&&!a.enable))return !!r.match(a.data.url)})},getMappingData(n=window.location.href){let r=this.getUrlMatchedRule(true,n),t=[];return r.forEach(e=>{try{let a=Array.isArray(e.dynamicData)?[...e.dynamicData].concat(e.data):[e.data];for(let i=0;i<a.length;i++){const s=a[i];s.isRegExp?t.push({searchValue:new RegExp(s.searchValue,s.regExpFlag),replaceValue:s.replaceValue}):t.push({searchValue:s.searchValue,replaceValue:s.replaceValue});}}catch(a){f.error("字符映射规则转换发生错误：",a);}}),t},getData(){return ee(this.$data.STORAGE_KEY,[])},setData(n){ie(this.$data.STORAGE_KEY,n);},addData(n){let r=this.getData();return r.findIndex(e=>e.uuid==n.uuid)===-1?(r.push(n),ie(this.$data.STORAGE_KEY,r),true):false},updateData(n){let r=this.getData(),t=r.findIndex(a=>a.uuid==n.uuid),e=false;return t!==-1&&(e=true,r[t]=n),this.setData(r),e},deleteData(n){let r=this.getData(),t=r.findIndex(a=>a.uuid==n.uuid),e=false;return t!==-1&&(e=true,r.splice(t,1)),this.setData(r),e},clearData(){ct(this.$data.STORAGE_KEY);},exportRule(n="rule.json",r="rule-subscribe.json"){let t=P.alert({title:{text:"请选择导出方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="only-export-rule-list">导出规则</div>
                    <div class="btn-control" data-mode="export-to-subscribe">导出订阅规则</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(s,l){s.close();}}},mask:{enable:true},drag:true,width:Z.info.width,height:Z.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),e=t.$shadowRoot.querySelector(".btn-control[data-mode='only-export-rule-list']"),a=t.$shadowRoot.querySelector(".btn-control[data-mode='export-to-subscribe']"),i=(s,l)=>{let o=new Blob([JSON.stringify(l,null,4)]),c=window.URL.createObjectURL(o),u=document.createElement("a");u.href=c,u.download=s,u.click(),setTimeout(()=>{window.URL.revokeObjectURL(c);},1500);};b.on(e,"click",s=>{d.preventEvent(s);try{let l=this.getData();if(l.length===0){m.warning("规则为空，无需导出");return}i(n,l),t.close();}catch(l){m.error(l.toString(),{consoleLogContent:true});}}),b.on(a,"click",s=>{d.preventEvent(s);const l=this;t.close();try{if(this.getData().length===0){m.warning("规则为空，无需导出");return}let c=K.config.panelHandleContentUtils(),u=function(v){return {get(R,_){return v[R]??_},set(R,_){v[R]=_,nt.set(l.$data.EXPORT_CONFIG_KEY,v);}}},p=()=>{let v=nt.get(this.$data.EXPORT_CONFIG_KEY,{});if((v==null?void 0:v.title)===""||v.title==null){m.error("订阅标题不能为空");return}if(v.version==null){m.error("版本号不能为空");return}else v.version=Number(v.version);v.homePage==null&&(v.homePage=void 0),v.lastModified=Date.now(),v.ruleData=this.getData(),i(r,v),h.close();},h=P.alert({title:{text:"请填写导出配置",position:"center"},content:{text:`
							
						`,html:!0},btn:{ok:{enable:!0,text:"导出",callback(v,R){p();}},close:{enable:!0,callback(v,R){v.close();}}},mask:{enable:!0},drag:!0,width:Z.info.width,height:Z.info.height,style:`
						${K.config.cssText.panelCSS}

						.pops-alert-content li{
							list-style-type: none;
							display: flex;
							align-items: center;
							justify-content: space-between;
							margin: 10px;
						}
					`}),g=h.$shadowRoot.querySelector(".pops-alert-content"),k=nt.get(this.$data.EXPORT_CONFIG_KEY,{}),w=J("订阅标题","title","","",void 0,"");Reflect.set(w.props,F,u(k));let D=c.createSectionContainerItem_input(w),C=J("版本号","version","","",void 0,"",!0);Reflect.set(C.props,F,u(k));let N=c.createSectionContainerItem_input(C),S=J("主页地址","homePage","","",void 0,"选填");Reflect.set(S.props,F,u(k));let T=c.createSectionContainerItem_input(S);b.append(g,D),b.append(g,N),b.append(g,T);}catch(o){m.error(o.toString(),{consoleLogContent:true});}});},importRule(n){let r=P.alert({title:{text:"请选择导入方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="local">本地导入</div>
                    <div class="btn-control" data-mode="network">网络导入</div>
                    <div class="btn-control" data-mode="clipboard">剪贴板导入</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(l,o){l.close();}}},mask:{enable:true},drag:true,width:Z.info.width,height:Z.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
            `}),t=r.$shadowRoot.querySelector(".btn-control[data-mode='local']"),e=r.$shadowRoot.querySelector(".btn-control[data-mode='network']"),a=r.$shadowRoot.querySelector(".btn-control[data-mode='clipboard']"),i=l=>{let o=this.getData(),c=[];for(let u=0;u<l.length;u++){const p=l[u];o.findIndex(g=>g.uuid===p.uuid)!==-1||c.push(p);}o=o.concat(c),this.setData(o),m.success(`共 ${l.length} 条规则，新增 ${c.length} 条`),n==null||n();},s=l=>new Promise(o=>{let c=d.toJSON(l);if(!Array.isArray(c)){f.error(c),m.error("导入失败，格式不符合（不是数组）",{consoleLogContent:true}),o(false);return}if(!c.length){m.error("导入失败，解析出的数据为空",{consoleLogContent:true}),o(false);return}i(c),o(true);});b.on(t,"click",l=>{d.preventEvent(l),r.close();let o=b.createElement("input",{type:"file",accept:".json"});b.on(o,["propertychange","input"],c=>{var h;if(!((h=o.files)!=null&&h.length))return;let u=o.files[0],p=new FileReader;p.onload=()=>{s(p.result);},p.readAsText(u,"UTF-8");}),o.click();}),b.on(e,"click",l=>{d.preventEvent(l),r.close();let o=P.prompt({title:{text:"网络导入",position:"center"},content:{text:"",placeholder:"请填写URL",focus:true},btn:{close:{enable:true,callback(p,h){p.close();}},ok:{text:"导入",callback:async(p,h)=>{let g=p.text;if(d.isNull(g)){m.error("请填入完整的url");return}let k=m.loading("正在获取配置..."),w=await M.get(g,{allowInterceptConfig:false});if(k.close(),!w.status){f.error(w),m.error("获取配置失败",{consoleLogContent:true});return}await s(w.data.responseText)&&p.close();}},cancel:{enable:false}},mask:{enable:true},drag:true,width:Z.info.width,height:"auto"}),c=o.$shadowRoot.querySelector("input"),u=o.$shadowRoot.querySelector(".pops-prompt-btn-ok");b.on(c,["input","propertychange"],p=>{b.val(c)===""?b.attr(u,"disabled","true"):b.removeAttr(u,"disabled");}),b.listenKeyboard(c,"keydown",(p,h,g)=>{p==="Enter"&&g.length===0&&b.val(c)!==""&&d.dispatchEvent(u,"click");}),d.dispatchEvent(c,"input");}),b.on(a,"click",async l=>{d.preventEvent(l),r.close();let o=await d.getClipboardInfo();if(o.error!=null){m.error(o.error.toString());return}if(o.content.trim()===""){m.warning("获取到的剪贴板内容为空");return}await s(o.content);});}},I={$data:{isMatchedLink:false,clipboardText:""},$match:{matchedInfo:new Le.Dictionary,blackMatchedInfo:new Le.Dictionary,tempMatchedInfo:new Le.Dictionary,matchedInfoRuleKey:new Set},$rule:{ruleOption:{},ruleSetting:{},rule:[]},$extraRule:{shareCodeNotMatchRegexpList:[/vipstyle|notexist|ajax|file|download|ptqrshow|xy-privacy/g,/comp|web|undefined|1125|unproved|console|account|favicon|setc/g],accessCodeNotMatchRegexpList:[/^(font)/gi],noAccessCodeRegExp:[/( |提取码:|\n密码：)/gi,/{#accessCode#}/gi,/{#encodeURI-accessCode#}|{#encodeURIComponent-accessCode#}/gi,/{#decodeURI-accessCode#}|{#decodeURIComponent-accessCode#}/gi,/(\?pwd=|&pwd=|\?password=|\?p=)/gi]},init(){this.initLinkDict();},initLinkDict(){Object.keys(this.$rule.ruleOption).forEach(t=>{this.$match.matchedInfo.set(t,new d.Dictionary),this.$match.blackMatchedInfo.set(t,new d.Dictionary),this.$match.tempMatchedInfo.set(t,new d.Dictionary);});let n=we.getUrlMatchedRule();n.length&&(f.info("成功命中网站规则 ==> ",n),Oe.add({key:"matchedUrlRuleList",text:`🌏 命中网站规则 ${n.length} 条`,autoReload:false,isStoreValue:false,showText(t){return t},callback:()=>{f.info("当前网址："+self.location.href),te.isTopWindow()&&alert(`以下是命中的规则名：
`+n.map(t=>t.name).join(`
`));}}));let r=et.getUrlMatchedRule();r.length&&(f.info("成功命中字符规则 ==> ",r),Oe.add({key:"characterMapping",text:`🌏 命中字符规则 ${r.length} 条`,autoReload:false,isStoreValue:false,showText(t){return t},callback:()=>{f.info("当前网址："+self.location.href),te.isTopWindow()&&alert(`以下是命中的规则名：
`+r.map(t=>t.name).join(`
`));}}));},handleLink(n,r,t){let e=this.handleShareCode(n,r,t);if(d.isNull(e))return;let a=this.handleAccessCode(n,r,t);return a=this.handleAccessCodeByUserRule(n,r,a,t),{shareCode:e,accessCode:a}},handleShareCode(n,r,t){var l;let e=I.$rule.ruleOption[n][r],a=(l=t.match(e.shareCode))==null?void 0:l.filter(o=>d.isNotNull(o));if(d.isNull(a)){f.error("匹配shareCode为空",{匹配的文本:t,规则:e,正在使用的规则:e.shareCode,网盘名称:n,网盘名称索引下标:r});return}let i=a[0];e.shareCodeNeedRemoveStr&&(i=i.replace(e.shareCodeNeedRemoveStr,""));let s=e.shareCodeNotMatch;if(!(s!=null&&i.match(s))){for(const o of I.$extraRule.shareCodeNotMatchRegexpList)if(i.match(o))return;if(i=decodeURI(i),!(y.shareCode.excludeIdenticalSharedCodes.value&&d.isSameChars(i,y.shareCode.excludeIdenticalSharedCodesCoefficient.value))&&!(i.endsWith("http")||i.endsWith("https")))return i}},handleAccessCode(n,r,t){var s;let e=this.$rule.ruleOption[n][r],a="";if(!e.checkAccessCode)return "";let i=t.match(e.checkAccessCode);if(i){let o=(s=i[i.length-1].match(e.accessCode))==null?void 0:s.filter(c=>d.isNotNull(c));if(d.isNull(o))return "";o.length&&(a=o[0],a.startsWith("http")&&(a=""));}if(d.isNotNull(a)){for(const l of I.$extraRule.accessCodeNotMatchRegexpList)if(a.match(l)){a="";break}e.acceesCodeNotMatch&&a.match(e.acceesCodeNotMatch)&&(a="");}return a},handleAccessCodeByUserRule(n,r,t,e){let a=we.getUrlMatchedRule(),i=t;for(let s=0;s<a.length;s++){const l=a[s];let o=we.getRuleData(l),c=Reflect.get(o,Ee.features.customAccessCode(n));if(Reflect.get(o,Ee.features.customAccessCodeEnable(n))&&typeof c=="string"){i=c,f.success(`使用自定义网站规则中的提取码 ${n} ${i}`);break}}return i},handleLinkShow(n,r,t,e,a){let i=I.$rule.ruleOption[n][r];if(i==null)throw m.error("BUG: 获取uiLink规则失败"),f.error("BUG: 分析参数",n,r,t,e),new TypeError("获取uiLink规则失败");let s=Q.replaceParam(i.uiLinkShow,{shareCode:t});if(typeof e=="string"&&e.trim()!=""?s=Q.replaceParam(s,{accessCode:e}):s=Fe.replaceText(s,I.$extraRule.noAccessCodeRegExp,""),i.paramMatch){let l=I.$match.matchedInfo.get(n).get(t);if(a=a??(l==null?void 0:l.matchText),d.isNotNull(a)){let o=a.match(i.paramMatch),c={};if(o)for(let u=0;u<o.length;u++)c[`$${u}`]=o[u];s=Q.replaceParam(s,c);}}return s},getLinkStorageInst(n,r=0,t=false,e){return {accessCode:n,ruleIndex:r,isForceAccessCode:t,matchText:e}}},Bt={tianYiYunLoginTip:{PC:{width:"30vw",height:"280px"},Mobile:{width:"80vw",height:"250px"}},jianGuoYunLoginTip:{PC:{width:"350px",height:"200px"},Mobile:{width:"350px",height:"200px"}},settingView:{PC:{width:"800px",height:"600px"},Mobile:{width:"92vw",height:"80vh"}},setDefaultValueView:{PC:{width:"350px",height:"200px"},Mobile:{width:"350px",height:"200px"}},mainView:{PC:{width:"500px",height:"100%"},Mobile:{width:"88vw",height:"50vh"}},mainViewSmallWindow:{PC:{get width(){return y.smallWindow["netdisk-ui-small-window-width"].value+"px"},height:"auto"},Mobile:{get width(){return y.smallWindow["netdisk-ui-small-window-width"].value+"px"},height:"auto"}},oneFileStaticView:{PC:{width:"550px",height:"350px"},Mobile:{width:"88vw",height:"300px"}},moreFileStaticView:{PC:{width:"700px",height:"600px"},Mobile:{width:"88vw",height:"500px"}},inputNewAccessCodeView:{PC:{width:"400px",height:"200px"},Mobile:{width:"88vw",height:"160px"}},historyMatchView:{PC:{width:"50vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},customRulesView:{PC:{width:"50vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},customRuleDebugView:{PC:{width:"55vw",height:"70vh"},Mobile:{width:"88vw",height:"70vh"}},matchPasteTextView:{PC:{width:"50vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},accessCodeRuleView:{PC:{width:"50vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},accessCodeRuleEditView:{PC:{width:"44vw",height:"50vh"},Mobile:{width:"70vw",height:"45vh"}},websiteRuleView:{PC:{width:"45vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}},websiteEditRuleView:{PC:{width:"45vw",height:"65vh"},Mobile:{width:"88vw",height:"60vh"}}},Gt=function(n){window.location.hostname==="pan.baidu.com"&&window.location.pathname==="/share/init"&&window.location.search.startsWith("?surl=")&&(f.success("自动填写链接",n),d.waitNode("div.verify-form #accessCode").then(r=>{var t;if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),r.value=n.accessCode,d.dispatchEvent(r,"input"),(t=document.querySelector("div.verify-form #submitBtn"))==null||t.click();})),window.location.hostname==="pan.baidu.com"&&window.location.pathname==="/wap/init"&&window.location.search.startsWith("?surl=")&&(f.success("自动填写链接",n),d.waitNode("div.extractWrap div.extract-content div.extractInputWrap.extract input[type=text]").then(r=>{var t;if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),r.value=n.accessCode,d.dispatchEvent(r,"input"),(t=document.querySelector("div.extractWrap div.extract-content button.m-button"))==null||t.click();}));},Ht=function(n){window.location.hostname.match(/lanzou[a-z]{1}.com/gi)&&(f.success("自动填写链接",n),d.waitNode("#pwd").then(r=>{var t,e;if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),r.value=n.accessCode,d.dispatchEvent(r,"input"),(t=document.querySelector("#passwddiv div.passwddiv-input > div")||r.nextElementSibling)==null||t.click(),(e=document.querySelector("#sub"))==null||e.click();}),d.waitNode("#f_pwd").then(r=>{d.mutationObserver(r,{config:{attributes:true,attributeFilter:["style"]},callback:(t,e)=>{var i;let a=document.querySelector("#f_pwd #pwd");if(!d.isVisible(a)){f.error("输入框不可见，不输入密码");return}e.disconnect(),f.success("自动填充访问码并关闭观察者"),m.success("自动填充访问码"),a.value=n.accessCode,d.dispatchEvent(a,"input"),(i=document.querySelector("#f_pwd #sub"))==null||i.click();}});}));},jt=function(n){function r(t,e){let a=0,i=30,s=setInterval(()=>{if(a++,a>i){f.error("结束循环检查，退出。"),clearInterval(s);return}if(!d.isVisible(t)){f.warn(`第 ${a} 次：输入框不可见，不输入密码`);return}e(),clearInterval(s);},500);}window.location.hostname==="cloud.189.cn"&&(f.success("自动填写链接",n),d.waitNode("input#code_txt").then(t=>{r(t,()=>{m.success("自动填充访问码");let e=document.querySelector(".btn.btn-primary.visit");t.value=n.accessCode,t._value=n.accessCode,d.dispatchEvent(t,"input"),d.dispatchEvent(e,"click");});})),window.location.hostname==="h5.cloud.189.cn"&&(f.success("自动填写链接",n),d.waitNode("input.access-code-input").then(t=>{r(t,()=>{m.success("自动填充访问码"),t.value=n.accessCode,t._value=n.accessCode,d.dispatchEvent(t,"input"),d.dispatchEvent(document.querySelector("div.button"),"click");});}));},qt=function(n){window.location.hostname==="caiyun.139.com"&&(f.success("自动填写链接",n),d.waitNode("#token-input").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),r.value=n.accessCode,d.dispatchEvent(r,"input"),document.querySelector("#homepage div.token div.token-form a").click();}),d.waitNode("#app div.token-form input[type=text]").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),r.value=n.accessCode,d.dispatchEvent(r,"input"),document.querySelector("div.token-form a.btn-token").click();}));},Ue={async waitReactPropsToSet(n,r,t){if(!Array.isArray(t)){this.waitReactPropsToSet(n,r,[t]);return}function e(){let a=null;return typeof n=="string"?a=document.querySelector(n):typeof n=="function"?a=n():n instanceof HTMLElement&&(a=n),a}typeof n=="string"&&!await d.waitNode(n,1e4)||t.forEach(a=>{typeof a.msg=="string"&&f.info(a.msg);function i(){let s=e();if(s==null)return  false;let l=d.getReactObj(s);if(l==null)return  false;let o=l[r];return o==null?false:!!a.check(o)}d.waitPropertyByInterval(()=>e(),i,250,1e4).then(()=>{let s=e();if(s==null)return;let l=d.getReactObj(s);if(l==null)return;let o=l[r];o!=null&&a.set(o);});});}},Zt=function(n){(window.location.hostname==="www.aliyundrive.com"||window.location.hostname==="www.alipan.com")&&(f.success("自动填写链接",n),d.waitNode("#root input.ant-input").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),r.value=n.accessCode,Ue.waitReactPropsToSet(r,"reactFiber",{check(t){var e;return typeof((e=t==null?void 0:t.memoizedProps)==null?void 0:e.onChange)=="function"},set(t){t.memoizedProps.onChange({currentTarget:r,target:r});}}),document.querySelector('#root button[type="submit"]').click();}),d.waitNode("#root input[name=pwd]").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),r.value=n.accessCode,Ue.waitReactPropsToSet(r,"reactFiber",{check(t){var e;return typeof((e=t==null?void 0:t.memoizedProps)==null?void 0:e.onChange)=="function"},set(t){t.memoizedProps.onChange({currentTarget:r,target:r});}}),document.querySelector('#root button[type="submit"]').click();}));},Wt=function(n){window.location.hostname==="www.123pan.com"&&(f.success("自动填写链接",n),d.waitNode("#app .ca-fot input.ant-input[type=text]").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),Ue.waitReactPropsToSet(r,"reactProps",{check(e){return typeof(e==null?void 0:e.onChange)=="function"},set(e){e.onChange({target:{value:n.accessCode}});}});let t=r.nextSibling;t==null||t.click();}),d.waitNode("#app .appinput input.ant-input[type=text]").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),Ue.waitReactPropsToSet(r,"reactProps",{check(e){return typeof(e==null?void 0:e.onChange)=="function"},set(e){e.onChange({target:{value:n.accessCode}});}});let t=r.nextSibling;t==null||t.click();}));},Kt=function(n){window.location.hostname==="share.weiyun.com"&&(f.success("自动填写链接",n),d.waitNode("#app input.input-txt").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),r.value=n.accessCode,d.dispatchEvent(r,"input"),d.dispatchEvent(r,"change"),setTimeout(()=>{document.querySelector(".form-item button.btn-main").click();},500);}),d.waitNode(".input-wrap input.pw-input").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),r.value=n.accessCode,d.dispatchEvent(r,"input"),d.dispatchEvent(r,"change"),setTimeout(()=>{document.querySelector(".pw-btn-wrap button.btn").click();},500);}));},Yt=function(n){window.location.hostname==="pan.xunlei.com"&&(f.success("自动填写链接",n),d.waitNode("#__layout div.pass-input-wrap input.td-input__inner").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}f.error("输入框不可见，不输入密码"),r.value=n.accessCode,d.dispatchEvent(r,"input"),d.dispatchEvent(r,"change"),setTimeout(()=>{document.querySelector("#__layout div.pass-input-wrap button.td-button").click();},500);}),d.waitNode("#__layout div.pass-wrapper input.td-input__inner").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}f.error("输入框不可见，不输入密码"),r.value=n.accessCode,d.dispatchEvent(r,"input"),d.dispatchEvent(r,"change"),setTimeout(()=>{document.querySelector("#__layout div.pass-wrapper button.td-button").click();},500);}));},Jt=function(n){window.location.hostname==="pan.quark.cn"&&(f.success("自动填写链接",n),d.waitNode("#ice-container input.ant-input[class*=ShareReceive]").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),Ue.waitReactPropsToSet(r,"reactProps",{check(t){return (t==null?void 0:t.onChange)==="function"},set(t){t.onChange({target:{value:n.accessCode}});}}),Ue.waitReactPropsToSet(r,"reactEventHandlers",{check(t){return (t==null?void 0:t.onChange)==="function"},set(t){t.onChange({target:{value:n.accessCode}});}});}));},Xt=function(n){f.success("自动填写链接",n),d.waitNode("#passcode").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),r.value=n.accessCode,d.dispatchEvent(r,"input"),document.querySelector("#main-content .form-group button.btn[type=button]").click();});},Qt=function(n){window.location.hostname==="115.com"&&(f.success("自动填写链接",n),d.waitNode("input.text").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),r.value=n.accessCode,d.dispatchEvent(r,"input"),document.querySelector("#js-share_code div.form-decode div.submit a").click();}));},ea=function(n){window.location.hostname.endsWith(".link.yunpan.com")&&(f.success("自动填写链接",n),d.waitNode("#extract-bg-container input.pwd-input").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),r.value=n.accessCode,d.dispatchEvent(r,"input");let t=ot("#extract-bg-container input.submit-btn");t==null||t.click();}),d.waitNode("#extractForm input.pwd-input").then(r=>{if(!d.isVisible(r)){f.error("输入框不可见，不输入密码");return}m.success("自动填充访问码"),r.value=n.accessCode,d.dispatchEvent(r,"input");let t=ot("#extractForm input.submit-btn");t==null||t.click();}));},X={matchRange_text:{before(n,r=20){const t=L(z.matchRange_text.before(n),r);return parseInt(t.value.toString())},after(n,r=10){const t=L(z.matchRange_text.after(n),r);return parseInt(t.value.toString())}},matchRange_html:{before(n,r=100){const t=L(z.matchRange_html.before(n),r);return parseInt(t.value.toString())},after(n,r=15){const t=L(z.matchRange_html.after(n),r);return parseInt(t.value.toString())}},function:{enable(n,r=true){return !!L(z.function.enable(n),r).value},linkClickMode(n,r="copy"){return L(z.function.linkClickMode(n),r).value},checkLinkValidity(n,r=false){return !!L(z.function.checkLinkValidity(n),r).value},checkLinlValidityHoverTip(n,r=true){return !!L(z.function.checkLinkValidityHoverTip(n),r).value}},linkClickMode_openBlank:{openBlankAutoFilleAccessCode(n,r=true){return !!L(z.linkClickMode_openBlank.openBlankAutoFilleAccessCode(n),r).value},openBlankWithCopyAccessCode(n,r=false){return !!L(z.linkClickMode_openBlank.openBlankWithCopyAccessCode(n),r).value}},schemeUri:{enable(n,r=false){return !!L(z.schemeUri.enable(n),r).value},isForwardLinearChain(n,r=false){return !!L(z.schemeUri.isForwardLinearChain(n),r).value},isForwardBlankLink(n,r=false){return !!L(z.schemeUri.isForwardBlankLink(n),r).value},uri(n,r=""){return L(z.schemeUri.uri(n),r).value}}},Be={key:"tempNetDiskInfo",$data:{netDiskInfo:null,get enable(){return y.features.autoFillAccessCode.value}},init(){if(!this.$data.enable)return;this.$data.netDiskInfo=this.getValue();let n=false;for(let r=0;r<this.$data.netDiskInfo.length;r++){const t=this.$data.netDiskInfo[r];if(!X.linkClickMode_openBlank.openBlankAutoFilleAccessCode(t.ruleKeyName))continue;let a=t.accessCode;if(a==null||typeof a=="string"&&a.trim()==="")continue;let i=t.shareCode;if(t.ruleKeyName==="baidu"&&i.startsWith("1")&&(i=i.slice(1,i.length)),window.location.href.includes(i)){let l=Be.netDisk[t.ruleKeyName];typeof l=="function"?(f.success("成功匹配到对应的自动填充访问码的网盘信息：",t),l(t)):f.warn("自动填充访问码失败："+t.ruleKeyName+"，原因：该网盘未适配"),n=true;break}}n||f.error("未触发自动填充访问码，原因：未找到对应的网盘信息：👇",this.$data.netDiskInfo);},netDisk:{baidu:Gt,lanzou:Ht,tianyiyun:jt,hecaiyun:qt,aliyun:Zt,wenshushu:()=>{},nainiu:()=>{},_123pan:Wt,weiyun:Kt,xunlei:Yt,_115pan:Qt,chengtong:Xt,kuake:Jt,jianguoyun:()=>{},onedrive:()=>{},"360yunpan":ea},setValue(n){ie(this.key,n);},addValue(n){let r=n.accessCode;if(r==null||typeof r=="string"&&r.trim()==="")return;let t=this.getValue();t=t.filter(e=>!(e.ruleKeyName===n.ruleKeyName&&e.shareCode===n.shareCode)),t.push(n),this.setValue(t);},getValue(){let n=ee(this.key,[]);return Array.isArray(n)||(n=[n]),n=n.filter(r=>Date.now()-r.time<24*60*60*1e3),this.setValue(n),n}},ta=function(){},qe="(123pan|123865|123684|123652|123912).(com|cn)",St={rule:[{link_innerText:`${qe}/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)`,link_innerHTML:`${qe}/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)`,shareCode:new RegExp(`${qe}/s/([a-zA-Z0-9_-]{8,14})`,"gi"),shareCodeNeedRemoveStr:new RegExp(`${qe}/s/`,"gi"),checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"123pan.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://123pan.com/s/{#shareCode#}",copyUrl:`https://123pan.com/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"123盘",key:"_123pan",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:true,isForwardBlankLink:true,uri:""}}}},At={KEY:"_123pan_User_Authorization",set(n){ie(this.KEY,n);},get(){return ee(this.KEY)}},aa=function(){if(window.location.hostname!=="www.123pan.com"||X.function.linkClickMode(St.setting.key)!=="parseFile")return;let n=he.localStorage.getItem("authorToken");d.isNull(n)||(n=n.replace(/^\"/,"").replace(/\"$/,""),f.success("获取123网盘已登录用户的authorToken值👇"),f.success(n),At.set(n));},dt={init(){Object.keys(dt.netDisk).forEach(n=>{this.netDisk[n]();});},netDisk:{_123pan:aa,lanzouyx:ta}},j={protocol:"jumpwsv",pathname:"go",parseDataToSchemeUri(n,r){if(!this.isEnableForward(n))return r;let e=X.schemeUri.uri(n);return d.isNull(e)&&(e=this.getSchemeUri(this.get1DMSchemeUriOption(r))),e.startsWith(this.protocol)&&(r=r.replace(/&/g,"{-and-}"),r=r.replace(/#/g,"{-number-}")),e=Q.replaceParam(e,{intentData:r}),e},isEnableForward(n){return X.schemeUri.enable(n)},isForwardDownloadLink(n){return this.isEnableForward(n)&&X.schemeUri.isForwardLinearChain(n)},isForwardBlankLink(n){return this.isEnableForward(n)&&X.schemeUri.isForwardBlankLink(n)},getSchemeUri(n){return `${this.protocol}://${this.pathname}?${d.toSearchParamsStr(n)}`},get1DMSchemeUriOption(n=""){return {package:"idm.internet.download.manager.plus",activity:"idm.internet.download.manager.UrlHandlerDownloader",intentAction:"android.intent.action.VIEW",intentData:n,intentExtra:""}}};class xe{constructor(){G(this,"ruleIndex",0);G(this,"shareCode","");G(this,"accessCode","");}}class ra extends xe{constructor(){super(...arguments);G(this,"panelList",[]);G(this,"Authorization","");G(this,"code",{5113:"您今日下载流量已超出10GB限制，购买VIP会员即可体验无限流量下载",5103:"分享码错误或者分享地址错误",5104:"分享已过期","-1000":"获取出错","-2000":"请求异常","-3000":"请求意外中止","-4000":"请求超时",104:"文件已失效"});G(this,"Headers",{"user-agent":"123pan/v2.4.0(Android_7.1.2;Xiaomi)",platform:"android","app-version":"61","x-app-version":"2.4.0"});}async init(t,e,a){const i=this;if(f.info(t,e,a),i.ruleIndex=t,i.shareCode=e,i.accessCode=a,i.panelList=[],i.Authorization=At.get(),!await i.checkLinkValidity())return;let l=await i.getFiles();if(l)if(l.length===1&&l[0].Type==0){let o=l[0];if(o.Status==104){m.error("文件已失效");return}let c=o.DownloadUrl,u="";if(c===""){let g=await i.getFileDownloadInfo(o.Etag,o.FileId,o.S3KeyFlag,i.shareCode,o.Size);g&&g.code===0?(c=g.data.DownloadURL,j.isForwardDownloadLink("_123pan")&&(c=j.parseDataToSchemeUri("_123pan",c)),u=d.formatByteToSize(o.Size)):g&&g.code===401?(c="javascript:;",u="请登录后下载"):(c="javascript:;",u="获取下载链接失败");}else j.isForwardDownloadLink("_123pan")&&(c=j.parseDataToSchemeUri("_123pan",c)),u=d.formatByteToSize(o.Size);let p=new Date(o.CreateAt).getTime(),h=new Date(o.UpdateAt).getTime();p=d.formatTime(p),h=d.formatTime(h),x.staticView.oneFile({title:"123盘单文件直链",fileName:o.FileName,fileSize:u,downloadUrl:c,fileUploadTime:p,fileLatestTime:h});}else {m.info("正在递归文件");let o=m.loading("正在解析多文件中，请稍后..."),c=i.getFolderInfo(l,0);o.close(),f.info("递归完毕"),x.staticView.moreFile("123盘文件解析",c);}}async checkLinkValidity(){const t=this;m.info("正在校验链接有效性");let e=`https://www.123pan.com/s/${t.shareCode}`,a=await M.get({url:e,headers:{"User-Agent":d.getRandomPCUA(),Referer:"https://www.123pan.com"}});if(f.info(a),!a.status)return  false;let s=a.data.responseText.match(/window.g_initialProps[\s]*=[\s]*\{(.+?)\};/s);if(s){f.info(s);let l=d.toJSON(`{${s[s.length-1]}}`);if(f.info(l),l.res.code!==0)return m.error(l.res.message),false;if(l.res.data.HasPwd&&(t.accessCode==null||t.accessCode===""))m.error("密码缺失!"),x.newAccessCodeView("密码缺失","_123pan",t.ruleIndex,t.shareCode,t.accessCode,c=>{t.init(t.ruleIndex,t.shareCode,c.accessCode);});else return  true}else m.error("校验链接-获取初始化内容失败");}async getFiles(t=0){const e=this,a={limit:100,next:1,orderBy:"share_id",orderDirection:"desc",shareKey:e.shareCode,SharePwd:e.accessCode,ParentFileId:t,Page:1};let i=`https://www.123pan.com/b/api/share/get?${d.toSearchParamsStr(a)}`,s=await M.get({url:i,headers:{Accept:"*/*",Referer:`https://www.123pan.com/s/${e.shareCode}`,...e.Headers}});if(f.info(s),!s.status)return;let l=s.data,o=d.toJSON(l.responseText);if(o.code===0)return o.data.InfoList;o.code===5103?x.newAccessCodeView(void 0,"_123pan",e.ruleIndex,e.shareCode,e.accessCode,c=>{e.init(e.ruleIndex,e.shareCode,c.accessCode);}):e.code[o.code]?m.error(e.code[o.code]):"message"in o?m.error(o.message):m.error("123盘：未知的JSON格式");}async getFilesByRec(t){const e=this;let a=await M.get({url:`https://www.123pan.com/b/api/share/get?limit=100&next=1&orderBy=share_id&orderDirection=desc&shareKey=${e.shareCode}&SharePwd=${e.accessCode}&ParentFileId=${t}&Page=1`,headers:{Accept:"*/*",Referer:`https://www.123pan.com/s/${e.shareCode}`,...e.Headers}});if(!a.status)return;let i=a.data;f.info(i);let s=d.toJSON(i.responseText);if(s.code==0)return s.data.InfoList}getFolderInfo(t,e){const a=this;let i=[],s=[],l=[];return t.forEach(o=>{o.Type?s.push({fileName:o.FileName,fileSize:0,fileType:"",createTime:new Date(o.CreateAt).getTime(),latestTime:new Date(o.UpdateAt).getTime(),isFolder:true,index:e,async clickEvent(){let c=await a.getFilesByRec(o.FileId);return c?a.getFolderInfo(c,e+1):[]}}):l.push({fileName:o.FileName,fileSize:o.Size,fileType:"",createTime:new Date(o.CreateAt).getTime(),latestTime:new Date(o.UpdateAt).getTime(),isFolder:false,index:e,async clickEvent(){if(o.Status==104)m.error("文件已失效");else if(o.DownloadUrl){let c=o.DownloadUrl;return j.isForwardDownloadLink("_123pan")&&(c=j.parseDataToSchemeUri("_123pan",c)),{url:c,autoDownload:true,mode:"aBlank"}}else {let c=await a.getFileDownloadInfo(o.Etag,o.FileId,o.S3KeyFlag,a.shareCode,o.Size);if(c&&c.code===0)return {url:c.data.DownloadURL,autoDownload:true,mode:"aBlank"};c&&c.code===401?m.error("请登录后下载"):m.error((c==null?void 0:c.message)||"获取下载链接失败");}}});}),s.sort((o,c)=>o.fileName.localeCompare(c.fileName)),l.sort((o,c)=>o.fileName.localeCompare(c.fileName)),i=i.concat(s),i=i.concat(l),i}async getFileDownloadInfo(t,e,a,i,s){const l=this;let o=l.getFileDownloadAuth(),c={"Content-Type":"application/json;charset=UTF-8",Host:"www.123pan.com",Accept:"*/*",Referer:"https://www.123pan.com/s/"+i,Origin:"https://www.123pan.com",...l.Headers};l.Authorization&&Reflect.set(c,"Authorization","Bearer "+l.Authorization),f.success("获取下载链接加密参数："+o);let u=await M.post(`https://www.123pan.com/a/api/share/download/info?${o[0]}=${o[1]}`,{data:JSON.stringify({Etag:t,FileID:e,S3keyFlag:a,ShareKey:i,Size:s}),responseType:"json",headers:c});if(!u.status)return;let p=u.data,h=d.toJSON(p.responseText);return f.info(h),h.code==0?(h.data.DownloadURL=l.decodeDownloadUrl(h.data.DownloadURL),h):{code:h.code,message:h.message}}getFileDownloadAuth(){function t(i){var s,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8;if(arguments.length!==0){typeof i=="object"?s=i:((""+i).length===10&&(i=1e3*parseInt(i)),s=new Date(i));var o=i+6e4*new Date(i).getTimezoneOffset(),c=o+36e5*l;return s=new Date(c),{y:s.getFullYear(),m:s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1,d:s.getDate()<10?"0"+s.getDate():s.getDate(),h:s.getHours()<10?"0"+s.getHours():s.getHours(),f:s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes()}}}function e(i){for(var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,l=function(){for(var h,g=[],k=0;k<256;k++){h=k;for(var w=0;w<8;w++)h=1&h?3988292384^h>>>1:h>>>1;g[k]=h;}return g},o=l(),c=i,u=-1,p=0;p<c.length;p++)u=u>>>8^o[255&(u^c.charCodeAt(p))];return u=(-1^u)>>>0,u.toString(s)}function a(i){var s="web",l=3,o=Math.round((new Date().getTime()+60*new Date().getTimezoneOffset()*1e3+288e5)/1e3).toString(),c="a,d,e,f,g,h,l,m,y,i,j,n,o,p,k,q,r,s,t,u,b,c,v,w,s,z",u=Math.round(1e7*Math.random()),p,h,g,k,w,D,C,N,S;for(var T in p=c.split(","),h=t(o),g=h.y,k=h.m,w=h.d,D=h.h,C=h.f,N=[g,k,w,D,C].join(""),S=[],N)S.push(p[Number(N[T])]);var v,R;return v=e(S.join("")),R=e("".concat(o,"|").concat(u,"|").concat(i,"|").concat(s,"|").concat(l,"|").concat(v)),[v,"".concat(o,"-").concat(u,"-").concat(R)]}return a("/a/api/share/download/info")}decodeDownloadUrl(t){return t===""?"":t}}class na extends xe{constructor(){super(...arguments);G(this,"X_Share_Token_Data",{expire_time:"2000-01-01T00:00:00.000Z",expires_in:7200,share_token:""});G(this,"X_Device_Id",null);G(this,"X_Canary","client=web,app=share,version=v2.3.1");}async init(t,e,a){const i=this;if(f.info(t,e,a),i.ruleIndex=t,i.shareCode=e,i.accessCode=a,i.X_Device_Id=i.get_X_Device_Id(),f.info("生成X_Device_Id："+i.X_Device_Id),globalThis.location.hostname!=="www.aliyundrive.com"&&globalThis.location.hostname!=="www.alipan.com"){let c=re.getBlankUrl("aliyun",i.ruleIndex,i.shareCode,i.accessCode),u=m.error(`请在阿里云盘页面解析，<a href="${c}">点我前往</a>`,{html:true,timeout:1e4});b.on(u.$Qmsg.querySelector("a[href]"),"click",void 0,p=>{d.preventEvent(p),ke.openBlankUrl(c,"aliyun",i.ruleIndex,i.shareCode,i.accessCode);});return}let s=await this.list_by_share(e,"root");if(!s)return;m.info("正在解析链接");let l=m.loading("正在解析多文件中，请稍后..."),o=i.getFolderInfo(s,0);l.close(),f.info("解析完毕"),x.staticView.moreFile("阿里云盘文件解析",o);}getFolderInfo(t,e=0){const a=this;let i=[],s=[],l=[];return t.forEach(o=>{o.type!=="folder"?l.push({fileName:o.name,fileSize:o.size,fileType:o.file_extension,createTime:new Date(o.created_at).getTime(),latestTime:new Date(o.updated_at).getTime(),isFolder:false,index:e,async clickEvent(){let c=await a.get_share_link_download_url(o.share_id,o.file_id);if(!c)return;let u=c;return j.isForwardDownloadLink("aliyun")&&(u=j.parseDataToSchemeUri("aliyun",u)),{autoDownload:true,mode:"aBlank",url:u}}}):s.push({fileName:o.name,fileSize:0,fileType:"",createTime:o.created_at,latestTime:o.updated_at,isFolder:true,index:e,async clickEvent(){let c=await a.list_by_share(o.share_id,o.file_id);return c?a.getFolderInfo(c,e+1):[]}});}),s.sort((o,c)=>o.fileName.localeCompare(c.fileName)),l.sort((o,c)=>o.fileName.localeCompare(c.fileName)),i=i.concat(s),i=i.concat(l),f.info("getFilesInfoByRec",i),i}async list_by_share(t,e,a="name",i="DESC"){const s=this;let l=await M.post("https://api.aliyundrive.com/adrive/v2/file/list_by_share",{data:JSON.stringify({share_id:t,parent_file_id:e,limit:20,image_thumbnail_process:"image/resize,w_256/format,jpeg",image_url_process:"image/resize,w_1920/format,jpeg/interlace,1",video_thumbnail_process:"video/snapshot,t_1000,f_jpg,ar_auto,w_256",order_by:a,order_direction:i}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Origin:"https://www.aliyundrive.com",Referer:"https://www.aliyundrive.com/","X-Canary":s.X_Canary,"X-Device-Id":s.X_Device_Id,"X-Share-Token":await s.get_X_Share_Token(s.shareCode,s.accessCode),"User-Agent":d.getRandomPCUA()},allowInterceptConfig:false,onerror(){}});if(!l.status){s.handle_request_error(l);return}let o=d.toJSON(l.data.responseText);return f.info("列出文件列表：",o),o.items}async get_share_link_download_url(t,e){const a=this;let i=await M.post("https://api.aliyundrive.com/v2/file/get_share_link_download_url",{data:JSON.stringify({expire_sec:600,file_id:e,share_id:t}),headers:{Accept:"application/json, text/plain, */*",Origin:"https://www.aliyundrive.com",Referer:"https://www.aliyundrive.com/","Content-Type":"application/json;charset=UTF-8",Authorization:"Bearer "+a.getAuthorization(),"X-Share-Token":await a.get_X_Share_Token(a.shareCode,a.accessCode),"User-Agent":d.getRandomPCUA()},responseType:"arraybuffer",allowInterceptConfig:false,onerror(){}});if(!i.status){a.handle_request_error(i);return}let s=d.toJSON(i.data.responseText);return f.info("获取文件的下载链接：",s),s.download_url}handle_request_error(t){f.error(t);let e=d.toJSON(t.data.responseText);e.message==""?m.error(t.msg):m.error(e.message);}getAuthorization(){let t=he.localStorage.getItem("token");if(d.isNotNull(t)&&t!=null){let a=d.toJSON(t).access_token;return f.success("获取阿里云盘的access_token：",a),a}else f.error("获取access_token失败，请先登录账号！"),m.error("获取access_token失败，请先登录账号！");}async get_X_Share_Token(t,e){const a=this;if(new Date<new Date(a.X_Share_Token_Data.expire_time))return a.X_Share_Token_Data.share_token;let i=await M.post("https://api.aliyundrive.com/v2/share_link/get_share_token",{data:JSON.stringify({share_id:t,share_pwd:e}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Origin:"https://www.aliyundrive.com",Referer:"https://www.aliyundrive.com/","X-Canary":a.X_Canary,"X-Device-Id":a.X_Device_Id,"User-Agent":d.getRandomPCUA()},allowInterceptConfig:false,onerror(){}});if(!i.status){a.handle_request_error(i);return}let s=d.toJSON(i.data.responseText);return a.X_Share_Token_Data=s,f.info("获取share_token：",a.X_Share_Token_Data),a.X_Share_Token_Data.share_token}get_X_Device_Id(){for(var t=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,e=[],a=0;a<256;++a)e.push((a+256).toString(16).substr(1));function i(){return crypto.getRandomValues(new Uint8Array(16))}var s=function(o){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,u=(e[o[c+0]]+e[o[c+1]]+e[o[c+2]]+e[o[c+3]]+"-"+e[o[c+4]]+e[o[c+5]]+"-"+e[o[c+6]]+e[o[c+7]]+"-"+e[o[c+8]]+e[o[c+9]]+"-"+e[o[c+10]]+e[o[c+11]]+e[o[c+12]]+e[o[c+13]]+e[o[c+14]]+e[o[c+15]]).toLowerCase();if(!function(p){return typeof p=="string"&&t.test(p)}(u))throw TypeError("Stringified UUID is invalid");return u},l=function(o,c,u){var p=(o=o||{}).random||(o.rng||i)();return p[6]=15&p[6]|64,p[8]=63&p[8]|128,s(p)};return l()}}class ia extends xe{init(r,t,e){f.info(r,t,e),this.ruleIndex=r,this.shareCode=t,this.accessCode=e;let a=ee("baidu-baiduwp-php-url"),i=ee("baidu-baiduwp-php-post-form"),s=ee("baidu-baiduwp-php-copy-url");if(!a){m.error("请先在设置中配置百度网盘-网址");return}if(!i){m.error("请先在设置中配置百度网盘-表单参数");return}i=Q.replaceParam(i,{shareCode:t,accessCode:e});let l=document.createElement("form"),o={},c=new URLSearchParams(i);l.action=a,l.method="post",l.style.display="none",l.target="_blank";for(let[u,p]of c){let h=document.createElement("textarea");h.name=u,h.value=p,l.appendChild(h),o[u]=p;}f.info("表单数据",o),document.body.appendChild(l),f.info("访问网址",a),s?(ke.copy("baidu",r,t,e,"1.5秒后跳转至解析站"),setTimeout(()=>{l.submit();},1500)):l.submit();}}const mt=`.pops[type-value="alert"]\r
	.pops-alert-title:has(+ .pops-alert-content .netdisk-url-box-all:empty) {\r
	border-bottom: none;\r
}\r
.netdisk-url-box {\r
	border-bottom: 1px solid #e4e6eb;\r
}\r
.netdisk-url-div {\r
	display: flex;\r
	align-items: center;\r
	width: 100%;\r
	padding: 5px 0px 5px 0px;\r
}\r
.netdisk-icon {\r
	display: contents;\r
}\r
.netdisk-icon .netdisk-icon-img {\r
	cursor: pointer;\r
	width: 28px;\r
	height: 28px;\r
	min-width: 28px;\r
	min-height: 28px;\r
	font-size: 0.8em;\r
	margin: 0px 10px;\r
}\r
.netdisk-url-div .netdisk-icon,\r
.netdisk-url-div .netdisk-status {\r
	flex: 0 0 auto;\r
}\r
.netdisk-url-div .netdisk-url {\r
	flex: 1;\r
}\r
.netdisk-icon .netdisk-icon-img {\r
	border-radius: 10px;\r
	box-shadow: 0 0.3px 0.6px rgb(0 0 0 / 6%), 0 0.7px 1.3px rgb(0 0 0 / 8%),\r
		0 1.3px 2.5px rgb(0 0 0 / 10%), 0 2.2px 4.5px rgb(0 0 0 / 12%),\r
		0 4.2px 8.4px rgb(0 0 0 / 14%), 0 10px 20px rgb(0 0 0 / 20%);\r
}\r
.netdisk-status[data-check-failed] {\r
	padding: 5px 5px;\r
}\r
.netdisk-url {\r
	padding: 5px 5px;\r
}\r
.netdisk-url a {\r
	color: #ff4848 !important;\r
	min-height: 28px;\r
	overflow-x: hidden;\r
	overflow-y: auto;\r
	font-size: 0.8em;\r
	border: none;\r
	display: flex;\r
	align-items: center;\r
	width: 100%;\r
	height: 100%;\r
	padding: 0px;\r
	word-break: break-word;\r
	text-align: left;\r
}\r
.netdisk-status {\r
	display: none;\r
}\r
.netdisk-status[data-check-valid] {\r
	display: flex;\r
	align-items: center;\r
	width: 15px;\r
	height: 15px;\r
}\r
\r
.netdisk-status[data-check-valid="failed"] {\r
	color: red;\r
}\r
\r
.netdisk-status[data-check-valid="partial-violation"] {\r
	color: orange;\r
}\r
\r
.netdisk-status[data-check-valid="error"] {\r
	cursor: pointer;\r
}\r
\r
.netdisk-status[data-check-valid="success"] {\r
	color: green;\r
}\r
\r
.netdisk-status[data-check-valid="verify"] {\r
	color: #faad14;\r
}\r
\r
.netdisk-status[data-check-valid="loading"] svg {\r
	animation: rotating 2s linear infinite;\r
}\r
\r
.netdisk-url-box:has(.netdisk-status[data-check-valid="failed"]) {\r
	text-decoration: line-through;\r
}\r
\r
.whitesevPop-whitesevPopSetting :focus-visible {\r
	outline-offset: 0;\r
	outline: 0;\r
}\r
.netdisk-url a[isvisited="true"] {\r
	color: #8b8888 !important;\r
}\r
.netdisk-url a:active {\r
	box-shadow: 0 0 0 1px #616161 inset;\r
}\r
.netdisk-url a:focus-visible {\r
	outline: 0;\r
}\r
.whitesevPop-content p[pop] {\r
	text-indent: 0;\r
}\r
.whitesevPop-button[type="primary"] {\r
	border-color: #2d8cf0;\r
	background-color: #2d8cf0;\r
}\r
`,_e=function(n,r){return {KEY:n,default:r,get value(){return ee(n,r)},set value(t){ie(n,t);}}},de={show(){x.Alias.uiLinkAlias==null?(this.createView(),this.initViewEvent()):x.Alias.uiLinkAlias.show();},createView(){const n={view:{"netdisl-small-window-shrink-status":_e("netdisl-small-window-shrink-status",false),"netdisk-ui-small-window-position":_e("netdisk-ui-small-window-position",null)}},r='<div class="netdisk-url-box-all"></div>';if(y.features["netdisk-behavior-mode"].value.toLowerCase().includes("smallwindow")){x.Alias.uiLinkAlias=P.alert({title:{text:"网盘",position:"center"},content:{text:r,html:true},btn:{ok:{enable:false},close:{callback(s){y.features["netdisk-behavior-mode"].value.toLowerCase().includes("suspension")?(ce.mode.current_suspension_smallwindow_mode.value="suspension",s.hide(),x.suspension.show()):(x.Alias.uiLinkAlias=void 0,s.close());}}},mask:{enable:false},animation:"",beforeAppendToPageCallBack(s,l){let o=s.querySelector(".pops-header-control"),c=s.querySelector(".pops-alert-title"),u=s.querySelector(".pops-alert-content"),p=b.createElement("button",{className:"pops-header-control",innerHTML:`
                                <i class="pops-icon">
                                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                                    <path fill="currentColor" d="M290.816 774.144h167.936c12.288 0 20.48 8.192 20.48 20.48s-8.192 20.48-20.48 20.48h-219.136c-12.288 0-20.48-8.192-20.48-20.48v-2.048-206.848c0-12.288 8.192-20.48 20.48-20.48s20.48 8.192 20.48 20.48v163.84l210.944-198.656c8.192-8.192 20.48-8.192 28.672 0s8.192 20.48 0 28.672l-208.896 194.56z m462.848-524.288h-167.936c-12.288 0-20.48-8.192-20.48-20.48s8.192-20.48 20.48-20.48h219.136c12.288 0 20.48 8.192 20.48 20.48v208.896c0 12.288-8.192 20.48-20.48 20.48s-20.48-8.192-20.48-20.48v-163.84l-210.944 198.656c-8.192 8.192-20.48 8.192-28.672 0s-8.192-20.48 0-28.672l208.896-194.56z m188.416 323.584c0 12.288-8.192 20.48-20.48 20.48s-20.48-8.192-20.48-20.48v-389.12c0-34.816-26.624-61.44-61.44-61.44h-655.36c-34.816 0-61.44 26.624-61.44 61.44v655.36c0 34.816 26.624 61.44 61.44 61.44h655.36c34.816 0 61.44-26.624 61.44-61.44v-94.208c0-12.288 8.192-20.48 20.48-20.48s20.48 8.192 20.48 20.48v94.208c0 57.344-45.056 102.4-102.4 102.4h-655.36c-57.344 0-102.4-45.056-102.4-102.4v-655.36c0-57.344 45.056-102.4 102.4-102.4h655.36c57.344 0 102.4 45.056 102.4 102.4v389.12z">
                                    </path>
                                </svg>
                                </i>
                                `},{type:"launch","data-header":true}),h=b.createElement("button",{className:"pops-header-control",innerHTML:`
                                <i class="pops-icon">
                                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                                    <path fill="currentColor" d="M618.496 425.984h167.936c12.288 0 20.48 8.192 20.48 20.48s-8.192 20.48-20.48 20.48h-219.136c-12.288 0-20.48-8.192-20.48-20.48v-2.048-206.848c0-12.288 8.192-20.48 20.48-20.48s20.48 8.192 20.48 20.48v163.84l210.944-198.656c8.192-8.192 20.48-8.192 28.672 0s8.192 20.48 0 28.672l-208.896 194.56z m-192.512 172.032h-167.936c-12.288 0-20.48-8.192-20.48-20.48s8.192-20.48 20.48-20.48h219.136c12.288 0 20.48 8.192 20.48 20.48v208.896c0 12.288-8.192 20.48-20.48 20.48s-20.48-8.192-20.48-20.48v-163.84l-210.944 198.656c-8.192 8.192-20.48 8.192-28.672 0s-8.192-20.48 0-28.672l208.896-194.56z m516.096-24.576c0 12.288-8.192 20.48-20.48 20.48s-20.48-8.192-20.48-20.48v-389.12c0-34.816-26.624-61.44-61.44-61.44h-655.36c-34.816 0-61.44 26.624-61.44 61.44v655.36c0 34.816 26.624 61.44 61.44 61.44h655.36c34.816 0 61.44-26.624 61.44-61.44v-94.208c0-12.288 8.192-20.48 20.48-20.48s20.48 8.192 20.48 20.48v94.208c0 57.344-45.056 102.4-102.4 102.4h-655.36c-57.344 0-102.4-45.056-102.4-102.4v-655.36c0-57.344 45.056-102.4 102.4-102.4h655.36c57.344 0 102.4 45.056 102.4 102.4v389.12z">
                                    </path>
                                </svg>
                                </i>
                                `},{type:"shrink","data-header":true});b.before(o,p),b.before(o,h),b.on(p,"click",void 0,function(){b.addClass(p,"pops-hide-important"),b.removeClass(h,"pops-hide-important"),b.removeClass(c,"pops-no-border-important"),b.removeClass(u,"pops-hide-important"),n.view["netdisl-small-window-shrink-status"].value=false;},{capture:true}),b.on(h,"click",void 0,function(){b.removeClass(p,"pops-hide-important"),b.addClass(h,"pops-hide-important"),b.addClass(c,"pops-no-border-important"),b.addClass(u,"pops-hide-important"),n.view["netdisl-small-window-shrink-status"].value=true;},{capture:true}),n.view["netdisl-small-window-shrink-status"].value?h.click():p.click();},dragMoveCallBack(s,l,o){n.view["netdisk-ui-small-window-position"].value={left:l,top:o};},class:"whitesevPop",style:`
                    ${mt}

                    .pops {
                        --container-title-height: 35px;
                        --content-max-height: ${y.smallWindow["netdisk-ui-small-window-max-height"].value}px;
                        --netdisk-line-space: 8px;
                        --netdisk-icon-size: 24px;
                    }
                    .pops[type-value="alert"]{
                        transform: none;
                    }
                    .pops {
                        max-height: var(--content-max-height);
                    }
                    .pops[type-value=alert] .pops-alert-content{
                        max-height: calc(var(--content-max-height) - var(--container-title-height) - var(--container-bottom-btn-height));
                    }
                    .pops-header-controls button.pops-header-control[type][data-header]{
                        padding: 0px 5px;
                    }
                    .netdisk-url-div{
                        padding: 0px;
                    }
                    .netdisk-icon .netdisk-icon-img{
                        width: var(--netdisk-icon-size);
                        height: var(--netdisk-icon-size);
                        min-width: var(--netdisk-icon-size);
                        min-height: var(--netdisk-icon-size);
                        margin: 0px var(--netdisk-line-space);
                    }
                    .netdisk-status{
                        margin-right: var(--netdisk-line-space);
                    }
                    .netdisk-url{
                        padding: 2px 0px;
                    }
                    `},x.popsStyle.mainViewSmallWindow);let a=n.view["netdisk-ui-small-window-position"].value,i=x.Alias.uiLinkAlias.popsElement;if(a){let s=b.width(i,true),l=b.height(i,true),o=b.width(window),c=b.height(window);const{transformLeft:u,transformTop:p}=b.getTransform(i);let h=o-s+u,g=c-l+p,k=0+u,w=0+p;a.top>g?a.top=g:a.top<w&&(a.top=w),a.left>h?a.left=h:a.left<k&&(a.left=k),i.style.transitionDuration="0s",i.style.left=a.left+"px",i.style.top=a.top+"px",setTimeout(()=>{i.style.transitionDuration="0s";},300);}}else x.Alias.uiLinkAlias=P.alert({title:{text:"网盘",position:"center"},content:{text:r,html:true},btn:{ok:{enable:false},close:{callback(a){x.Alias.uiLinkAlias=void 0,a.close();}}},mask:{clickCallBack(a){a(),x.Alias.uiLinkAlias=void 0;}},class:"whitesevPop",style:`
                    ${mt}

                    .pops {
                        max-height: 60vh;
                    }
					@media screen and (max-width: 600px) {
						.pops {
                       		max-height: 50vh;
                    	}
					}
                    `},x.popsStyle.mainView);let t=x.Alias.uiLinkAlias.$shadowRoot.querySelector(".netdisk-url-box-all");x.isMatchedNetDiskIconMap.forEach(a=>{let i=I.$match.matchedInfo.get(a),s=document.createDocumentFragment();i.forEach((l,o)=>{let c=I.handleLinkShow(a,l.ruleIndex,o,l.accessCode,l.matchText),u=this.createViewBoxElementInfo(x.src.icon[a],a,l.ruleIndex,o,l.accessCode,c);s.appendChild(u.$viewBox);}),t.appendChild(s);});let e=y.smallWindow["netdisk-link-view-z-index"].value;e>0&&b.css(x.Alias.uiLinkAlias.popsElement,{"z-index":e}),x.Alias.uiLinkAlias.popsElement.querySelectorAll(".netdisk-url-box-all .netdisk-url-box").forEach(a=>{let i=a.querySelector(".netdisk-link").getAttribute("data-rule-key"),s=parseInt(a.querySelector(".netdisk-link").getAttribute("data-rule-index")),l=a.querySelector(".netdisk-link").getAttribute("data-sharecode"),o=a.querySelector(".netdisk-link").getAttribute("data-accesscode");A.check(a,i,s,l,o);});},initViewEvent(){x.setRightClickMenu(x.Alias.uiLinkAlias.$shadowRoot,".whitesevPop .netdisk-url a"),this.registerIconGotoPagePosition(x.Alias.uiLinkAlias.$shadowRoot),this.setNetDiskUrlClickEvent(x.Alias.uiLinkAlias.$shadowRoot,".netdisk-url a"),x.setGlobalRightClickMenu(x.Alias.uiLinkAlias.$shadowRoot.querySelector(".pops .pops-alert-title > p"));},createElementAttributeRuleInfoJSON(n){return {"data-rule-key":n.ruleKeyName,"data-rule-index":n.ruleIndex,"data-sharecode":n.shareCode,"data-accesscode":n.accessCode}},handleElementAttributeRuleInfo(n,r){let t=this.createElementAttributeRuleInfoJSON(n);for(const e in t){const a=t[e];Array.isArray(r)?r.forEach(i=>{i.setAttribute(e,a.toString());}):r.setAttribute(e,a.toString());}},praseElementAttributeRuleInfo(n){let r={ruleKeyName:n.getAttribute("data-rule-key"),ruleIndex:parseInt(n.getAttribute("data-rule-index")),shareCode:n.getAttribute("data-sharecode"),accessCode:n.getAttribute("data-accesscode")};return isNaN(r.ruleIndex)&&(f.warn("元素上的 ruleIndex 的值是NaN，调整为默认值0",n),r.ruleIndex=0),r},createViewBoxElementInfo(n,r,t,e,a,i){let s=b.createElement("div",{className:"netdisk-url-box",innerHTML:`
			<div class="netdisk-url-div">
                <div class="netdisk-icon">
                    <div class="netdisk-icon-img">
                    </div>
                </div>
                <div class="netdisk-status">

                </div>
                <div class="netdisk-url">
                    <a  class="netdisk-link" href="javascript:;" isvisited="false"></a>
                </div>
            </div>
			`});const{$urlDiv:l,$icon:o,$iconImg:c,$checkValidStatus:u,$url:p,$link:h}=this.parseViewBoxElementInfo(s);return c.style.cssText=`background: url(${n}) no-repeat;background-size: 100%;`,b.html(h,i),this.handleElementAttributeRuleInfo({ruleKeyName:r,ruleIndex:t,shareCode:e,accessCode:a},[c,h]),I.$rule.rule.forEach(g=>{g.setting.key===r&&typeof g.afterRenderUrlBox=="function"&&g.afterRenderUrlBox({$viewBox:s,$urlDiv:l,$url:p,$link:h,ruleKeyName:r,ruleIndex:t,shareCode:e,accessCode:a});}),{$viewBox:s,$urlDiv:l,$icon:o,$iconImg:c,$checkValidStatus:u,$url:p,$link:h}},parseViewBoxElementInfo(n){let r=n.matches(".netdisk-url-box")?n:n.closest(".netdisk-url-box"),t=r.querySelector(".netdisk-url-div"),e=r.querySelector(".netdisk-icon"),a=r.querySelector(".netdisk-icon-img"),i=r.querySelector(".netdisk-status"),s=r.querySelector(".netdisk-url"),l=r.querySelector(".netdisk-link");return {$urlBox:r,$urlDiv:t,$icon:e,$iconImg:a,$checkValidStatus:i,$url:s,$link:l}},setNetDiskUrlClickEvent(n,r){b.on(n,"click",r,t=>{let e=t.target;e.setAttribute("isvisited","true");const a=de.praseElementAttributeRuleInfo(e);t.ctrlKey?this.netDiskUrlClickEvent({data:a,clickMode:"openBlank",$click:e}):this.netDiskUrlClickEvent({data:a,$click:e});}),b.on(n,"auxclick",r,(t,e)=>{if(t.button!==1)return;d.preventEvent(t),e.setAttribute("isvisited","true");const a=de.praseElementAttributeRuleInfo(e);let i=re.getBlankUrl(a.ruleKeyName,a.ruleIndex,a.shareCode,a.accessCode);ke.openBlankUrl(i,a.ruleKeyName,a.ruleIndex,a.shareCode,a.accessCode,true);});},netDiskUrlClickEvent(n){const{ruleKeyName:r,ruleIndex:t,shareCode:e,accessCode:a}=n.data;let i=n.clickMode??X.function.linkClickMode(n.data.ruleKeyName),s=()=>{if(n.$click){let l=n.$click.closest(".pops");if(l){let o=l.querySelector('.pops-header-control[type="close"]');o&&o.click();}}};if(i==="copy"||i==="copy-closePopup")ke.copy(r,t,e,a),i==="copy-closePopup"&&s();else if(i==="openBlank"||i==="openBlank-closePopup"){let l=re.getBlankUrl(r,t,e,a);j.isForwardBlankLink(r)?ke.openBlankWithScheme(r,t,e,a):ke.openBlankUrl(l,r,t,e,a),i==="openBlank-closePopup"&&s();}else i==="parseFile"||i==="parseFile-closePopup"?ke.parseFile(r,t,e,a).then(()=>{i==="parseFile-closePopup"&&s();}):(f.error("未知点击动作："+i),m.error("未知点击动作："+i));},registerContextMenu(n,r,t=[],e="whitesevSuspensionContextMenu"){let a=[];t.forEach(s=>{a.push({icon:"",iconIsLoading:false,text:s.text,callback:s.callback});});let i={target:n,targetSelector:r,data:a,isAnimation:false,className:e,only:true};P.rightClickMenu(i);},addLinkView(n,r,t,e,a){if(x.netDiskHistoryMatch.changeMatchedData(n,r,t,e,a),!x.Alias.uiLinkAlias)return;f.info(n,r,t,e);let i=x.src.icon[n],s=I.handleLinkShow(n,r,t,e,a),l=this.createViewBoxElementInfo(i,n,r,t,e,s),o=x.Alias.uiLinkAlias.$shadowRoot.querySelector(".netdisk-url-box-all");b.append(o,l.$viewBox);let c=o.children[o.children.length-1];A.check(c,n,r,t,e);},changeLinkView(n,r,t,e,a){if(x.netDiskHistoryMatch.changeMatchedData(n,r,t,e,a),!x.Alias.uiLinkAlias)return;let i=I.handleLinkShow(n,r,t,e,a),s=x.Alias.uiLinkAlias.popsElement.querySelector(`.netdisk-url a[data-sharecode='${t}'][data-rule-index='${r}']`);f.info("修改网盘链接视图"),f.info(s),s.setAttribute("data-accesscode",e),b.html(s,i);},registerIconGotoPagePosition(n){let r,t,e;b.on(n,"click",".whitesevPop .netdisk-icon .netdisk-icon-img",function(a){let s=a.target.getAttribute("data-sharecode");if(y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode"].value){if(typeof s!="string"){m.error("获取data-sharecode属性失败");return}if(e==null?e=s:e!==s&&(f.info(`上一个搜索：${e}，切换至：${s}`),r=void 0,t=void 0,e=s),r==null&&(r=d.findElementsWithText(document.documentElement,s),t=r.next()),t!=null&&t.value)if(f.success("定位元素",t),t.value.nodeType===Node.ELEMENT_NODE&&t.value.getClientRects().length){if(t.value.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode-with-select"].value){let l=t.value.innerText||t.value.textContent,o,c,u;if(l.includes(s)){let p=Array.from(t.value.childNodes).filter(h=>h.nodeType===Node.TEXT_NODE);for(const h of p)if(h.textContent.includes(s)){o=h,c=h.textContent.indexOf(s),u=c+s.length;break}}try{d.selectElementText(t.value,o,c,u);}catch(p){f.error(p),d.selectElementText(t.value);}}}else if(t.value.nodeType===Node.TEXT_NODE&&t.value.parentElement.getClientRects().length)if(y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode-with-select"].value){let l=t.value.textContent||t.value.nodeValue,o=t.value,c=l.indexOf(s),u=c+s.length;try{d.selectElementText(t.value,o,c,u);}catch(h){f.error(h),d.selectElementText(t.value.parentElement);}let p=globalThis.getSelection();if(p.rangeCount>0){let g=p.getRangeAt(0).getBoundingClientRect(),k=globalThis.scrollY,w=g.top+k-globalThis.innerHeight/2;globalThis.scrollTo({behavior:"smooth",top:w});}else t.value.parentElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"});}else try{let l=new Range;l.selectNodeContents(t.value);let o=l.getBoundingClientRect(),c=globalThis.scrollY,u=o.top+c-globalThis.innerHeight/2;globalThis.scrollTo({behavior:"smooth",top:u});}catch(l){f.error(l),t.value.parentElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"});}else f.error("无法定位该元素位置",t.value),m.error(`无法定位该元素位置，类型：<${(t.value.nodeName||t.value.localName||t.value.tagName).toLowerCase()}>`,{html:false});if(t=r.next(),t.done){if(!y.smallIconNavgiator["pops-netdisk-icon-click-event-loop-find-sharecode"].value){m.info("已经定位至最后一个元素了");return}r=void 0,t=void 0;}}});}};class sa extends xe{init(r,t,e){let a="chengtong";if(r!==3){f.warn("解析站暂时只支持单文件解析，非单文件链接的点击动作为新标签页打开"),de.netDiskUrlClickEvent({data:{ruleKeyName:a,ruleIndex:r,shareCode:t,accessCode:e},clickMode:"openBlank"});return}let i=ee("chengtong-parse-file-api-host");if(d.isNull(i)){m.error("请先配置文件解析接口地址");return}i.endsWith("/")||(i+="/");let s=i+"?file="+t;d.isNotNull(e)&&(s+="&pass="+e),window.open(s,"_blank");}}class oa extends xe{constructor(){super(...arguments);G(this,"errorCode",{UnAuthorized:"请先登录坚果云账号"});}async init(t,e,a){const i=this;f.info(t,e,a),i.ruleIndex=t,i.shareCode=e,i.accessCode=a;let s=await i.getRequestDownloadParams();if(s)if(s.isdir){let l=m.loading("正在遍历多文件信息..."),o=await i.getFolderInfo(s.hash);if(!o){l.close();return}let c=i.parseMoreFile(o,s.hash,s.name);l.close(),x.staticView.moreFile("坚果云文件解析",c);}else {let l=d.formatByteToSize(s.size),o=await i.getFileLink(s.hash,s.name);if(!o)return;j.isForwardDownloadLink("jianguoyun")&&(o=j.parseDataToSchemeUri("jianguoyun",o)),f.info(o),x.staticView.oneFile({title:"坚果云盘单文件直链",fileName:s.name,fileSize:l,downloadUrl:o});}}parseMoreFile(t,e="",a=""){const i=this;f.info("解析多文件信息",t);let s=[];return t.forEach(l=>{let o=l.relPath;o.startsWith("/")&&(o=o.replace(/^\//,"")),s.push({fileName:o,fileSize:l.size,fileType:"",createTime:l.mtime,latestTime:l.mtime,isFolder:false,index:0,async clickEvent(){m.info("正在获取下载链接...");let c=await i.getDirLink(e,o,l.relPath);if(c)return m.success("获取成功！"),j.isForwardDownloadLink("jianguoyun")&&(c=j.parseDataToSchemeUri("jianguoyun",c)),f.info(c),{autoDownload:true,mode:"aBlank",url:c}}});}),s}async getRequestDownloadParams(){const t=this;f.info("获取hash值"),m.info("正在获取请求信息");let e=/var[\s]*PageInfo[\s]*=[\s]*{([\s\S]+)};/i;new FormData().append("pd",t.accessCode);let i={url:`https://www.jianguoyun.com/p/${t.shareCode}`,data:t.accessCode===""?void 0:`pd=${t.accessCode}`,responseType:"html",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Agent":d.getRandomPCUA(),Referer:`https://www.jianguoyun.com/p/${t.shareCode}`}},s;if(t.accessCode===""?s=await M.get(i):s=await M.post(i),!s.status)return;let l=s.data;f.info("请求信息"),f.info(l);let o=l.responseText.match(e);if(o){let c=o[o.length-1];c=`({${c}})`,c=window.eval(c),f.info(c);let u=c.name,p=c.size,h=c.hash,g=c.needsPassword,k=c.owner,w=c.isdir,D=c.errorCode;if(u=decodeURIComponent(u),f.success("是否是文件夹 ===> "+w),f.success("hash ===> "+h),f.success("name ===> "+u),f.success("size ===> "+p),g&&(t.accessCode==null||t.accessCode==="")){m.error("密码不正确!"),x.newAccessCodeView("密码缺失","jianguoyun",t.ruleIndex,t.shareCode,t.accessCode,C=>{t.init(t.ruleIndex,t.shareCode,C.accessCode);});return}if(D==="AuthenticationFailed"){m.error("密码错误"),x.newAccessCodeView(void 0,"jianguoyun",t.ruleIndex,t.shareCode,t.accessCode,C=>{t.init(t.ruleIndex,t.shareCode,C.accessCode);});return}if(h===""||h==null){f.error("hash为空，可能文件被撤销分享了"),m.error("文件分享已被撤销");return}if(p==null&&w==false){f.error("无size，可能文件被删除了"),m.error(`“${u}”文件已被拥有者（“${k}”）删除`);return}else return {name:u,hash:h,size:p,needsPassword:g,owner:k,isdir:w}}else l.responseText.match("对不起，找不到您指定的文件。")?(f.error("啊噢！ (404) 对不起，找不到您指定的文件。"),m.error("坚果云: 对不起，找不到您指定的文件。")):l.responseText.match("对不起，您的某些输入不正确。")?(f.error("可能该链接不需要访问码或者访问码有问题"),x.newAccessCodeView(void 0,"jianguoyun",t.ruleIndex,t.shareCode,t.accessCode,c=>{t.init(t.ruleIndex,t.shareCode,c.accessCode);})):(f.error("获取PageInfo失败"),m.error("坚果云: 获取PageInfo失败"));}async getFileLink(t="",e=""){var o;const a=this;e=encodeURIComponent(e);let i=await M.get({url:`https://www.jianguoyun.com/d/ajax/fileops/pubFileLink?k=${t}&name=${e}&wm=false${a.accessCode===""?"":"&pd="+a.accessCode}&forwin=1&_=${new Date().getTime()}`,responseType:"json",headers:{"User-Agent":d.getRandomPCUA()},allowInterceptConfig:false,onerror:function(){}});if(!i.status){if(d.isNotNull((o=i.data)==null?void 0:o.responseText)){let c=d.toJSON(i.data.responseText);f.error("坚果云",c),c.errorCode==="UnAuthorized"?a.gotoLogin():m.error(c.detailMsg);}else m.error("请求异常");return}let s=i.data;f.info("请求信息",s);let l=d.toJSON(s.responseText);if(f.info("解析JSON",l),l.hasOwnProperty("errorCode")){m.error("坚果云: "+l.detailMsg);return}else {if(l.hasOwnProperty("url"))return l.url;m.error("坚果云: 处理下载链接异常");}}async getDirLink(t="",e="",a="/"){var c;const i=this;e=encodeURIComponent(e);let s=await M.get({url:`https://www.jianguoyun.com/d/ajax/dirops/pubDIRLink?k=${t}&dn=${e}&p=${a}&forwin=1&_=${new Date().getTime()}`,responseType:"json",headers:{"User-Agent":d.getRandomPCUA()},allowInterceptConfig:false,onerror:function(){}});if(!s.status){if(d.isNotNull((c=s.data)==null?void 0:c.responseText)){let u=d.toJSON(s.data.responseText);f.error("坚果云",u),u.errorCode==="UnAuthorized"?i.gotoLogin():m.error(u.detailMsg);}else m.error("请求异常");return}let l=s.data;f.info("请求信息",l);let o=d.toJSON(l.responseText);if(f.info(o),o.hasOwnProperty("errorCode")){m.error("坚果云: "+o.detailMsg);return}else {if(o.hasOwnProperty("url"))return o.url;m.error("坚果云: 处理下载链接异常");}}async getFolderInfo(t=""){let e=await M.get({url:`https://www.jianguoyun.com/d/ajax/dirops/pubDIRBrowse?hash=${t}&relPath=%2F&_=${new Date().getTime()}`,responseType:"json",headers:{"User-Agent":d.getRandomPCUA()}});if(!e.status)return;let a=e.data;f.info("请求信息",a);let i=d.toJSON(a.responseText);if(f.info(i),"objects"in i)return i.objects;m.error("坚果云: 处理多文件信息异常");}gotoLogin(){P.confirm({title:{text:"提示",position:"center"},content:{text:"解析失败，原因：当前尚未登录坚果云，是否前往登录？"},btn:{reverse:true,position:"end",ok:{text:"前往",callback:function(t){window.open("https://www.jianguoyun.com/d/login#from=https%3A%2F%2Fwww.jianguoyun.com%2F","_blank");}}}},x.popsStyle.jianGuoYunLoginTip);}}const me={DEFAULT_HOST_NAME:"www.lanzout.com",MENU_KEY:"lanzou-host-name",get hostname(){return L(this.MENU_KEY,this.DEFAULT_HOST_NAME).value}};let gt=n=>(n=n.replace(/\/\/.+/gi,""),n=n.replace(/\/\*[\s\S\n]+\*\//gi,""),n);class la extends xe{constructor(){super(...arguments);G(this,"router",{root(t=""){return t.startsWith("/")&&(t=t.replace(/^\//,"")),`https://${me.hostname}/${t}`},root_tp(t=""){return t.startsWith("/")&&(t=t.replace(/^\//,"")),`https://${me.hostname}/tp/${t}`},root_s(t=""){return t.startsWith("/")&&(t=t.replace(/^\//,"")),`https://${me.hostname}/s/${t}`}});G(this,"regexp",{unicode:{match:/[%\u4e00-\u9fa5]+/g,tip:"中文链接",isUnicode:false},noFile:{match:/div>来晚啦...文件取消分享了<\/div>/g,tip:"来晚啦...文件取消分享了"},noExists:{match:/div>文件不存在，或已删除<\/div>/g,tip:"文件不存在，或已删除"},linkInValid:{match:/div>文件链接失效，请获取新链接<\/div>/g,tip:"文件链接失效，请获取新链接"},needVipToShare:{match:/class="fbox">非会员.+请先开通会员/gi,tip:"该链接为非会员用户分享的文件，目前无法下载"},moreFile:{match:/<span id=\"filemore\" onclick=\"more\(\);\">/g},sign:{match:/var[\s]*(posign|postsign|vidksek|skdklds)[\s]*=[\s]*'(.+?)';/},fileName:{match:/<title>(.*)<\/title>/},fileSize:{match:/<span class=\"mtt\">\((.*)\)<\/span>/},loadDownHost:{match:/var[\s]*(vkjxld)[\s]*=[\s]*'(.+?)'/i},loadDown:{match:/var[\s]*(loaddown|oreferr|spototo|domianload|hyggid)[\s]*=[\s]*'(.+?)'/i},appleDown:{match:/var[\s]*appitem[\s]*=[\s]*'(.+?)'/i},uploadTime:{match:/mt2\"\>时间:<\/span>(.+?)[\s]*<span/i}});}async init(t,e,a){f.info(t,e,a),this.ruleIndex=t,this.shareCode=e,this.accessCode=a,this.regexp.unicode.isUnicode=!!this.shareCode.match(this.regexp.unicode.match),t===2?await this.getMoreFile(this.router.root_s(this.shareCode)):await this.getFileLink();}async getFileLink(t=false){var l,o,c,u,p,h,g,k,w;const e=this;let a=this.router.root(this.shareCode);f.info("蓝奏云-获取文件下载链接"+a);let i=await M.get({url:a,headers:{Accept:"*/*","User-Agent":d.getRandomPCUA(),Referer:a},allowInterceptConfig:false,onerror(){}});if(!i.status){if(f.error(i),i.type==="ontimeout")return;if(d.isNull(i.data.responseText)){m.error("请求异常");return}this.checkPageCode(i.data)&&m.error("未知情况");return}let s=i.data;if(s.readyState!==4){f.error(s),m.error("请求失败，请重试");return}if(s.responseText==null){f.error(s),m.error("获取网页内容为空");return}if(e.checkPageCode(s))if(e.isMoreFile(s))await e.getMoreFile();else {f.info(s);let D=gt(s.responseText);if(t){let S=D.match(/var[\s]*link[\s]*=[\s]*\'tp\/(.+?)\';/i);e.shareCode=S[S.length-1],f.info(`新参数 => ${e.shareCode}`);}let C=b.parseHTML(D,true,true),N=C.querySelector('iframe[class^="ifr"]')||C.querySelector('iframe[class^="n_downlink"]');if(N){let S=N.getAttribute("src");f.error("该链接需要重新通过iframe地址访问获取信息",S),m.info("正在请求下载信息");let T=((l=C.querySelector("body div.d > div"))==null?void 0:l.innerText)||((o=C.querySelector("#filenajax"))==null?void 0:o.innerText)||((u=(c=C.querySelector("title"))==null?void 0:c.textContent)==null?void 0:u.replace(/ - 蓝奏云$/i,"")),v=D.match(/文件大小：<\/span>(.+?)<br>/i)||((p=C.querySelector("div.n_box div.n_file div.n_filesize"))==null?void 0:p.innerText)||((h=C.querySelector(".d2 table tr td .fileinfo:nth-child(1) .fileinforight"))==null?void 0:h.innerText),R=D.match(/上传时间：<\/span>(.+?)<br>/i)||((g=C.querySelector("#file[class=''] .n_file_info span.n_file_infos"))==null?void 0:g.innerText)||((k=C.querySelector(".d2 table tr td .fileinfo:nth-child(3) .fileinforight"))==null?void 0:k.innerText)||((w=C.querySelector("#file[class='filter'] .n_file_info span.n_file_infos"))==null?void 0:w.innerText);v?(Array.isArray(v)&&(v=v[v.length-1]),typeof v=="string"&&(v=v.replaceAll("大小：",""))):f.error("解析文件大小信息失败"),R?(Array.isArray(R)&&(R=R[R.length-1]),R.toString().toLowerCase().startsWith("android")&&(f.error("解析出的文件上传时间信息是Android/xxxx开头"),R=void 0)):f.error("解析文件上传时间信息失败");let _=await e.getLinkByIframe(S,{fileName:T,fileSize:v,fileUploadTime:R});_&&(j.isForwardDownloadLink("lanzou")&&(_=j.parseDataToSchemeUri("lanzou",_)),x.staticView.oneFile({title:"蓝奏云单文件直链",fileName:T,fileSize:v,downloadUrl:_,fileUploadTime:R}));}else await e.getLink(s);}}checkPageCode(t){let e=t.responseText;return e.match(this.regexp.noFile.match)?(m.error(this.regexp.noFile.tip),false):e.match(this.regexp.noExists.match)?(m.error(this.regexp.noExists.tip),false):e.match(this.regexp.needVipToShare.match)?(m.error(this.regexp.needVipToShare.tip),false):e.match(this.regexp.linkInValid.match)?(m.error(this.regexp.linkInValid.tip),false):true}isMoreFile(t){const e=this;return t.responseText.match(e.regexp.moreFile.match)?(f.info("该链接为多文件"),true):(f.info("该链接为单文件"),false)}async getLink(t){const e=this;let a=t.responseText;if(a==null){f.error("shareCode错误，重新从页面中获取"),await e.getFileLink(true);return}a=gt(a);let i=a.match(/'sign':'(.+?)',/i)||a.match(e.regexp.sign.match),s="",l="",o=a.match(e.regexp.fileName.match),c=o?o[o.length-1].trim():"",u=a.match(e.regexp.fileSize.match)||a.match(/<div class="n_filesize">大小：(.+?)<\/div>/i),p=u?u[u.length-1].trim():"",h=a.match(e.regexp.uploadTime.match)||a.match(/<span class="n_file_infos">(.+?)<\/span>/i),g=h?h[h.length-1].trim():"",k=a.match(/[\s]+url[\s]+:[\s]+'\/ajaxm.php\?file=([0-9]+)',/i)||a.match(/\/\/url[\s]+:[\s]+'\/ajaxm.php\?file=([0-9]+)',/i),w=k?k[k.length-1]:"1";if(i){l=i[i.length-1],f.info(`获取Sign: ${l}`),d.isNotNull(e.accessCode)?(f.info("传入参数=>有密码"),s=e.accessCode):f.info("传入参数=>无密码");let D=await e.getKNDS(),C=await M.post({url:e.router.root("ajaxm.php?file="+w),responseType:"json",headers:{accept:"application/json, text/javascript, */*","Content-Type":"application/x-www-form-urlencoded","User-Agent":d.getRandomAndroidUA(),Origin:"https://"+me.hostname,Referer:e.router.root(e.shareCode)},data:`action=downprocess&sign=${l}&p=${s}&kd=${D}`});if(!C.status)return;let N=C.data;if(f.info(N),N.readyState===4){let S=d.toJSON(N.responseText),T=`${S.dom}/file/${S.url}`;typeof S.url=="string"&&(S.url.startsWith("http")||S.url.startsWith(S.dom))&&(T=S.url),S.zt,"密码不正确".indexOf(S.inf)!=-1?(m.error("密码不正确!"),x.newAccessCodeView(void 0,"lanzou",e.ruleIndex,e.shareCode,e.accessCode,v=>{e.init(e.ruleIndex,e.shareCode,v.accessCode);})):(c=S.inf?S.inf:c,f.info(T),j.isForwardDownloadLink("lanzou")&&(T=j.parseDataToSchemeUri("lanzou",T)),x.staticView.oneFile({title:"蓝奏云单文件直链",fileName:c,fileSize:p,downloadUrl:T,fileUploadTime:g}));}else m.error("请求失败，请重试");}else {let D=a.match(e.regexp.loadDownHost.match),C=a.match(e.regexp.loadDown.match),N=a.match(e.regexp.appleDown.match),S=N[N.length-1];if(d.isNull(C)&&(C=a.match(/var[\s]*(cppat)[\s]*=[\s]*'(.+?)'/i)),d.isNull(D)&&S&&(S=S[S.length-1],D=[S],C=[""],f.success("多文件-当前链接猜测为苹果的文件",S)),d.isNull(D)){m.error("蓝奏云直链：获取sign的域名失败，请反馈开发者",{timeout:3500});return}if(d.isNull(C)){m.error("蓝奏云直链：获取sign失败，请反馈开发者",{timeout:3500});return}let T=`${D[D.length-1]}${C[C.length-1]}`;f.info(c,p,T),f.info(T),j.isForwardDownloadLink("lanzou")&&(T=j.parseDataToSchemeUri("lanzou",T)),x.staticView.oneFile({title:"蓝奏云单文件直链",fileName:c,fileSize:p,downloadUrl:T,fileUploadTime:g});}}async getLinkByIframe(t,e){const a=this;f.info(t,e);let i=a.router.root(t),s=await M.get({url:i,headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","User-Agent":d.getRandomPCUA(),Referer:a.router.root(a.shareCode)}});if(!s.status)return;let l=s.data;f.info(l);let o=l.responseText,c=o.match(/'websignkey'[\s]*:[\s]*'(.+?)'/i)||o.match(/var[\s]*aihidcms[\s]*=[\s]*'(.*)';/i),u=o.match(/var[\s]*ciucjdsdc[\s]*=[\s]*'(.*)';/i),p=o.match(/var[\s]*ajaxdata[\s]*=[\s]*'(.+)';/i),h=o.match(/'sign':[\s]*'(.+)',/i)||o.match(/var[\s]*wp_sign[\s]*=[\s]*'(.*)';/i),g=o.match(/[^\/\/]url[\s]*:[\s]*'(.+?)'[\s]*,/i)||o.match(/url[\s]*:[\s]*'(.+?)'[\s]*,/),k="ajaxm.php",w="",D="",C="",N="",S=await this.getKNDS();if(g?k=g[g.length-1]:m.error("提取ajaxm.php的具体参数失败，使用默认的"+k),c)w=c[c.length-1];else {m.error("ajaxm.php请求参数 websignkey 获取失败");return}if(u)D=u[u.length-1];else {m.error("ajaxm.php请求参数 websign 获取失败");return}if(p)C=p[p.length-1];else {m.error("ajaxm.php请求参数 signs 获取失败");return}if(h)N=h[h.length-1];else {m.error("ajaxm.php请求参数 sign 获取失败");return}let T={action:"downprocess",signs:C,sign:N,websign:D,websignkey:w,kd:S,ves:1};f.success("请求的路径参数："+k),f.success(["ajaxm.php的请求参数-> ",T]);let v=await M.post(a.router.root(k),{data:d.toSearchParamsStr(T),headers:{Accept:"application/json, text/javascript, */*","Content-Type":"application/x-www-form-urlencoded",Referer:a.router.root(a.shareCode),"User-Agent":d.getRandomPCUA()}});if(!v.status)return;let R=v.data;f.info(R);let _=d.toJSON(R.responseText),$=`${_.dom}/file/${_.url}`;if(_.zt,await M.get("https://down-load.lanrar.com/file/kdns.js",{allowInterceptConfig:false}),(await M.get("https://boce.lanosso.com/file/kdns2.js",{allowInterceptConfig:false})).status?f.info("测试killdns2成功，不改变原downloadUrl"):($+="&lanosso",f.info("测试killdns2失败使用参数 lanosso")),f.success("直链",$),"密码不正确".indexOf(_.inf)!=-1)m.error("密码不正确!"),x.newAccessCodeView(void 0,"lanzou",a.ruleIndex,a.shareCode,a.accessCode,B=>{a.init(a.ruleIndex,a.shareCode,B.accessCode);});else return e.fileName=d.isNotNull(_.inf)?_.inf:e.fileName,f.info($),$}async getKNDS(){let t=await M.get("https://down-load.lanrar.com/file/kdns.js",{allowInterceptConfig:false});return t.status&&d.isNotNull(t.data.responseText)?1:0}async getMoreFile(t){const e=this;t==null&&(t=e.router.root(e.shareCode));let a=await M.get({url:t,headers:{Accept:"*/*","User-Agent":d.getRandomAndroidUA(),Referer:t}});if(!a.status)return;let i=a.data;if(f.info(i),i.readyState!==4){m.error("请求失败，请重试");return}let s=i.responseText,l=s.match(/\'fid\':(.+?),/)[1].replaceAll("'",""),o=s.match(/\'uid\':(.+?),/)[1].replaceAll("'",""),c=1,u=s.match(/\'t\':(.+?),/)[1],p=new RegExp(u+`[\\s]*=[\\s]*('|")(.+?)('|");`),h=s.match(p)[2],g=s.match(/\'k\':(.+?),/)[1],k=new RegExp(g+`[\\s]*=[\\s]*('|")(.+?)('|");`),w=s.match(k)[2],C=`lx=${e.shareCode.match(e.regexp.unicode.match)?1:2}&fid=${l}&uid=${o}&pg=${c}&rep=0&t=${h}&k=${w}&up=1&ls=1&pwd=${e.accessCode}`;f.info(`多文件请求参数：${C}`);let N=await M.post({url:e.router.root("filemoreajax.php"),responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","User-Agent":d.getRandomAndroidUA(),Referer:t},data:C});if(!N.status)return;let S=N.data;f.info(S);let T=d.toJSON(S.responseText),v=T.zt,R=T.info;if(v===4)m.error(R);else if(v===1){let _=m.loading("获取文件夹成功，解析文件直链中..."),$=T.text,E=[];f.info(`本链接一共${$.length}个文件`);for(let B=0;B<$.length;B++){let O=$[B],q=O.id,U=O.name_all,ne=O.size,se=O.icon,fe=O.time;E.push({fileName:U,fileSize:ne,fileType:se,createTime:fe,latestTime:fe,isFolder:false,index:0,async clickEvent(){let Ce=await e.parseMoreFile(q,U,ne,fe);if(Ce.success)return {autoDownload:true,mode:"aBlank",url:Ce.downloadUrl};f.error("获取下载信息失败：",Ce),m.error(Ce.msg);}});}_.close(),x.staticView.moreFile("蓝奏云文件解析",E);}else "密码不正确".indexOf(R)!==-1?(m.error("密码不正确!"),x.newAccessCodeView(void 0,"lanzou",e.ruleIndex,e.shareCode,e.accessCode,_=>{e.init(e.ruleIndex,e.shareCode,_.accessCode);})):"没有了".indexOf(R)!==-1?m.error("没有文件了"):m.error("未知错误");}async parseMoreFile(t,e,a,i){const s=this;let l=await M.get({url:s.router.root(t),headers:{Accept:"*/*","User-Agent":d.getRandomPCUA(),Referer:s.router.root(s.shareCode)}});if(f.info(l),!l.status)return {success:false,fileName:e,fileSize:a,fileUploadTime:i,msg:`解析失败，${l.msg}`,downloadUrl:void 0};let c=l.data.responseText,u=b.parseHTML(c,true,true),p=u.querySelector('iframe[class^="ifr"]')||u.querySelector('iframe[class^="n_downlink"]');if(!p)return {success:false,fileName:e,fileSize:a,fileUploadTime:i,msg:"解析iframe链接失败",downloadUrl:void 0};let h=p.getAttribute("src");f.error("该链接需要重新通过iframe地址访问获取信息",h),m.info("正在请求下载信息");let g=await s.getLinkByIframe(h,{fileName:e,fileSize:a,fileUploadTime:i});return g?(j.isForwardDownloadLink("lanzou")&&(g=j.parseDataToSchemeUri("lanzou",g)),{success:true,fileName:e,fileSize:a,fileUploadTime:i,msg:"success",downloadUrl:g}):{success:false,fileName:e,fileSize:a,fileUploadTime:i,msg:"获取下载链接失败",downloadUrl:void 0}}}const Ze={LanZouDiskApp:"lanZouY-disk-app",EncryptList:["Y","y","0","Z","z","N","n","M","I","6","m","W","w","1","X","x","L","l","K","7","k","i","U","u","2","V","v","J","j","8","G","g","F","S","s","3","T","t","H","h","f","E","e","D","Q","q","4","R","r","9","d","a","C","c","B","O","o","5","P","p","b","A"],decodeChar(n){for(let r=0;r<this.EncryptList.length;r++)if(n==this.EncryptList[r])return r;return  -1},idEncrypt(n){let r=1,t=0;if(n!=""&&n.length>4){let e;n=n.substring(3,n.length-1);for(let a=0;a<n.length;a++)e=n.charAt(n.length-a-1),t+=this.decodeChar(e)*r,r*=62;}return t},encrypt(n){const r=Ie.enc.Utf8.parse(this.LanZouDiskApp),t=Ie.enc.Utf8.parse(n);return Ie.AES.encrypt(t,r,{mode:Ie.mode.ECB,padding:Ie.pad.Pkcs7})},encryptHex(n){return this.encrypt(n,this.LanZouDiskApp).ciphertext.toString().toUpperCase()}};class ca extends xe{constructor(){super(...arguments);G(this,"$data",{devType:6,devModel:"Chrome",extra:2,type:0,offset:1,limit:60});G(this,"uuid");G(this,"userId");G(this,"shareCodeId");}async init(t,e,a){var l,o,c,u;const i=this;f.info(t,e,a),i.ruleIndex=t,i.shareCode=e,i.accessCode=a,i.shareCodeId=i.getDecodeShareCodeId(e),i.uuid=i.getEncodeUUID();let s=await this.recommendList(i.$data.devType,i.$data.devModel,i.uuid,i.$data.extra,i.getEncodeTimeStamp(),i.shareCode,i.$data.type,i.$data.offset,i.$data.limit);if(s&&s.list.length){if((o=(l=s.list[0])==null?void 0:l.map)!=null&&o.userId)i.userId=(u=(c=s.list[0])==null?void 0:c.map)==null?void 0:u.userId;else {m.error("解析获取【userId】为空");return}if(s.list[0].folderIds==null){f.success("该链接是 单文件");let p=s.list[0].fileList[0],g=await i.parseFolderInfo(s.list[0].fileList,0)[0].clickEvent();if(g&&!Array.isArray(g)){let k=g.url;j.isForwardDownloadLink("lanzouyx")&&(k=j.parseDataToSchemeUri("lanzouyx",k)),x.staticView.oneFile({title:"蓝奏云优享单文件直链",fileName:p.fileName,fileSize:p.fileSize*1024,downloadUrl:k,fileUploadTime:d.formatToTimeStamp(p.updTime),fileLatestTime:d.formatToTimeStamp(p.updTime)});}}else {f.success("该链接是 多文件"),m.info("正在递归文件");let p=m.loading("正在解析多文件中，请稍后..."),h=i.parseFolderInfo(s.list[0].fileList,0);p.close(),f.info("递归完毕"),x.staticView.moreFile("蓝奏云优享解析",h);}}}parseFolderInfo(t,e){const a=this;let i=[],s=[],l=[];return t.forEach(o=>{o.fileType===2?s.push({fileName:o.folderName,fileSize:0,fileType:"",createTime:new Date(o.updTime).getTime(),latestTime:new Date(o.updTime).getTime(),isFolder:true,index:e,async clickEvent(c,u){let p=a.getEncodeTimeStamp(),h=o.folderId,g=await a.getFolderInfo(a.$data.devType,a.$data.devModel,a.uuid,a.$data.extra,p,a.shareCode,h,a.$data.offset,a.$data.limit);return g&&g.list?a.parseFolderInfo(g.list,e+1):[]}}):l.push({fileName:o.fileName,fileSize:o.fileSize*1024,fileType:"",createTime:new Date(o.updTime).getTime(),latestTime:new Date(o.updTime).getTime(),isFolder:false,index:e,async clickEvent(){let c=o.fileId,u=o.userId||a.userId,p=a.uuid;if(d.isNull(u)){m.error("获取【userId】为空");return}if(d.isNull(p)){m.error("获取【uuid】为空");return}let h=await a.getDownloadFileUrl(...a.getDownloadFileParams(c,u,p));if(h)return j.isForwardDownloadLink("lanzouyx")&&(h=j.parseDataToSchemeUri("lanzouyx",h)),{url:h,autoDownload:true,mode:"aBlank"}}});}),s.sort((o,c)=>o.fileName.localeCompare(c.fileName)),l.sort((o,c)=>o.fileName.localeCompare(c.fileName)),i=i.concat(s),i=i.concat(l),i}async recommendList(t=this.$data.devType,e=this.$data.devModel,a="",i=this.$data.extra,s="",l="",o=this.$data.type,c=this.$data.offset,u=this.$data.limit){let p=await M.post(`https://api.ilanzou.com/unproved/recommend/list?${d.toSearchParamsStr({devType:t,devModel:e,uuid:a,extra:i,timestamp:s,shareId:l,code:this.accessCode,type:o,offset:c,limit:u})}`,{headers:{Accept:"application/json, text/plain, */*",Origin:"https://www.ilanzou.com",Referer:"https://www.ilanzou.com/","Sec-Fetch-Site":"same-site",Host:"api.ilanzou.com","User-Agent":d.getRandomPCUA()},responseType:"json"});if(!p.status)return;let h=d.toJSON(p.data.responseText);if(f.success("获取链接信息：",h),h.code!==200){m.error("请求链接信息失败");return}if(!h.list.length){m.error("获取链接信息为空");return}return h}async getFolderInfo(t=this.$data.devType,e=this.$data.devModel,a="",i=this.$data.extra,s="",l="",o="",c=this.$data.offset,u=this.$data.limit){let p=await M.post(`https://api.ilanzou.com/unproved/share/list?${d.toSearchParamsStr({devType:t,devModel:e,uuid:a,extra:i,timestamp:s,shareId:l,code:this.accessCode,folderId:o,offset:c,limit:u})}`,{headers:{Accept:"application/json, text/plain, */*",Origin:"https://www.ilanzou.com",Referer:"https://www.ilanzou.com/","Sec-Fetch-Site":"same-site",Host:"api.ilanzou.com","User-Agent":d.getRandomPCUA()}});if(!p.status)return;let h=d.toJSON(p.data.responseText);if(f.success("获取文件列表信息：",h),h.code===200)return h;m.error(h.msg);}async getDownloadFileUrl(t="",e=1,a=this.$data.devType,i="",s="",l="",o=this.shareCode){return `https://api.ilanzou.com/unproved/file/redirect?${d.toSearchParamsStr({downloadId:t,enable:e,devType:a,uuid:i,timestamp:s,auth:l,shareId:o})}`}getEncodeUUID(t=21){return ((a=21)=>crypto.getRandomValues(new Uint8Array(a)).reduce((i,s)=>(s&=63,i+=s<36?s.toString(36):s<62?(s-26).toString(36).toUpperCase():s>62?"-":"_",i),""))(t)}getDecodeShareCodeId(t){return Ze.idEncrypt(t)}getEncodeTimeStamp(t=Date.now()){return Ze.encryptHex(t)}getDownloadFileParams(t,e="",a){const i=this;let s=Date.now(),l=Ze.encryptHex(t+"|"+e),o=1,c=i.getEncodeTimeStamp(s),u=Ze.encryptHex(t+"|"+s);return [l,o,i.$data.devType,a,c,u,i.shareCode]}gotoLogin(){P.confirm({title:{position:"center",text:"蓝奏云优享"},content:{text:"必须先在【蓝奏云优享】进行登录，然后登录成功后刷新获取必备的下载参数【uuid】和【userId】。",html:false},btn:{reverse:true,position:"end",ok:{text:"前往",enable:true,callback(){window.open("https://www.ilanzou.com","_blank");}}}},x.popsStyle.tianYiYunLoginTip);}}const Rt={isSupport_GM_download(){try{return typeof ut=="function"}catch(n){return console.error(n),false}}};class ua extends xe{constructor(){super(...arguments);G(this,"panelList",[]);G(this,"panelContent","");G(this,"OK_CODE","0000");}async init(t,e,a){const i=this;f.info(t,e,a),i.ruleIndex=t,i.shareCode=e,i.accessCode=a,i.panelList=[],i.panelContent="";let s=await i.checkLinkValidity(i.shareCode,i.accessCode);if(s)if(s.isFolder){m.info("正在递归文件");let l=m.loading("正在解析多文件中，请稍后..."),o=await i.getShareFolder(s.data.guid);if(!o){l.close();return}let c=await i.getShareFiles(s.data.guid);if(!c){l.close();return}let u=i.getFolderInfo(s.data.guid,o,c,0);l.close(),f.info("递归完毕"),x.staticView.moreFile("奶牛快传文件解析",u);}else {let l;if(s.zipDownload?l=await i.getZipFileDownloadUrl(i.shareCode,s.guid,s.fileName):l=await i.getDownloadUrl(i.shareCode,s.guid,s.id),!l)return;j.isForwardDownloadLink("nainiu")&&(l=j.parseDataToSchemeUri("nainiu",l)),x.staticView.oneFile({title:"奶牛快传单文件直链",fileName:s.fileName,fileType:s.fileType,fileSize:s.fileSize,downloadUrl:l,fileUploadTime:s.fileUploadTime,fileLatestTime:s.fileLatestTime,clickCallBack:o=>{i.downloadFile(s.fileName,l);}});}}async checkLinkValidity(t,e){const a=this;let i=await a.getShareByUniqueUrl(t);if(!i)return  false;let s=i.code,l=i.message;if(s!==a.OK_CODE)return m.error(l),false;{let o=i.data.needPassword,c=i.data.zipDownload;return o&&d.isNull(e)?(m.error("密码缺失!"),x.newAccessCodeView("密码缺失","nainiu",a.ruleIndex,a.shareCode,a.accessCode,u=>{a.init(a.ruleIndex,a.shareCode,u.accessCode);}),false):c?(m.success("该链接为zip单文件"),{zipDownload:c,guid:i.data.guid,fileSize:d.formatByteToSize(i.data.firstFolder.size),fileName:i.data.firstFolder.title,fileUploadTime:d.formatTime(i.data.firstFolder.created_at),fileLatestTime:d.formatTime(i.data.firstFolder.updated_at)}):i.data.firstFile==null?(m.success("该链接为文件夹类型"),{isFolder:true,guid:i.data.guid,firstFolder:i.data.firstFolder,data:i.data}):{zipDownload:c,guid:i.data.guid,id:i.data.firstFile.id,fileSize:d.formatByteToSize(i.data.firstFile.file_info.size),fileName:i.data.firstFile.file_info.title,fileType:i.data.firstFile.file_info.format,fileUploadTime:d.formatTime(i.data.firstFile.created_at),fileLatestTime:d.formatTime(i.data.firstFile.updated_at)}}}getFolderInfo(t,e,a,i=0){const s=this;let l=[],o=[],c=[];return e.forEach(u=>{l.push({fileName:u.title,fileSize:0,fileType:"",createTime:u.created_at,latestTime:u.updated_at,isFolder:true,index:i,async clickEvent(){if(!u.child_folder_count&&!u.content_count)return [];let p=await s.getShareFolder(t,u.id);if(!p)return [];let h=await s.getShareFiles(t,u.id);return h?s.getFolderInfo(t,p,h,i+1):[]}});}),a.forEach(u=>{let p=u.file_info.title,h=u.file_info.format??"";h&&(p=p+"."+h),l.push({fileName:p,fileSize:u.file_info.size,fileType:h,createTime:u.created_at,latestTime:u.updated_at,isFolder:false,index:i,async clickEvent(){let g=await s.getDownloadUrl(s.shareCode,t,u.id);g&&(j.isForwardDownloadLink("nainiu")&&(g=j.parseDataToSchemeUri("nainiu",g)),s.downloadFile(p,g));}});}),o.sort((u,p)=>u.fileName.localeCompare(p.fileName)),c.sort((u,p)=>u.fileName.localeCompare(p.fileName)),l=l.concat(o),l=l.concat(c),f.info("getFolderInfo",l),l}async parseMoreFile(t,e){}async getShareFolder(t,e="",a=0,i=100){const s=this;let l=await M.get(`https://cowtransfer.com/core/api/transfer/share/folders?transferGuid=${t}&folderId=${e}&page=${a}&size=${i}`,{headers:{Accept:"application/json","User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/"}});if(f.success(l),!l.status)return;let o=d.toJSON(l.data.responseText);if(o.code!==s.OK_CODE){m.error(o.message);return}let c=o.data.folders;if(!Array.isArray(c)){m.error("data.folders不是数组");return}return c}async getShareFiles(t,e="",a=0,i=20,s=false){const l=this;let o=await M.get(`https://cowtransfer.com/core/api/transfer/share/files?transferGuid=${t}&folderId=${e}&page=${a}&size=${i}&subContent=${s}`,{headers:{Accept:"application/json","User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/"}});if(f.success(o),!o.status)return;let c=d.toJSON(o.data.responseText);if(c.code!==l.OK_CODE){m.error(c.message);return}let u=c.data.files;if(!Array.isArray(u)){m.error("data.files不是数组");return}return u}async getShareByUniqueUrl(t){let e=`https://cowtransfer.com/core/api/transfer/share?uniqueUrl=${t}`,a=await M.get({url:e,headers:{"User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/s/"+t}});if(f.info(a),!a.status)return;let i=a.data,s=d.toJSON(i.responseText);return f.info("转换的JSON",s),s}async getDownloadUrl(t,e="",a=""){const i=this;let s=`https://cowtransfer.com/core/api/transfer/share/download?transferGuid=${e}&fileId=${a}`,l=await M.get({url:s,headers:{"User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/s/"+t}});if(f.info(l),!l.status)return;let o=l.data,c=d.toJSON(o.responseText);if(f.info("转换的JSON",c),c.code===i.OK_CODE)return c.data.downloadUrl;m.error(`奶牛快传-获取直链：${c.message}`);}async getZipFileDownloadUrl(t,e="",a=""){const i=this;let s=`https://cowtransfer.com/core/api/transfer/share/download?transferGuid=${e}&title=${a}`,l=await M.get({url:s,headers:{"User-Agent":d.getRandomPCUA(),Referer:"https://cowtransfer.com/s/"+t}});if(f.info(l),!l.status)return;let o=l.data,c=d.toJSON(o.responseText);if(f.info("转换的JSON",c),c.code===i.OK_CODE)return c.data.downloadUrl;m.error(`奶牛快传-获取直链：${c.message}`);}async downloadFile(t,e){if(f.info("下载文件：",t,e),window.location.hostname==="cowtransfer.com"){window.open(e,"_blank");return}if(!Rt.isSupport_GM_download()){m.error("当前脚本环境不支持API 【GM_download】");return}m.info(`调用【GM_download】下载：${t}`);let a=null,i=false,s=false,l=m.loading("下载中...",{showClose:true,onClose(){!i&&typeof a=="function"&&a();}}),o=ut({url:e,name:t,headers:{Referer:"https://cowtransfer.com/s/"+this.shareCode},onload(){i=true,l.close(),m.success(`下载 ${t} 已完成`,{consoleLogContent:true});},onprogress(c){if(typeof c=="object"&&"loaded"in c&&"total"in c&&!s){let p=(c.loaded/c.total*100).toFixed(2);l.setText(`下载中...${p}%`),c.loaded===c.total&&(s=true);}},onerror(c){l.close(),f.error("下载失败error👉",c),typeof c=="object"&&c.error?m.error(`下载 ${t} 失败或已取消 原因：${c.error}`,{timeout:6e3,consoleLogContent:true}):m.error(`下载 ${t} 失败或已取消`,{consoleLogContent:true});},ontimeout(){l.close(),m.error(`下载 ${t} 请求超时`,{consoleLogContent:true});}});typeof o=="object"&&o!=null&&"abort"in o&&(a=o.abort);}}class da extends xe{constructor(){super(...arguments);G(this,"shareId");G(this,"shareMode",1);G(this,"code",{ShareNotFoundFlatDir:"抱歉，该文件的分享平铺目录未找到",ShareNotFound:"抱歉，您访问的页面地址有误，或者该页面不存在。",ShareAuditNotPass:"抱歉，该内容审核不通过",FileNotFound:"抱歉，文件不存在",ShareExpiredError:"抱歉，您访问的页面地址有误，或者该页面不存在",ShareAuditWaiting:"抱歉，该链接处于审核中",ShareInfoNotFound:"抱歉，您访问的页面地址有误，或者该页面不存在",FileTooLarge:"抱歉，文件太大，不支持下载",InvalidSessionKey:"天翼云PC端Cookie未生成，是否前去登录？<br />&nbsp;&nbsp;&nbsp;&nbsp;(注意,需要当前浏览器的UA切换成PC且在登录后要等待进入个人云空间后生成Cookie，不是手机端浏览的个人云空间，那样生成的Cookie无法使用)"});}async init(t,e,a){const i=this;f.info(t,e,a),i.ruleIndex=t,i.shareCode=e,i.accessCode=a;let s=await i.getShareInfoByCodeV2(e);if(s){if(f.info("解析的JSON信息",s),s.needAccessCode&&d.isNull(i.accessCode)){m.error("密码不正确!"),x.newAccessCodeView(void 0,"tianyiyun",i.ruleIndex,i.shareCode,i.accessCode,l=>{i.init(i.ruleIndex,i.shareCode,l.accessCode);});return}if("shareId"in s)this.shareId=s.shareId;else {let l=await i.getShareId(e,a);l&&(this.shareId=l);}if("shareMode"in s&&(this.shareMode=s.shareMode),this.shareId!=null)if(s.isFolder){m.info("正在递归文件");let l=m.loading("正在解析多文件中，请稍后..."),o=s.fileId,c=await i.listShareDir(e,a,void 0,void 0,o,o,void 0,this.shareId,void 0,void 0,void 0);if(!c){l.close();return}let u=i.getFolderInfo(e,a,c,0);l.close(),f.info("递归完毕"),x.staticView.moreFile("天翼云文件解析",u);return}else {let l=await i.getDownloadUrl(i.shareCode,i.accessCode,s.fileId,this.shareId);l&&(j.isForwardDownloadLink("tianyiyun")&&(l=j.parseDataToSchemeUri("tianyiyun",l)),x.staticView.oneFile({title:"天翼云单文件直链",fileName:s.fileName,fileSize:d.formatByteToSize(s.fileSize),downloadUrl:l,fileUploadTime:s.fileCreateDate,fileLatestTime:s.fileLastOpTime}));}}}async getUserBriefInfo(t){const e=this;let a=await M.get("https://cloud.189.cn/api/portal/v2/getUserBriefInfo.action",{headers:{Accept:"application/json;charset=UTF-8",Referer:"https://cloud.189.cn/web/share?code="+t,"User-Agent":d.getRandomPCUA()},allowInterceptConfig:false,onerror(){}});if(f.info(a),!a.status){let s=d.toJSON(a.data.responseText);s.res_code in e.code?m.error(e.code[s.res_code]):m.error("请求异常");return}let i=d.toJSON(a.data.responseText);if(i.res_code===0)return i}async getShareInfoByCodeV2(t){const e=this;let a=await M.post({url:"https://cloud.189.cn/api/open/share/getShareInfoByCodeV2.action",data:`shareCode=${t}`,headers:{Accept:"application/json;charset=UTF-8","Content-Type":"application/x-www-form-urlencoded","User-Agent":d.getRandomPCUA(),"Sign-Type":1,Referer:"https://cloud.189.cn/web/share?code="+t,Origin:"https://cloud.189.cn"},allowInterceptConfig:false,onerror(){}});if(!a.status){let l=d.toJSON(a.data.responseText);f.error("获取下载参数失败的JSON信息",l),l.res_code in e.code?m.error(e.code[l.res_code]):m.error(l.res_message);return}let i=a.data;f.info(i);let s=d.toJSON(i.responseText);if(s.res_code==0)return s;e.code.hasOwnProperty(s.res_code)?m.error(e.code[s.res_code]):m.error("获取FileId失败");}async getShareId(t,e){let a=await M.get({url:`https://cloud.189.cn/api/open/share/checkAccessCode.action?shareCode=${t}&accessCode=${e}`,headers:{Accept:"application/json;charset=UTF-8","Cache-Control":"no-cache","User-Agent":d.getRandomPCUA(),"Sign-Type":1,Referer:`https://cloud.189.cn/web/share?code=${t}`},responseType:"json"});if(!a.status)return;let i=a.data;f.info(i);let s=d.toJSON(i.responseText);if(s.res_code===0&&"shareId"in s)return s.shareId;m.error("获取shareId失败"),f.info(s);}getNoCacheValue(){let t="";for(let e=0;e<17;e++)t+=d.getRandomValue(1,9);return "0."+t}async getDownloadUrl(t,e,a,i){const s=this;let l=await M.get({url:`https://cloud.189.cn/api/open/file/getFileDownloadUrl.action?fileId=${a}&dt=1&shareId=${i}`,headers:{Accept:"application/json;charset=UTF-8","Cache-Control":"no-cache","User-Agent":d.getRandomPCUA(),Referer:`https://cloud.189.cn/web/share?code=${t}`,"Sign-Type":1},responseType:"json",allowInterceptConfig:false,onerror(){}});if(f.info(l),!l.status){let u=d.toJSON(l.data.responseText);u.errorCode==="InvalidSessionKey"?s.gotoLogin(s.code.InvalidSessionKey):u.res_code in s.code?m.error(s.code[u.res_code]):m.error("请求异常");return}let o=l.data,c=d.toJSON(o.responseText);if(f.info(c),c.res_code===0)return c.fileDownloadUrl;c.res_code==="InvalidSessionKey"||c.errorCode==="InvalidSessionKey"?s.gotoLogin(s.code.InvalidSessionKey):s.code.hasOwnProperty(c.res_code)?m.error(s.code[c.res_code]):(m.error("请求失败"),f.error(o));}gotoLogin(t=""){P.confirm({title:{position:"center",text:"天翼云"},content:{text:t,html:false},btn:{reverse:true,position:"end",ok:{text:"前往",enable:true,callback(){window.open("https://cloud.189.cn/api/portal/loginUrl.action?redirectURL=https://cloud.189.cn/web/main","_blank");}}}},x.popsStyle.tianYiYunLoginTip);}async listShareDir(t,e,a=1,i=60,s,l,o=true,c,u=5,p="lastOpTime",h=true){const g=this,k={pageNum:a,pageSize:i,fileId:s,shareDirFileId:l,isFolder:o,shareId:c,shareMode:this.shareMode,iconOption:u,orderBy:p,descending:h,accessCode:e};let w=await M.get(`https://cloud.189.cn/api/open/share/listShareDir.action?${d.toSearchParamsStr(k)}`,{headers:{Accept:"application/json;charset=UTF-8",Referer:`https://cloud.189.cn/web/share?code=${t}`,"Sign-Type":1,"User-Agent":d.getRandomPCUA()},responseType:"json",allowInterceptConfig:false,onerror(){}});if(!w.status){let N=d.toJSON(w.data.responseText);f.error("解析文件夹信息失败",N),N.res_code in g.code?m.error(g.code[N.res_code]):"res_message"in N?m.error(N.res_message):m.error("解析文件夹信息失败");return}let D=w.data;f.info(D);let C=d.toJSON(D.responseText);if(C.res_code==0)return C.fileListAO;g.code.hasOwnProperty(C.res_code)?m.error(g.code[C.res_code]):m.error("获取FileId失败");}getFolderInfo(t,e,a,i=0){const s=this;let l=[],o=[],c=[];return a.folderList.forEach(u=>{l.push({fileName:u.name,fileSize:0,fileType:"",createTime:d.formatToTimeStamp(u.createDate),latestTime:d.formatToTimeStamp(u.lastOpTime),isFolder:true,index:i,async clickEvent(){let p=await s.listShareDir(t,e,1,100,u.id,u.id,void 0,s.shareId,void 0,void 0,void 0);return p?s.getFolderInfo(t,e,p,i+1):[]}});}),a.fileList.forEach(u=>{l.push({fileName:u.name,fileSize:u.size,fileType:"",createTime:d.formatToTimeStamp(u.createDate),latestTime:d.formatToTimeStamp(u.lastOpTime),isFolder:false,index:i,async clickEvent(){let p=await s.getDownloadUrl(t,e,u.id,s.shareId);if(p)return j.isForwardDownloadLink("tianyiyun")&&(p=j.parseDataToSchemeUri("tianyiyun",p)),{autoDownload:true,mode:"aBlank",url:p}}});}),o.sort((u,p)=>u.fileName.localeCompare(p.fileName)),c.sort((u,p)=>u.fileName.localeCompare(p.fileName)),l=l.concat(o),l=l.concat(c),f.info("getFolderInfo",l),l}}class pa extends xe{async init(r,t,e){const a=this;if(f.info(r,t,e),a.ruleIndex=r,a.shareCode=t,a.accessCode=e,m.info("检查是否已登录UC网盘"),!await a.isLogin()){a.gotoLogin("检测到尚未登录UC网盘，是否前去登录？<br />&nbsp;&nbsp;&nbsp;&nbsp;(注意,需要当前浏览器的UA切换成PC才有登录选项)");return}let s=await a.getStoken(a.shareCode,a.accessCode);if(!s)return;let l=await a.getDetail(a.shareCode,a.accessCode,s);if(!l){m.error("UC网盘：获取detail失败");return}if(l.length===1&&l[0].dir==false&&l[0].file_type===1){let o=l[0],c=await a.getDownload(a.shareCode,s,o.fid,o.share_fid_token);if(!c)return;if(!c[0].download_url){m.error("获取download_url失败");return}x.staticView.oneFile({title:"UC网盘单文件直链",fileName:c[0].file_name,fileSize:d.formatByteToSize(c[0].size),downloadUrl:c[0].download_url,fileUploadTime:d.formatTime(c[0].created_at),fileLatestTime:d.formatTime(c[0].last_update_at),clickCallBack(){a.downloadFile(c[0].file_name,c[0].download_url);}});}else {m.info("正在递归文件");let o=m.loading("正在解析多文件中，请稍后..."),c=a.getFolderInfo(l,s,0);o.close(),f.info("递归完毕"),x.staticView.moreFile("UC网盘文件解析",c);return}}async isLogin(){let r=await M.get("https://drive.uc.cn/",{headers:{"User-Agent":d.getRandomPCUA()}});if(f.success("判断是否已登录UC网盘",r),!!r.status)return r.data.finalUrl==="https://drive.uc.cn/list"?"已登录":false}downloadFile(r,t){if(f.info("调用【GM_download】下载：",arguments),window.location.hostname==="drive.uc.cn"){window.open(t,"_blank");return}if(!Rt.isSupport_GM_download()){m.error("当前脚本环境不支持API 【GM_download】");return}m.info(`调用【GM_download】下载：${r}`);let e=null,a=false,i=false,s=m.loading("下载中...",{showClose:true,onClose(){!a&&typeof e=="function"&&e();}}),l=ut({url:t,name:r,headers:{Referer:"https://drive.uc.cn/"},onload(){a=true,s.close(),m.success(`下载 ${r} 已完成`,{consoleLogContent:true});},onprogress(o){if(typeof o=="object"&&"loaded"in o&&"total"in o&&!i){let u=(o.loaded/o.total*100).toFixed(2);s.setText(`下载中...${u}%`),o.loaded===o.total&&(i=true);}},onerror(o){s.close(),f.error("下载失败error👉",o),typeof o=="object"&&o.error?m.error(`下载 ${r} 失败或已取消 原因：${o.error}`,{timeout:6e3,consoleLogContent:true}):m.error(`下载 ${r} 失败或已取消`,{consoleLogContent:true});},ontimeout(){s.close(),m.error(`下载 ${r} 请求超时`,{consoleLogContent:true});}});typeof l=="object"&&l!=null&&"abort"in l&&(e=l.abort);}gotoLogin(r=""){P.confirm({title:{position:"center",text:"UC网盘"},content:{text:r,html:false},btn:{reverse:true,position:"end",ok:{text:"前往",enable:true,callback(){window.open("https://drive.uc.cn","_blank");}}}},x.popsStyle.tianYiYunLoginTip);}async getStoken(r,t){let e=await M.post("https://pc-api.uc.cn/1/clouddrive/share/sharepage/token?entry=ft&fr=pc&pr=UCBrowser",{data:JSON.stringify({share_for_transfer:true,passcode:t,pwd_id:r}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8","User-Agent":d.getRandomPCUA(),Origin:"https://drive.uc.cn",Referer:"https://drive.uc.cn/"},allowInterceptConfig:false,onerror(){}});if(!e.status){let i=d.toJSON(e.data.responseText);f.error("获取stoken失败JSON信息",i),"message"in i?m.error(i.message):m.error("请求异常，获取stoken失败");return}let a=d.toJSON(e.data.responseText);if(f.info("获取stoken：",a),a.code!==0){f.error("获取stoken失败",a),m.error("获取stoken失败");return}return a.data.stoken}async getDetail(r,t,e,a=0,i=0,s=1,l=50,o=0,c=0,u=1){let p=await M.get(`https://pc-api.uc.cn/1/clouddrive/transfer_share/detail?pr=UCBrowser&fr=h5&pwd_id=${r}&__t=${new Date().getTime()}&passcode=${t}&stoken=${encodeURIComponent(e)}&pdir_fid=${a}&force=${i}&_page=${s}&_size=${l}&_fetch_banner=${o}&_fetch_share=${c}&_fetch_total=${u}&_sort=${encodeURIComponent("file_type:asc,file_name:asc")}`,{headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomPCUA(),Origin:"https://drive.uc.cn",Referer:"https://drive.uc.cn/"}});if(!p.status)return;let h=d.toJSON(p.data.responseText);if(f.info("获取detail：",h),h.code!==0){f.error("获取detail失败",h),m.error("获取detail失败");return}let g=h.metadata;return g&&g._total&&g._total>g._size?await this.getDetail(r,t,e,a,i,s,g._total,o,c,u):h.data.list}async getDownload(r,t,e,a){let i=await M.post("https://pc-api.uc.cn/1/clouddrive/file/download?entry=ft&fr=pc&pr=UCBrowser",{data:JSON.stringify({fids:[e],pwd_id:r,stoken:t,fids_token:[a]}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8","User-Agent":d.getRandomPCUA(),Origin:"https://drive.uc.cn",Referer:"https://drive.uc.cn/"}});if(!i.status)return;let s=d.toJSON(i.data.responseText);if(f.info("获取download：",s),s.code!==0){f.error("获取download失败",s),m.error("获取download失败");return}if(s.data.length===0){f.error("获取download detail失败",s),m.error("获取download detail失败失败");return}return s.data}getFolderInfo(r,t,e=0){const a=this;let i=[],s=[],l=[];return r.forEach(o=>{o.dir==false&&o.file_type===1?l.push({fileName:o.file_name,fileSize:o.size,fileType:"",createTime:o.created_at,latestTime:o.updated_at,isFolder:false,index:e,async clickEvent(){let c="",u=await a.getDownload(a.shareCode,t,o.fid,o.share_fid_token);if(u&&u.length?c=u[0].download_url:c="",o.ban)m.error("文件已被禁止下载");else {let p=c;if(j.isForwardDownloadLink("uc")&&(p=j.parseDataToSchemeUri("uc",p)),p===c)a.downloadFile(o.file_name,c);else return {autoDownload:true,mode:"aBlank",url:c}}}}):s.push({fileName:o.file_name,fileSize:o.size,fileType:"",createTime:o.created_at,latestTime:o.updated_at,isFolder:true,index:e,async clickEvent(){if(o.include_items===0)return f.success("里面没有文件"),[];let c=await a.getDetail(a.shareCode,a.accessCode,t,o.fid);return c?a.getFolderInfo(c,t,e+1):[]}});}),s.sort((o,c)=>o.fileName.localeCompare(c.fileName)),l.sort((o,c)=>o.fileName.localeCompare(c.fileName)),i=i.concat(s),i=i.concat(l),f.info("getFilesInfoByRec",i),i}}class ha extends xe{constructor(){super(...arguments);G(this,"token");G(this,"code",{1004:"no token",1008:"您没有权限访问",1013:"糟糕，此任务已过期销毁，下次要记得续期",1066:"对方设置的下载 / 预览次数已用完",1088:"糟糕，您访问的页面不存在"});}async init(t,e,a){const i=this;if(f.info(t,e,a),i.ruleIndex=t,i.shareCode=e,i.accessCode=a,m.info("正在请求直链中..."),!await this.getWssToken())return;let l=await this.getPid();l&&await this.getFileNList(l.bid,l.pid);}async getWssToken(){const t=this;let e=await M.post("https://www.wenshushu.cn/ap/login/anonymous",{responseType:"json",data:JSON.stringify({dev_info:"{}"}),headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomAndroidUA(),Referer:"https://www.wenshushu.cn/f/"+t.shareCode}});if(f.success(e),!e.status)return;let a=d.toJSON(e.data.responseText);if(a.code===0)return t.token=a.data.token,a.data.token;a.code in t.code?m.error(t.code[a.code]):m.error("获取wss失败");}async getPid(){const t=this;let e=await M.post({url:"https://www.wenshushu.cn/ap/task/mgrtask",responseType:"json",data:JSON.stringify({tid:t.shareCode,password:"",ufileid:""}),headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomAndroidUA(),Referer:"https://www.wenshushu.cn/f/"+t.shareCode,"x-token":t.token}});if(f.success(e),!e.status)return;let a=e.data,i=d.toJSON(a.responseText);if(i.code===0)return {bid:i.data.boxid,pid:i.data.ufileid};i.code in t.code?m.error(t.code[i.code]):m.error("获取pid失败");}async getFileNList(t,e){const a=this;let i=await M.post("https://www.wenshushu.cn/ap/ufile/nlist",{responseType:"json",data:JSON.stringify({start:0,sort:{name:"asc"},bid:t,pid:e,options:{uploader:"true"},size:50}),headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomAndroidUA(),Referer:"https://www.wenshushu.cn/f/"+a.shareCode,"x-token":a.token}});if(f.success(i),!i.status)return;let s=i.data,l=d.toJSON(s.responseText);l.code===0?l.data.fileList[0].type===2?(m.error("该链接为多层级文件嵌套，跳转"),ke.openBlankUrl(re.getBlankUrl("wenshushu",a.ruleIndex,a.shareCode,a.accessCode),"wenshushu",a.ruleIndex,a.shareCode,a.accessCode)):await a.getDownloadUrl(l.data.fileList[0]):l.code in a.code?m.error(a.code[l.code]):m.error("获取文件信息失败");}async getDownloadUrl(t){const e=this;let a=t.fname,i=d.formatByteToSize(t.size),s=await M.post("https://www.wenshushu.cn/ap/dl/sign",{responseType:"json",data:JSON.stringify({ufileid:t.fid,consumeCode:0}),headers:{Accept:"application/json, text/plain, */*","User-Agent":d.getRandomAndroidUA(),Referer:"https://www.wenshushu.cn/f/"+e.shareCode,"x-token":e.token}});if(!s.status)return;f.success(s);let l=s.data,o=d.toJSON(l.responseText);if(o.code==0){let c=o.data.url;c===""?m.error("对方的分享流量不足"):(j.isForwardDownloadLink("wenshushu")&&(c=j.parseDataToSchemeUri("wenshushu",c)),x.staticView.oneFile({title:"文叔叔单文件直链",fileName:a,fileSize:i,downloadUrl:c}));}else o.data in e.code?m.error(e.code[o.data]):m.error("获取下载链接失败");}}const Qe={rule:{baidu:ia,lanzou:la,lanzouyx:ca,tianyiyun:da,wenshushu:ha,_123pan:ra,jianguoyun:oa,nainiu:ua,uc:pa,aliyun:na,chengtong:sa}},re={getBlankUrl(n,r,t,e){let a=I.$rule.ruleOption[n][r],i=a.blank;t&&(i=Q.replaceParam(i,{shareCode:t})),e&&e!==""?i=Q.replaceParam(i,{accessCode:e}):i=Fe.replaceText(i,I.$extraRule.noAccessCodeRegExp,"");let s=I.$match.matchedInfo.get(n).get(t);if(a.paramMatch){let l=s.matchText.match(a.paramMatch),o={};for(let c=0;c<l.length;c++)o[`$${c}`]=l[c];i=Q.replaceParam(i,o);}return i},getCopyUrlInfo(n,r,t,e){let a=I.$rule.ruleOption[n][r],i=a.copyUrl;t&&(i=Q.replaceParam(i,{shareCode:t})),e&&e!==""?i=Q.replaceParam(i,{accessCode:e}):i=Fe.replaceText(i,I.$extraRule.noAccessCodeRegExp,"");let s=I.$match.matchedInfo.get(n).get(t);if(a.paramMatch){let l=s.matchText.match(a.paramMatch),o={};for(let c=0;c<l.length;c++)o[`$${c}`]=l[c];i=Q.replaceParam(i,o);}return i}},ke={copy(n,r,t,e,a="已复制"){d.setClip(re.getCopyUrlInfo(n,r,t,e)).then(i=>{i?m.success(a):m.error("执行复制失败",{consoleLogContent:true});}).catch(()=>{m.error("执行复制失败",{consoleLogContent:true});});},async parseFile(n,r,t,e){f.success("链接解析：",[...arguments]),Qe.rule[n]?await new Qe.rule[n]().init(r,t,e):(f.error(`${n} 未配置解析函数`,[n,r,t,e]),m.error("该链接未配置解析函数"));},openBlankUrl(n,r,t,e,a,i=false){var l;f.success(`新标签页打开${i?"（后台打开）":""}`,[...arguments]),Be.$data.enable&&Be.addValue({url:n,ruleKeyName:r,ruleIndex:t,shareCode:e,accessCode:a,time:Date.now()}),j.isForwardBlankLink(r)&&(n=j.parseDataToSchemeUri(r,n)),(l=ot("meta[name='referrer']"))==null||l.setAttribute("content","no-referrer");let s=()=>{if(i)Lt(n,{active:false});else try{let o=window.open(n,"_blank");o&&o.focus();}catch(o){f.error(o,n);let c=b.createElement("a");c.setAttribute("href",n),c.setAttribute("target","_blank"),c.click(),c.remove();}};d.isNotNull(a)&&X.linkClickMode_openBlank.openBlankWithCopyAccessCode(r)?d.setClip(a).then(()=>{s();}):s();},openBlankWithScheme(n,r,t,e){f.success("scheme新标签页打开",[...arguments]);let a=re.getBlankUrl(n,r,t,e);a=j.parseDataToSchemeUri(n,a),window.open(a,"_blank");}},fa={async init(n,r,t){let e=re.getBlankUrl("baidu",n,r,t),a=await M.get(e,{headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36",Host:"pan.baidu.com",Referer:`https://pan.baidu.com/share/init?surl=${r}&pwd=${t}`,"sec-ch-ua":'"Chromium";v="134", "Not:A-Brand";v="24", "Google Chrome";v="134"',Origin:"https://pan.baidu.com"},...le}),i=a.data.responseText,s=a.data.finalUrl;return typeof s=="string"&&new URL(s).hostname!=="pan.baidu.com"?{...A.status.verify,msg:`<a href='${s}' target='_blank' style="color: red;">触发百度安全验证</a>`,data:a}:!a.status&&d.isNull(i)?{...A.status.error,data:a}:a.data.finalUrl.includes("404.html")?{...A.status.error,data:a}:i.includes("过期时间：")?{...A.status.success,data:a}:i.includes("输入提取")?{...A.status.needAccessCode,data:a}:i.includes("不存在")||i.includes("已失效")?{...A.status.failed,data:a}:{...A.status.unknown,data:a}}},ma={async init(n,r,t){let e=re.getBlankUrl("lanzou",n,r,t),a=new URL(e),i=await M.get(e,{headers:{"User-Agent":d.getRandomPCUA(),Host:a.hostname,Origin:a.origin,Referer:e},...le});if(!i.status)return {...A.status.error,data:i};let s=i.data.responseText;return d.isNull(s)?{...A.status.failed,data:s}:s.includes("输入密码")?{...A.status.needAccessCode,data:s}:s.includes("来晚啦")||s.includes("不存在")||s.includes("div>文件链接失效，请获取新链接</div>")?{...A.status.failed,data:s}:{...A.status.success,data:s}}},ga={async init(n,r,t){let e=new Qe.rule.lanzouyx;e.shareCodeId=e.getDecodeShareCodeId(r);let a=e.getEncodeTimeStamp(),i=e.getEncodeUUID(),s=await M.post(`https://api.ilanzou.com/unproved/recommend/list?${d.toSearchParamsStr({devType:e.$data.devType,devModel:e.$data.devModel,uuid:i,extra:e.$data.extra,timestamp:a,code:t,shareId:r,type:e.$data.type,offset:e.$data.offset,limit:e.$data.limit})}`,{headers:{Accept:"application/json, text/plain, */*",Origin:"https://www.ilanzou.com",Referer:"https://www.ilanzou.com/","Sec-Fetch-Site":"same-site",Host:"api.ilanzou.com","User-Agent":d.getRandomPCUA()},responseType:"json",...le});if(!s.status)return {...A.status.error,data:s};let l=d.toJSON(s.data.responseText);return f.success("获取链接信息：",l),l.code!==200?{...A.status.error,data:l}:l.list.length?{...A.status.success,data:l}:{...A.status.failed,data:l}}},ba={async init(n,r,t){let e=await M.post("https://api.cloud.189.cn/open/share/getShareInfoByCodeV2.action",{data:`shareCode=${r}`,headers:{Accept:"application/json;charset=UTF-8","Content-Type":"application/x-www-form-urlencoded","User-Agent":d.getRandomPCUA(),"Sign-Type":1,Referer:"https://cloud.189.cn/web/share?code="+r,Origin:"https://cloud.189.cn"},...le}),a=e.data.responseText;return !e.status&&d.isNull(a)?{...A.status.error,data:e}:a.includes("ShareInfoNotFound")||a.includes("ShareNotFound")||a.includes("FileNotFound")||a.includes("ShareAuditWaiting")||a.includes("ShareExpiredError")||a.includes("ShareAuditNotPass")?{...A.status.failed,data:e}:a.includes("needAccessCode")?{...A.status.needAccessCode,data:e}:{...A.status.success,data:e}}},wa={async init(n,r,t){var i;let e=await M.post("https://api.aliyundrive.com/adrive/v3/share_link/get_share_by_anonymous?share_id="+r,{data:JSON.stringify({share_id:r}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","User-Agent":d.getRandomPCUA(),Referer:"https://www.aliyundrive.com/",Origin:"https://www.aliyundrive.com"},...le}),a=d.toJSON(e.data.responseText);return !e.status&&d.isNull(a)?{...A.status.error,data:e}:a.code==="ParamFlowException"||a.code==="NotFound.ShareLink"||a.code==="ShareLink.Cancelled"?{...A.status.failed,data:a}:a.file_count===0||((i=a.file_infos)==null?void 0:i.length)===0?{...A.status.failed,data:a}:{...A.status.success,data:a}}},ka={async init(n,r,t){let e=await M.post("https://www.wenshushu.cn/ap/task/mgrtask",{data:JSON.stringify({tid:r}),headers:{"Content-Type":"application/json","User-Agent":d.getRandomPCUA(),"x-token":"wss:7pmakczzw6i",Host:"www.wenshushu.cn",Origin:"https://www.wenshushu.cn",Referer:re.getBlankUrl("wenshushu",n,r,t)},responseType:"json",...le});if(!e.status&&d.isNull(e.data.responseText))return {...A.status.error,data:e};let a=d.toJSON(e.data.responseText);return a.code!==0?{...A.status.failed,data:a}:{...A.status.success,data:a}}},ya={async init(n,r,t){let e=await M.get(`https://cowtransfer.com/core/api/transfer/share?uniqueUrl=${r}`,{headers:{"User-Agent":d.getRandomPCUA(),Host:"cowtransfer.com",Origin:"https://cowtransfer.com",Referer:"https://cowtransfer.com/"},...le});if(!e.status&&d.isNull(e.data.responseText))return {...A.status.error,data:e};let a=d.toJSON(e.data.responseText);return a.code!="0000"?{...A.status.failed,data:a}:a.data.needPassword&&a.data.needPassword?{...A.status.needAccessCode,data:a}:{...A.status.success,data:a}}},xa={async init(n,r,t){let e=await M.get("https://www.123pan.com/api/share/info?shareKey="+r,{headers:{"User-Agent":d.getRandomPCUA(),Host:"www.123pan.com",Origin:"https://www.123pan.com",Referer:"https://www.123pan.com/"},responseType:"json",...le});if(!e.status&&d.isNull(e.data.responseText))return {...A.status.error,data:e};let a=d.toJSON(e.data.responseText);return e.data.responseText.includes("分享页面不存在")||a.code!==0?{...A.status.failed,data:a}:a.data.HasPwd?{...A.status.needAccessCode,data:a}:{...A.status.success,data:a}}},va={async init(n,r,t){let e=re.getBlankUrl("weiyun",n,r,t),a=await M.get(e,{headers:{"User-Agent":d.getRandomPCUA(),Host:"share.weiyun.com",Origin:"https://share.weiyun.com",Referer:e},...le});if(!a.status&&d.isNull(a.data.responseText))return {...A.status.error,data:a};let i=a.data.responseText;return i.includes("已删除")||i.includes("违反相关法规")||i.includes("已过期")||i.includes("已经删除")||i.includes("目录无效")?{...A.status.failed,data:a}:i.includes('"need_pwd":1')||i.includes('"pwd":"')?{...A.status.needAccessCode,data:a}:{...A.status.success,data:a}}},Ca={async init(n,r,t){let e=await M.post("https://xluser-ssl.xunlei.com/v1/shield/captcha/init",{data:JSON.stringify({client_id:"Xqp0kJBXWhwaTpB6",device_id:"925b7631473a13716b791d7f28289cad",action:"get:/drive/v1/share",meta:{package_name:"pan.xunlei.com",client_version:"1.45.0",captcha_sign:"1.fe2108ad808a74c9ac0243309242726c",timestamp:"1645241033384"}}),headers:{"User-Agent":d.getRandomPCUA(),Host:"pan.xunlei.com",Referer:re.getBlankUrl("xunlei",n,r,t),Origin:"https://pan.xunlei.com"},...le});if(!e.status&&d.isNull(e.data.responseText))return {...A.status.error,data:e};let i=d.toJSON(e.data.responseText).captcha_token,s=await M.get("https://api-pan.xunlei.com/drive/v1/share?share_id="+r,{headers:{"User-Agent":d.getRandomPCUA(),Host:"pan.xunlei.com",Referer:re.getBlankUrl("xunlei",n,r,t),Origin:"https://pan.xunlei.com","x-captcha-token":i,"x-client-id":"Xqp0kJBXWhwaTpB6","x-device-id":"925b7631473a13716b791d7f28289cad"},...le});if(!s.status&&d.isNull(s.data.responseText))return {...A.status.error,data:[e,s]};let l=s.data.responseText;return l.includes("NOT_FOUND")||l.includes("SENSITIVE_RESOURCE")||l.includes("EXPIRED")||l.includes("DELETED")?{...A.status.failed,data:s}:l.includes("PASS_CODE_EMPTY")?{...A.status.needAccessCode,data:s}:{...A.status.success,data:s}}},Sa={async init(n,r,t){let e=re.getBlankUrl("chengtong",n,r,t);const i=new URL(e).pathname.split("/")[1].trim();let s="";if(i==="f"||i==="file")s=`https://webapi.ctfile.com/getfile.php?path=${i}&f=${r}&passcode=${t}&token=0&r=${Math.random()}&ref=`;else if(i==="d"||i==="dir")s=`https://webapi.ctfile.com/getdir.php?path=${i}&d=${r}&folder_id=&passcode=${t}&token=0&r=${Math.random()}&ref=`;else return f.warn("未知path",[n,r,t]),{...A.status.unknown,data:null};let l=await M.get(s,{headers:{Host:"webapi.ctfile.com",Origin:"https://url95.ctfile.com",Referer:e,Accept:"application/json, text/javascript, */*; q=0.01","User-Agent":d.getRandomPCUA()},...le}),o=l.data.responseText;if(!l.status&&d.isNull(o))return {...A.status.error,data:l};let c=d.toJSON(o);return c.code===200?{...A.status.success,data:c}:c.code===401?{...A.status.needAccessCode,data:c}:c.code===404||c.code===503||c.code===504?{...A.status.failed,data:c}:{...A.status.unknown,data:c}}},Aa={async init(n,r,t){let e=await M.post("https://drive.quark.cn/1/clouddrive/share/sharepage/token?pr=ucpro&fr=pc",{data:JSON.stringify({pwd_id:r,passcode:""}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8","User-Agent":d.getRandomPCUA(),Origin:"https://pan.quark.cn",Referer:re.getBlankUrl("kuake",n,r,t)},...le});if(!e.status&&d.isNull(e.data.responseText))return {...A.status.error,data:e};let a=d.toJSON(e.data.responseText);if(a.message.includes("需要提取码"))return {...A.status.needAccessCode,data:a};if(a.message.includes("ok")){let i=a.data.stoken,s={pwd_id:r,stoken:i,_fetch_share:1,__t:Date.now()},l=await M.get(`https://drive-h.quark.cn/1/clouddrive/share/sharepage/detail?${d.toSearchParamsStr(s)}`,{headers:{Accept:"application/json, text/plain, */*",Origin:"https://pan.quark.cn",Referer:"https://pan.quark.cn/","User-Agent":d.getRandomPCUA()},...le});if(!l.status||d.isNull(l.data.responseText))return {...A.status.error,data:l};let o=d.toJSON(l.data.responseText);return o.data.share.status==1?o.data.share.partial_violation?{...A.status.partialViolation,data:[a,o]}:{...A.status.success,data:[a,o]}:{...A.status.failed,data:[a,o]}}else return {...A.status.failed,data:a}}},Ra={async init(n,r,t){let e=re.getBlankUrl("jianguoyun",n,r,t),a=await M.get(e,{headers:{"User-Agent":d.getRandomPCUA(),Host:"www.jianguoyun.com",Referer:re.getBlankUrl("jianguoyun",n,r,t),Origin:"https://www.jianguoyun.com"},...le}),i=a.data.responseText;return !a.status&&d.isNull(i)?{...A.status.error,data:a}:i.includes("<h1>啊噢！")?{...A.status.failed,data:a}:{...A.status.success,data:a}}},_a={async init(n,r,t){var l,o,c;let e=re.getBlankUrl("onedrive",n,r,t),a=new URL(e),i=await M.get(e,{headers:{"User-Agent":d.getRandomPCUA(),Host:a.hostname,Referer:e,Origin:a.origin},...le});if(!i.status){let u=(o=(l=i.data)==null?void 0:l.status)==null?void 0:o.toString();return u==="429"?{...A.status.error,data:i}:u==="404"?{...A.status.failed,data:i}:{...A.status.error,data:i}}let s=i.data.responseText;if(d.isNotNull(s))try{let p=(c=b.parseHTML(s,!0,!0).querySelector("title"))==null?void 0:c.innerHTML;if(p!=null&&p.includes("错误"))return {...A.status.failed,data:i}}catch{}return {...A.status.success,data:i}}},Da={async init(n,r,t){let e=await M.get("https://drive.uc.cn/s/"+r,{headers:{"User-Agent":d.getRandomAndroidUA(),Host:"drive.uc.cn",Referer:re.getBlankUrl("uc",n,r,t),Origin:"https://drive.uc.cn"},...le}),a=e.data.responseText;if(!e.status&&d.isNull(a))return {...A.status.error,data:e};let i=b.parseHTML(a,true,true);if(i.querySelector(".h5-page-main")){let s=i.querySelector(".h5-page-main"),l=s.textContent||s.innerText;return l.includes("失效")||l.includes("不存在")||l.includes("违规")||l.includes("删除")?{...A.status.failed,data:e}:{...A.status.unknown,data:e}}else return i.querySelector(".main-body .input-wrap input")?{...A.status.needAccessCode,data:e}:{...A.status.success,data:e}}},Na={async init(n,r,t){let e=await M.get(`https://webapi.115.com/share/snap?share_code=${r}&offset=0&limit=20&receive_code=&cid=`,{headers:{Accept:"application/json, text/javascript, */*;","User-Agent":d.getRandomPCUA(),Host:"webapi.115.com",Referer:"https://115.com/",Origin:"https://115.com"},...le});if(!e.status)return d.isNull(e.data.responseText)?{...A.status.failed,data:e}:{...A.status.error,data:e};let a=d.toJSON(e.data.responseText);if(a.state)return {...A.status.success,data:a};if(typeof a.error=="string"){if(a.error.includes("访问码"))return {...A.status.needAccessCode,data:a};if(a.error.includes("链接")||a.error.includes("分享已取消"))return {...A.status.failed,data:a}}return {...A.status.unknown,data:a}}},Ta={async init(n,r,t){let e="https://www.yunpan.com/lk/surl_"+r,a=await M.get(e,{headers:{"User-Agent":d.getRandomPCUA()},responseType:"json",...le});if(!a.status&&d.isNull(a.data.responseText))return {...A.status.error,data:a};let s=b.parseHTML(a.data.responseText,true,true).querySelector(".page-error .error-msg");if(s){let l=b.text(s);return l.includes("分享链接已失效")?{...A.status.failed,data:a}:{...A.status.unknown,data:a,tipMsg:l}}return {...A.status.success,data:a}}},Ma={loading:{code:1,msg:"验证中...",setIcon(n){b.html(n,K.config.iconSVG.loading);},setView(n,r,t){A.setViewCheckValid(n,"loading",t??this.msg),this.setIcon(n);}},success:{code:200,msg:"有效",setIcon(n){b.html(n,`
				<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
					<path
					fill="currentColor"
					d="M874.119618 149.859922A510.816461 510.816461 0 0 0 511.997 0.00208a509.910462 509.910462 0 0 0-362.119618 149.857842c-199.817789 199.679789-199.817789 524.581447 0 724.260236a509.969462 509.969462 0 0 0 362.119618 149.857842A508.872463 508.872463 0 0 0 874.119618 874.120158c199.836789-199.679789 199.836789-524.581447 0-724.260236zM814.94268 378.210681L470.999043 744.132295a15.359984 15.359984 0 0 1-5.887994 4.095996c-1.751998 1.180999-2.913997 2.362998-5.276994 2.913997a34.499964 34.499964 0 0 1-13.469986 2.914997 45.547952 45.547952 0 0 1-12.897986-2.303998l-4.095996-2.363997a45.291952 45.291952 0 0 1-7.009992-4.095996l-196.902793-193.789796a34.126964 34.126964 0 0 1-10.555989-25.186973c0-9.37399 3.583996-18.74698 9.98399-25.186974a36.429962 36.429962 0 0 1 50.372947 0l169.98382 167.423824L763.389735 330.220732a37.059961 37.059961 0 0 1 50.371947-1.732998 33.647965 33.647965 0 0 1 11.165988 25.186973 35.544963 35.544963 0 0 1-9.98399 24.575974v-0.04z m0 0"></path>
				</svg>
				`);},setView(n,r,t){A.setViewCheckValid(n,"success",t??this.msg),this.setIcon(n),A.setViewAgainCheckClickEvent(n,r);}},error:{code:-404,msg:"网络异常",setIcon(n){b.html(n,`
				<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
					<path
					fill="currentColor"
					d="M511.808 692.224c-18.048 0-35.136 3.968-50.432 11.392-25.472 12.416-46.528 33.92-57.792 60.032-5.632 14.144-9.024 29.504-9.024 45.952 0 65.152 52.672 117.824 117.248 117.824 65.28 0 117.952-52.672 117.952-117.824 0-64.64-52.672-117.376-117.952-117.376z m0 178.496c-33.408 0-60.608-27.712-60.608-61.12 0-33.472 27.2-60.672 60.608-60.672s61.248 27.2 61.248 60.672c0 33.472-27.776 61.12-61.248 61.12zM286.784 661.632c3.968 3.392 8.512 5.632 12.992 5.632L438.08 523.328c-60.032 14.72-114.432 49.344-155.328 98.624-9.536 11.84-7.872 30.08 4.032 39.68zM622.912 534.656l-43.008 45.312c45.312 13.056 86.72 40.256 117.376 78.208 5.632 6.784 13.568 10.24 22.08 10.24 6.272 0 12.416-2.24 18.176-6.784 11.904-9.6 13.568-27.84 3.392-39.68-31.808-39.104-72.704-69.12-118.016-87.296zM511.808 391.168c17.024 0 33.408 1.216 49.856 3.456l47.68-49.856c-31.744-6.848-64.064-10.24-97.536-10.24-142.784 0-277.12 63.488-367.232 174.656-10.24 11.904-8.576 30.08 3.904 39.68 5.12 4.48 11.328 6.784 18.176 6.784 7.936 0 15.872-3.968 21.568-10.816 79.872-97.536 197.76-153.664 323.584-153.664zM751.616 400.32l-40.256 41.92c47.04 24.96 89.536 60.032 124.096 102.592 10.24 12.48 27.84 14.208 40.256 3.968 11.968-9.6 13.632-27.84 3.968-39.68-36.16-44.8-79.872-81.088-128.064-108.8zM705.152 244.928l42.56-44.672c-73.664-28.992-153.6-44.224-235.904-44.224-196.672 0-380.864 87.872-505.6 239.744-9.6 12.48-7.872 30.08 3.968 40.256 5.632 3.968 11.904 6.208 18.112 6.208 7.936 0 16.448-3.392 22.144-10.176C163.84 292.608 332.096 212.672 511.808 212.672c66.944 0 132.16 10.752 193.344 32.256zM1017.472 395.776c-40.192-49.92-87.296-92.416-139.456-126.976l-39.68 41.344C889.408 343.04 935.36 383.808 973.888 432c9.6 11.904 27.776 13.568 39.68 3.968 11.84-10.176 14.144-27.712 3.904-40.192zM937.408 104.512c-11.328-10.944-29.312-10.496-40.064 0.832L179.008 854.72c-10.816 11.328-10.496 29.248 0.896 40.064 5.44 5.312 12.48 7.872 19.584 7.872 7.488 0 14.848-2.88 20.416-8.704L938.24 144.576c10.88-11.328 10.496-29.248-0.832-40.064z"></path>
				</svg>
				`);},setView(n,r,t){A.setViewCheckValid(n,"error",t??this.msg),this.setIcon(n),A.setViewAgainCheckClickEvent(n,r);}},verify:{code:-405,msg:"触发安全验证",setIcon(n){b.html(n,`
				<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
					<path 
						fill="currentColor"
						d="M514.389 1005.60899999c-269.967 0-489.59499999-219.642-489.595-489.59499999S244.42199999 26.405 514.389 26.405 1003.984 246.047 1003.984 516s-219.62800001 489.60899999-489.595 489.60900001z m0-938.24399999C267.00400001 67.365 65.754 268.615 65.754 516s201.264 448.63499999 448.635 448.635S963.024 763.385 963.024 516 761.774 67.365 514.389 67.365z" p-id="9895"></path><path d="M245.993 621.56800001c41.014-8.138 86.112-18.03600001 135.264-29.71000001-0.355 14.145-0.177 26.69199999 0.532 37.65499999-40.318 8.493-82.93 18.92400001-127.836 31.29400001l-7.959-39.23900001z m78.506-261.50200001l-12.206 145.872h53.57500001l13.78999998-178.763H259.249v-36.073h160.727l-16.438 214.821h33.423c-2.471 74.61499999-4.779 135.973-6.895 184.06100002-1.065 53.754-24.399 80.623-70.01399999 80.62299998-19.101 0-41.547-0.53200001-67.36500001-1.598-1.775-13.079-4.06799999-27.047-6.895-41.902 25.46300001 3.181 48.087 4.779 67.898 4.779 24.753 0 37.834-15.033 39.253-45.084 2.11599999-38.898 3.891-87.163 5.31099998-144.807H270.951l16.971-181.945h36.577z m309.248-98.659l-10.076 16.971c42.789 76.03500001 95.833 131.373 159.13 166.025-11.318 14.145-20.685 26.528-28.112 37.13699999-62.231-45.971-112.981-101.30799999-152.235-166.02499998-36.073 64.006-86.466 121.474-151.17000001 172.38699999-6.363-9.18799999-15.21-20.33-26.52799998-33.423 70.369-48.797 124.30000001-113.158 161.77799999-193.086h47.213zM441.194 718.111h191.488c25.46300001-62.942 48.087-128.723 67.89800001-197.318l40.31799999 12.725c-20.862 63.297-42.96699999 124.832-66.301 184.593h93.361v36.60499999H441.19300001v-36.60499999z m27.047-169.73900001l37.137-11.67399999c17.32599998 50.217 31.82600002 94.945 43.5 134.198l-39.253 13.258c-11.674-45.261-25.46300001-90.522-41.383-135.78200001z m27.06099999-91.76399999h218.53500001v36.605H495.30200001v-36.605z m64.17100001 67.885l37.655-10.076c14.854 53.043 27.047 99.369 36.605 138.977l-38.72099999 11.141c-10.254-48.797-22.091-95.477-35.53900001-140.04300001z">
					</path>
				</svg>
				`);},setView(n,r,t){A.setViewCheckValid(n,"verify",t??this.msg),this.setIcon(n),A.setViewAgainCheckClickEvent(n,r);}},failed:{code:0,msg:"已失效",setIcon(n){b.html(n,`
				<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
					<path
						fill="currentColor"
						d="M549.044706 512l166.189176-166.249412a26.383059 26.383059 0 0 0 0-36.98447 26.383059 26.383059 0 0 0-37.044706 0L512 475.015529l-166.249412-166.249411a26.383059 26.383059 0 0 0-36.98447 0 26.383059 26.383059 0 0 0 0 37.044706L475.015529 512l-166.249411 166.249412a26.383059 26.383059 0 0 0 0 36.98447 26.383059 26.383059 0 0 0 37.044706 0L512 548.984471l166.249412 166.249411a26.383059 26.383059 0 0 0 36.98447 0 26.383059 26.383059 0 0 0 0-37.044706L548.984471 512zM512 1024a512 512 0 1 1 0-1024 512 512 0 0 1 0 1024z"></path>
				</svg>
				`);},setView(n,r,t){A.setViewCheckValid(n,"failed",t??this.msg),this.setIcon(n),A.setViewAgainCheckClickEvent(n,r);}},needAccessCode:{code:201,msg:"需要提取码",setIcon(n){b.html(n,`
				<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
					<path
					fill="currentColor"
					d="M757.810429 373.751333 325.645708 373.751333l0-83.895759c0-103.694687 81.507362-184.922686 185.559183-184.922686 78.121242 0 146.053424 46.74565 173.062568 119.090329 3.865028 10.352789 15.384385 15.609513 25.742291 11.746532 10.351766-3.866051 15.609513-15.390525 11.744485-25.742291C688.844707 121.877815 606.198405 64.918545 511.204891 64.918545c-61.918211 0-119.246895 23.662933-161.423483 66.63156-41.3692 42.142819-64.151066 98.363262-64.151066 158.305469l0 83.895759-20.007683 0c-60.774155 0-110.042255 49.267077-110.042255 110.042255l0 366.139981c0 60.774155 49.267077 110.042255 110.042255 110.042255l492.187769 0c60.775178 0 110.042255-49.267077 110.042255-110.042255L867.852684 483.793588C867.852684 423.01841 818.585607 373.751333 757.810429 373.751333zM827.837318 849.933569c0 38.674834-31.352055 70.02689-70.02689 70.02689L265.62266 919.960459c-38.674834 0-70.02689-31.352055-70.02689-70.02689L195.59577 483.793588c0-38.674834 31.352055-70.02689 70.02689-70.02689l492.187769 0c38.674834 0 70.02689 31.352055 70.02689 70.02689L827.837318 849.933569z"></path>
					<path
					fill="currentColor"
					d="M509.715981 583.832002c-11.048637 0-20.007683 8.959046-20.007683 20.007683l0 110.042255c0 11.048637 8.958022 20.007683 20.007683 20.007683s20.007683-8.958022 20.007683-20.007683L529.723663 603.839685C529.723663 592.790024 520.765641 583.832002 509.715981 583.832002z"></path>
				</svg>
				`);},setView(n,r,t){A.setViewCheckValid(n,"needAccessCode",t??this.msg),this.setIcon(n),A.setViewAgainCheckClickEvent(n,r);}},partialViolation:{code:202,msg:"存在部分违规文件",setIcon(n){b.html(n,`
				<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
					<path 
					fill="currentColor"
					d="M954.963 810.267L543.112 96.919c-14.07-24.37-49.245-24.37-63.315 0L67.945 810.267c-14.07 24.37 3.518 54.832 31.657 54.832h823.703c28.141 0 45.728-30.463 31.658-54.832zM476.699 306.55c0-19.115 15.64-34.755 34.755-34.755 19.115 0 34.755 15.64 34.755 34.755v281.817c0 19.115-15.64 34.755-34.755 34.755-19.115 0-34.755-15.64-34.755-34.755V306.55z m34.755 445.293c-23.198 0-42.004-18.806-42.004-42.004s18.806-42.004 42.004-42.004c23.198 0 42.004 18.806 42.004 42.004s-18.806 42.004-42.004 42.004z"></path>
				</svg>`);},setView(n,r,t){A.setViewCheckValid(n,"partial-violation",t??this.msg),this.setIcon(n);}},unknown:{code:-200,msg:"未知检查情况",setIcon(n){b.html(n,`
				<svg viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg">
					<path
					fill="currentColor"
					d="M512.473172 1023.995242A511.814852 511.814852 0 0 1 313.545134 40.351073a512.244696 512.244696 0 0 1 398.855715 943.658633 508.815937 508.815937 0 0 1-199.927677 39.985536z m0-943.658634C274.559237 80.336608 80.629391 274.266455 80.629391 512.18039s193.929846 431.843781 431.843781 431.843781 431.843781-193.929846 431.843781-431.843781S751.386745 80.336608 512.473172 80.336608z"></path>
					<path
					fill="currentColor"
					d="M506.475342 716.10662a39.985535 39.985535 0 0 1-39.985536-39.985535v-76.972156c0-79.971071 64.976495-144.947566 144.947566-144.947565a77.971794 77.971794 0 0 0 0-155.943588H445.4974a56.979388 56.979388 0 0 0-56.979387 56.979388 39.985535 39.985535 0 0 1-79.971071 0c0-74.972879 60.977941-136.950458 136.950458-136.950459h164.940333c86.968539 0 157.942864 70.974325 157.942865 157.942865s-69.974687 157.942864-157.942865 157.942864a64.976495 64.976495 0 0 0-64.976494 64.976495v76.972156a39.985535 39.985535 0 0 1-38.985897 39.985535zM505.475703 742.097218a48.982281 48.982281 0 1 0 48.982281 48.982281 48.982281 48.982281 0 0 0-48.982281-48.982281z"></path>
				</svg>
				`);},setView(n,r,t){A.setViewCheckValid(n,"unknown",t??this.msg),this.setIcon(n),A.setViewAgainCheckClickEvent(n,r);}}},$a={baidu:fa,lanzou:ma,lanzouyx:ga,tianyiyun:ba,aliyun:wa,wenshushu:ka,nainiu:ya,_123pan:xa,weiyun:va,xunlei:Ca,_115pan:Na,chengtong:Sa,kuake:Aa,jianguoyun:Ra,onedrive:_a,uc:Da,"360yunpan":Ta},le={allowInterceptConfig:false,onerror(){},ontimeout(){}},A={$data:{isConsuming:false,subscribe:[]},status:Ma,ruleCheckValidFunction:$a,async check(n,r,t,e,a){if(this.$data.subscribe.push({$urlBox:n,ruleKeyName:r,ruleIndex:t,shareCode:e,accessCode:a}),!this.$data.isConsuming){this.$data.isConsuming=true;for(let i=0;i<this.$data.subscribe.length;i++){const s=this.$data.subscribe[i];await this.checkLinkValidity(s,true),await d.sleep(250),this.$data.subscribe.splice(i,1),i--;}this.$data.isConsuming=false;}},async checkLinkValidity(n,r){const{$checkValidStatus:t}=de.parseViewBoxElementInfo(n.$urlBox);if(this.isViewCheckValid(t)&&!r)return;this.setCheckStatusElementToolTip(n);let e=n.ruleKeyName;if(!X.function.checkLinkValidity(e)){f.error("未开启checkLinkValidity功能",n);return}let a=this.ruleCheckValidFunction[n.ruleKeyName];if(!a||a&&typeof a.init!="function"){f.error("没有配置该网盘的校验有效性",n);return}this.status.loading.setView(t,n);let i=await a.init(n.ruleIndex,n.shareCode,n.accessCode);if(!i){f.error("该验证函数的返回值不是有效值",[i,n]);return}i.setView(t,n,i.tipMsg),i.data&&Reflect.set(t,"data-httpx-response",i.data);},setViewAgainCheckClickEvent(n,r){b.on(n,"click",void 0,()=>{const{$urlBox:t,$link:e}=de.parseViewBoxElementInfo(n),a=de.praseElementAttributeRuleInfo(e);let i={$urlBox:t,ruleKeyName:a.ruleKeyName,ruleIndex:a.ruleIndex,shareCode:a.shareCode,accessCode:a.accessCode};this.checkLinkValidity(i,true);},{once:true});},isViewCheckValid(n){return !(!n.hasAttribute("data-check-valid")||n.getAttribute("data-check-valid")==="error")},setViewCheckValid(n,r,t){n.setAttribute("data-check-valid",r),n.setAttribute("data-msg",t),Reflect.set(n,"data-msg",t);},removeViewCheckValid(n){n.removeAttribute("data-check-valid"),n.removeAttribute("data-msg"),Reflect.deleteProperty(n,"data-msg");},isStatusSuccess(n){return Math.floor(n.code/100)===2},getStatusName(n){for(const r of Object.keys(A.status)){let t=this.status[r];if(n.code===t.code)return r}},setCheckStatusElementToolTip(n){if(!X.function.checkLinlValidityHoverTip(n.ruleKeyName))return;function r(){const{$checkValidStatus:a}=de.parseViewBoxElementInfo(n.$urlBox);return a}let t=r();if(t.hasAttribute("data-pops-tooltip"))return;t.setAttribute("data-pops-tooltip","true");let e=a=>{let i=Reflect.get(a,"data-msg"),s=a.getAttribute("data-msg");return i??s};K.tooltip({target:t,className:"github-tooltip",isFixed:true,content(){return e(t)},showBeforeCallBack(){let a=e(t);if(a==null||typeof a=="string"&&a.trim()==="")return  false},zIndex(){let a=d.getMaxZIndex(10),i=K.config.InstanceUtils.getPopsMaxZIndex(10).zIndex;return d.getMaxValue(a,i)+100}});}},Ia={requiredFileMap:new Map,async file(n,r){if(d.isNull(n))return f.error("NetDiskRequire.file的参数path为空",n),false;if(this.requiredFileMap.has(n))return f.warn("NetDiskRequire.file的参数path已引入过",n),true;let t=await M.get(n,r);if(!t.status)return  false;let e=t.data.responseText,a=this.requiredFileMap.get(n);return this.requiredFileMap.set(n,a++),f.info("加载js文件",n),he.eval(`
		let exports = void 0;
		let module = void 0;
		let define = void 0;
		`+e),await d.sleep(300),true}},_t=n=>({"matchRange-text-before":X.matchRange_text.before(n).toString(),"matchRange-text-after":X.matchRange_text.after(n).toString()}),Dt=n=>({"matchRange-html-before":X.matchRange_html.before(n).toString(),"matchRange-html-after":X.matchRange_html.after(n).toString()}),Ve={handleShareCode(n,r,t){var s;let e=(s=n.match(r.shareCode))==null?void 0:s.filter(l=>d.isNotNull(l));if(t({status:true,msg:["正则: shareCode","作用: 获取shareCode","结果: ",JSON.stringify(e)]}),d.isNull(e)){t({status:false,msg:"匹配shareCode为空"});return}let a=e[0];t({status:true,msg:["取第一个值: "+a]}),r.shareCodeNeedRemoveStr&&(a=a.replace(r.shareCodeNeedRemoveStr,""),t({status:true,msg:["正则: shareCodeNeedRemoveStr","作用: 删除ShareCode前面不需要的字符串",`结果: ${a}`]}));let i=r.shareCodeNotMatch;if(i!=null&&a.match(i)){f.error(`不可能的shareCode => ${a}`),t({status:false,msg:["正则: shareCodeNotMatch","作用: 用于判断提取到的shareCode是否是错误的shareCode","结果: true 该shareCode不是正确的"]});return}for(const l of I.$extraRule.shareCodeNotMatchRegexpList)if(a.match(l)){f.error(`不可能的shareCode => ${a}`),t({status:false,msg:["正则: 内置的shareCodeNotMatchRegexpList","作用: 使用该正则判断提取到的shareCode是否正确","结果: true 该shareCode不是正确的"]});return}if(a=decodeURI(a),t({status:true,msg:["对shareCode进行解码: "+a]}),y.shareCode.excludeIdenticalSharedCodes.value&&d.isSameChars(a,y.shareCode.excludeIdenticalSharedCodesCoefficient.value)){t({status:false,msg:["已开启【排除分享码】且该分享码命中该规则"]});return}if(a.endsWith("http")||a.endsWith("https")){t({status:false,msg:["该分享码以http|https结尾"]});return}return t({status:true,msg:"处理完毕的shareCode: "+a}),a},handleAccessCode(n,r,t){var i;let e="";if(!r.checkAccessCode)return t({status:true,msg:"因未配置规则checkAccessCode，默认accessCode的值为空"}),"";let a=n.match(r.checkAccessCode);if(t({status:true,msg:["正则: checkAccessCode","作用: 用来判断link_innerText或者link_innerHTML匹配到的字符串中是否存在密码","结果: ",JSON.stringify(a)]}),a){let s=a[a.length-1];t({status:true,msg:"取最后一个值: "+s});let l=(i=s.match(r.accessCode))==null?void 0:i.filter(o=>d.isNotNull(o));if(t({status:true,msg:["正则: accessCode","作用: 用来提取link_innerText或者link_innerHTML匹配到的字符串中的密码","结果: ",JSON.stringify(l)]}),d.isNull(l))return t({status:true,msg:"因↑匹配到的结果为空，默认accessCode的值为空"}),"";l.length&&(e=l[0],t({status:true,msg:"取第一个值: "+e}),e.startsWith("http")&&(t({status:true,msg:"排除不可能的accessCode，重置accessCode的值为空"}),e=""));}if(d.isNotNull(e)){for(const s of I.$extraRule.accessCodeNotMatchRegexpList)if(e.match(s)){e="",t({status:true,msg:["正则: 内置的accessCodeNotMatchRegexpList","作用: 使用该正则判断提取到的accessCode是否正确","结果: true 重置accessCode为空"]});break}r.acceesCodeNotMatch&&e.match(r.acceesCodeNotMatch)&&(e="",t({status:true,msg:["正则: acceesCodeNotMatch","作用: 用于判断提取到的accessCode是否是错误的accessCode","结果: true 重置accessCode为空"]}));}return t({status:true,msg:"处理完毕的accessCode: "+e}),e},handleLinkShow(n,r,t,e,a){let i=Q.replaceParam(r.uiLinkShow,{shareCode:t});if(a({status:true,msg:["正则: uiLinkShow","作用: 用于显示在弹窗中的字符串","备注: 对shareCode进行参数替换",`结果: ${i}`]}),e&&e!=""?(i=Q.replaceParam(i,{accessCode:e}),a({status:true,msg:["正则: uiLinkShow","作用: 用于显示在弹窗中的字符串","备注: 对accessCode进行参数替换",`结果: ${i}`]})):(i=Fe.replaceText(i,I.$extraRule.noAccessCodeRegExp,""),a({status:true,msg:["正则: 内置的noAccessCodeRegExp","作用: 因accessCode为空，使用该正则去除不需要的字符串",`结果: ${i}`]})),r.paramMatch&&d.isNotNull(n)){let s=n.match(r.paramMatch),l={};if(s)for(let o=0;o<s.length;o++)l[`$${o}`]=s[o];i=Q.replaceParam(i,l),a({status:true,msg:["正则: paramMatch","作用: 用于对matchText进行提取需要的关键内容，替换关键字：{#$1#}、{#$2#}...","参数: "+JSON.stringify(l,void 0,4),`结果: ${i}`]});}return a({status:true,msg:"处理完毕的uiLink: "+i}),i},handleBlank(n,r,t,e,a){let i=Q.replaceParam(r.blank,{shareCode:t});if(a({status:true,msg:["正则: blank","作用: 用于点击跳转的链接","备注: 对shareCode进行参数替换",`结果: ${i}`]}),e&&e!=""?(i=Q.replaceParam(i,{accessCode:e}),a({status:true,msg:["正则: blank","作用: 用于点击跳转的链接","备注: 对accessCode进行参数替换",`结果: ${i}`]})):(i=Fe.replaceText(i,I.$extraRule.noAccessCodeRegExp,""),a({status:true,msg:["正则: 内置的noAccessCodeRegExp","作用: 因accessCode为空，使用该正则去除不需要的字符串",`结果: ${i}`]})),r.paramMatch&&d.isNotNull(n)){let s=n.match(r.paramMatch),l={};if(s)for(let o=0;o<s.length;o++)l[`$${o}`]=s[o];i=Q.replaceParam(i,l),a({status:true,msg:["正则: paramMatch","作用: 用于对matchText进行提取需要的关键内容，替换关键字：{#$1#}、{#$2#}...","参数: "+JSON.stringify(l,void 0,4),`结果: ${i}`]});}return a({status:true,msg:"处理完毕的blank: "+i}),i},handleCopyUrl(n,r,t,e,a){let i=Q.replaceParam(r.copyUrl,{shareCode:t});if(a({status:true,msg:["正则: copyUrl","作用: 用于复制到剪贴板的链接","备注: 对shareCode进行参数替换",`结果: ${i}`]}),e&&e!=""?(i=Q.replaceParam(i,{accessCode:e}),a({status:true,msg:["正则: copyUrl","作用: 用于复制到剪贴板的链接","备注: 对accessCode进行参数替换",`结果: ${i}`]})):(i=Fe.replaceText(i,I.$extraRule.noAccessCodeRegExp,""),a({status:true,msg:["正则: 内置的noAccessCodeRegExp","作用: 因accessCode为空，使用该正则去除不需要的字符串",`结果: ${i}`]})),r.paramMatch&&d.isNotNull(n)){let s=n.match(r.paramMatch),l={};if(s)for(let o=0;o<s.length;o++)l[`$${o}`]=s[o];i=Q.replaceParam(i,l),a({status:true,msg:["正则: paramMatch","作用: 用于对matchText进行提取需要的关键内容，替换关键字：{#$1#}、{#$2#}...","参数: "+JSON.stringify(l,void 0,4),`结果: ${i}`]});}return a({status:true,msg:"处理完毕的copyUrl: "+i}),i}},ze={depthQueryShadowRootAllNode(n){let r=[];function t(e){let a=Array.from(e.querySelectorAll("*"));return a.forEach(i=>{if(i.classList&&i.classList.contains("pops-shadow-container"))return;let s=i.shadowRoot;s&&s instanceof ShadowRoot&&r.push({shadowRoot:s,childNode:t(s)});}),a}return t(n),r},ignoreStrRemove(n,r=false){let t=[];return t.length&&t.forEach(e=>{if(e!=null)if(r)e.innerHTML!=null&&(n=n.replaceAll(e.innerHTML,""));else {let a=e.innerText||e.textContent;a!=null&&(a=a.replaceAll(a,""));}}),n},getPageText(n=document.documentElement,r){let t=[];if(t.push((n==null?void 0:n.textContent)||(n==null?void 0:n.innerText)||""),r){let e=this.depthQueryShadowRootAllNode(n);e.length&&e.forEach(a=>{let i=a.shadowRoot.textContent;i&&t.push(i);});}return t=t.filter(e=>e!==""),t},getPageHTML(n=document.documentElement,r){let t=[];if(t.push(n.innerHTML),r){let e=this.depthQueryShadowRootAllNode(n);e.length&&e.forEach(a=>{let i=a.shadowRoot.innerHTML;i&&t.push(i);});}return t=t.filter(e=>e!==""),t},getInputElementValue(n=document.documentElement,r){let t=[];if(Array.from(n.querySelectorAll("input")).forEach(e=>{t.push(e.value);}),r){let e=this.depthQueryShadowRootAllNode(n);e.length&&e.forEach(a=>{for(let i=0;i<a.childNode.length;i++){const s=a.childNode[i];s instanceof HTMLInputElement&&s.value&&t.push(s.value);}});}return t},getTextAreaElementValue(n=document.documentElement,r){let t=[];if(Array.from(n.querySelectorAll("textarea")).forEach(e=>{t.push(e.value);}),r){let e=this.depthQueryShadowRootAllNode(n);e.length&&e.forEach(a=>{for(let i=0;i<a.childNode.length;i++){const s=a.childNode[i];s instanceof HTMLTextAreaElement&&s.value&&t.push(s.value);}});}return t},getSelectContent(){let n={text:"",html:""},r=window.getSelection();if(r){n.text=r.toString();let t=b.createElement("div");if(!r.isCollapsed){const e=r.getRangeAt(0).cloneContents();t.appendChild(e),n.html=b.html(t);}}return n}},Ea=`.whitesevPopNetDiskHistoryMatch .pops-confirm-content ul {\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content li {\r
	display: flex;\r
	flex-direction: column;\r
	justify-content: center;\r
	border-radius: 10px;\r
	box-shadow: 0 0.3px 0.6px rgb(0 0 0 / 6%), 0 0.7px 1.3px rgb(0 0 0 / 8%),\r
		0 1.3px 2.5px rgb(0 0 0 / 10%), 0 2.2px 4.5px rgb(0 0 0 / 12%),\r
		0 4.2px 8.4px rgb(0 0 0 / 14%), 0 10px 20px rgb(0 0 0 / 20%);\r
	margin: 20px 10px;\r
	padding: 10px;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-search {\r
	height: 11%;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-table {\r
	height: calc(85% - 40px);\r
	overflow: auto;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-page {\r
	display: flex;\r
	justify-content: center;\r
	align-items: center;\r
	margin-top: 10px;\r
}\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-search\r
	input {\r
	border: none;\r
	border-bottom: 1px solid #000000;\r
	padding: 0px 5px;\r
	line-height: normal;\r
	width: -moz-available;\r
	width: -webkit-fill-available;\r
	width: fill-available;\r
	margin: 5px 5px 0px 5px;\r
	background: none;\r
}\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-search\r
	input:focus-visible {\r
	outline: none;\r
	border-bottom: 1px solid #0009ff;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link {\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link a {\r
	color: #ff4848;\r
	font-size: 0.8em;\r
	border: none;\r
	word-break: break-word;\r
}\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-link\r
	a[isvisited="true"] {\r
	color: #8b8888;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-icon {\r
}\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-icon\r
	.netdisk-icon-img {\r
	width: 28px;\r
	height: 28px;\r
	min-width: 28px;\r
	min-height: 28px;\r
	font-size: 0.8em;\r
	border-radius: 10px;\r
	box-shadow: 0 0.3px 0.6px rgb(0 0 0 / 6%), 0 0.7px 1.3px rgb(0 0 0 / 8%),\r
		0 1.3px 2.5px rgb(0 0 0 / 10%), 0 2.2px 4.5px rgb(0 0 0 / 12%),\r
		0 4.2px 8.4px rgb(0 0 0 / 14%), 0 10px 20px rgb(0 0 0 / 20%);\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-url {\r
	color: #000;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-top-url {\r
	color: #000;\r
}\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-functions\r
	button.btn-delete {\r
	background: #263cf3;\r
	color: #fff;\r
}\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-functions\r
	button.btn-delete:active {\r
	background: #6e7be8;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-icon,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-url,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-top-url,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-add-time,\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-update-time,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-url-title,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-functions {\r
	display: flex;\r
	margin: 5px 0px;\r
}\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-icon p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-url p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-top-url p,\r
.whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-add-time p,\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-update-time\r
	p,\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-url-title\r
	p,\r
.whitesevPopNetDiskHistoryMatch\r
	.pops-confirm-content\r
	.netdiskrecord-functions\r
	p {\r
	min-width: 80px;\r
	max-width: 80px;\r
	align-self: center;\r
}\r
`,tt={storageKey:"netDiskHistoryMatch",isSetOtherEvent:false,dataPaging:void 0,show(){let n=this.getStorageData(),r="",t=this;n=this.orderNetDiskHistoryMatchData(n);for(let e=0;e<10;e++)n[e]&&(r+=t.getTableHTML(n[e]).html);r=`
        <div class="netdiskrecord-search">
            <input type="text" placeholder="搜索链接/网址/网址标题，可正则搜索">
        </div>
        <div class="netdiskrecord-table"><ul>${r}</ul></div>
        <div class="netdiskrecord-page">

        </div>`,x.Alias.historyAlias=P.confirm({title:{text:"历史匹配记录",position:"center"},content:{text:r,html:true},btn:{reverse:true,position:"space-between",ok:{enable:true,callback(e){e.close(),x.Alias.historyAlias=void 0;}},close:{callback(e){e.close(),x.Alias.historyAlias=void 0;}},cancel:{enable:false},other:{enable:true,text:`清空所有(${n.length})`,type:"xiaomi-primary",callback:e=>{P.confirm({title:{text:"删除",position:"center"},content:{text:"确定清空所有的记录？",html:false},btn:{ok:{enable:true,callback(a){t.clearStorageData(),b.remove(x.Alias.historyAlias.$shadowRoot.querySelectorAll(".whitesevPopNetDiskHistoryMatch .pops-confirm-content ul li")),a.close(),b.html(x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-page"),""),b.text(x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .pops-confirm-btn-other"),b.text(x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .pops-confirm-btn-other")).replace(/[\d]+/gi,"0"));}},cancel:{text:"取消",enable:true}}});}}},mask:{clickCallBack(e){e(),x.Alias.historyAlias=null;}},class:"whitesevPopNetDiskHistoryMatch",style:Ea},x.popsStyle.historyMatchView),this.setDataPaging(n),this.setEvent(x.Alias.historyAlias.$shadowRoot),this.setSearchEvent(),x.setRightClickMenu(x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch"),".netdiskrecord-link a",true);},getCSS(){},getTableHTML(n){let r=I.handleLinkShow(n.ruleKeyName,n.ruleIndex,n.shareCode,n.accessCode,n.matchText),t=b.createElement("li",{innerHTML:`
			<div class="netdiskrecord-link">
				<p>链接</p>
				<a  href="javascript:;" isvisited="false">${r}</a>
			</div>
			<div class="netdiskrecord-icon">
				<p>网盘</p>
				<div class="netdisk-icon-img"></div>
			</div>
			<div class="netdiskrecord-url">
				<p>网址</p>
				<a href="${n.url}" target="_blank">${n.url}</a>
			</div>
			<div class="netdiskrecord-url-title">
				<p>网址标题</p>
				${n.title}
			</div>
			<div class="netdiskrecord-add-time">
				<p>记录时间</p>
				${d.formatTime(n.addTime)}
			</div>
			<div class="netdiskrecord-update-time">
				<p>更新时间</p>
				${d.formatTime(n.updateTime)}
			</div>
			<div class="netdiskrecord-functions">
				<p>功能</p>
				<button class="btn-delete">删除</button>
			</div>
			`}),e=t.querySelector(".netdiskrecord-link"),a=e.querySelector("a"),i=t.querySelector(".netdiskrecord-icon"),s=t.querySelector(".netdisk-icon-img"),l=t.querySelector(".netdiskrecord-url"),o=t.querySelector(".netdiskrecord-url-title"),c=t.querySelector(".netdiskrecord-add-time"),u=t.querySelector(".netdiskrecord-update-time"),p=t.querySelector(".netdiskrecord-functions"),h=p.querySelector(".btn-delete");if(de.handleElementAttributeRuleInfo({ruleKeyName:n.ruleKeyName,ruleIndex:n.ruleIndex,shareCode:n.shareCode,accessCode:n.accessCode},a),s.style.cssText=`background: url(${x.src.icon[n.ruleKeyName]}) no-repeat;background-size:100%`,n.url!==n.topURL){let g=b.createElement("div",{className:"netdiskrecord-top-url",innerHTML:`
				<p>Top网址</p>
				<a href="${n.topURL}" target="_blank">${n.topURL}</a>
				`});b.after(l,g);}return h.setAttribute("data-json",JSON.stringify(n)),Reflect.set(h,"data-json",n),{$liItemContainer:t,$link:e,$linkAnchor:a,$icon:i,$iconImg:s,$url:l,$urlTitle:o,$addTime:c,$updateTime:u,$features:p,$featuresBtnDelete:h,html:t.outerHTML}},setEvent(n){let r=this;x.view.setNetDiskUrlClickEvent(n,".whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-link a"),b.on(n,"click",".whitesevPopNetDiskHistoryMatch .pops-confirm-content .netdiskrecord-functions button.btn-delete",function(t){var u;let e=P.loading({parent:n.querySelector(".whitesevPopNetDiskHistoryMatch .pops-confirm-content ul"),content:{text:"删除中..."},only:true,addIndexCSS:false}),a=t.target,i=a.getAttribute("data-json");(u=a.closest("li"))==null||u.remove(),r.deleteStorageData(i),e==null||e.close();let s=b.text(n.querySelector(".whitesevPopNetDiskHistoryMatch .pops-confirm-btn-other")),l=s.match(/[\d]+/gi),o=parseInt(l[l.length-1]);o--,s=s.replace(/[\d]+/gi,o.toString()),b.text(n.querySelector(".whitesevPopNetDiskHistoryMatch .pops-confirm-btn-other"),s);let c=r.getStorageData();c=r.orderNetDiskHistoryMatchData(c),r.dataPaging.refresh(c),r.pageChangeCallBack(c,r.dataPaging.CONFIG.currentPage);});},pageChangeCallBack(n,r){let t=(r-1)*10,e="";for(let a=0;a<10&&n[t];a++){e+=this.getTableHTML(n[t]).html;t++;}x.Alias.historyAlias.$shadowRoot.querySelectorAll(".whitesevPopNetDiskHistoryMatch .netdiskrecord-table ul li").forEach(a=>a.remove()),b.append(x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-table ul"),e);},setDataPaging(n){let r=this,t=new hr({data:n,pageCount:10,pageStep:K.isPhone()?2:4,currentPage:1,pageChangeCallBack:function(e){r.pageChangeCallBack(n,e);}});this.dataPaging=t,t.addCSS(x.Alias.historyAlias.$shadowRoot),t.append(x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-page"));},setSearchEvent(){let n=false,r,t=this;function e(){if(n)return;n=true,r=P.loading({parent:x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .pops-confirm-content ul"),content:{text:"搜索中..."},only:true,addIndexCSS:false});let a=x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-search input").value.trim(),i=t.getStorageData();if(i=t.orderNetDiskHistoryMatchData(i),a===""){let l="";i.forEach((o,c)=>{c>9||(l+=t.getTableHTML(o).html);}),x.Alias.historyAlias.$shadowRoot.querySelectorAll(".whitesevPopNetDiskHistoryMatch .netdiskrecord-table ul li").forEach(o=>o.remove()),b.append(x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-table ul"),l),r==null||r.close(),n=false,t.setDataPaging(i);return}let s="";i.forEach(l=>{(I.handleLinkShow(l.ruleKeyName,l.ruleIndex,l.shareCode,l.accessCode,l.matchText).match(new RegExp(a,"ig"))||l.url.match(new RegExp(a,"ig"))||l.topURL.match(new RegExp(a,"ig"))||l.title.match(new RegExp(a,"ig")))&&(s+=t.getTableHTML(l).html);}),b.remove(x.Alias.historyAlias.$shadowRoot.querySelectorAll(".whitesevPopNetDiskHistoryMatch .netdiskrecord-table ul li")),b.append(x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-table ul"),s),b.remove(x.Alias.historyAlias.$shadowRoot.querySelectorAll(".whitesevPopNetDiskHistoryMatch .netdiskrecord-page > *")),r==null||r.close(),r=void 0,n=false;}b.listenKeyboard(x.Alias.historyAlias.$shadowRoot.querySelector(".whitesevPopNetDiskHistoryMatch .netdiskrecord-search input"),"keypress",a=>{a==="Enter"&&e();});},orderNetDiskHistoryMatchData(n){let r=y.historyMatch["netdisk-history-match-ordering-rule"].value,t=r.indexOf("降序")!==-1,e=r.indexOf("记录时间")!==-1?"addTime":"updateTime";return d.sortListByProperty(n,a=>a[e],t),n},queryAccessCode(n,r,t){let e=this.getStorageData();for(let a=0;a<e.length;a++){const i=e[a];if(i.ruleKeyName===n&&i.shareCode===r)return t&&d.isNotNull(i.accessCode),i.accessCode}},syncAccessCode(n,r,t,e){if(y.historyMatch.saveMatchNetDisk.value){if(tt.changeMatchedDataAccessCode(n,r,t,e))return f.success("已成功同步访问码至历史匹配记录"),true;f.error("同步访问码至历史匹配记录失败");}return  false},changeMatchedDataAccessCode(n,r,t,e){let a=this.getStorageData(),i=false;for(let s=0;s<a.length;s++){const l=a[s];l.ruleKeyName===n&&String(l.ruleIndex)===String(r)&&l.shareCode===t&&(i=true,a[s].accessCode=e,a[s].updateTime=Date.now());}return i&&this.saveStorageData(a),i},changeMatchedData(n,r,t,e,a){if(!y.historyMatch.saveMatchNetDisk.value)return  false;let i=this.getStorageData(),s=false;for(let l=0;l<i.length;l++){const o=i[l];if(o.ruleKeyName===n&&t.startsWith(o.shareCode)&&o.ruleIndex===r&&(y.historyMatch["netdisk-history-match-merge-same-link"].value||o.url===window.location.href&&o.topURL===top.window.location.href)){s=true;let c=false;if(a.trim()!==""&&o.matchText!==a&&(c=true,f.success("匹配历史记录 -> 设置新的matchText",[a]),i[l].matchText=a),d.isNotNull(e)&&o.accessCode!==e&&(c=true,f.success("匹配历史记录 -> 修改accessCode"),i[l].accessCode=e),c){i[l].updateTime=Date.now(),i[l].title&&(i[l].title=document.title),y.historyMatch["netdisk-history-match-merge-same-link"].value&&(i[l].url=window.location.href,i[l].topURL=top.window.location.href);break}}}if(!s){s=true,f.success("匹配历史记录 -> 增加新的");let l=Date.now();i=[...i,{url:window.location.href,topURL:top.window.location.href,ruleKeyName:n,ruleIndex:r,shareCode:t,accessCode:e,addTime:l,updateTime:l,title:document.title||top.document.title,matchText:a}];}return this.saveStorageData(i),true},checkAndRepairLocalData(){let n=0,r=ee(this.storageKey);if(Array.isArray(r))for(let t=0;t<r.length;t++){let e=false;const a=r[t];typeof a.matchText!="string"&&(a.matchText="",e=true),typeof a.ruleKeyName!="string"&&typeof a.netDiskName=="string"&&(a.ruleKeyName=a.netDiskName,delete a.netDiskName,e=true),typeof a.ruleIndex!="number"&&typeof a.netDiskIndex=="number"&&(a.ruleIndex=a.netDiskIndex,delete a.netDiskIndex,e=true),e&&n++;}else r=[];return this.saveStorageData(r),{count:r.length,repairCount:n}},getStorageData(){let n=ee(this.storageKey,[]);return n==null&&(n=[],this.saveStorageData(n)),n},saveStorageData(n){ie(this.storageKey,n);},deleteStorageData(n){let r=false,t=this.getStorageData();for(let e=0;e<t.length;e++)if(JSON.stringify(t[e])===n){f.success("删除 ===> ",t[e]),t.splice(e,1),r=true;break}return r&&this.saveStorageData(t),r},clearStorageData(){this.saveStorageData([]);}},We={addHost(n){let r=this.getList();r.includes(n)||r.push(n),this.updateList(r);},findHost(n){return this.getList().findIndex(e=>e===n)!==-1},removeHost(n){let r=this.getList(),t=false,e=r.findIndex(a=>a===n);return e!==-1&&(t=true,r.splice(e,1),this.updateList(r)),t},getList(){let n=ee(V.neverTipWorkerInitErrorKey,[]);return Array.isArray(n)||(n=[n]),n},updateList(n){ie(V.neverTipWorkerInitErrorKey,n);}};class La{constructor(r){G(this,"option");this.option=r;}showView(){let r=P.alert({title:{text:this.option.title,position:"center"},content:{text:`
                <div class="filter-container"></div>
                `},btn:{ok:{enable:false}},mask:{enable:true},width:window.innerWidth>500?"350px":"80vw",height:window.innerHeight>500?"300px":"70vh",style:`
            .filter-container{
                height: 100%;
                display: flex;
                flex-direction: column;
                gap: 20px;
            }
            .filter-container button{
                text-wrap: wrap;
                padding: 8px;
                height: auto;
                text-align: left;
            }
            `}),t=r.$shadowRoot.querySelector(".filter-container"),e=document.createDocumentFragment();this.option.filterOption.forEach(a=>{let i=document.createElement("button");i.innerText=a.name;let s=async()=>{(await this.option.getAllRuleInfo()).forEach(async o=>{await a.filterCallBack(o.data)?b.show(o.$el,false):b.hide(o.$el,false);}),typeof this.option.execFilterCallBack=="function"&&await this.option.execFilterCallBack(),r.close();};b.on(i,"click",async l=>{d.preventEvent(l),!(typeof a.callback=="function"&&!await a.callback(l,s))&&await s();}),e.appendChild(i);}),t.appendChild(e);}}class Fa{constructor(r){G(this,"option");this.option=r;}async showView(){var s;let r=P.confirm({title:{text:this.option.title,position:"center"},content:{text:`
                    <form class="rule-form-container" onsubmit="return false">
                        <ul class="rule-form-ulist">
                            
                        </ul>
                        <input type="submit" style="display: none;" />
                    </form>
                    `,html:true},btn:d.assign({ok:{callback:async()=>{await i();}}},this.option.btn||{},true),mask:{enable:true},style:`
                ${K.config.cssText.panelCSS}
                
                .rule-form-container {
                    
                }
                .rule-form-container li{
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 5px 20px;
                    gap: 10px;
                }
				.rule-form-ulist-dynamic{
					--button-margin-top: 0px;
					--button-margin-right: 0px;
					--button-margin-bottom: 0px;
					--button-margin-left: 0px;
					display: flex;
					flex-direction: column;
					align-items: flex-start;
					padding: 5px 0px 5px 20px;
				}
				.rule-form-ulist-dynamic__inner{
					width: 100%;
				}
				.rule-form-ulist-dynamic__inner-container{
					display: flex;
					align-items: center;
					border-top: 1px solid #d8d8d8;
				}
				.dynamic-forms{
					width: 100%;
				}
                .pops-panel-item-left-main-text{
                    max-width: 150px;
                }
                .pops-panel-item-right-text{
                    padding-left: 30px;
                }
                .pops-panel-item-right-text,
                .pops-panel-item-right-main-text{
                    text-overflow: ellipsis;
                    overflow: hidden;
                    white-space: nowrap;
                }
				.pops-panel-item-left-desc-text{
					line-height: normal;
					margin-top: 6px;
					font-size: 0.8em;
					color: rgb(108, 108, 108);
				}
				
                ${((s=this.option)==null?void 0:s.style)??""}
            `,width:typeof this.option.width=="function"?this.option.width():window.innerWidth>500?"500px":"88vw",height:typeof this.option.height=="function"?this.option.height():window.innerHeight>500?"500px":"80vh"}),t=r.$shadowRoot.querySelector(".rule-form-container");r.$shadowRoot.querySelector("input[type=submit]");let e=r.$shadowRoot.querySelector(".rule-form-ulist"),a=await this.option.getView(await this.option.data());e.appendChild(a);const i=async()=>{(await this.option.onsubmit(t,await this.option.data())).success&&(r.close(),await this.option.dialogCloseCallBack(true));};}}class Nt{constructor(r){G(this,"option");this.option=r;}async showView(r){const t=this;let e=this.option.contentConfig;e.forEach(a=>{var s,l;a.forms=[],a.headerTitle=a.headerTitle||a.title,(s=a.subscribe)!=null&&s.enable&&(a.headerTitle=a.headerTitle+`
                <div class="subscribe-container">
                    <button class="subscribe-btn" type="subscribe" data-has-icon="false" data-righticon="false">
                        <span>${((l=a.subscribe)==null?void 0:l.title)||"订阅"}</span>
                    </button>
                </div>
            `);let i=a.callback;a.callback=async(o,c,u)=>{if(typeof i=="function"&&i(o,u,u),a.subscribe&&a.subscribe.enable){let k=c.querySelector(".subscribe-btn");const w=a.subscribe;b.on(k,"click",async D=>{var T;d.preventEvent(D),await((T=w==null?void 0:w.callback)==null?void 0:T.call(w));let C=this.enterDeepMenu(u,(w==null?void 0:w.headerTitle)||(w==null?void 0:w.title)||"订阅",()=>{this.updateRuleContaienrElement(a.ruleOption,w,u);}),N=C.$rightRuleContainer;this.createButtonControls(N,C.$section,w,async()=>{let v=P.prompt({title:{text:"添加订阅",position:"center"},content:{text:"",focus:true,placeholder:"输入URL"},btn:{cancel:{enable:false},ok:{enable:true,text:"下一步",async callback($,E){let B=b.val(R).trim();if(B==="")return;f.info("订阅："+B);let O=m.loading("正在获取订阅信息...");try{let q=await(w==null?void 0:w.getSubscribeInfo(B));if(q.data){$.close();let U=q.data,ne=U.data.title||U.subscribeData.title||U.data.url,se=P.alert({title:{text:"添加订阅",position:"center"},content:{text:`
																	<div class="subscribe-network-title">
																		<span>订阅链接名称：</span>
																		<input type="text" placeholder="输入订阅链接的名称">
																	</div>
																	<div class="subscribe-network-data-count"></div>
																	<div class="subscribe-network-home-url"></div>
																	<div class="subscribe-network-url"></div>
																	<div class="subscribe-network-version"></div>
																	<div class="subscribe-network-last-modified"></div>
																`,html:!0},btn:{ok:{text:"添加",type:"subscribe",callback:async(ft,rt)=>{await w.addData(U)||m.error("该订阅已存在",{consoleLogContent:!0}),t.updateRuleContaienrElement(w,w,C.$section),ft.close();}}},width:Z.setting.width,height:"auto",style:`
																.pops button[type="subscribe"]{
																	--button-color: #ffffff;
																	--button-bd-color: #67b279;
																	--button-bg-color: #67b279;
																}
																.pops button[type="subscribe"]:hover{
																	--button-color: #ffffff;
																	--button-bd-color:rgb(91, 159, 107);;
																	--button-bg-color:rgb(91, 159, 107);;
																}

																.pops-alert-content{
																	display: flex;
																	flex-direction: column;
																	gap: 4px;
																	padding: 20px;
																}
																.pops-alert-content a {
																	color: #3d3d3d;
																}
																.pops-alert-content > div{
																	display: flex;
																}
																.pops-alert-content > div > span:first-child{
																	white-space: nowrap;
																}
																.subscribe-network-title input{
																	width: 100%;
																	flex: 1 1 auto;
																	line-height: 1.3;
																	outline: none;
																	text-overflow: ellipsis;
																	border-radius: 8px;
																	border: 1px solid #e4e4e4;
																	background-color: #f6f6f6;
																	padding: 16px 16px 16px 16px;
																	font-size: 16px;
																}
																.subscribe-network-title input:focus{

																}
															`}),fe=se.$shadowRoot.querySelector(".subscribe-network-title input"),Ce=se.$shadowRoot.querySelector(".subscribe-network-data-count"),je=se.$shadowRoot.querySelector(".subscribe-network-home-url"),Mt=se.$shadowRoot.querySelector(".subscribe-network-url"),pt=se.$shadowRoot.querySelector(".subscribe-network-version"),ht=se.$shadowRoot.querySelector(".subscribe-network-last-modified");b.val(fe,ne),b.on(fe,["input","propertychange"],ft=>{let rt=b.val(fe);U.data.title=rt===""?void 0:rt;}),b.html(Ce,`
																<span>规则数量：</span>
																<span>${U.subscribeData.ruleData.length}</span>
															`),typeof U.subscribeData.homePage=="string"?b.html(je,`
																<span>主页：</span>
																<a href="${U.subscribeData.homePage}" target="_blank">${U.subscribeData.homePage}</a>
															`):je.remove(),b.html(Mt,`
																<span>URL：</span>
																<a href="${U.data.url}" target="_blank">${U.data.url}</a>
															`),U.subscribeData.version!=null?b.html(pt,`
																	<span>版本：</span>
																	<span>${U.subscribeData.version}</span>
																`):pt.remove(),U.subscribeData.lastModified!=null?b.html(ht,`
																	<span>更新时间：</span>
																	<span>${d.formatTime(U.subscribeData.lastModified)}</span>
																`):ht.remove();}else m.error(q.msg,{consoleLogContent:!0});}catch(q){m.error(q.toString(),{consoleLogContent:true});}finally{O.close();}}}},width:Z.info.width,height:"auto"}),R=v.$shadowRoot.querySelector("input"),_=v.$shadowRoot.querySelector(".pops-prompt-btn-ok ");b.on(R,["input","propertychange"],$=>{b.val(R)===""?b.attr(_,"disabled","true"):b.removeAttr(_,"disabled");}),b.listenKeyboard(R,"keydown",($,E,B,O)=>{$==="Enter"&&B.length===0&&(d.preventEvent(O),d.dispatchEvent(_,"click"));}),d.dispatchEvent(R,"input");});let S=await w.data();await this.addRuleElement(w,w,C.$section,S);});}let p=this.createButtonControls(u,u,a.ruleOption,async()=>{this.showEditView(a.ruleOption,void 0,false,await a.ruleOption.getAddData(),u);}),h=await a.ruleOption.data(),g=false;await this.addRuleElement(a.ruleOption,void 0,u,h,(k,w)=>{(typeof r=="function"?r(k):true)||(g=true,b.hide(w,false));}),g&&p.$ruleControlFilter&&b.text(p.$ruleControlFilter,"取消过滤");};}),P.panel({title:{text:typeof this.option.title=="function"?this.option.title():this.option.title,position:"center"},content:e,btn:{close:{enable:true,callback(a,i){a.close();}}},mask:{clickEvent:{toClose:false}},class:this.option.className||"rule-panel-view",width:Z.settingBig.width,height:Z.settingBig.height,style:`
                ${this.option.style||""}
                .pops button[type="subscribe"]{
                    --button-color: #ffffff;
                    --button-bd-color: #67b279;
                    --button-bg-color: #67b279;
                }
                .pops button[type="subscribe"]:hover{
                    --button-color: #ffffff;
                    --button-bd-color:rgb(91, 159, 107);;
                    --button-bg-color:rgb(91, 159, 107);;
                }
                section.pops-panel-container .pops-panel-container-header-ul li:has(.subscribe-btn){
                    justify-content: space-between !important;
                }
				section.pops-panel-container ul li.rule-controls{
					justify-content: flex-start;
					overflow-x: auto;
				}

				section.pops-panel-container ul:has(>.rule-view-container){
					overflow: hidden;
					display: flex;
					flex-direction: column;
				}

				.rule-view-container{
					margin: var(--pops-panel-forms-margin-top-bottom) calc(var(--pops-panel-forms-margin-left-right) + var(--pops-panel-forms-margin-left-right));
					margin-top: 0;
					overflow: auto;
					background: #ffffff;
					border-radius: var(--pops-panel-forms-container-item-border-radius);
					padding: 5px 10px;
					position: relative;
				}
				.rule-view-container:empty{
					display: none;
				}
				.rule-item{
					display: flex;
					align-items: center;
					line-height: normal;
					font-size: 16px;
					padding: 4px 8px;
					gap: 8px;
				}
				.rule-name{
					flex: 1;
					white-space: nowrap;
					text-overflow: ellipsis;
					overflow: hidden;
				}
				.rule-controls{
					display: flex;
					align-items: center;
					text-overflow: ellipsis;
					overflow: hidden;
					white-space: nowrap;
					gap: 8px;
					padding: 0px;
				}
				.rule-controls-enable{
					
				}
				.rule-controls-edit{
					
				}
				.rule-controls-delete{
					
				}
				.rule-controls-edit,
				.rule-controls-delete{
					width: 16px;
					height: 16px;
					cursor: pointer;
				}
            `});}enterDeepMenu(r,t,e){let a=r.matches("section")?r:r.closest("section");b.addClass(a,"pops-hide-important");let i=b.createElement("section",{className:"pops-panel-container pops-panel-deepMenu-container",innerHTML:`
				<ul class="pops-panel-deepMenu-container-header-ul">
					<div class="pops-panel-deepMenu-container-header">
						<i class="pops-panel-deepMenu-container-left-arrow-icon">${K.config.iconSVG.arrowLeft}</i>
						<p>${t}</p>
					</div>
				</ul>
				<ul class="pops-panel-ulist-container"></ul>
			`});b.after(a,i);let s=i.querySelector(".pops-panel-deepMenu-container-header-ul"),l=i.querySelector(".pops-panel-deepMenu-container-left-arrow-icon"),o=i.querySelector(".pops-panel-ulist-container");return b.on(l,"click",c=>{d.preventEvent(c);let u=b.prev(i);b.remove(i),u&&b.removeClass(u,"pops-hide-important"),e();}),{$section:i,$headerContainer:s,$arrowLeft:l,$rightRuleContainer:o,quiteDeepMenu:()=>{l.click();}}}createButtonControls(r,t,e,a){var g,k,w,D,C;let i=e.btnControls,s=b.createElement("li",{className:"rule-controls"});b.append(r,s);let l=null;(g=i==null?void 0:i.add)!=null&&g.enable&&(l=b.createElement("button",{className:"rule-control-add",innerHTML:"<span>添加</span>"},{type:"primary","data-has-icon":"false","data-righticon":"false"}),b.on(l,"click",async N=>{var T,v,R;d.preventEvent(N);let S=await((R=(v=(T=e.btnControls)==null?void 0:T.add)==null?void 0:v.callback)==null?void 0:R.call(this,{event:N,$section:t}));typeof S=="boolean"&&!S||await(a==null?void 0:a());}),b.append(s,l));let o=null;(k=i==null?void 0:i.filter)!=null&&k.enable&&(o=b.createElement("button",{className:"rule-control-filter",innerHTML:"<span>过滤</span>"},{type:"default","data-has-icon":"false","data-righticon":"false"}),b.on(o,"click",async N=>{var R,_,$,E,B,O,q;d.preventEvent(N);let S=await((_=(R=i==null?void 0:i.filter)==null?void 0:R.callback)==null?void 0:_.call(R));if(typeof S=="boolean"&&!S)return;let T=()=>Array.from(t.querySelectorAll(".rule-view-container .rule-item")),v=o;if(v)if(b.text(v).includes("取消"))T().forEach(U=>{b.show(U,false);}),b.text(v,"过滤");else {let U="过滤规则";typeof(($=i==null?void 0:i.filter)==null?void 0:$.title)=="function"?U=(E=i==null?void 0:i.filter)==null?void 0:E.title():typeof((B=i==null?void 0:i.filter)==null?void 0:B.title)=="string"&&(U=(O=i==null?void 0:i.filter)==null?void 0:O.title),new La({title:U,filterOption:((q=i==null?void 0:i.filter)==null?void 0:q.option)||[],execFilterCallBack(){b.text(v,"取消过滤");},getAllRuleInfo:()=>T().map(se=>({data:this.parseRuleElement(se).data,$el:se}))}).showView();}}),b.append(s,o));let c=null;(w=i==null?void 0:i.clearAll)!=null&&w.enable&&(c=b.createElement("button",{className:"rule-control-clear-all",innerHTML:"<span>清空所有</span>"},{type:"xiaomi-primary","data-has-icon":"false","data-righticon":"false"}),b.on(c,"click",N=>{d.preventEvent(N);let S=P.confirm({title:{text:"提示",position:"center"},content:{text:"确定清空所有的数据？",html:false},btn:{ok:{enable:true,callback:async T=>{var _,$;f.success("清空所有");let v=await(($=(_=i==null?void 0:i.clearAll)==null?void 0:_.callback)==null?void 0:$.call(_));if(typeof v=="boolean"&&!v)return;let R=await(e==null?void 0:e.data());if(!R||R.length){m.error("清理失败");return}else m.success("清理成功");await this.updateDeleteAllBtnText(e,s),this.clearContent(t),S.close();}},cancel:{text:"取消",enable:true}},width:"300px",height:"200px"});}),b.append(s,c));let u=null;(D=i==null?void 0:i.import)!=null&&D.enable&&(u=b.createElement("button",{className:"rule-control-import",innerHTML:"<span>导入</span>"},{type:"default","data-has-icon":"false","data-righticon":"false"}),b.on(u,"click",async N=>{var T,v;d.preventEvent(N);await((v=(T=i==null?void 0:i.import)==null?void 0:T.callback)==null?void 0:v.call(T,()=>{this.updateRuleContaienrElement(e,void 0,t);}));}),b.append(s,u));let p=null;(C=i==null?void 0:i.export)!=null&&C.enable&&(p=b.createElement("button",{className:"rule-control-export",innerHTML:"<span>导出</span>"},{type:"default","data-has-icon":"false","data-righticon":"false"}),b.on(p,"click",async N=>{var T,v;d.preventEvent(N);await((v=(T=i==null?void 0:i.export)==null?void 0:T.callback)==null?void 0:v.call(T,{event:N}));}),b.append(s,p));let h=b.createElement("div",{className:"rule-view-container",innerHTML:""});return b.append(t,h),{$ruleContainer:h,$ruleControls:s,$ruleControlAdd:l,$ruleControlFilter:o,$ruleControlClearAll:c,$ruleControlImport:u,$ruleControlExport:p}}parseViewElement(r){let t=r.querySelector(".rule-view-container"),e=r.querySelector(".rule-control-clear-all");return {$container:t,$deleteBtn:e}}parseRuleElement(r){let t=r.querySelector(".rule-controls-enable"),e=t.querySelector(".pops-panel-switch"),a=t.querySelector(".pops-panel-switch__input"),i=t.querySelector(".pops-panel-switch__core"),s=r.querySelector(".rule-controls-edit"),l=r.querySelector(".rule-controls-delete");return {$enable:t,$enableSwitch:e,$enableSwitchInput:a,$enableSwitchCore:i,$edit:s,$delete:l,data:Reflect.get(r,"data-rule")}}async createRuleElement(r,t,e,a){var w,D,C,N,S,T,v,R;let i=e,s=await r.getDataItemName(i),l=b.createElement("div",{className:"rule-item",innerHTML:`
			<div class="rule-name">${s}</div>
			<div class="rule-controls">
				<div class="rule-controls-enable">
					<div class="pops-panel-switch">
						<input class="pops-panel-switch__input" type="checkbox">
						<span class="pops-panel-switch__core">
							<div class="pops-panel-switch__action">
							</div>
						</span>
					</div>
				</div>
				<div class="rule-controls-edit">
					${K.config.iconSVG.edit}
				</div>
				<div class="rule-controls-delete">
					${K.config.iconSVG.delete}
				</div>
			</div>
			`});Reflect.set(l,"data-rule",i);let o="pops-panel-switch-is-checked";const{$enable:c,$enableSwitch:u,$enableSwitchCore:p,$enableSwitchInput:h,$delete:g,$edit:k}=this.parseRuleElement(l);return (D=(w=r.btnControls)==null?void 0:w.ruleEnable)!=null&&D.enable?(b.on(p,"click",async _=>{var E,B;let $=false;if(u.classList.contains(o)?(u.classList.remove(o),$=false):(u.classList.add(o),$=true),h.checked=$,await((B=(E=r==null?void 0:r.btnControls)==null?void 0:E.ruleEnable)==null?void 0:B.callback(i,$)),$&&t){let O=e,q=await t.getSubscribeInfo(O.data.url);if(q.data){let U=q.data;U.uuid=O.uuid,U.data=O.data,U.data.latestUpdateTime=Date.now(),await t.updateData(U);}else O.data.updateFailedTime=Date.now(),await t.updateData(O),f.error(O),m.error(q.msg,{consoleLogContent:true});await this.updateRuleContaienrElement(r,t,a);}}),await((N=(C=r==null?void 0:r.btnControls)==null?void 0:C.ruleEnable)==null?void 0:N.getEnable(i))&&u.classList.add(o)):c.remove(),(T=(S=r==null?void 0:r.btnControls)==null?void 0:S.ruleEdit)!=null&&T.enable?b.on(k,"click",_=>{var $,E,B,O;if(d.preventEvent(_),typeof((E=($=r.btnControls)==null?void 0:$.ruleEdit)==null?void 0:E.callback)=="function"){let q=(O=(B=r.btnControls)==null?void 0:B.ruleEdit)==null?void 0:O.callback({context:this,event:_,option:r,subscribeOption:t,ruleData:i,$section:a,$ruleItem:l,enterDeepMenu:async U=>{let ne=this.enterDeepMenu(a,U.headerTitle||"",()=>{this.updateRuleContaienrElement(r,t,a);}),se=ne.$rightRuleContainer;this.createButtonControls(se,ne.$section,U,void 0);let fe=await U.data();await this.addRuleElement(U,void 0,ne.$section,fe);}});if(typeof q=="boolean"&&!q)return}this.showEditView(r,t,true,i,a,l,q=>{i=null,i=q;});}):k.remove(),(R=(v=r==null?void 0:r.btnControls)==null?void 0:v.ruleDelete)!=null&&R.enable?b.on(g,"click",_=>{d.preventEvent(_);let $=P.confirm({title:{text:"提示",position:"center"},content:{text:"确定删除该条数据？",html:false},btn:{ok:{enable:true,callback:async E=>{var O,q;f.success("删除数据"),await((q=(O=r==null?void 0:r.btnControls)==null?void 0:O.ruleDelete)==null?void 0:q.deleteCallBack(i))?(m.success("成功删除该数据"),l.remove(),await this.updateDeleteAllBtnText(r,a),$.close()):m.error("删除该数据失败");}},cancel:{text:"取消",enable:true}},width:"300px",height:"200px"});}):g.remove(),l}async addRuleElement(r,t,e,a,i){let{$container:s}=this.parseViewElement(e),l=[],o=Array.isArray(a)?a:[a],c=document.createDocumentFragment();for(let u=0;u<o.length;u++){let p=o[u],h=await this.createRuleElement(r,t,p,e);c.appendChild(h),i==null||i(p,h),l.push(h);}return s.appendChild(c),await this.updateDeleteAllBtnText(r,e),l}async updateRuleContaienrElement(r,t,e){this.clearContent(e);const{$container:a}=this.parseViewElement(e);let i=await r.data();await this.addRuleElement(r,t,e,i),await this.updateDeleteAllBtnText(r,e);}async updateRuleItemElement(r,t,e,a,i){let s=await this.createRuleElement(r,t,e,i);return a.after(s),a.remove(),s}clearContent(r){const{$container:t}=this.parseViewElement(r);b.html(t,"");}setDeleteBtnText(r,t,e=false){const{$deleteBtn:a}=this.parseViewElement(r);e?b.html(a,t):b.text(a,t);}async updateDeleteAllBtnText(r,t){let a=(await r.data()).length,i="清空所有";a!==0&&(i+=`(${a})`),this.setDeleteBtnText(t,i);}showEditView(r,t,e,a,i,s,l,o){var p,h,g,k,w,D;let c=async C=>{if(C){if(typeof o=="function"){let N=await r.getData(a);o(N);}}else if(e||await r.deleteData(a),typeof l=="function"){let N=await r.getData(a);l(N);}};new Fa({title:e?"编辑":"添加",data:()=>a,dialogCloseCallBack:c,getView:async C=>{var N,S,T;return await((T=(S=(N=r.btnControls)==null?void 0:N.ruleEdit)==null?void 0:S.getView)==null?void 0:T.call(S,C,e))},btn:{ok:{enable:true,text:e?"修改":"添加"},cancel:{callback:async(C,N)=>{C.close(),await c(false);}},close:{callback:async(C,N)=>{C.close(),await c(false);}}},onsubmit:async(C,N)=>{var T,v,R;let S=await((R=(v=(T=r==null?void 0:r.btnControls)==null?void 0:T.ruleEdit)==null?void 0:v.onsubmit)==null?void 0:R.call(v,C,e,N));return S.success?e?(m.success("修改成功"),i&&await this.updateRuleItemElement(r,t,S.data,s,i)):i&&await this.addRuleElement(r,t,i,S.data):e&&f.error("修改失败"),S},style:(h=(p=r==null?void 0:r.btnControls)==null?void 0:p.ruleEdit)==null?void 0:h.style,width:(k=(g=r==null?void 0:r.btnControls)==null?void 0:g.ruleEdit)==null?void 0:k.viewWidth,height:(D=(w=r==null?void 0:r.btnControls)==null?void 0:w.ruleEdit)==null?void 0:D.viewHeight}).showView();}}const Y=new Ct({STORAGE_API_KEY:"websiteRule",STORAGE_KEY:"rule-subscribe"});class Oa{constructor(r){G(this,"option");G(this,"storageApi");this.option=r,this.storageApi=new Pe(r.STORAGE_API_KEY);}getAllSubscribe(){return this.storageApi.get(this.option.STORAGE_KEY,[])}getAllSubscribeRule(r=false){let t=this.getAllSubscribe(),e=[];for(let a=0;a<t.length;a++){const i=t[a];if(!(r&&!i.data.enable))for(let s=0;s<i.subscribeData.ruleData.length;s++){const l=i.subscribeData.ruleData[s];r&&!l.setting.enable||(l.subscribeUUID=i.uuid,e.push(l));}}return e}getSubscribe(r){return this.getAllSubscribe().find(e=>e.uuid==r)}getSubscribeRule(r,t){let e=this.getSubscribe(r);if(e)return e.subscribeData.ruleData.find(i=>i.key===t)}deleteAllSubscribe(){this.storageApi.delete(this.option.STORAGE_KEY);}deleteSubscribe(r){let t=typeof r=="string"?r:r.uuid,e=this.getAllSubscribe(),a=e.findIndex(i=>i.uuid===t);return a!==-1&&(e.splice(a,1),this.storageApi.set(this.option.STORAGE_KEY,e)),a!==-1}clearSubscribe(r){let t=typeof r=="string"?r:r.uuid,e=this.getAllSubscribe(),a=e.findIndex(i=>i.uuid===t);return a!==-1?(e[a].subscribeData.ruleData=[],this.storageApi.set(this.option.STORAGE_KEY,e),true):false}addSubscribe(r){let t=false,e=this.getAllSubscribe();return e.findIndex(i=>i.uuid===r.uuid)===-1&&(e.push(r),t=true),t&&this.storageApi.set(this.option.STORAGE_KEY,e),t}updateSubscribe(r){let t=false,e=this.getAllSubscribe(),a=e.findIndex(i=>i.uuid===r.uuid);return a!==-1&&(e[a]=r,t=true),t&&this.storageApi.set(this.option.STORAGE_KEY,e),t}updateSubscribeRule(r,t){let e=false,a=this.getAllSubscribe(),i=a.find(s=>s.uuid===r);if(i){let s=i.subscribeData.ruleData.findIndex(l=>l.key===t.key);s!==-1&&(i.subscribeData.ruleData[s]=t,e=true);}return e&&this.storageApi.set(this.option.STORAGE_KEY,a),true}deleteSubscribeRule(r,t){let e=false,a=typeof t=="string"?t:t.key,i=this.getAllSubscribe(),s=i.findIndex(l=>l.uuid===r);if(s!==-1){let o=i[s].subscribeData.ruleData.findIndex(c=>c.key===a);o!==-1&&(i[s].subscribeData.ruleData.splice(o,1),this.storageApi.set(this.option.STORAGE_KEY,i),e=true);}return e}async getSubscribeInfo(r){let t=await M.get(r,{allowInterceptConfig:false,timeout:1e4,headers:{"User-Agent":d.getRandomPCUA()}});if(!t.status)return f.error(t),{data:null,msg:"获取订阅信息失败"};let e=t.data.responseText,a=d.toJSON(e);return typeof a.title=="string"&&typeof a.version=="number"&&typeof a.lastModified=="number"&&Array.isArray(a.ruleData)?{data:{uuid:d.generateUUID(),subscribeData:a,data:{enable:true,url:r,latestUpdateTime:Date.now(),updateFailedTime:null}},msg:""}:(f.error(a),{data:null,msg:"订阅链接的内容格式不正确"})}async updateAllSubscribe(){let r=this.getAllSubscribe();for(let t=0;t<r.length;t++){const e=r[t];if(!e.data.enable||typeof e.data.updateFailedTime=="number"&&d.formatTime(e.data.updateFailedTime,"yyyyMMdd")===d.formatTime(Date.now(),"yyyyMMdd")||typeof e.data.latestUpdateTime=="number"&&d.formatTime(Date.now(),"yyyyMMdd")===d.formatTime(e.data.latestUpdateTime,"yyyyMMdd"))continue;let a=await this.getSubscribeInfo(e.data.url),i=false;if(a.data){let s=a.data;s.uuid=e.uuid,s.data=e.data,s.data.latestUpdateTime=Date.now();let l=s.data.title||s.subscribeData.title||s.data.url;e.data.updateFailedTime=null,i=this.updateSubscribe(s),i?f.success(`更新订阅成功：${l}`):f.error(`更新订阅失败：${l}`,e);}else f.error("更新订阅失败："+a.msg,e);i||(e.data.updateFailedTime=Date.now(),this.updateSubscribe(e));}}importSubscribe(r){let t=P.alert({title:{text:"请选择导入方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="local">本地导入</div>
                    <div class="btn-control" data-mode="network">网络导入</div>
                    <div class="btn-control" data-mode="clipboard">剪贴板导入</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(o,c){o.close();}}},mask:{enable:true},drag:true,width:Z.info.width,height:Z.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),e=t.$shadowRoot.querySelector(".btn-control[data-mode='local']"),a=t.$shadowRoot.querySelector(".btn-control[data-mode='network']"),i=t.$shadowRoot.querySelector(".btn-control[data-mode='clipboard']"),s=o=>{let c=this.getAllSubscribe(),u=[];for(let p=0;p<o.length;p++){const h=o[p];c.findIndex(k=>k.uuid===h.uuid)!==-1||u.push(h);}c=c.concat(u),this.storageApi.set(this.option.STORAGE_KEY,c),m.success(`共 ${o.length} 条订阅，新增 ${u.length} 条`),r==null||r();},l=o=>new Promise(c=>{let u=d.toJSON(o);if(!Array.isArray(u)){f.error(u),m.error("导入失败，格式不符合（不是数组）",{consoleLogContent:true}),c(false);return}if(!u.length){m.error("导入失败，解析出的数据为空",{consoleLogContent:true}),c(false);return}let p=u[0];if(!(typeof p.data=="object"&&p.data!=null&&typeof p.subscribeData=="object"&&p.subscribeData!=null&&typeof p.uuid=="string")){m.error("导入失败，解析的格式不符合",{consoleLogContent:true}),c(false);return}s(u),c(true);});b.on(e,"click",o=>{d.preventEvent(o),t.close();let c=b.createElement("input",{type:"file",accept:".json"});b.on(c,["propertychange","input"],u=>{var g;if(!((g=c.files)!=null&&g.length))return;let p=c.files[0],h=new FileReader;h.onload=()=>{l(h.result);},h.readAsText(p,"UTF-8");}),c.click();}),b.on(a,"click",o=>{d.preventEvent(o),t.close();let c=P.prompt({title:{text:"网络导入",position:"center"},content:{text:"",placeholder:"请填写URL",focus:true},btn:{close:{enable:true,callback(h,g){h.close();}},ok:{text:"导入",callback:async(h,g)=>{let k=h.text;if(d.isNull(k)){m.error("请填入完整的url");return}let w=m.loading("正在获取配置..."),D=await M.get(k,{allowInterceptConfig:false});if(w.close(),!D.status){f.error(D),m.error("获取配置失败",{consoleLogContent:true});return}await l(D.data.responseText)&&h.close();}},cancel:{enable:false}},mask:{enable:true},drag:true,width:Z.info.width,height:"auto"}),u=c.$shadowRoot.querySelector("input"),p=c.$shadowRoot.querySelector(".pops-prompt-btn-ok");b.on(u,["input","propertychange"],h=>{b.val(u)===""?b.attr(p,"disabled","true"):b.removeAttr(p,"disabled");}),b.listenKeyboard(u,"keydown",(h,g,k)=>{h==="Enter"&&k.length===0&&b.val(u)!==""&&d.dispatchEvent(p,"click");}),d.dispatchEvent(u,"input");}),b.on(i,"click",async o=>{d.preventEvent(o),t.close();let c=await d.getClipboardInfo();if(c.error!=null){m.error(c.error.toString());return}if(c.content.trim()===""){m.warning("获取到的剪贴板内容为空");return}await l(c.content);});}exportSubscribe(r="rule.json"){let t=P.alert({title:{text:"请选择导出方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="only-export-rule-list">导出订阅</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(i,s){i.close();}}},mask:{enable:true},drag:true,width:Z.info.width,height:Z.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),e=t.$shadowRoot.querySelector(".btn-control[data-mode='only-export-rule-list']"),a=(i,s)=>{let l=new Blob([JSON.stringify(s,null,4)]),o=window.URL.createObjectURL(l),c=document.createElement("a");c.href=o,c.download=i,c.click(),setTimeout(()=>{window.URL.revokeObjectURL(o);},1500);};b.on(e,"click",i=>{d.preventEvent(i);try{let s=this.getAllSubscribe();if(s.length===0){m.warning("订阅为空，无需导出");return}a(r,s),t.close();}catch(s){m.error(s.toString(),{consoleLogContent:true});}});}}const ae=new Oa({STORAGE_API_KEY:"userRule",STORAGE_KEY:"rule-subscribe"}),He={init(){this.updateAllSubscribe();},getPanelView(n=0){let r={title:"规则管理器",contentConfig:[ue.getRulePanelViewOption(),we.getRulePanelViewOption(),et.getRulePanelViewOption()]};return r.contentConfig=r.contentConfig.map((e,a)=>(e.isDefault=a===n,e)),new Nt(r)},showView(n=0){this.getPanelView(n).showView();},updateAllSubscribe(){ae.updateAllSubscribe(),Y.updateAllSubscribe(),oe.updateAllSubscribe();}},V={isHandleMatch:false,workerInitError:null,neverTipWorkerInitErrorKey:"never-toast-worker-error",delayNotMatchCount:0,postMessageType:"worker-init-error",dispatchMonitorDOMChange:false,blobUrl:"",GM_matchWorker:void 0,init(){this.listenWorkerInitErrorDialog(),this.initWorkerBlobUrl(),this.initWorker(),this.monitorDOMChange();},initWorkerBlobUrl(){const n=`
        (() => {
            function ${V.handleRegularMatch.toString()}

            function ${V.uniqueArr}
            
            this.addEventListener(
            "message",
            function (event) {
                const data = event.data;
                let matchedList = [];
                ${V.handleRegularMatch.name}(data,(matchData)=>{
                	matchedList.push(matchData);
                })
                matchedList = ${V.uniqueArr.name}(matchedList);
                this.postMessage({
					options: data,
					msg: "Match End",
					data: matchedList,
					startTime: data.startTime,
					endTime: Date.now(),
                });
            },
            {
                capture: true,
            }
            );
        })();
  		`;let r=new Blob([n],{type:"application/javascript"}),t=globalThis.URL.createObjectURL(r);globalThis.trustedTypes&&typeof globalThis.trustedTypes.createPolicy=="function"&&(t=globalThis.trustedTypes.createPolicy("workerPolicy",{createScriptURL:a=>a}).createScriptURL(t)),V.blobUrl=t,f.info(`Worker Blob Link ===> ${V.blobUrl}`);},handleRegularMatch(n,r){const t=Object.keys(n.matchedRuleOption),e=n.textList.map(a=>{for(let i=0;i<n.characterMapping.length;i++){const s=n.characterMapping[i];try{typeof s.searchValue=="string"?a=a.replaceAll(s.searchValue,s.replaceValue):a=a.replace(s.searchValue,s.replaceValue);}catch{}}return a});for(const a of t){const i=n.matchedRuleOption[a];for(let s=0;s<i.length;s++){const l=i[s];let o=[];if(n.matchTextRange.includes("innerText")&&o.push(new RegExp(l.link_innerText,"gi")),n.matchTextRange.includes("innerHTML")&&o.push(new RegExp(l.link_innerHTML,"gi")),!n.matchTextRange.length)throw console.error(n),new TypeError("未设置匹配范围");if(!o.length)throw new TypeError("未知的匹配范围: "+n.matchTextRange);for(let c=0;c<o.length;c++){const u=o[c];for(let p=0;p<e.length;p++){let g=e[p].match(u);g&&g.length&&r({ruleKeyName:a,ruleIndex:s,data:g});}}}}},uniqueArr(n){return n.filter((r,t,e)=>t===e.findIndex(a=>JSON.stringify(a)===JSON.stringify(r)))},initWorker(){try{V.GM_matchWorker=new Worker(V.blobUrl),V.GM_matchWorker.onmessage=V.onMessage,V.GM_matchWorker.onerror=V.onError;}catch(n){this.workerInitError=n,V.GM_matchWorker={postMessage(r){return new Promise((t,e)=>{let a=[];try{V.handleRegularMatch(r,i=>{a.push(i);});}catch(i){V.onError(i);}finally{a=V.uniqueArr(a),V.onMessage(new MessageEvent("message",{data:{options:r,msg:"Match End",data:a,startTime:r.startTime,endTime:Date.now()}})),t(null);}})}};}},listenWorkerInitErrorDialog(){if(!te.isTopWindow())return;const n=this;b.on(window,"message",r=>{let t=r.data;if(typeof t=="object"&&(t==null?void 0:t.type)===this.postMessageType){let e=t.data;n.registerWorkerInitErrorNeverTipToast(e.hostname),P.confirm({title:{text:"Worker Init Error",position:"center"},content:{text:`
							<div style="padding: 10px;gap: 10px;display: flex;flex-direction: column;">
								<p>链接：${e.url}</p>
								<p>来源：${te.isTopWindow()?"top":"iframe"}</p>
								<p>原因：初始化Worker失败，可能页面使用了Content-Security-Policy策略，执行匹配时如果页面的内容过大会导致页面卡死，请使用Menu模式进行匹配或者使用CSP插件禁用CSP策略（不建议）。</p>
								<p>
									错误信息：
									<span style="color: red;">${e.error}</span>
								</p>
							</div>
							`,html:true},btn:{merge:true,position:"space-between",ok:{text:"添加网站规则",callback(a,i){let s=we.getTemplateData();s.name="手动匹配："+e.hostname,s.url=`^http(s|):\\/\\/${e.hostname}\\/`,s.data[y.features["netdisk-match-mode"].KEY]="Menu";let l=new Nt({title(){return "规则管理器"},contentConfig:[we.getRulePanelViewOption(s)]});l.showEditView(l.option.contentConfig[0].ruleOption,void 0,false,s,void 0,void 0,void 0,()=>{m.success("添加成功");});}},cancel:{text:"网站规则",callback(a,i){He.getPanelView(0).showView();}},other:{enable:true,text:"不再提示",type:"xiaomi-primary",callback(a,i){P.confirm({title:{text:"提示",position:"center"},content:{text:`确定不再弹出该提示？（仅针对域名：${e.hostname}）`},btn:{ok:{callback(s,l){We.addHost(e.hostname),s.close();}}}},{PC:{width:"400px",height:"200px"},Mobile:{width:"80vw",height:"200px"}});}}}},{PC:{width:"550px",height:"350px"},Mobile:{width:"88vw",height:"500px"}});}});},dispatchWorkerInitErrorDialog(){top==null||top.postMessage({type:this.postMessageType,data:{url:window.location.href,hostname:window.location.hostname,error:this.workerInitError}},"*");},registerWorkerInitErrorNeverTipToast(n){let r="💀 Worker初始化失败",t=()=>We.findHost(n)?r+"（已设置不再提示）":r,e={key:"workerInitErrorNeverTipToast-"+n,text:t(),autoReload:false,isStoreValue:false,showText:t,callback:()=>{We.findHost(n)?confirm("是否允许弹出Worker初始化失败的弹窗提示？")&&(We.removeHost(n)?m.success("删除成功"):m.error("删除失败"),Oe.update(e)):this.dispatchWorkerInitErrorDialog();}};Oe.update(e);},postMessage(n,r){V.GM_matchWorker.postMessage(n,r);},onMessage(n){const r=n.data;r.data.length,(r.options.from==="PasteText"||r.options.from==="ShortCut-Select-Content")&&x.matchPasteText.workerMatchEndCallBack(r),r.options.from.startsWith("FirstLoad")&&V.delayNotMatchCount++,V.successCallBack(r);},onError(n){V.errorCallBack(n);},successCallBack(n){if(!n.data.length){V.matchingEndCallBack();return}const r=[];for(const e of n.data){I.$match.matchedInfoRuleKey.add(e.ruleKeyName);let a=new Set;e.data.forEach(i=>{a.add(i);}),a.forEach(i=>{let s=I.handleLink(e.ruleKeyName,e.ruleIndex,i);s&&r.push({shareCode:s.shareCode,accessCode:s.accessCode,ruleKeyName:e.ruleKeyName,ruleIndex:e.ruleIndex,matchText:i});});}let t=r.filter((e,a,i)=>i.findIndex(l=>l.accessCode===e.accessCode&&l.ruleIndex===e.ruleIndex&&l.ruleKeyName===e.ruleKeyName&&l.shareCode===e.shareCode)===a);if(t.forEach(e=>{I.$match.tempMatchedInfo.has(e.ruleKeyName)&&I.$match.tempMatchedInfo.get(e.ruleKeyName).set(e.shareCode,e);}),t.forEach(e=>{let{shareCode:a,accessCode:i,ruleKeyName:s,ruleIndex:l,matchText:o}=e;const u=I.$rule.rule.find(g=>g.setting.key===s).rule[l];let p=false;if(I.$match.blackMatchedInfo.forEach((g,k)=>{if(k!==e.ruleKeyName)return;g.has(a)&&(p=true,f.warn(`匹配到黑名单分享码，已过滤：${a}`,JSON.stringify(e)));}),p)return;if(u.shareCodeExcludeRegular&&Array.isArray(u.shareCodeExcludeRegular))for(const g of u.shareCodeExcludeRegular){let k=I.$match.matchedInfo.get(g),w=I.$match.tempMatchedInfo.get(g);if(k.startsWith(a)||w.startsWith(a)){f.warn(`${s}：该分享码【${a}】与已匹配到该分享码的规则【${g}】冲突`);return}}const h=I.$match.matchedInfo.get(s);if(I.$data.isMatchedLink=true,h.startsWith(a)){let g=h.getStartsWith(a);if(typeof g.isForceAccessCode=="boolean"&&g.isForceAccessCode||d.isNotNull(g.accessCode)||d.isNull(i))return;h.set(a,I.getLinkStorageInst(i,l,false,o)),x.view.changeLinkView(s,l,a,i,o),f.info(`该匹配项无密码，设置密码 ${s} ${l}: ${a}  ===> ${i}`);}else {if(d.isNull(i)&&y.accessCode.allowQueryHistoryMatchingAccessCode.value){let g=tt.queryAccessCode(s,a,true);g&&(f.info("历史匹配记录 ==> 查询到访问码："+g),i=g);}h.set(a,I.getLinkStorageInst(i,l,false,o)),x.isMatchedNetDiskIconMap.add(s),x.view.addLinkView(s,l,a,i,o),f.success(`添加链接 ${s} ${l}: ${a}  ===> ${i}`);}}),Object.keys(I.$match.tempMatchedInfo.getItems()).forEach(e=>{I.$match.tempMatchedInfo.get(e).clear();}),I.$data.isMatchedLink)switch(y.features["netdisk-behavior-mode"].value){case "suspension_smallwindow".toLowerCase():ce.mode.current_suspension_smallwindow_mode.value==="suspension"?x.suspension.show():x.view.show();break;case "suspension_window".toLowerCase():x.suspension.show();break;case "smallwindow".toLowerCase():x.view.show();break;default:f.error("未知的行为模式："+y.features["netdisk-behavior-mode"].value);}V.matchingEndCallBack();},errorCallBack(n){V.matchingEndCallBack(true),f.error("Worker Error",n);},matchingEndCallBack(n){if(n)V.isHandleMatch=false,V.delayNotMatchCount>0&&(V.delayNotMatchCount=0,V.dispatchMonitorDOMChange=true);else {const r=parseFloat(y.match.delaytime.value.toString())*1e3;setTimeout(()=>{V.matchingEndCallBack(true);},r);}},monitorDOMChange(){const n=y.match.isAddedNodesToMatch.value,r=y.match.readClipboard.value,t=y.match.pageMatchRange.value;let e=true,a=true,i=true,s=y.match.depthQueryWithShadowRoot.value;const l={},o=et.getMappingData();I.$rule.rule.forEach(h=>{let g=h.setting.key;X.function.enable(g)&&(Reflect.has(l,g)?l[g]=[...l[g],...h.rule]:Reflect.set(l,g,h.rule));});async function c(h){if(V.isHandleMatch){V.delayNotMatchCount++;return}if(n&&h&&h.length){let w=false;for(let D=0;D<h.length;D++){const C=h[D];if(C.addedNodes&&C.addedNodes instanceof NodeList&&C.addedNodes.length){w=true;break}}if(!w)return}V.isHandleMatch=true;const g=Date.now();if(r)try{let w=await d.getClipboardInfo();w.error!=null&&(I.$data.clipboardText=w.content);}catch{}typeof I.$data.clipboardText!="string"&&(I.$data.clipboardText="");const k=[];if(d.isNotNull(I.$data.clipboardText)){let w=I.$data.clipboardText;k.push(w);}if(y.match.allowMatchLocationHref){let w=Q.getDecodeComponentUrl();k.push(w);}if(e&&(e=false,k.length)){V.postMessage({characterMapping:o,textList:k,matchTextRange:t,matchedRuleOption:l,startTime:g,from:"FirstLoad-DOMChange"});return}if(t.includes("innerText")){let w=ze.getPageText(document.documentElement,s);if(k.push(...w),a){a=false,V.postMessage({characterMapping:o,textList:k,matchTextRange:t,matchedRuleOption:l,startTime:g,from:"FirstLoad-Text-DOMChange"});return}}if(t.includes("innerHTML")){let w=ze.getPageHTML(document.documentElement,s);if(k.push(...w),i){i=false,V.postMessage({characterMapping:o,textList:k,matchTextRange:t,matchedRuleOption:l,startTime:g,from:"FirstLoad-HTML-DOMChange"});return}}if(y.match.toBeMatchedWithInputElementValue){let w=ze.getInputElementValue(document.documentElement,s);k.push(...w);}if(y.match.toBeMatchedTextAreaElementValue){let w=ze.getTextAreaElementValue(document.documentElement,s);k.push(...w);}V.postMessage({characterMapping:o,textList:k,matchTextRange:t,matchedRuleOption:l,startTime:g,from:"DOMChange"});}let u=V.dispatchMonitorDOMChange;Object.defineProperty(V,"dispatchMonitorDOMChange",{set:function(h){if(u=h,h){let g=mr("html");c([{addedNodes:g,attributeName:null,attributeNamespace:null,nextSibling:null,oldValue:null,previousSibling:null,removedNodes:g,target:g[0],type:"attributes"}]);}},get:function(){return u}});let p=y.features["netdisk-match-mode"].value;if(p!=="Menu"){let h=ee(this.neverTipWorkerInitErrorKey,[]);if(Array.isArray(h)||(h=[h]),this.workerInitError!=null){f.error("初始化Worker失败，可能页面使用了Content-Security-Policy策略，使用代替函数，该函数执行匹配时如果页面的内容过大会导致页面卡死",this.workerInitError);let g=h.find(k=>k===window.location.hostname);g?this.registerWorkerInitErrorNeverTipToast(g):this.dispatchWorkerInitErrorDialog();}}p==="MutationObserver"?(d.mutationObserver(document.documentElement,{callback:c,config:{childList:y.match["mutationObserver-childList"].value,characterData:y.match["mutationObserver-characterData"].value,subtree:y.match["mutationObserver-subtree"].value}}),this.dispatchMonitorDOMChange=true):p==="Menu"?Oe.add({key:"performPageTextMatchingManually_"+window.location.href,text:"点击执行文本匹配"+(te.isTopWindow()?"":"（iframe）"),autoReload:false,isStoreValue:false,showText(h){return h},callback:()=>{this.dispatchMonitorDOMChange=true;}}):f.error("未知匹配模式："+p);}},bt={$el:{$select:null,$log:null,$matchText:null,$button:null},reset(){Object.keys(this.$el).forEach(n=>{Reflect.deleteProperty(this.$el,n);});},setLog(n,...r){let t="";r.forEach(a=>{t!==""&&(t+=`
`),typeof a!="string"?t+=JSON.stringify(a,void 0,4):t+=a;});let e=b.createElement("p",{innerText:t},{"data-tag":n});b.append(this.$el.$log,e);},clearLog(){b.html(this.$el.$log);},showUI(n){if(this.reset(),d.isNull(n.regexp)){m.error("请先配置regexp");return}let r=this,e=ue.parseRule([n])[0].rule,a=P.confirm({title:{text:`调试规则 ${n.key}`,position:"center"},content:{text:`
                    <div class="custom-rule-container">
                        <textarea class="custom-rule-match-text" placeholder="请输入需要测试匹配的字符串"></textarea>
                        <div class="custom-rule-input-container">
                        <select class="custom-rule-select-regexp"></select>
                        <button class="custom-rule-run-match-button" type="primary" data-icon="" data-righticon="false">
                            <span>执行</span>
                        </button>
                        </div>
                    </div>
                    <div class="custom-rule-match-log">
                        <div>匹配日志↓</div>
                        <div class="custom-rule-match-log-container"></div>
                    </div>
                    `,html:true},btn:{ok:{enable:false}},style:`
                .custom-rule-container{
                    display: flex;
                    align-items: center;
                }
                .custom-rule-select-regexp{
                    width: 100%;
                    height: 32px;
                    line-height: normal;
                    border: 1px solid rgb(184, 184, 184, var(--pops-bd-opacity));
                    border-radius: 5px;
                    text-align: center;
                    outline: 0;
                    background: rgb(255, 255, 255, var(--pops-bg-opacity));
                    box-shadow: none;
                }
                .custom-rule-input-container{
                    display: flex;
                    flex-wrap: wrap;
                    justify-content: center;
                    margin: 5px;
                    width: 30%;
                }
                .custom-rule-select-regexp-item{

                }
                button.custom-rule-run-match-button{
                    margin-top: 5px;
                }
                textarea.custom-rule-match-text{
                    width: 100%;
                    min-height: 70px;
                    outline: none;
                    margin: 0px;
                    background-image: none;
                    background-color: transparent;
                    display: inline-block;
                    resize: vertical;
                    padding: 5px;
                    line-height: normal;
                    box-sizing: border-box;
                    border: 1px solid rgb(220, 223, 230);
                    appearance: none;
                }
                .custom-rule-match-log{

                }
                .custom-rule-match-log-container{
                    padding: 5px;
                    background: rgb(229, 229, 229);
                }
                .custom-rule-match-log-container p{
                    margin: 2px 0px;
                    border-bottom: 1px solid #000000;
                }
                .custom-rule-match-log-container p:last-child{
                    border-bottom: 0px;
                    margin-bottom: 0px;
                }
                .custom-rule-match-log-container p[data-tag]{
                
                }
                .custom-rule-match-log-container p[data-tag="info"]{

                }
                .custom-rule-match-log-container p[data-tag="success"]{
                    color: green;
                }
                .custom-rule-match-log-container p[data-tag="warn"]{
                    color: yellow;
                }
                .custom-rule-match-log-container p[data-tag="error"]{
                    color: red;
                }
                `},x.popsStyle.customRuleDebugView);this.$el.$select=a.$shadowRoot.querySelector(".custom-rule-select-regexp"),this.$el.$matchText=a.$shadowRoot.querySelector(".custom-rule-match-text"),this.$el.$log=a.$shadowRoot.querySelector(".custom-rule-match-log-container"),this.$el.$button=a.$shadowRoot.querySelector(".custom-rule-run-match-button"),e.forEach((l,o)=>{this.$el.$select.appendChild(b.createElement("option",{className:"custom-rule-select-regexp-item",innerText:"regexp下标:"+o,"data-value":l}));});function i(l){Array.isArray(l.msg)?r.setLog(l.status?"info":"error",...l.msg):r.setLog(l.status?"info":"error",l.msg),l.status||r.setLog("error","执行完毕");}function s(){try{if(d.isNull(r.$el.$matchText.value)){m.error("请先输入待匹配的字符串");return}r.clearLog();let l=n.key,o=r.$el.$select.selectedIndex,c=r.$el.$select.selectedOptions[o]["data-value"];f.info("当前选中的规则: ",c);let u={};u[n.key]=[c];let p=[];if(V.handleRegularMatch({characterMapping:et.getMappingData(),matchedRuleOption:u,textList:[r.$el.$matchText.value],matchTextRange:["innerText","innerHTML"],startTime:Date.now(),from:"Debug"},h=>{p.push(...h.data);}),!p.length){r.setLog("error","未成功匹配到数据");return}p=V.uniqueArr(p),r.setLog("info","成功匹配到的数据 ==> ",p),p.forEach((h,g)=>{r.setLog("success","当前处理的字符串: "+h),r.setLog("success","当前执行: 对shareCode进行处理获取");let k=Ve.handleShareCode(h,c,i);if(d.isNull(k))return;r.setLog("info"," "),r.setLog("info","================分割线================"),r.setLog("info"," "),r.setLog("success","当前执行: 对accessCode进行处理获取");let w=Ve.handleAccessCode(h,c,i);r.setLog("info"," "),r.setLog("info","================分割线================"),r.setLog("info"," "),r.setLog("success","当前执行: 对uiLinkShow进行处理获取");let D=Ve.handleLinkShow(h,c,k,w,i);r.setLog("info"," "),r.setLog("info","================分割线================"),r.setLog("info"," "),r.setLog("success","当前执行: 对blank进行处理获取");let C=Ve.handleBlank(h,c,k,w,i);r.setLog("info"," "),r.setLog("info","================分割线================"),r.setLog("info"," "),r.setLog("success","当前执行: 对copyUrl进行处理获取");let N=Ve.handleCopyUrl(h,c,k,w,i);r.setLog("success","执行完毕");});}catch(l){f.error(l),r.setLog(l.toString());}}b.on(r.$el.$button,"click",void 0,s);}},wt=`.pops[type-value="confirm"] .pops-confirm-content {\r
	overflow: hidden;\r
}\r
/* textarea美化 */\r
.pops.whitesevPopNetDiskCustomRules[type-value="confirm"]\r
	.pops-confirm-content\r
	textarea {\r
	width: 100%;\r
	height: 100%;\r
	border: none;\r
	outline: none;\r
	padding: 0;\r
	margin: 0;\r
	-webkit-appearance: none;\r
	-moz-appearance: none;\r
	appearance: none;\r
	background-image: none;\r
	background-color: transparent;\r
\r
	display: inline-block;\r
	resize: vertical;\r
	padding: 5px 15px;\r
	line-height: normal;\r
	box-sizing: border-box;\r
	border: 1px solid #dcdfe6;\r
	transition: border-color 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);\r
	appearance: none;\r
	resize: none;\r
}\r
/* 获得焦点 */\r
.pops.whitesevPopNetDiskCustomRules[type-value="confirm"]\r
	.pops-confirm-content\r
	textarea:focus {\r
	outline: none;\r
	border-color: #3677f0;\r
}\r
/* 提示文字 */\r
.pops.whitesevPopNetDiskCustomRules[type-value="confirm"]\r
	.pops-confirm-content\r
	textarea::placeholder {\r
	color: #c0c4cc;\r
}\r
/* 鼠标hover */\r
.pops.whitesevPopNetDiskCustomRules[type-value="confirm"]\r
	.pops-confirm-content\r
	textarea:hover {\r
	border-color: #c0c4cc;\r
}\r
`,De={show(n,r,t){let e="添加";n&&(e="编辑"),e+="链接识别规则";let a=null;function i(u,p){let h=a.value.trim(),g=ue.parseRuleStrToRule(h);if(g.success){let k=g.data;if(n)if(ue.updateRule(r,k))m.success("更新成功");else {m.error("更新失败");return}else ue.addRule(k),m.success("添加成功");t==null||t(k);}else m.error(g.msg);}function s(u){let p=a.value.trim(),h=ue.parseRuleStrToRule(p);if(h.success){let g=h.data;bt.showUI(g);}else m.error(h.msg);}function l(u){try{let p=JSON.parse(a.value),h=ue.getFormatRule(p);a.value=h,m.success("格式化成功");}catch(p){f.error(p),m.error(p.message,{html:true,timeout:3500});}}a=P.confirm({title:{text:e,position:"center"},content:{text:'<textarea class="netdisk-custom-rules" placeholder="请输入规则配置"></textarea>',html:true},btn:{merge:true,mergeReverse:false,reverse:false,position:"space-between",ok:{text:"保存",callback:(u,p)=>{i();}},cancel:{text:"调试",callback:(u,p)=>{s();}},other:{enable:true,text:"格式化",type:"xiaomi-primary",callback:(u,p)=>{l();}}},class:"whitesevPopNetDiskCustomRules",style:wt},x.popsStyle.customRulesView).$shadowRoot.querySelector("textarea");let c;n?c=ue.getRule(r):c=ue.getTemplateRule(),a.value=ue.getFormatRule(c);},showSubscribe(n,r,t){let e="编辑订阅的链接识别规则",a=null;function i(u,p){let h=a.value.trim(),g=ue.parseRuleStrToRule(h);if(g.success){let k=g.data;if(ae.updateSubscribeRule(n,k))m.success("更新成功");else {m.error("更新失败");return}t==null||t(k);}else m.error(g.msg);}function s(u){let p=a.value.trim(),h=ue.parseRuleStrToRule(p);if(h.success){let g=h.data;bt.showUI(g);}else m.error(h.msg);}function l(u){try{let p=JSON.parse(a.value),h=ue.getFormatRule(p);a.value=h,m.success("格式化成功");}catch(p){f.error(p),m.error(p.message,{html:true,timeout:3500});}}a=P.confirm({title:{text:e,position:"center"},content:{text:'<textarea class="netdisk-custom-rules" placeholder="请输入规则配置"></textarea>',html:true},btn:{merge:true,mergeReverse:false,reverse:false,position:"space-between",ok:{text:"保存",callback:(u,p)=>{i();}},cancel:{text:"调试",callback:(u,p)=>{s();}},other:{enable:true,text:"格式化",type:"xiaomi-primary",callback:(u,p)=>{l();}}},class:"whitesevPopNetDiskCustomRules",style:wt},x.popsStyle.customRulesView).$shadowRoot.querySelector("textarea");let c;c=ae.getSubscribeRule(n,r),a.value=ue.getFormatRule(c);}},Te=new Pe("userRule"),$e=new Pe("userRuleBindContext"),ue={$data:{STORAGE_KEY:"rule",EXPORT_CONFIG_KEY:"rule-export-config",__userRule:null,get userRule(){return this.__userRule==null&&(this.__userRule=new d.Dictionary),this.__userRule}},init(){let n=ee("userRule");Array.isArray(n)&&(ct("userRule"),this.setRule(n));let r=this.parseRule(this.getAllRule()),t=this.parseRule(ae.getAllSubscribeRule());r=r.concat(t),r.forEach(e=>{this.$data.userRule.set(e.setting.key,e);});},parseRuleStrToRule(n){function r(e){return typeof e.link_innerText!="string"?{success:false,msg:"regexp缺失的键名: link_innerText，类型: string"}:typeof e.link_innerHTML!="string"?{success:false,msg:"regexp缺失的键名: link_innerHTML，类型: string"}:typeof e.shareCode!="string"?{success:false,msg:"regexp缺失的键名: shareCode，类型: string"}:typeof e.shareCodeNeedRemoveStr!="string"?{success:false,msg:"regexp缺失的键名: shareCodeNeedRemoveStr，类型: string"}:typeof e.uiLinkShow!="string"?{success:false,msg:"regexp缺失的键名: uiLinkShow，类型: string"}:typeof e.blank!="string"?{success:false,msg:"regexp缺失的键名: blank，类型: string"}:typeof e.copyUrl!="string"?{success:false,msg:"regexp缺失的键名: copyUrl，类型: string"}:typeof e.accessCode=="string"&&typeof e.checkAccessCode!="string"?{success:false,msg:"regexp设置了accessCode但是没有设置checkAccessCode"}:typeof e.accessCode!="string"&&typeof e.checkAccessCode=="string"?{success:false,msg:"regexp设置了checkAccessCode但是没有设置accessCode"}:{success:true,msg:"校验rule成功"}}function t(e){return typeof e.name!="string"?{success:false,msg:"setting缺失的键名: name，类型: string"}:typeof e.enable!="boolean"?{success:false,msg:"setting缺失的键名: enable，类型: boolean"}:{success:true,msg:"校验setting成功"}}try{let e=typeof n=="string"?d.toJSON(n):n;if(f.info("解析出的规则对象：",e),typeof e!="object")return {success:!1,msg:"该规则不是object类型"};if(Object.keys(e).length===0)return {success:!1,msg:"该规则为空"};if(typeof e.key!="string")return {success:!1,msg:"缺失的键名: key，类型: string"};if(typeof e.regexp!="object")return {success:!1,msg:"缺失的键名: regexp，类型: object|Arrany"};if(typeof e.setting!="object")return {success:!1,msg:"缺失的键名: setting，类型: object"};if(Array.isArray(e.regexp))for(const i of e.regexp){let s=r(i);if(!s.success)return s}else {let i=r(e.regexp);if(!i.success)return i}let a=t(e.setting);return a.success?{success:!0,msg:"解析成功",data:e}:a}catch(e){return f.error(e),{success:false,msg:e.message}}},getBindContext(n){return {rule:n,NetDiskRequire:Ia,CryptoJS:Ie,httpx:M,utils:d,DOMUtils:b,window,unsafeWindow:he,NetDiskCheckLinkValidity:A,log:f,Qmsg:m,pops:K,setValue:$e.set.bind($e),getValue:$e.get.bind($e),deleteValue:$e.delete.bind($e)}},parseRule(n){function r(e,a,i){const{shareCode:s,shareCodeNeedRemoveStr:l,shareCodeNotMatch:o,checkAccessCode:c,accessCode:u,acceesCodeNotMatch:p,paramMatch:h,...g}=i;let k={...g};return k.link_innerText=Q.replaceParam(k.link_innerText,_t(e)),k.link_innerHTML=Q.replaceParam(k.link_innerText,Dt(e)),typeof s=="string"&&(k.shareCode=new RegExp(s,"ig")),typeof l=="string"&&(k.shareCodeNeedRemoveStr=new RegExp(l,"ig")),typeof o=="string"&&(k.shareCodeNotMatch=new RegExp(o,"ig")),typeof c=="string"&&(k.checkAccessCode=new RegExp(c,"ig")),typeof u=="string"&&(k.accessCode=new RegExp(u,"ig")),typeof p=="string"&&(k.acceesCodeNotMatch=new RegExp(p,"ig")),typeof h=="string"&&(k.paramMatch=new RegExp(h,"i")),k}let t=[];for(const e of n){let a={subscribeUUID:e.subscribeUUID,rule:[],setting:{name:e.setting.name,key:e.key,configurationInterface:{matchRange_text:{},matchRange_html:{},function:{},linkClickMode_openBlank:{},schemeUri:{},ownFormList:[]}},isUserRule:true,afterRenderUrlBox:void 0};const i=e.regexp,s=e.key;if(Array.isArray(i)?i.forEach(c=>{a.rule.push(r(s,e,c));}):a.rule.push(r(s,e,i)),e.setting){if(this.initDefaultValue(z.function.enable(s),!!e.setting.enable),a.setting.configurationInterface.function.enable=!!e.setting.enable,typeof e.setting.isBlank=="boolean"&&(this.initDefaultValue(z.function.linkClickMode(s),"openBlank"),a.setting.configurationInterface.function.linkClickMode={openBlank:{default:true,enable:true}}),typeof e.setting.linkClickMode=="object"){let c=d.assign(Q.getDefaultLinkClickMode(),e.setting.linkClickMode||{}),u=null,p=Object.keys(c).map(h=>{let g=c[h];if(g.enable)return g.default&&(u=h),{value:h,text:g.text}}).filter(h=>h!=null);u==null&&(u=p[0].value),this.initDefaultValue(z.function.linkClickMode(s),u);}typeof e.setting.openBlankWithCopyAccessCode=="boolean"&&(this.initDefaultValue(z.linkClickMode_openBlank.openBlankWithCopyAccessCode(s),!!e.setting.openBlankWithCopyAccessCode),a.setting.configurationInterface.linkClickMode_openBlank.openBlankWithCopyAccessCode=!!e.setting.openBlankWithCopyAccessCode),typeof e.setting.openBlankAutoFilleAccessCode=="boolean"&&(this.initDefaultValue(z.linkClickMode_openBlank.openBlankAutoFilleAccessCode(s),!!e.setting.openBlankAutoFilleAccessCode),a.setting.configurationInterface.linkClickMode_openBlank.openBlankAutoFilleAccessCode=!!e.setting.openBlankAutoFilleAccessCode),typeof e.setting.checkLinkValidity=="boolean"&&(this.initDefaultValue(z.function.checkLinkValidity(s),!!e.setting.checkLinkValidity),a.setting.configurationInterface.function.checkLinkValidity=!!e.setting.checkLinkValidity),typeof e.setting.checkLinkValidityHoverTip=="boolean"&&this.initDefaultValue(z.function.checkLinkValidityHoverTip(s),!!e.setting.checkLinkValidityHoverTip),typeof e.setting.isForward=="boolean"&&(this.initDefaultValue(z.schemeUri.enable(s),!!e.setting.isForward),a.setting.configurationInterface.schemeUri.enable=!!e.setting.isForward),typeof e.setting.schemeUri=="string"&&(this.initDefaultValue(z.schemeUri.uri(s),e.setting.schemeUri),a.setting.configurationInterface.schemeUri.uri=e.setting.schemeUri),typeof e.setting.innerTextAccessCodeBeforeMaxRange=="number"&&(this.initDefaultValue(z.matchRange_text.before(s),e.setting.innerTextAccessCodeBeforeMaxRange),a.setting.configurationInterface.matchRange_text.before=e.setting.innerTextAccessCodeBeforeMaxRange),typeof e.setting.innerTextAccessCodeAfterMaxRange=="number"&&(this.initDefaultValue(z.matchRange_text.after(s),e.setting.innerTextAccessCodeAfterMaxRange),a.setting.configurationInterface.matchRange_text.after=e.setting.innerTextAccessCodeAfterMaxRange),typeof e.setting.innerHTMLAccessCodeBeforeMaxRange=="number"&&(this.initDefaultValue(z.matchRange_html.before(s),e.setting.innerHTMLAccessCodeBeforeMaxRange),a.setting.configurationInterface.matchRange_html.before=e.setting.innerHTMLAccessCodeBeforeMaxRange),typeof e.setting.innerHTMLAccessCodeAfterMaxRange=="number"&&(this.initDefaultValue(z.matchRange_html.after(s),e.setting.innerHTMLAccessCodeAfterMaxRange),a.setting.configurationInterface.matchRange_html.after=e.setting.innerHTMLAccessCodeAfterMaxRange);}if(typeof e.icon=="string"){let c=e.icon;x.src.addIcon(s,c);}const l=Object.getPrototypeOf(async function(){}).constructor;if(typeof e.checkLinkValidityFunction=="string")try{let c=this.getBindContext(e);Reflect.set(A.ruleCheckValidFunction,s,{init:new l("ruleIndex","shareCode","accessCode",e.checkLinkValidityFunction).bind(c)});}catch(c){f.error(c);}if(typeof e.AuthorizationFunction=="string")try{let c=this.getBindContext(e);Reflect.deleteProperty(c,"NetDiskCheckLinkValidity"),dt.netDisk[s]=new l(e.AuthorizationFunction).bind(c);}catch(c){f.error(c);}if(typeof e.AutoFillAccessCodeFunction=="string")try{let c=this.getBindContext(e);Reflect.deleteProperty(c,"NetDiskCheckLinkValidity"),Be.netDisk[s]=new l("netDiskInfo",e.AutoFillAccessCodeFunction).bind(c);}catch(c){f.error(c);}if(typeof e.parseFunction=="string")try{let c=this.getBindContext(e);Reflect.deleteProperty(c,"NetDiskCheckLinkValidity"),Reflect.set(Qe.rule,s,new l(e.parseFunction).bind(c));}catch(c){f.error(c);}if(typeof e.afterRenderUrlBox=="string")try{let c=this.getBindContext(e);Reflect.deleteProperty(c,"NetDiskCheckLinkValidity"),a.afterRenderUrlBox=new l("option",e.afterRenderUrlBox).bind(c);}catch(c){f.error(c);}let o=t.find(c=>c.setting.key===a.setting.key);o?o.rule=o.rule.concat(a.rule):t.push(a);}return t},getNetDiskRuleConfig(){return this.$data.userRule.values()},initDefaultValue(n,r){ee(n)==null&&ie(n,r);},getTemplateRule(){return {key:"规则名",icon:"图标链接字符串或图片的base64字符串",regexp:[{link_innerText:"",link_innerHTML:"",shareCode:"",shareCodeNeedRemoveStr:"",uiLinkShow:"",blank:"",copyUrl:""}],setting:{name:"设置界面的名字",enable:true,linkClickMode:"openBlank",openBlankWithCopyAccessCode:true}}},getRulePanelViewOption(n){const r=this;K.config.panelHandleContentUtils();let t=()=>n??this.getTemplateRule(),e={id:"user-rule",title:"链接识别",headerTitle:"链接识别规则",subscribe:{enable:true,data(){return ae.getAllSubscribe()},getData:a=>ae.getSubscribe(a.uuid)??a,getDataItemName(a){return `
						<style>
							.subscribe-rule-title-info-wrapper{
								display: flex;
								flex-direction: column;
								gap: 4px;
							}
							.subscribe-rule-title-info-wrapper .rule-name-text{
								white-space: nowrap;
								text-overflow: ellipsis;
								overflow: hidden;
								font-weight: 600;
								font-size: 16px;
								line-height: 24px;
							}
							.subscribe-rule-title-info-wrapper .subscribe-rule-small-span-text{
								font-size: 14px;
								line-height: 16px;
								white-space: pre-wrap;
							}
						</style>
						<div class="subscribe-rule-title-info-wrapper">
							<div class="rule-name-text" style="white-space: nowrap;text-overflow: ellipsis;overflow: hidden;font-size: 16px;font-weight: 600;line-height: 24px;">${a.data.title||a.subscribeData.title||a.data.url}</div>
								<div class="subscribe-rule-small-span-text">${a.subscribeData.ruleData.length} 条规则，更新于：${d.formatTime(a.data.latestUpdateTime,"yyyy年MM月dd日 HH:mm:ss")}${typeof a.data.updateFailedTime=="number"?`，<span style="color: red;">更新失败于：${d.formatTime(a.data.updateFailedTime,"yyyy年MM月dd日 HH:mm:ss")}</span>`:""}</div>
								${a.subscribeData.homePage?`<a href="${a.subscribeData.homePage}" class="subscribe-rule-small-span-text" target="_blank" style="color:#67b279;">转到主页</a>`:""}
								<a href="${a.data.url}" class="subscribe-rule-small-span-text" target="_blank" style="color:#67b279;">订阅地址</a>
						</div>`},addData:a=>ae.addSubscribe(a),updateData:a=>ae.updateSubscribe(a),deleteData:a=>ae.deleteSubscribe(a),btnControls:{add:{enable:true},filter:{enable:true,title:"过滤订阅",option:[{name:"过滤【已启用】的订阅",filterCallBack(a){return a.data.enable}},{name:"过滤【未启用】的订阅",filterCallBack(a){return !a.data.enable}}]},clearAll:{enable:true,callback:()=>{ae.deleteAllSubscribe();}},ruleEnable:{enable:true,getEnable(a){return a.data.enable},async callback(a,i){a.data.enable=i,ae.updateSubscribe(a);}},ruleEdit:{enable:true,callback:a=>{let i=a.ruleData.uuid;return a.enterDeepMenu({headerTitle:a.ruleData.data.title||a.ruleData.subscribeData.title||a.ruleData.data.url,data(){var l;let s=ae.getSubscribe(i);return ((l=s==null?void 0:s.subscribeData)==null?void 0:l.ruleData)??a.ruleData.subscribeData.ruleData},getData(s){return ae.getSubscribeRule(i,s.key)??s},getDataItemName(s){return s.setting.name},addData(s){return  true},updateData(s){return ae.updateSubscribeRule(i,s)},deleteData(s){return ae.deleteSubscribeRule(i,s)},btnControls:{filter:{enable:true,option:[{name:"过滤【已启用】的规则",filterCallBack(s){return s.setting.enable}},{name:"过滤【未启用】的规则",filterCallBack(s){return !s.setting.enable}}]},clearAll:{enable:true,callback:()=>{ae.clearSubscribe(i);}},ruleEdit:{enable:true,callback(s){return De.showSubscribe(i,s.ruleData.key,async l=>{let o=await s.context.updateRuleItemElement(s.option,s.subscribeOption,l,s.$ruleItem,s.$section);s.$ruleItem=o;}),false}},ruleDelete:{enable:true,deleteCallBack(s){return ae.deleteSubscribeRule(i,s)}}}}),false}},ruleDelete:{enable:true,deleteCallBack:a=>ae.deleteSubscribe(a)},import:{enable:true,callback(a){ae.importSubscribe(()=>{a();});}},export:{enable:true,callback(){ae.exportSubscribe(ye+"-网站规则-订阅.json");}}},getSubscribeInfo:ae.getSubscribeInfo.bind(ae)},ruleOption:{btnControls:{add:{enable:true,callback(a){return De.show(false,void 0,i=>{this.updateRuleContaienrElement(e.ruleOption,void 0,a.$section);}),false}},filter:{enable:true,title:"过滤规则",option:[{name:"过滤【已启用】的规则",filterCallBack(a){return a.setting.enable}},{name:"过滤【未启用】的规则",filterCallBack(a){return !a.setting.enable}}]},clearAll:{enable:true,callback:()=>{r.clearRule();}},import:{enable:true,callback:a=>{r.importRule(()=>{a();});}},export:{enable:true,callback:()=>{r.exportRule(ye+"-链接识别规则.json",ye+"-链接识别规则-订阅模式.json");}},ruleEdit:{enable:true,callback(a){return De.show(true,a.ruleData.key,async i=>{let s=await a.context.updateRuleItemElement(a.option,a.subscribeOption,i,a.$ruleItem,a.$section);a.$ruleItem=s;}),false}},ruleDelete:{enable:true,deleteCallBack:a=>r.deleteRule(a.key)}},data:()=>this.getAllRule(),getAddData:()=>t(),getData:a=>this.getAllRule().find(l=>l.key===a.key)??a,getDataItemName:a=>a.setting.name,updateData:a=>this.updateRule(a.key,a),deleteData:a=>this.deleteRule(a.key)}};return e},addRule(n){let r=this.getAllRule();r.push(n),this.setRule(r);},setRule(n){n=Array.isArray(n)?n:[n],Te.set(this.$data.STORAGE_KEY,n);},updateRule(n,r){let t=this.getAllRule(),e=t.findIndex(a=>a.key===n);return e!==-1?(t.splice(e,1,r),this.setRule(t),true):false},deleteRule(n){let r=this.getAllRule(),t=r.findIndex(e=>e.key===n);return t!==-1?(r.splice(t,1),this.setRule(r),true):false},clearRule(){Te.delete(this.$data.STORAGE_KEY);},getAllRule(){return Te.get(this.$data.STORAGE_KEY,[])},getRule(n){return this.getAllRule().find(t=>t.key===n)},getFormatRule(n){return JSON.stringify(n||this.getAllRule(),void 0,4)},exportRule(n="rule.json",r="rule-subscribe.json"){let t=P.alert({title:{text:"请选择导出方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="only-export-rule-list">导出规则</div>
                    <div class="btn-control" data-mode="export-to-subscribe">导出订阅规则</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(s,l){s.close();}}},mask:{enable:true},drag:true,width:Z.info.width,height:Z.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),e=t.$shadowRoot.querySelector(".btn-control[data-mode='only-export-rule-list']"),a=t.$shadowRoot.querySelector(".btn-control[data-mode='export-to-subscribe']"),i=(s,l)=>{let o=new Blob([JSON.stringify(l,null,4)]),c=window.URL.createObjectURL(o),u=document.createElement("a");u.href=c,u.download=s,u.click(),setTimeout(()=>{window.URL.revokeObjectURL(c);},1500);};b.on(e,"click",s=>{d.preventEvent(s);try{let l=this.getAllRule();if(l.length===0){m.warning("规则为空，无需导出");return}i(n,l),t.close();}catch(l){m.error(l.toString(),{consoleLogContent:true});}}),b.on(a,"click",s=>{d.preventEvent(s);const l=this;t.close();try{if(this.getAllRule().length===0){m.warning("规则为空，无需导出");return}let c=K.config.panelHandleContentUtils(),u=function(v){return {get(R,_){return v[R]??_},set(R,_){v[R]=_,Te.set(l.$data.EXPORT_CONFIG_KEY,v);}}},p=()=>{let v=Te.get(this.$data.EXPORT_CONFIG_KEY,{});if((v==null?void 0:v.title)===""||v.title==null){m.error("订阅标题不能为空");return}if(v.version==null){m.error("版本号不能为空");return}else v.version=Number(v.version);v.homePage==null&&(v.homePage=void 0),v.lastModified=Date.now(),v.ruleData=this.getAllRule(),i(r,v),h.close();},h=P.alert({title:{text:"请填写导出配置",position:"center"},content:{text:`
							
						`,html:!0},btn:{ok:{enable:!0,text:"导出",callback(v,R){p();}},close:{enable:!0,callback(v,R){v.close();}}},mask:{enable:!0},drag:!0,width:Z.info.width,height:Z.info.height,style:`
						${K.config.cssText.panelCSS}

						.pops-alert-content li{
							list-style-type: none;
							display: flex;
							align-items: center;
							justify-content: space-between;
							margin: 10px;
						}
					`}),g=h.$shadowRoot.querySelector(".pops-alert-content"),k=Te.get(this.$data.EXPORT_CONFIG_KEY,{}),w=J("订阅标题","title","","",void 0,"");Reflect.set(w.props,F,u(k));let D=c.createSectionContainerItem_input(w),C=J("版本号","version","","",void 0,"",!0);Reflect.set(C.props,F,u(k));let N=c.createSectionContainerItem_input(C),S=J("主页地址","homePage","","",void 0,"选填");Reflect.set(S.props,F,u(k));let T=c.createSectionContainerItem_input(S);b.append(g,D),b.append(g,N),b.append(g,T);}catch(o){m.error(o.toString(),{consoleLogContent:true});}});},importRule(n){let r=P.alert({title:{text:"请选择导入方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="local">本地导入</div>
                    <div class="btn-control" data-mode="network">网络导入</div>
                    <div class="btn-control" data-mode="clipboard">剪贴板导入</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(l,o){l.close();}}},mask:{enable:true},drag:true,width:Z.info.width,height:Z.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),t=r.$shadowRoot.querySelector(".btn-control[data-mode='local']"),e=r.$shadowRoot.querySelector(".btn-control[data-mode='network']"),a=r.$shadowRoot.querySelector(".btn-control[data-mode='clipboard']"),i=l=>{let o=this.getAllRule(),c=[];for(let u=0;u<l.length;u++){const p=l[u];o.findIndex(g=>g.key===p.key)!==-1||c.push(p);}o=o.concat(c),c.length?(Te.set(this.$data.STORAGE_KEY,o),f.info(["新增的规则：",c]),m.success(`共 ${l.length} 条规则，新增 ${c.length} 条`)):m.error("未新增规则，请删除旧规则再重新导入"),n==null||n();},s=l=>new Promise(o=>{let c=d.toJSON(l);if(Array.isArray(c)){if(!c.length){m.error("导入失败，解析出的数据为空",{consoleLogContent:true}),o(false);return}}else c=[c];let u=[];for(let h=0;h<c.length;h++){const g=c[h];let k=this.parseRuleStrToRule(g);if(!k.success){if(c.length===1){m.error(k.msg,{timeout:4e3});return}continue}k.data&&u.push(k.data);}let p=c.length-u.length;p>0&&(p===c.length?m.error("所有规则均未通过规则检查，请检查规则",{timeout:4e3}):m.warning(`检测到有 ${p}条未通过规则检查的规则，已忽略`,{timeout:4e3})),u.length&&(i(u),o(true));});b.on(t,"click",l=>{d.preventEvent(l),r.close();let o=b.createElement("input",{type:"file",accept:".json"});b.on(o,["propertychange","input"],c=>{var h;if(!((h=o.files)!=null&&h.length))return;let u=o.files[0],p=new FileReader;p.onload=()=>{s(p.result);},p.readAsText(u,"UTF-8");}),o.click();}),b.on(e,"click",l=>{d.preventEvent(l),r.close();let o=P.prompt({title:{text:"网络导入",position:"center"},content:{text:"",placeholder:"请填写URL",focus:true},btn:{close:{enable:true,callback(p,h){p.close();}},ok:{text:"导入",callback:async(p,h)=>{let g=p.text;if(d.isNull(g)){m.error("请填入完整的url");return}let k=m.loading("正在获取配置..."),w=await M.get(g,{allowInterceptConfig:false});if(k.close(),!w.status){f.error(w),m.error("获取配置失败",{consoleLogContent:true});return}await s(w.data.responseText)&&p.close();}},cancel:{enable:false}},mask:{enable:true},drag:true,width:Z.info.width,height:"auto"}),c=o.$shadowRoot.querySelector("input"),u=o.$shadowRoot.querySelector(".pops-prompt-btn-ok");b.on(c,["input","propertychange"],p=>{b.val(c)===""?b.attr(u,"disabled","true"):b.removeAttr(u,"disabled");}),b.listenKeyboard(c,"keydown",(p,h,g)=>{p==="Enter"&&g.length===0&&b.val(c)!==""&&d.dispatchEvent(u,"click");}),d.dispatchEvent(c,"input");}),b.on(a,"click",async l=>{d.preventEvent(l),r.close();let o=await d.getClipboardInfo();if(o.error!=null){m.error(o.error.toString());return}if(o.content.trim()===""){m.warning("获取到的剪贴板内容为空");return}await s(o.content);});}},Ua={rule:[{link_innerText:"pan.baidu.com/s/[0-9a-zA-Z-_]{6,24}([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码|\\?pwd=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"pan.baidu.com/s/[0-9a-zA-Z-_]{6,24}([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码|\\?pwd=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/pan\.baidu\.com\/s\/([0-9a-zA-Z-_]+)/gi,shareCodeNeedRemoveStr:/pan\.baidu\.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码|pwd=)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"pan.baidu.com/s/{#shareCode#}?pwd={#accessCode#}",blank:"https://pan.baidu.com/s/{#shareCode#}?pwd={#accessCode#}",copyUrl:"https://pan.baidu.com/s/{#shareCode#}?pwd={#accessCode#}"},{link_innerText:"pan.baidu.com/(share|wap)/init\\?surl=[0-9a-zA-Z-_]{5,24}([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码|&pwd=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"pan.baidu.com/(share|wap)/init\\?surl=[0-9a-zA-Z-_]{5,24}([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码|&pwd=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/pan\.baidu\.com\/(share|wap)\/init\?surl=([0-9a-zA-Z-_]+)/gi,shareCodeNeedRemoveStr:/pan\.baidu\.com\/(share|wap)\/init\?surl=/gi,checkAccessCode:/(密码|访问码|提取码|&pwd=)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"pan.baidu.com/share/init?surl={#shareCode#}&pwd={#accessCode#}",blank:"https://pan.baidu.com/share/init?surl={#shareCode#}&pwd={#accessCode#}",copyUrl:"https://pan.baidu.com/share/init?surl={#shareCode#}&pwd={#accessCode#}"}],setting:{name:"百度网盘",key:"baidu",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:true,uri:""}}}},Pa=()=>({rule:[{link_innerText:"(lanzou[a-z]{0,1}|lan[a-z]{2}).com/(tp/|u/|)([a-zA-Z0-9_-]{5,22}|[%0-9a-zA-Z]{4,90}|[\\u4e00-\\u9fa5]{1,20})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[a-zA-Z0-9]{3,6}|)",link_innerHTML:"(lanzou[a-z]{0,1}|lan[a-z]{2}).com/(tp/|u/|)([a-zA-Z0-9_-]{5,22}|[%0-9a-zA-Z]{4,90}|[\\u4e00-\\u9fa5]{1,20})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[a-zA-Z0-9]{3,6}|)",shareCode:/(lanzou[a-z]{0,1}|lan[a-z]{2}).com\/(tp\/|u\/|)([a-zA-Z0-9_\-]{5,22}|[%0-9a-zA-Z]{4,90}|[\u4e00-\u9fa5]{1,20})/gi,shareCodeNeedRemoveStr:/(lanzou[a-z]{0,1}|lan[a-z]{2}).com\/(tp\/|u\/|)/gi,shareCodeExcludeRegular:["lanzouyx"],checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{3,})/gi,uiLinkShow:`${me.hostname}/{#shareCode#} 提取码: {#accessCode#}`,blank:`https://${me.hostname}/{#shareCode#}`,copyUrl:`https://${me.hostname}/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"(lanzou[a-z]{0,1}|lan[a-z]{2}).com/s/([a-zA-Z0-9_-]{5,22}|[%0-9a-zA-Z]{4,90}|[\\u4e00-\\u9fa5]{1,20})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[a-zA-Z0-9]{3,6}|)",link_innerHTML:"(lanzou[a-z]{0,1}|lan[a-z]{2}).com/s/([a-zA-Z0-9_-]{5,22}|[%0-9a-zA-Z]{4,90}|[\\u4e00-\\u9fa5]{1,20})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[a-zA-Z0-9]{3,6}|)",shareCode:/(lanzou[a-z]{0,1}|lan[a-z]{2}).com\/s\/([a-zA-Z0-9_\-]{5,22}|[%0-9a-zA-Z]{4,90}|[\u4e00-\u9fa5]{1,20})/gi,shareCodeNeedRemoveStr:/(lanzou[a-z]{0,1}|lan[a-z]{2}).com\/s\//gi,shareCodeExcludeRegular:["lanzouyx"],checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{3,})/gi,uiLinkShow:`${me.hostname}/s/{#shareCode#} 提取码: {#accessCode#}`,blank:`https://${me.hostname}/s/{#shareCode#}`,copyUrl:`https://${me.hostname}/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"蓝奏云",key:"lanzou",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:false,isForwardBlankLink:false,uri:""},ownFormList:[{text:"其它配置",type:"forms",forms:[J("蓝奏云域名",me.MENU_KEY,me.DEFAULT_HOST_NAME,"",void 0,`例如：${me.DEFAULT_HOST_NAME}`)]}]}}}),Va={rule:[{link_innerText:"ilanzou.com/s/([a-zA-Z0-9_-]{5,22})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码|\\?code=)[\\s\\S]{0,{#matchRange-text-after#}}[a-zA-Z0-9]{3,6}|)",link_innerHTML:"ilanzou.com/s/([a-zA-Z0-9_-]{5,22})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码|\\?code=)[\\s\\S]{0,{#matchRange-html-after#}}[a-zA-Z0-9]{3,6}|)",shareCode:/ilanzou.com\/s\/([a-zA-Z0-9_\-]{5,22})/gi,shareCodeNeedRemoveStr:/ilanzou.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码|\?code=)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{3,})/gi,uiLinkShow:"www.ilanzou.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.ilanzou.com/s/{#shareCode#}?code={#accessCode#}",copyUrl:"https://www.ilanzou.com/s/{#shareCode#}?code={#accessCode#}"}],setting:{name:"蓝奏云优享",key:"lanzouyx",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:false,isForwardBlankLink:false,uri:""}}}},za={rule:[{link_innerText:"(cloud.189.cn/web/share\\?code=([0-9a-zA-Z_-]){8,14}|cloud.189.cn/t/([a-zA-Z0-9_-]{8,14}))([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"(cloud.189.cn/web/share\\?code=([0-9a-zA-Z_-]){8,14}|cloud.189.cn/t/([a-zA-Z0-9_-]{8,14}))([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/cloud.189.cn\/web\/share\?code=([0-9a-zA-Z_\-]){8,14}|cloud.189.cn\/t\/([a-zA-Z0-9_\-]{8,14})/gi,shareCodeNeedRemoveStr:/cloud\.189\.cn\/t\/|cloud.189.cn\/web\/share\?code=/gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"cloud.189.cn/t/{#shareCode#} 提取码: {#accessCode#}",blank:"https://cloud.189.cn/t/{#shareCode#}",copyUrl:`https://cloud.189.cn/t/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"天翼云",key:"tianyiyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:false,isForwardBlankLink:false,uri:""}}}},Ba={rule:[{link_innerText:"caiyun.139.com/m/i\\?([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"caiyun.139.com/m/i\\?([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/caiyun\.139\.com\/m\/i\?([a-zA-Z0-9_\-]{8,14})/gi,shareCodeNeedRemoveStr:/caiyun\.139\.com\/m\/i\?/gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"caiyun.139.com/m/i?{#shareCode#} 提取码: {#accessCode#}",blank:"https://caiyun.139.com/m/i?{#shareCode#}",copyUrl:`https://caiyun.139.com/m/i?{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"yun.139.com/link/w/i/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"yun.139.com/link/w/i/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/yun\.139\.com\/link\/w\/i\/([a-zA-Z0-9_\-]{8,14})/gi,shareCodeNeedRemoveStr:/yun\.139\.com\/link\/w\/i\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"yun.139.com/link/w/i/{#shareCode#} 提取码: {#accessCode#}",blank:"https://yun.139.com/link/w/i/{#shareCode#}",copyUrl:`https://yun.139.com/link/w/i/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"中国移动云盘",key:"hecaiyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}}},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:false,uri:""}}}},Ga={rule:[{link_innerText:"aliyundrive.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"aliyundrive.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/aliyundrive\.com\/s\/([a-zA-Z0-9_\-]{8,14})/g,shareCodeNeedRemoveStr:/aliyundrive\.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"aliyundrive.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.aliyundrive.com/s/{#shareCode#}",copyUrl:`https://www.aliyundrive.com/s/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"aliyundrive.com/t/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"aliyundrive.com/t/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/aliyundrive\.com\/t\/([a-zA-Z0-9_\-]{8,14})/g,shareCodeNeedRemoveStr:/aliyundrive\.com\/t\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"aliyundrive.com/t/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.aliyundrive.com/t/{#shareCode#}",copyUrl:`https://www.aliyundrive.com/t/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"alipan.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"alipan.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/alipan\.com\/s\/([a-zA-Z0-9_\-]{8,14})/g,shareCodeNeedRemoveStr:/alipan\.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"alipan.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.alipan.com/s/{#shareCode#}",copyUrl:`https://www.alipan.com/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"阿里云",key:"aliyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:true,isForwardBlankLink:true,uri:""}}}},Ha={rule:[{link_innerText:"(wenshushu.cn|wss.ink|ws28.cn|wss1.cn|ws59.cn|wss.cc)/f/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"(wenshushu.cn|wss.ink|ws28.cn|wss1.cn|ws59.cn|wss.cc)/f/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/(wenshushu.cn|wss.ink|ws28.cn|wss1.cn|ws59.cn|wss.cc)\/f\/([a-zA-Z0-9_-]{8,14})/gi,shareCodeNeedRemoveStr:/(wenshushu.cn|wss.ink|ws28.cn|wss1.cn|ws59.cn|wss.cc)\/f\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/[0-9a-zA-Z]{4}/gi,uiLinkShow:"www.wenshushu.cn/f/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.wenshushu.cn/f/{#shareCode#}",copyUrl:`https://www.wenshushu.cn/f/{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"wenshushu.cn/k/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"wenshushu.cn/k/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/wenshushu.cn\/k\/([a-zA-Z0-9_-]{8,14})/gi,shareCodeNeedRemoveStr:/wenshushu.cn\/k\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/[0-9a-zA-Z]{4}/gi,uiLinkShow:"www.wenshushu.cn/k/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.wenshushu.cn/k/{#shareCode#}",copyUrl:`https://www.wenshushu.cn/k/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"文叔叔",key:"wenshushu",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:true,isForwardBlankLink:true,uri:""}}}},ja={rule:[{link_innerText:"cowtransfer.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-text-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"cowtransfer.com/s/([a-zA-Z0-9_-]{8,14})([\\s\\S]{0,{#matchRange-html-before#}}(密码|访问码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/cowtransfer.com\/s\/([a-zA-Z0-9_\-]{8,14})/gi,shareCodeNeedRemoveStr:/cowtransfer\.com\/s\//gi,checkAccessCode:/(密码|访问码|提取码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"cowtransfer.com/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://cowtransfer.com/s/{#shareCode#}",copyUrl:`https://cowtransfer.com/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"奶牛",key:"nainiu",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:true,isForwardBlankLink:true,uri:""}}}},qa={rule:[{link_innerText:"weiyun.com/[0-9a-zA-Z-_]{7,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"weiyun.com/[0-9a-zA-Z-_]{7,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/weiyun.com\/([0-9a-zA-Z\-_]{7,24})/gi,shareCodeNeedRemoveStr:/weiyun.com\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"share.weiyun.com/{#shareCode#} 提取码: {#accessCode#}",blank:"https://share.weiyun.com/{#shareCode#}",copyUrl:`https://share.weiyun.com/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"微云",key:"weiyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:true,uri:""}}}},Za={rule:[{link_innerText:"xunlei.com/s/[0-9a-zA-Z-_]{8,30}([\\s\\S]{0,{#matchRange-text-before#}}(\\?pwd=|访问码|提取码|密码|)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"xunlei.com/s/[0-9a-zA-Z-_]{8,30}([\\s\\S]{0,{#matchRange-html-before#}}(\\?pwd=|访问码|提取码|密码|)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/xunlei.com\/s\/([0-9a-zA-Z\-_]{8,30})/gi,shareCodeNeedRemoveStr:/xunlei.com\/s\//gi,checkAccessCode:/(\?pwd=|提取码|密码|访问码)[\s\S]+/g,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"pan.xunlei.com/s/{#shareCode#}?pwd={#accessCode#} 提取码: {#accessCode#}",blank:"https://pan.xunlei.com/s/{#shareCode#}?pwd={#accessCode#}",copyUrl:"https://pan.xunlei.com/s/{#shareCode#}?pwd={#accessCode#}"}],setting:{name:"迅雷云盘",key:"xunlei",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:true,uri:""}}}},Wa={rule:[{link_innerText:"(pan.jc-box.com|download.jamcz.com|545c.com)/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(pan.jc-box.com|download.jamcz.com|545c.com)/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/(pan.jc-box.com|download.jamcz.com|545c.com)\/d\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(pan.jc-box.com|download.jamcz.com|545c.com)\/d\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,paramMatch:/([a-zA-Z0-9\.]+)\/d\//i,uiLinkShow:"{#$1#}/d/{#shareCode#} 提取码: {#accessCode#}",blank:"https://{#$1#}/d/{#shareCode#}?p={#accessCode#}",copyUrl:`https://{#$1#}/d/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"ct.ghpym.com/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"ct.ghpym.com/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/ct.ghpym.com\/d\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/ct.ghpym.com\/d\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,paramMatch:/([a-zA-Z0-9\.]+)\/d\//i,uiLinkShow:"{#$1#}/d/{#shareCode#} 提取码: {#accessCode#}",blank:"http://{#$1#}/d/{#shareCode#}?p={#accessCode#}",copyUrl:`http://{#$1#}/d/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"ctfile.com/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"ctfile.com/d/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/ctfile.com\/d\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/ctfile.com\/d\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"url95.ctfile.com/d/{#shareCode#} 提取码: {#accessCode#}",blank:"https://url95.ctfile.com/d/{#shareCode#}?p={#accessCode#}",copyUrl:`https://url95.ctfile.com/d/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"(2k.us|u062.com|545c.com|t00y.com|tc5.us)/file/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(2k.us|u062.com|545c.com|t00y.com|tc5.us)/file/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/(2k.us|u062.com|545c.com|t00y.com|tc5.us)\/file\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(2k.us|u062.com|545c.com|t00y.com|tc5.us)\/file\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"u062.com/file/{#shareCode#} 提取码: {#accessCode#}",blank:"https://u062.com/file/{#shareCode#}?p={#accessCode#}",copyUrl:`https://u062.com/file/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"(pan.jc-box.com|545c.com|down.jc-box.com|download.cx05.cc|download.jamcz.com|download.macenjoy.co)/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(pan.jc-box.com|545c.com|down.jc-box.com|download.cx05.cc|download.jamcz.com|download.macenjoy.co)/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/(pan.jc-box.com|545c.com|down.jc-box.com|download.cx05.cc|download.jamcz.com|download.macenjoy.co)\/f\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(pan.jc-box.com|545c.com|down.jc-box.com|download.cx05.cc|download.jamcz.com|download.macenjoy.co)\/f\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,paramMatch:/([0-9a-zA-Z\.]+)\/f\//i,uiLinkShow:"{#$1#}/f/{#shareCode#} 提取码: {#accessCode#}",blank:"http://{#$1#}/f/{#shareCode#}?p={#accessCode#}",copyUrl:`http://{#$1#}/f/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"url[0-9]{2}.com/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"url[0-9]{2}.com/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/url[0-9]{2}.com\/f\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/url[0-9]{2}.com\/f\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,paramMatch:/([0-9a-zA-Z\.]+)\/f\//i,uiLinkShow:"{#$1#}/f/{#shareCode#} 提取码: {#accessCode#}",blank:"http://{#$1#}/f/{#shareCode#}?p={#accessCode#}",copyUrl:`http://{#$1#}/f/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"(ctfile.com|089u.com)/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(ctfile.com|089u.com)/f/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4,6}|)",shareCode:/(ctfile.com|089u.com)\/f\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(ctfile.com|089u.com)\/f\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,6})/gi,uiLinkShow:"url95.ctfile.com/f/{#shareCode#} 提取码: {#accessCode#}",blank:"https://url95.ctfile.com/f/{#shareCode#}?p={#accessCode#}",copyUrl:`https://url95.ctfile.com/f/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`},{link_innerText:"(089u.com|474b.com)/dir/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4,6}|)",link_innerHTML:"(089u.com|474b.com)/dir/[0-9a-zA-Z-_]{8,26}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=|\\?p=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{6}|)",shareCode:/(089u.com|474b.com)\/dir\/([0-9a-zA-Z\-_]{8,26})/gi,shareCodeNeedRemoveStr:/(089u.com|474b.com)\/dir\//gi,checkAccessCode:/(提取码|密码|访问码|\\?password=|\\?p=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{6})/gi,uiLinkShow:"089u.com/dir/{#shareCode#} 提取码: {#accessCode#}",blank:"https://089u.com/dir/{#shareCode#}?p={#accessCode#}",copyUrl:`https://089u.com/dir/{#shareCode#}?p={#accessCode#}
密码：{#accessCode#}`}],setting:{name:"城通网盘",key:"chengtong",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:true,uri:""},ownFormList:[{type:"forms",text:"文件解析配置",forms:[J("<a target='_blank' href='https://github.com/qinlili23333/ctfileGet/'>解析站</a>","chengtong-parse-file-api-host","https://ctfile.qinlili.bid","解析站配置，暂时只支持file，非file为新标签页打开",void 0,"")]}]}}},Ka={rule:[{link_innerText:"quark.cn/s/[0-9a-zA-Z-_]{8,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"quark.cn/s/[0-9a-zA-Z-_]{8,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/quark.cn\/s\/([0-9a-zA-Z\-_]{8,24})/gi,shareCodeNeedRemoveStr:/quark.cn\/s\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"quark.cn/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://pan.quark.cn/s/{#shareCode#}",copyUrl:`https://pan.quark.cn/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"夸克网盘",key:"kuake",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:true,uri:""}}}},Ke={MENU_KEY:"magnet-preview-tooltip-enable",MENU_DEFAULT_VALUE:true},Ya={rule:[{link_innerText:"magnet:\\?xt=urn:btih:[0-9a-fA-F]{32,40}",link_innerHTML:"magnet:\\?xt=urn:btih:[0-9a-fA-F]{32,40}",shareCode:/magnet:\?xt=urn:btih:([0-9a-fA-F]{32,40})/gi,shareCodeNeedRemoveStr:/magnet:\?xt=urn:btih:/gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4})/gi,uiLinkShow:"magnet:?xt=urn:btih:{#shareCode#}",blank:"magnet:?xt=urn:btih:{#shareCode#}",copyUrl:"magnet:?xt=urn:btih:{#shareCode#}"}],setting:{name:"BT磁力",key:"magnet",configurationInterface:{function:{enable:true,linkClickMode:{openBlank:{default:true}}},schemeUri:{enable:false,isForwardBlankLink:true,uri:""},ownFormList:[{type:"forms",text:`
						<a href="https://whatslink.info/" target="_blank">元数据查询</a>
					`,forms:[H("鼠标悬停预览",Ke.MENU_KEY,Ke.MENU_DEFAULT_VALUE,void 0,"注意：Api请求存在访问频率限制")]}]}},async afterRenderUrlBox(n){const r=this;if(!L(Ke.MENU_KEY,Ke.MENU_DEFAULT_VALUE).value)return;let e=false,a="正在请求Api中...",i=K.tooltip({target:n.$url,content:()=>a,isDiffContent:true,position:"follow",alwaysShow:false,isFixed:true,showArrow:false,delayCloseTime:300,triggerShowEventName:"mouseenter touchstart mousemove touchmove",otherDistance:15,className:"github-tooltip",showBeforeCallBack(s){if(e)return;e=true;let l=re.getBlankUrl(r.setting.key,n.ruleIndex,n.shareCode,n.accessCode);f.info(`正在获取magnet链接信息：${l}`),M.get("https://whatslink.info/api/v1/link?url="+l,{headers:{Referer:"https://whatslink.info/"},allowInterceptConfig:false}).then(o=>{let c=d.toJSON(o.data.responseText);if(!o.status){a="请求失败",typeof c.error=="string"&&c.error.trim()!==""&&(a=a+"，"+c.error),i.toolTip.changeContent(a);return}a=`
						<div class="wrapper">
							<div class="title">Summary</div>
							<div class="content">
								<div>Resource Name: ${c.name}</div>
								<div>Number of Files: ${c.count}</div>
								<div>Total File Size: ${d.formatByteToSize(c.size)}</div>
								<div>File Type: ${c.type.toLowerCase()}</div>
							</div>
						</div>
						${Array.isArray(c.screenshots)?`
							<div class="wrapper">
								<div class="title">Screenshots</div>
								<div class="content">
									<div class="image-list">
										${c.screenshots.map(u=>`
											<div class="img">
												<img src="${u.screenshot}" alt="img">
											</div>
										`).join("")}
										
									</div>
								</div>
							</div>
						`:""}
						`,i.toolTip.changeContent(a);});},style:`
				.pops-tip{
					max-height: 500px;
					overflow: hidden;
				}
				.wrapper .content{
					text-align: left;
				}
				.wrapper .image-list{
					overflow: auto;
					display: flex;
				}
				.wrapper .image-list img{
					max-width: 200px;
					max-height: 200px;
				}
			`});}},Ja={rule:[{link_innerText:"jianguoyun.com/p/[0-9a-zA-Z-_]{16,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]+|)",link_innerHTML:"jianguoyun.com/p/[0-9a-zA-Z-_]{16,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]+|)",shareCode:/jianguoyun.com\/p\/([0-9a-zA-Z\-_]{16,24})/gi,shareCodeNeedRemoveStr:/jianguoyun.com\/p\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{3,6})/gi,uiLinkShow:"jianguoyun.com/p/{#shareCode#} 提取码: {#accessCode#}",blank:"https://www.jianguoyun.com/p/{#shareCode#}",copyUrl:`https://www.jianguoyun.com/p/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"坚果云",key:"jianguoyun",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:false,isForwardBlankLink:false,uri:""}}}},Xa={rule:[{link_innerText:"[0-9a-zA-Z-_]+.sharepoint.com/[0-9a-zA-Z-_:]+/[0-9a-zA-Z-_:]+/personal/[0-9a-zA-Z-_]+/[0-9a-zA-Z-_]+([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=\\?e=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]+|)",link_innerHTML:"[0-9a-zA-Z-_]+.sharepoint.com/[0-9a-zA-Z-_:]+/[0-9a-zA-Z-_:]+/personal/[0-9a-zA-Z-_]+/[0-9a-zA-Z-_]+([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=\\?e=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]+|)",shareCode:/[0-9a-zA-Z-_]+\/[0-9a-zA-Z-_:]+\/[0-9a-zA-Z-_:]+\/personal\/[0-9a-zA-Z-_]+\/([0-9a-zA-Z\-_]+)/gi,shareCodeNeedRemoveStr:/[0-9a-zA-Z-_]+\/[0-9a-zA-Z-_:]+\/[0-9a-zA-Z-_:]+\/personal\/[0-9a-zA-Z-_]+\//gi,checkAccessCode:/(提取码|密码|访问码|\?password=|\?e=)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4,8})/gi,paramMatch:/([0-9a-zA-Z-_]+).sharepoint.com\/([0-9a-zA-Z-_:]+)\/([0-9a-zA-Z-_:]+)\/personal\/([0-9a-zA-Z-_]+)\/([0-9a-zA-Z-_]+)/i,uiLinkShow:"{#$1#}.sharepoint.com/{#$2#}/{#$3#}/personal/{#$4#}/{#shareCode#} 提取码: {#accessCode#}",blank:"https://{#$1#}.sharepoint.com/{#$2#}/{#$3#}/personal/{#$4#}/{#shareCode#}?e={#accessCode#}",copyUrl:`https://{#$1#}.sharepoint.com/{#$2#}/{#$3#}/personal/{#$4#}/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"OneDrive",key:"onedrive",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:false,uri:""}}}},Qa={rule:[{link_innerText:"(drive|fast).uc.cn/s/[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]+|)",link_innerHTML:"(drive|fast).uc.cn/s/[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]+|)",shareCode:/(drive|fast).uc.cn\/s\/([0-9a-zA-Z]{8,24})/gi,shareCodeNeedRemoveStr:/(drive|fast).uc.cn\/s\//gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]+)/gi,uiLinkShow:"drive.uc.cn/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://drive.uc.cn/s/{#shareCode#}",copyUrl:`https://drive.uc.cn/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"UC网盘",key:"uc",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true},parseFile:{enable:true},"parseFile-closePopup":{enable:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:false,isForwardBlankLink:false,uri:""}}}},be=function(n,r,t,e,a,i,s,l,o){let c={text:n,type:"slider",description:l,attributes:{},props:{},getValue(){return this.props[F].get(r,t)},getToolTipContent(u){return typeof s=="function"?s(u):`${u}`},callback(u,p){typeof i=="function"&&i(u,p)||this.props[F].set(r,p);},min:e,max:a,step:o};return Reflect.set(c.attributes,pe,r),Reflect.set(c.attributes,ge,t),Reflect.set(c.props,F,{get(u,p){return ee(u,p)},set(u,p){ie(u,p);}}),c},Re=function(n,r,t,e,a,i){let s=[];typeof e=="function"?s=e():s=e;let l={text:n,type:"select",description:i,attributes:{},props:{},getValue(){return this.props[F].get(r,t)},callback(o,c,u){let p=c;f.info(`选择：${u}`),this.props[F].set(r,p);},data:s};return Reflect.set(l.attributes,pe,r),Reflect.set(l.attributes,ge,t),Reflect.set(l.props,F,{get(o,c){return ee(o,c)},set(o,c){ie(o,c);}}),l},er={rule:[{link_innerText:"(115.com|115cdn.com|anxia.com)/s/[0-9a-zA-Z-_]{8,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]{4}|)",link_innerHTML:"(115.com|115cdn.com|anxia.com)/s/[0-9a-zA-Z-_]{8,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]{4}|)",shareCode:/(115.com|115cdn.com|anxia.com)\/s\/([0-9a-zA-Z\-_]{8,24})/gi,shareCodeNeedRemoveStr:/(115.com|115cdn.com|anxia.com)\/s\//gi,checkAccessCode:/(提取码|密码|\?password=|访问码)[\s\S]+/gi,accessCode:/(\?password=|)([0-9a-zA-Z]{4})/i,paramMatch:/(115.com|115cdn.com|anxia.com)/i,uiLinkShow:"{#$1#}/s/{#shareCode#} 提取码: {#accessCode#}",blank:"https://{#$1#}/s/{#shareCode#}",copyUrl:`https://{#$1#}/s/{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"115网盘",key:"_115pan",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardBlankLink:true,uri:""}}}},Ye={MENU_KEY:"ed2k-preview-tooltip-enable",MENU_DEFAULT_VALUE:true},tr={rule:[{link_innerText:"ed2k://\\|file\\|[^\\|]+\\|\\d+\\|[a-fA-F0-9]{32}\\|",link_innerHTML:"ed2k://\\|file\\|[^\\|]+\\|\\d+\\|[a-fA-F0-9]{32}\\|",shareCode:/ed2k:\/\/\\|file\\|[^\\|]+\\|\\d+\\|([a-fA-F0-9]{32})\|/gi,shareCodeNeedRemoveStr:/ /gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]{4})/gi,paramMatch:/ed2k:\/\/\|file\|([^\|]+)\|(\d+)\|([a-fA-F0-9]{32})\|/i,uiLinkShow:"ed2k://|file|{#$1#}|{#$2#}|{#$3#}|/",blank:"ed2k://|file|{#$1#}|{#$2#}|{#$3#}|/",copyUrl:"ed2k://|file|{#$1#}|{#$2#}|{#$3#}|/"}],setting:{name:"ed2k",key:"ed2k",configurationInterface:{function:{enable:true,linkClickMode:{openBlank:{default:true}}},schemeUri:{enable:false,isForwardBlankLink:true,uri:""},ownFormList:[{type:"forms",text:`
						<a href="https://whatslink.info/" target="_blank">元数据查询</a>
					`,forms:[H("鼠标悬停预览",Ye.MENU_KEY,Ye.MENU_DEFAULT_VALUE,void 0,"注意：Api请求存在访问频率限制")]}]}},afterRenderUrlBox(n){const r=this;if(!L(Ye.MENU_KEY,Ye.MENU_DEFAULT_VALUE).value)return;let e=false,a="正在请求Api中...",i=K.tooltip({target:n.$url,content:()=>a,isDiffContent:true,position:"follow",alwaysShow:false,isFixed:true,showArrow:false,delayCloseTime:300,triggerShowEventName:"mouseenter touchstart mousemove touchmove",otherDistance:15,className:"github-tooltip",showBeforeCallBack(s){if(e)return;e=true;let l=re.getBlankUrl(r.setting.key,n.ruleIndex,n.shareCode,n.accessCode);f.info(`正在获取ed2k链接信息：${l}`),M.get("https://whatslink.info/api/v1/link?url="+l,{headers:{Referer:"https://whatslink.info/"},allowInterceptConfig:false}).then(o=>{let c=d.toJSON(o.data.responseText);if(!o.status){a="请求失败",typeof c.error=="string"&&c.error.trim()!==""&&(a=a+"，"+c.error),i.toolTip.changeContent(a);return}a=`
						<div class="wrapper">
							<div class="title">Summary</div>
							<div class="content">
								<div>Resource Name: ${c.name}</div>
								<div>Number of Files: ${c.count}</div>
								<div>Total File Size: ${d.formatByteToSize(c.size)}</div>
								<div>File Type: ${c.type.toLowerCase()}</div>
							</div>
						</div>
						${Array.isArray(c.screenshots)?`
							<div class="wrapper">
								<div class="title">Screenshots</div>
								<div class="content">
									<div class="image-list">
										${c.screenshots.map(u=>`
											<div class="img">
												<img src="${u.screenshot}" alt="img">
											</div>
										`).join("")}
										
									</div>
								</div>
							</div>
						`:""}
						`,i.toolTip.changeContent(a);});},style:`
				.pops-tip{
					max-height: 500px;
					overflow: hidden;
				}
				.wrapper .content{
					text-align: left;
				}
				.wrapper .image-list{
					overflow: auto;
					display: flex;
				}
				.wrapper .image-list img{
					max-width: 200px;
					max-height: 200px;
				}
			`});}},ar={rule:[{link_innerText:"[0-9a-z]+.(link.yunpan.com|link.yunpan.360.cn)/lk/surl_[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]+|)",link_innerHTML:"[0-9a-z]+.(link.yunpan.com|link.yunpan.360.cn)/lk/surl_[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]+|)",shareCode:/(link.yunpan.com|link.yunpan.360.cn)\/lk\/surl_([0-9a-zA-Z]{8,24})/gi,shareCodeNeedRemoveStr:/(link.yunpan.com|link.yunpan.360.cn)\/lk\/surl_/gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]+)/gi,paramMatch:/([0-9a-z]+).(link.yunpan.com|link.yunpan.360.cn)\/lk\//i,uiLinkShow:"https://{#$1#}.{#$2#}/lk/surl_{#shareCode#} 提取码: {#accessCode#}",blank:"https://{#$1#}.{#$2#}/lk/surl_{#shareCode#}",copyUrl:`https://{#$1#}.{#$2#}/lk/surl_{#shareCode#}
密码：{#accessCode#}`},{link_innerText:"(yunpan.360.cn|www.yunpan.com)/lk/surl_[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-text-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-text-after#}}[0-9a-zA-Z]+|)",link_innerHTML:"(yunpan.360.cn|www.yunpan.com)/lk/surl_[0-9a-zA-Z]{8,24}([\\s\\S]{0,{#matchRange-html-before#}}(访问码|密码|提取码|\\?password=)[\\s\\S]{0,{#matchRange-html-after#}}[0-9a-zA-Z]+|)",shareCode:/(yunpan.360.cn|www.yunpan.com)\/lk\/surl_([0-9a-zA-Z]{8,24})/gi,shareCodeNeedRemoveStr:/(yunpan.360.cn|www.yunpan.com)\/lk\/surl_/gi,checkAccessCode:/(提取码|密码|访问码)[\s\S]+/gi,accessCode:/([0-9a-zA-Z]+)/gi,paramMatch:/(yunpan.360.cn|www.yunpan.com)/i,uiLinkShow:"https://{#$1#}/lk/surl_{#shareCode#} 提取码: {#accessCode#}",blank:"https://{#$1#}/lk/surl_{#shareCode#}",copyUrl:`https://{#$1#}/lk/surl_{#shareCode#}
密码：{#accessCode#}`}],setting:{name:"360AI云盘",key:"360yunpan",configurationInterface:{matchRange_text:{before:20,after:10},matchRange_html:{before:100,after:15},function:{enable:true,linkClickMode:{openBlank:{default:true}},checkLinkValidity:true,checkLinkValidityHoverTip:true},linkClickMode_openBlank:{openBlankAutoFilleAccessCode:true,openBlankWithCopyAccessCode:true},schemeUri:{enable:false,isForwardLinearChain:false,isForwardBlankLink:false,uri:""}}}},Ge={dataKey:"ruleData",$data:{ruleContent:[]},init(){this.initRule();},initRule(){let n=[Ua,Pa,Va,za,Ba,Ga,Ha,ja,St,qa,Za,er,Wa,Ka,Ya,tr,Ja,Xa,Qa,ar],r=ue.getNetDiskRuleConfig();[...n,...r].forEach(t=>{if(typeof t=="function"&&(t=t()),typeof t.setting.key!="string")throw new Error("规则未设置key");if(t.rule==null)throw new Error("规则未设置rule");const e=t.setting.key,a=t.setting.name,i=t.rule;if(Reflect.has(I.$rule.ruleOption,e)){let c=I.$rule.ruleOption[e];t.isUserRule?c=[...i,...c]:c=[...c,...i];let u=I.$rule.rule.find(p=>p.setting.key===e);u.rule=c;}else Reflect.set(I.$rule.ruleOption,e,t.rule),I.$rule.rule.push(t);Reflect.set(I.$rule.ruleSetting,e,t.setting),t.rule=this.parseRuleMatchRule(t);let s=this.parseRuleSetting(t),l=t.setting.name;x.src.hasIcon(e)&&(l=`
					<div class="netdisk-aside-icon" style="background-image: url(${x.src.icon[e]});"></div>
					<div class="netdisk-aside-text">${a}</div>`);let o=a;t.isUserRule&&(o+=`
					<div 
						class="netdisk-custom-rule-edit" 
						data-key="${e}" 
						data-type="${t.setting.name}"
						${typeof t.subscribeUUID=="string"?`data-subscribe-uuid="${t.subscribeUUID}"`:""}"
						
					>${K.config.iconSVG.edit}</div>`,o+=`
					<div
						class="netdisk-custom-rule-delete"
						data-key="${e}"
						data-type="${t.setting.name}"
						${typeof t.subscribeUUID=="string"?`data-subscribe-uuid="${t.subscribeUUID}"`:""}"
					>${K.config.iconSVG.delete}</div>`),this.$data.ruleContent.push({id:"netdisk-panel-config-"+e,title:l,headerTitle:o,attributes:{"data-key":e},forms:s,afterRender:c=>{c.$asideLiElement.setAttribute("data-function-enable",X.function.enable(e,true).toString());}});});},parseRuleMatchRule(n){let r=n.rule,t=[],e=n.setting.key;for(let a=0;a<r.length;a++){const i=r[a];typeof i.link_innerText=="string"&&(i.link_innerText=Q.replaceParam(i.link_innerText,_t(e))),typeof i.link_innerHTML=="string"&&(i.link_innerHTML=Q.replaceParam(i.link_innerHTML,Dt(e))),t.push(i);}return t},parseRuleSetting(n){let r=[];const t=n.setting.configurationInterface,e=n.setting.key;if(t==null)return [];if(t.function){let a=[];if("enable"in t.function){let i=typeof t.function.enable=="boolean"?t.function.enable:false;a.push(H("启用",z.function.enable(e),i,(s,l)=>{const o="data-function-enable";let p=s.target.getRootNode().querySelector(`.pops-panel-aside li[data-key="${e}"]`);p&&p.setAttribute(o,l.toString());},"开启可允许匹配该规则")),t.function.enable=X.function.enable(e);}if("linkClickMode"in t.function){let i=d.assign(Q.getDefaultLinkClickMode(),t.function.linkClickMode||{}),s=null,l=Object.keys(i).map(o=>{let c=i[o];if(c.enable)return c.default&&(s=o),{value:o,text:c.text}}).filter(o=>o!=null);s==null&&(s=l[0].value),a.push(Re("点击动作",z.function.linkClickMode(e),s,l,void 0,"点击匹配到的链接的执行的动作"));for(const o in t.function.linkClickMode){const c=t.function.linkClickMode[o];o===X.function.linkClickMode(e)?c.default=true:c.default=false;}}if("checkLinkValidity"in t.function){const i=typeof t.function.checkLinkValidity=="boolean"?t.function.checkLinkValidity:true;a.push(H("验证链接有效性",z.function.checkLinkValidity(e),i,void 0,"自动请求链接，判断该链接是否有效，在大/小窗内显示验证结果图标")),t.function.checkLinkValidity=X.function.checkLinkValidity(e);}if("checkLinkValidityHoverTip"in t.function){const i=typeof t.function.checkLinkValidityHoverTip=="boolean"?t.function.checkLinkValidityHoverTip:true;a.push(H("验证链接有效性-悬停提示",z.function.checkLinkValidityHoverTip(e),i,void 0,"当鼠标悬停在验证结果图标上时会显示相关验证信息"));}a.length&&r.push({text:"功能",type:"forms",forms:a});}if(t.linkClickMode_openBlank){let a=[];if("openBlankAutoFilleAccessCode"in t.linkClickMode_openBlank){const i=typeof t.linkClickMode_openBlank.openBlankAutoFilleAccessCode=="boolean"?t.linkClickMode_openBlank.openBlankAutoFilleAccessCode:true;a.push(H("自动填充访问码",z.linkClickMode_openBlank.openBlankAutoFilleAccessCode(e),i,void 0,"当点击动作是【新标签页打开】时且存在访问码，那就会自动填充访问码")),t.linkClickMode_openBlank.openBlankAutoFilleAccessCode=X.linkClickMode_openBlank.openBlankAutoFilleAccessCode(e);}if("openBlankWithCopyAccessCode"in t.linkClickMode_openBlank){const i=typeof t.linkClickMode_openBlank.openBlankWithCopyAccessCode=="boolean"?t.linkClickMode_openBlank.openBlankWithCopyAccessCode:false;a.push(H("跳转时复制访问码",z.linkClickMode_openBlank.openBlankWithCopyAccessCode(e),i,void 0,"当点击动作是【新标签页打开】时且存在访问码，那就会复制访问码到剪贴板")),t.linkClickMode_openBlank.openBlankWithCopyAccessCode=X.linkClickMode_openBlank.openBlankWithCopyAccessCode(e);}a.length&&r.push({text:"点击动作-新标签页打开",type:"forms",forms:a});}if(t.schemeUri){const a=[];if("enable"in t.schemeUri){const i=typeof t.schemeUri.enable=="boolean"?t.schemeUri.enable:false;a.push(H("启用",z.schemeUri.enable(e),i,void 0,"开启后可进行scheme uri转发")),t.schemeUri.enable=X.schemeUri.enable(e);}if("isForwardBlankLink"in t.schemeUri){const i=typeof t.schemeUri.isForwardBlankLink=="boolean"?t.schemeUri.isForwardBlankLink:false;a.push(H("转发新标签页链接",z.schemeUri.isForwardBlankLink(e),i,void 0,"对新标签页打开的链接进行scheme转换")),t.schemeUri.isForwardBlankLink=X.schemeUri.isForwardBlankLink(e);}if("isForwardLinearChain"in t.schemeUri){const i=typeof t.schemeUri.isForwardLinearChain=="boolean"?t.schemeUri.isForwardLinearChain:false;a.push(H("转发直链",z.schemeUri.isForwardLinearChain(e),i,void 0,"对解析的直链进行scheme转换")),t.schemeUri.isForwardLinearChain=X.schemeUri.isForwardLinearChain(e);}if("uri"in t.schemeUri){const i=typeof t.schemeUri.uri=="string"?t.schemeUri.uri:"";a.push(J("Uri链接",z.schemeUri.uri(e),i,"自定义的Scheme的Uri链接",void 0,"jumpwsv://go?package=xx&activity=xx&intentAction=xx&intentData=xx&intentExtra=xx")),t.schemeUri.uri=X.schemeUri.uri(e);}a.length&&r.push({text:"Scheme Uri转发",type:"forms",isFold:true,forms:a});}if(t.matchRange_text){let a=[];if("before"in t.matchRange_text){const i=typeof t.matchRange_text.before=="number"?t.matchRange_text.before:0;a.push(be("间隔前",z.matchRange_text.before(e),i,0,100,void 0,void 0,"提取码间隔前的字符长度")),t.matchRange_text.before=X.matchRange_text.before(e);}if("after"in t.matchRange_text){const i=typeof t.matchRange_text.after=="number"?t.matchRange_text.after:0;a.push(be("间隔后",z.matchRange_text.after(e),i,0,100,void 0,void 0,"提取码间隔后的字符长度")),t.matchRange_text.after=X.matchRange_text.after(e);}a.length&&r.push({text:"提取码文本匹配Text",type:"forms",forms:a});}if(t.matchRange_html){let a=[];if("before"in t.matchRange_html){const i=typeof t.matchRange_html.before=="number"?t.matchRange_html.before:0;a.push(be("间隔前",z.matchRange_html.before(e),i,0,100,void 0,void 0,"提取码间隔前的字符长度")),t.matchRange_html.before=X.matchRange_html.before(e);}if("after"in t.matchRange_html){const i=typeof t.matchRange_html.after=="number"?t.matchRange_html.after:0;a.push(be("间隔后",z.matchRange_html.after(e),i,0,100,void 0,void 0,"提取码间隔后的字符长度")),t.matchRange_html.after=X.matchRange_html.after(e);}a.length&&r.push({text:"提取码文本匹配HTML",type:"forms",forms:a});}return t.ownFormList&&r.push(...t.ownFormList),r},getRulePanelContent(){return this.$data.ruleContent}},it=`div[class^="netdisk-custom-rule-"] {\r
	display: flex;\r
	align-items: center;\r
	margin-left: 10px;\r
	cursor: pointer;\r
}\r
div[class^="netdisk-custom-rule-"] svg,\r
div[class^="netdisk-custom-rule-"] svg {\r
	width: 1.2em;\r
	height: 1.2em;\r
}\r
/* 控件被禁用的颜色 */\r
aside.pops-panel-aside li[data-key][data-function-enable="false"] {\r
	color: #a8abb2;\r
	filter: grayscale(100%);\r
}\r
/* 左侧网盘图标 */\r
aside.pops-panel-aside .netdisk-aside-icon {\r
	width: 20px;\r
	height: 20px;\r
	background-size: 100% 100%;\r
	background-repeat: no-repeat;\r
}\r
/* 设置间隔 */\r
aside.pops-panel-aside ul li {\r
	gap: 4px;\r
}\r
\r
/* mobile模式 */\r
@media screen and (max-width: 600px) {\r
	/* 隐藏左侧网盘图标 */\r
	aside.pops-panel-aside .netdisk-aside-text {\r
		display: none;\r
	}\r
}\r
`,at={show(){var e;if(x.Alias.settingAlias){f.error("设置界面已存在"),m.error("设置界面已存在");return}let n=te.getPanelContentConfig(),r=Ge.getRulePanelContent();n=n.concat(r);let t=P.panel({title:{text:`${((e=Me==null?void 0:Me.script)==null?void 0:e.name)||ye}-设置`,position:"center"},content:n,btn:{close:{enable:true,callback(a){a.close(),x.Alias.settingAlias=void 0;}}},mask:{clickCallBack(a){a(),x.Alias.settingAlias=void 0;}},class:"whitesevPopSetting",style:it},x.popsStyle.settingView);x.Alias.settingAlias=t,this.setRuleHeaderControlsClickEvent(t.$shadowRoot);},setRuleHeaderControlsClickEvent(n){b.on(n,"click",".netdisk-custom-rule-edit",function(r){let t=r.target,e=t.getAttribute("data-key");t.getAttribute("data-type");let a=t.getAttribute("data-subscribe-uuid");typeof a=="string"&&a.trim()!==""?De.showSubscribe(a,e,function(i){ue.updateRule(e,i);}):De.show(true,e);}),b.on(n,"click",".netdisk-custom-rule-delete",function(r){let t=r.target,e=t.getAttribute("data-key"),a=t.getAttribute("data-type"),i=t.getAttribute("data-subscribe-uuid");P.alert({title:{text:"提示",position:"center"},content:{text:`确定删除规则 ${a}(${e}) 吗？`},btn:{ok:{callback(s){let l;if(typeof i=="string"&&i.trim()!==""?l=ae.deleteSubscribeRule(i,e):l=ue.deleteRule(e),l){let o=x.Alias.settingAlias.$shadowRoot.querySelector(`.pops-panel-aside > ul > li[data-key="${e}"]`),c=o.previousElementSibling,u=o.nextElementSibling;c?c.click():u&&u.click(),o==null||o.remove(),m.success("删除成功"),s.close();}else m.error("删除规则失败");}}}});});}},rr=`.whitesevSuspension {\r
	top: 0;\r
	position: fixed;\r
	right: 10px;\r
	border-radius: 12px;\r
}\r
.whitesevSuspension .whitesevSuspensionMain {\r
	background: #fff;\r
	border: 1px solid #f2f2f2;\r
	box-shadow: 0 0 15px #e4e4e4;\r
	box-sizing: border-box;\r
	border-radius: inherit;\r
	height: inherit;\r
	width: inherit;\r
}\r
.whitesevSuspension .whitesevSuspensionFloor {\r
	border-bottom: 1px solid #f2f2f2;\r
	position: relative;\r
	box-sizing: border-box;\r
	border-radius: inherit;\r
	height: inherit;\r
	width: inherit;\r
}\r
.whitesevSuspension .whitesevSuspensionFloor .netdisk {\r
	background-position: center center;\r
	background-size: 115% 115%;\r
	background-repeat: no-repeat;\r
	display: flex;\r
	align-items: center;\r
	justify-content: center;\r
	border-radius: inherit;\r
	height: inherit;\r
	width: inherit;\r
}\r
.whitesevSuspension .whitesevSuspensionFloor .netdisk:hover {\r
	transition: all 300ms linear;\r
	background-color: #e4e4e4;\r
	transform: scale(1.1);\r
}\r
.whitesevPop-content p[pop] {\r
	height: 100%;\r
}\r
`,ce={position:{suspensionX:_e("suspensionX",W.width(window)-50),suspensionY:_e("suspensionY",(W.height(window)-50)/2),suspensionMaxX:_e("susponsionMax-x",W.width(window)-50),suspensionMaxY:_e("suspensionMax-y",W.height(window)-50),isRight:_e("isRight",false)},mode:{current_suspension_smallwindow_mode:_e("current_suspension_smallwindow_mode","suspension")}},Je={suspensionNode:null,isShow:false,isSetEvent:false,isRandBg:false,show(){this.isShow||(this.isShow=true,this.createUI(),this.setSuspensionPosition()),this.isSetEvent||(this.isSetEvent=true,this.setSuspensionEvent(),this.setResizeEventListener()),this.backgroundSwitch(),this.showSuspension();},showSuspension(){this.suspensionNode.style.display="";},hideSuspension(){this.suspensionNode.style.display="none";},isTopWindow(){return he.self.window===he.top.window},createUI(){y.suspension.size.value<15&&(y.suspension.size.value=15),y.suspension.size.value>250&&(y.suspension.size.value=250),y.suspension.opacity.value<.1&&(y.suspension.opacity.value=.1),y.suspension.opacity.value>1&&(y.suspension.opacity.value=1);let n=W.createElement("div",{className:"whitesev-suspension-shadow-container"}),r=n.attachShadow({mode:"open"}),t=y.suspension["suspended-z-index"].value;t<=0&&(t=d.getMaxValue(4e4,d.getMaxZIndex(10))),this.suspensionNode=W.createElement("div",{id:"whitesevSuspensionId",className:"whitesevSuspension",innerHTML:`
					<style type="text/css">
						/* 动态生成z-index */
						#whitesevSuspensionId{
							z-index: ${t};;
						}

						${rr}

					</style>
					<div class="whitesevSuspensionMain">
					<div class="whitesevSuspensionFloor">
						<div class="netdisk"></div>
					</div>
					</div>
                `},{style:`
                    width: ${y.suspension.size.value}px;
                    height: ${y.suspension.size.value}px;
                    opacity: ${y.suspension.opacity.value}
                `}),r.appendChild(this.suspensionNode),document.body.appendChild(n);},setSuspensionEvent(){let n=x.suspension.suspensionNode,r=new fr(n),t,e=false,a=false,i=0,s=0;r.on("pan",function(l){if(!e){e=true;let o=n.getBoundingClientRect();i=l.x-o.left,s=l.y-o.top,W.css(n,{cursor:"move",transition:"none"});}if(l.phase==="move"){let o=W.width(window)-y.suspension.size.value,c=W.height(window)-y.suspension.size.value,u=l.x-i,p=l.y-s;u=u>o?o:u,p=p>c?c:p,u=u<0?0:u,p=p<0?0:p,Je.saveSuspensionPosition({x:u,y:p}),W.css(n,{left:u+"px",top:p+"px"});}if(l.phase==="end"){e=false,W.css(n,{cursor:"auto"});let o=parseInt(W.css(n,"left"));if(y.suspension["suspended-button-adsorption-edge"].value){let c=0;o>=W.width(window)/2?(c=W.width(window)-y.suspension.size.value,x.suspension.isTopWindow()&&(ce.position.isRight.value=true)):x.suspension.isTopWindow()&&(ce.position.isRight.value=false),Je.saveSuspensionPosition({x:c}),W.css(n,{left:c+"px"});}W.css(n,{transition:"left 300ms ease 0s"});}}),r.on("tap",function(l){clearTimeout(t),t=void 0,a?(a=false,at.show()):(t=setTimeout(()=>{a=false,y.features["netdisk-behavior-mode"].value.includes("smallwindow")&&(ce.mode.current_suspension_smallwindow_mode.value="smallwindow",x.suspension.hideSuspension()),x.view.show();},200),a=true);}),x.setGlobalRightClickMenu(n);},saveSuspensionPosition(n){x.suspension.isTopWindow()&&n!=null&&(typeof n.x=="number"&&(ce.position.suspensionX.value=n.x),typeof n.y=="number"&&(ce.position.suspensionY.value=n.y),ce.position.suspensionMaxX.value=ce.position.suspensionMaxX.default,ce.position.suspensionMaxY.value=ce.position.suspensionMaxY.default);},setResizeEventListener(){W.on(globalThis,"resize",void 0,()=>{let n=document.activeElement;if(d.isPhone()){if(["input","textarea"].includes(n.localName))return;if(n.hasAttribute("contenteditable")&&n.getAttribute("contenteditable")==="true"||n.closest("[contenteditable='true']"))return;if(!document.hasFocus())return}this.setSuspensionPosition();});},setSuspensionPosition(){const n=W.width(window)-y.suspension.size.value,r=W.height(window)-y.suspension.size.value,t=ce.position.suspensionMaxX.value,e=ce.position.suspensionMaxY.value;ce.position.suspensionMaxX.default=n,ce.position.suspensionMaxY.default=r;let a=ce.position.suspensionX.value,i=ce.position.suspensionY.value;if(n!==t){let s=a/t;a=n*s;}if(r!==e){let s=i/e;i=r*s;}a>n?a=n:a<0&&(a=0),i>r?i=r:i<0&&(i=0),y.suspension["suspended-button-adsorption-edge"].value&&(ce.position.isRight.value?a=n:a=0),Je.saveSuspensionPosition({x:a,y:i}),W.css(x.suspension.suspensionNode,{left:a+"px",top:i+"px"});},backgroundSwitch(){if(this.isRandBg)return;function n(){let s=[];return x.isMatchedNetDiskIconMap.forEach(l=>{s=[...s,x.src.icon[l]];}),s}function r(s,l){t=n(),W.fadeOut(i,s,function(){e++,e=e<t.length?e:0,l=t[e],W.css(i,{"background-image":`url(${l})`}),W.fadeIn(i,s,function(){setTimeout(()=>{r(parseInt(y.suspension["randbg-time"].value.toString()),l);},parseInt(y.suspension["randbg-show-time"].value.toString()));});});}let t=[],e=0;t=n();let a=t[e],i=x.suspension.suspensionNode.querySelector(".whitesevSuspension .netdisk");W.css(i,{"background-image":`url(${a})`}),!(t.length<2||y.suspension["randbg-time"].value<=0)&&(this.isRandBg=true,r(parseInt(y.suspension["randbg-time"].value.toString().toString()),a));}},kt=`.pops-folder-list .list-name-text {\r
	max-width: 300px;\r
}\r
.netdisk-static-link-onefile .pops-folder-list .list-name-text {\r
	max-width: 220px;\r
}\r
.netdisk-static-link-onefile\r
	.pops-mobile-folder-content\r
	.pops-folder-list\r
	.list-name-text {\r
	max-width: unset;\r
}\r
`,nr={oneFile(n){f.success("成功获取单文件直链",n),P.folder({title:{text:n.title},folder:[{fileName:n.fileName,fileSize:n.fileSize,fileType:n.fileType??"",createTime:n.fileUploadTime||n.fileLatestTime,latestTime:n.fileLatestTime||n.fileUploadTime,isFolder:false,index:0,async clickEvent(){if(typeof n.clickCallBack=="function")n.clickCallBack(n);else return {autoDownload:true,mode:"aBlank",url:n.downloadUrl}}}],btn:{ok:{text:"下载",callback(){typeof n.clickCallBack=="function"?n.clickCallBack(n):window.open(n.downloadUrl,"_blank");}}},class:"netdisk-static-link-onefile",style:kt},x.popsStyle.oneFileStaticView);},moreFile(n,r=[]){f.success("文件解析信息",r),P.folder({title:{text:n},folder:r,style:kt},x.popsStyle.moreFileStaticView);}},ir=function(n="密码错误",r="",t,e,a,i=()=>{}){const s=P.prompt({title:{text:n,position:"center",html:false},btn:{reverse:true,position:"end",cancel:{text:"取消",callback(l,o){s.close();}},ok:{callback:l=>{var D,C,N,S;let o=l.text.replace(/[\s]*/gi,""),c=I.handleLinkShow(r,t,e,o,void 0),u=`.netdisk-url a[data-rule-key='${r}'][data-sharecode='${e}']`,p=`.netdiskrecord-link a[data-rule-key='${r}'][data-sharecode='${e}']`,h=(C=(D=x.Alias.uiLinkAlias)==null?void 0:D.$shadowRoot)==null?void 0:C.querySelector(u),g=(S=(N=x.Alias.historyAlias)==null?void 0:N.$shadowRoot)==null?void 0:S.querySelector(p);h&&(h.setAttribute("data-accesscode",o),b.html(h,c)),g&&(g.setAttribute("data-accesscode",o),b.html(g,c)),f.info(`${r} 重新输入的密码：${o}`);let k={isFindInMatchedDict:false,isUpdatedMatchedDict:false,isUpdatedHistoryMatched:false,accessCode:o},w=I.$match.matchedInfo.get(r);if(w.has(e)){k.isFindInMatchedDict=true,k.isUpdatedMatchedDict=true;let T=w.get(e);w.set(e,I.getLinkStorageInst(o,t,true,T.matchText));}k.isUpdatedHistoryMatched=tt.syncAccessCode(r,t,e,o),i(k),l.close();}}},content:{placeholder:"请重新输入密码",focus:true,select:true,text:a==null?"":typeof a=="string"?a:""},style:`
			input{
				font-size: larger;
			}
			`},x.popsStyle.inputNewAccessCodeView);b.listenKeyboard(s.$shadowRoot,"keypress",l=>{l==="Enter"&&s.$shadowRoot.querySelector(".pops-prompt-btn-ok").click();});},sr=`.pops[type-value="confirm"] .pops-confirm-content {\r
	overflow: hidden;\r
}\r
.netdisk-match-paste-text {\r
	--textarea-bd-color: #dcdfe6;\r
	display: inline-block;\r
	resize: vertical;\r
	padding: 5px 15px;\r
	line-height: normal;\r
	box-sizing: border-box;\r
	color: #606266;\r
	border: 1px solid var(--textarea-bd-color);\r
	border-radius: 4px;\r
	transition: border-color 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);\r
	outline: none;\r
	margin: 0;\r
	-webkit-appearance: none;\r
	-moz-appearance: none;\r
	appearance: none;\r
	background: none;\r
	width: 100%;\r
	height: 100%;\r
	appearance: none;\r
	resize: none;\r
}\r
.netdisk-match-paste-text:hover {\r
	--textarea-bd-color: #c0c4cc;\r
}\r
.netdisk-match-paste-text:focus {\r
	--textarea-bd-color: #3677f0;\r
}\r
`,or={show(){let n=P.confirm({title:{text:"主动识别文本",position:"center"},content:{text:`
                    <textarea class="netdisk-match-paste-text"></textarea>
                    `,html:true},btn:{ok:{text:"识别",callback(){var t,e;let r=((e=(t=n.popsElement)==null?void 0:t.querySelector(".netdisk-match-paste-text"))==null?void 0:e.value)||"";r.trim()!==""&&(r=Q.replaceChinese(r),V.postMessage({characterMapping:[{searchValue:/[\u4e00-\u9fa5]/g,replaceValue:""}],textList:[r],matchTextRange:y.match.pageMatchRange.value,matchedRuleOption:I.$rule.ruleOption,startTime:Date.now(),from:"PasteText"}));}}},class:"whitesevPopNetDiskMatchPasteText",style:sr},x.popsStyle.matchPasteTextView);n.popsElement.querySelector("textarea").focus();},workerMatchEndCallBack(n){n.data.length?m.success(`成功匹配${n.data.length}个，用时${Date.now()-n.startTime}ms`):m.error("未识别到链接");}},x={Alias:{uiLinkAlias:void 0,historyAlias:void 0,settingAlias:void 0},isMatchedNetDiskIconMap:new Set,defaultForbiddenScroll:false,popsStyle:Bt,src:{icon:{},hasIcon(n){return Reflect.has(this.icon,n)},addIcon(n,r){return this.hasIcon(n)?(f.warn("图标字典中已存在该icon："+n),false):Reflect.set(this.icon,n,r)}},suspension:Je,view:de,staticView:nr,newAccessCodeView:ir,netDiskHistoryMatch:tt,matchPasteText:or,setGlobalRightClickMenu(n){x.view.registerContextMenu(n,void 0,[{text:"设置",callback(){f.info("右键菜单-打开-"+this.text),at.show();}},{text:"历史匹配记录",callback(){f.info("右键菜单-打开-"+this.text),x.netDiskHistoryMatch.show();}},{text:"添加链接识别规则",callback(){f.info("右键菜单-打开-"+this.text),De.show(false);}},{text:"规则管理器",callback(){f.info("右键菜单-打开-"+this.text),He.showView();}},{text:"主动识别文本",callback(){f.info("右键菜单-打开-"+this.text),x.matchPasteText.show();}}]);},setRightClickMenu(n,r,t){let e=[{text:"复制链接",callback:function(a,i,s){let l=i.target;const{ruleKeyName:o,ruleIndex:c,shareCode:u,accessCode:p}=de.praseElementAttributeRuleInfo(l);ke.copy(o,c,u,p);}},{text:"访问链接",callback:function(a,i,s){let l=i.target;const{ruleKeyName:o,ruleIndex:c,shareCode:u,accessCode:p}=de.praseElementAttributeRuleInfo(l);let h=re.getBlankUrl(o,c,u,p);ke.openBlankUrl(h,o,c,u,p);}},{text:"后台打开",callback:function(a,i,s){let l=i.target;const{ruleKeyName:o,ruleIndex:c,shareCode:u,accessCode:p}=de.praseElementAttributeRuleInfo(l);let h=re.getBlankUrl(o,c,u,p);ke.openBlankUrl(h,o,c,u,p,true);}},{text:"复制访问码",callback:function(a,i,s){let l=i.target;const{ruleKeyName:o,ruleIndex:c,shareCode:u,accessCode:p}=de.praseElementAttributeRuleInfo(l);if(p==null||typeof p=="string"&&p.trim()===""){m.warning("无访问码");return}d.setClip(p).then(h=>{h?m.success("已复制"):m.error("执行复制失败",{consoleLogContent:true});}).catch(()=>{m.error("执行复制失败",{consoleLogContent:true});});}},{text:"修改访问码",callback:function(a,i,s){let l=a.target,o=i.target;const{ruleKeyName:c,ruleIndex:u,shareCode:p,accessCode:h}=de.praseElementAttributeRuleInfo(o);x.newAccessCodeView(this.text,c,u,p,h,g=>{if(t)if(g.isUpdatedMatchedDict){let k=new Date().getTime(),w=o.closest("li").querySelector(".netdiskrecord-update-time");W.text(w,d.formatTime(k)),W.attr(o,"data-accesscode",g.accessCode),m.success(`
										<div style="text-align: left;">旧: ${h}</div>
										<div style="text-align: left;">新: ${g.accessCode}</div>`,{html:true});}else m.error("修改失败");else W.attr(l,"data-accesscode",g.accessCode),g.isUpdatedMatchedDict?m.success(`
										<div style="text-align: left;">旧: ${h}</div>
										<div style="text-align: left;">新: ${g.accessCode}</div>`,{html:true}):g.isFindInMatchedDict?m.error("修改访问码失败"):m.error("修改访问码失败，因为当前已匹配字典中未找到对应的访问码");});}},{text:"复制全部",callback(a,i,s){let o=i.target.closest(".netdisk-url-box-all"),c=[];o.querySelectorAll(r).forEach(u=>{const{ruleKeyName:p,ruleIndex:h,shareCode:g,accessCode:k}=de.praseElementAttributeRuleInfo(u);let w=re.getCopyUrlInfo(p,h,g,k);c.push(w);}),d.setClip(c.join(`
`)).then(u=>{u?m.success("成功复制全部"):m.error("复制全部失败");}).catch(()=>{m.error("复制全部失败");});}}];t||(e.push({text:"删除当前项",callback:function(a,i,s){let l=i.target,o=l.closest(".netdisk-url-box");const{ruleKeyName:c,ruleIndex:u,shareCode:p,accessCode:h}=de.praseElementAttributeRuleInfo(l);let g=false;I.$match.matchedInfo.forEach((k,w)=>{w===c&&k.forEach((D,C)=>{C===p&&(g=true,k.delete(C),f.info("删除：",w,JSON.stringify(D)));});}),I.$match.matchedInfoRuleKey.clear(),I.$match.matchedInfo.forEach((k,w)=>{k.length&&I.$match.matchedInfoRuleKey.add(w);}),g?o.remove():m.error("发生意外情况，未在已匹配到的信息中到对应的网盘信息");}}),e.push({text:"删除所有项",callback:function(a,i,s){let l=i.target,o=l.closest(".netdisk-url-box-all");const{ruleKeyName:c,ruleIndex:u,shareCode:p,accessCode:h}=de.praseElementAttributeRuleInfo(l);I.$match.matchedInfo.forEach((g,k)=>{g.clear();}),I.$match.matchedInfoRuleKey.clear(),W.html(o,"");}})),x.view.registerContextMenu(n,r,e);}},yt=`/* 容器 */\r
.website-rule-container {\r
}\r
/* 每一条规则 */\r
.website-rule-item {\r
	display: flex;\r
	align-items: center;\r
	line-height: normal;\r
	font-size: 16px;\r
	padding: 4px 4px;\r
	gap: 6px;\r
}\r
/* 规则名 */\r
.website-rule-item .website-rule-name {\r
	flex: 1;\r
	white-space: nowrap;\r
	text-overflow: ellipsis;\r
	overflow: hidden;\r
}\r
/* 操作按钮 */\r
.website-rule-item .website-controls {\r
	display: flex;\r
	align-items: center;\r
	text-overflow: ellipsis;\r
	overflow: hidden;\r
	white-space: nowrap;\r
	gap: 8px;\r
	padding: 0px 4px;\r
}\r
/* 编辑和删除按钮 */\r
.website-rule-item .website-rule-edit,\r
.website-rule-item .website-rule-delete {\r
	width: 16px;\r
	height: 16px;\r
	cursor: pointer;\r
}\r
/* 启用按钮 */\r
.website-rule-item .website-rule-enable {\r
}\r
/* 编辑按钮 */\r
.website-rule-item .website-rule-edit {\r
}\r
/* 删除按钮 */\r
.website-rule-item .website-rule-delete {\r
}\r
`;function st(n){if(n===null||typeof n!="object")return n;let r=Array.isArray(n)?[]:{};for(let t in n)n.hasOwnProperty(t)&&(r[t]=st(n[t]));return r}const Se=new Pe("websiteRule"),we={$data:{STORAGE_KEY:"rule",EXPORT_CONFIG_KEY:"rule-export-config",isShowEditView:false},init(){},getTemplateData(){return {uuid:d.generateUUID(),subscribeUUID:null,enable:true,name:"",url:"",data:{}}},getRulePanelViewOption(n){const r=this;let t=K.config.panelHandleContentUtils(),e=()=>n??this.getTemplateData(),a=function(s){return {get(l,o){return s[l]??o},set(l,o){s[l]=o;}}};return {id:"website-rule",title:"网站规则",subscribe:{enable:true,data(){return Y.getAllSubscribe()},getData:s=>Y.getSubscribe(s.uuid)??s,getDataItemName(s){return `
						<style>
							.subscribe-rule-title-info-wrapper{
								display: flex;
								flex-direction: column;
								gap: 4px;
							}
							.subscribe-rule-title-info-wrapper .rule-name-text{
								white-space: nowrap;
								text-overflow: ellipsis;
								overflow: hidden;
								font-weight: 600;
								font-size: 16px;
								line-height: 24px;
							}
							.subscribe-rule-title-info-wrapper .subscribe-rule-small-span-text{
								font-size: 14px;
								line-height: 16px;
								white-space: pre-wrap;
							}
						</style>
						<div class="subscribe-rule-title-info-wrapper">
							<div class="rule-name-text" style="white-space: nowrap;text-overflow: ellipsis;overflow: hidden;font-size: 16px;font-weight: 600;line-height: 24px;">${s.data.title||s.subscribeData.title||s.data.url}</div>
								<div class="subscribe-rule-small-span-text">${s.subscribeData.ruleData.length} 条规则，更新于：${d.formatTime(s.data.latestUpdateTime,"yyyy年MM月dd日 HH:mm:ss")}${typeof s.data.updateFailedTime=="number"?`，<span style="color: red;">更新失败于：${d.formatTime(s.data.updateFailedTime,"yyyy年MM月dd日 HH:mm:ss")}</span>`:""}</div>
								${s.subscribeData.homePage?`<a href="${s.subscribeData.homePage}" class="subscribe-rule-small-span-text" target="_blank" style="color:#67b279;">转到主页</a>`:""}
								<a href="${s.data.url}" class="subscribe-rule-small-span-text" target="_blank" style="color:#67b279;">订阅地址</a>
						</div>`},addData:s=>Y.addSubscribe(s),updateData:s=>Y.updateSubscribe(s),deleteData:s=>Y.deleteSubscribe(s),btnControls:{add:{enable:true},filter:{enable:true,title:"过滤订阅",option:[{name:"过滤【已启用】的订阅",filterCallBack(s){return s.data.enable}},{name:"过滤【未启用】的订阅",filterCallBack(s){return !s.data.enable}}]},clearAll:{enable:true,callback:()=>{Y.deleteAllSubscribe();}},ruleEnable:{enable:true,getEnable(s){return s.data.enable},async callback(s,l){s.data.enable=l,Y.updateSubscribe(s);}},ruleEdit:{enable:true,callback:s=>{let l=s.ruleData.uuid;return s.enterDeepMenu({headerTitle:s.ruleData.data.title||s.ruleData.subscribeData.title||s.ruleData.data.url,data(){var c;let o=Y.getSubscribe(l);return ((c=o==null?void 0:o.subscribeData)==null?void 0:c.ruleData)??s.ruleData.subscribeData.ruleData},getData(o){return Y.getSubscribeRule(l,o.uuid)??o},getDataItemName(o){return o.name??o.url},addData(o){return  true},updateData(o){return Y.updateSubscribeRule(l,o)},deleteData(o){return Y.deleteSubscribeRule(l,o)},btnControls:{filter:{enable:true,option:[{name:"过滤【已启用】的规则",filterCallBack(o){return o.data.enable}},{name:"过滤【未启用】的规则",filterCallBack(o){return !o.data.enable}}]},clearAll:{enable:true,callback:()=>{Y.clearSubscribe(l);}},ruleEnable:{enable:true,getEnable(o){return o.enable},callback(o,c){o.data.enable=c,Y.updateSubscribeRule(l,o);}},ruleEdit:{enable:true,getView:(o,c)=>{r.$data.isShowEditView=true,c||(o=e());function u(T){return {get(v,R){let _=Y.getSubscribeRule(l,T);return Reflect.get(_.data,v)??R},set(v,R){let _=Y.getSubscribeRule(l,T);Reflect.set(_.data,v,R),Y.updateSubscribeRule(l,_);}}}let p=document.createDocumentFragment(),h=H("启用","enable",true);Reflect.set(h.props,F,a(o));let g=t.createSectionContainerItem_switch(h),k=J("规则名称","name","","",void 0,"必填");Reflect.set(k.props,F,a(o));let w=t.createSectionContainerItem_input(k),D=J("匹配网址","url","","",void 0,"必填，可正则");Reflect.set(D.props,F,a(o));let C=t.createSectionContainerItem_input(D),N=Xe("覆盖设置","","自定义",void 0,false,false,"primary",T=>{d.preventEvent(T);let v=te.getPanelContentConfig().concat(Ge.getRulePanelContent()),R=st(v);function _($){$.forEach(E=>{if(typeof(E==null?void 0:E.props)=="object"&&Reflect.has(E.props,F)){let O=u(o.uuid);Reflect.set(E.props,F,O);}let B=E.forms;B&&Array.isArray(B)&&_(B);});}for(let $=0;$<R.length;$++){let E=R[$];if(!E.forms)continue;if(typeof E.afterRender=="function"&&(E!=null&&E.id.toString().startsWith("netdisk-panel-config-"))&&(E.afterRender=O=>{let q=O.asideConfig.attributes["data-key"],U=z.function.enable(q),ne=Y.getSubscribeRule(l,o.uuid);O.$asideLiElement.setAttribute("data-function-enable",ne.data[U]??true);}),typeof E.attributes=="object"&&E.forms!=null&&pe in E.attributes){let O=E.attributes[pe],q=H("启用",Ee.features.customAccessCodeEnable(O),false,void 0,"启用后将允许执行下面的功能",void 0);Reflect.set(q.props,F,u(o.uuid));let U=J("自定义访问码",Ee.features.customAccessCode(O),"","让获取的到的链接的访问码都为自定义的访问码",void 0,"请输入自定义访问码",false,false);Reflect.set(U.props,F,u(o.uuid));let ne={text:"额外功能",type:"forms",forms:[q,U]};E.forms.length?E.forms.splice(1,0,ne):E.forms.push(ne);}let B=E.forms;B&&Array.isArray(B)&&_(B);}P.panel({title:{text:"覆盖设置",position:"center"},content:R,btn:{close:{enable:true,callback($){$.close();}}},mask:{clickCallBack($){$();}},only:false,class:"whitesevPopSetting",style:`
																${it}
																
																${yt}
						
						
																/* 隐藏顶部的图标 */
																.netdisk-custom-rule-edit,
																.netdisk-custom-rule-delete,
																/* 隐藏快捷键设置菜单，因为这个是全局唯一的 */
																.netdisk-panel-forms-shortcut-keys-deepMenu{
																	display: none !important;
																}`},x.popsStyle.settingView);},void 0),S=t.createSectionContainerItem_button(N);return p.appendChild(g),p.appendChild(w),p.appendChild(C),p.appendChild(S),p},onsubmit:(o,c,u)=>{let p=o.querySelectorAll(".rule-form-ulist > li"),h=e();if(c){h.uuid=u.uuid;let k=this.getAllRule().find(w=>w.uuid===h.uuid);k&&(h.data=k.data);}return p.forEach(g=>{let k=Reflect.get(g,"__formConfig__"),w=Reflect.get(k,"attributes"),D=Reflect.get(g,F),C=Reflect.get(w,pe);if(C==null)return;let N=Reflect.get(w,ge),S=D.get(C,N);Reflect.has(h,C)?Reflect.set(h,C,S):Reflect.has(h.data,C)?Reflect.set(h.data,C,S):f.error(`${C}不在数据中`);}),h.name==null||h.name.trim()===""?(m.error("规则名称不能为空"),{success:false,data:h}):h.url.trim()===""?(m.error("匹配网址不能为空"),{success:false,data:h}):c?{success:this.updateRule(h),data:h}:{success:this.addRule(h),data:h}}},ruleDelete:{enable:true,deleteCallBack(o){return Y.deleteSubscribeRule(l,o)}}}}),false}},ruleDelete:{enable:true,deleteCallBack:s=>Y.deleteSubscribe(s)},import:{enable:true,callback(s){Y.importSubscribe(()=>{s();});}},export:{enable:true,callback(){Y.exportSubscribe(ye+"-网站规则-订阅.json");}}},getSubscribeInfo:Y.getSubscribeInfo.bind(Y)},ruleOption:{btnControls:{add:{enable:true},filter:{enable:true,title:"过滤规则",option:[{name:"过滤【已启用】的规则",filterCallBack(s){return s.enable}},{name:"过滤【未启用】的规则",filterCallBack(s){return !s.enable}},{name:"过滤【在当前网址生效】的规则",filterCallBack(s){let l=new RegExp(s.url,"ig");return !!window.location.href.match(l)}}]},clearAll:{enable:true,callback:()=>{r.deleteAllRule();}},import:{enable:true,callback:s=>{r.importRule(()=>{s();});}},export:{enable:true,callback:()=>{r.exportRule(ye+"-网站规则.json",ye+"-网站规则-订阅模式.json");}},ruleEnable:{enable:true,getEnable(s){return s.enable},callback:(s,l)=>{s.enable=l,r.updateRule(s);}},ruleEdit:{enable:true,getView:(s,l)=>{r.$data.isShowEditView=true,l||(s=e());function o(N){return {get(S,T){let v=r.getRule(N)??e(),R=te.getValue(S,T);return (v&&Reflect.get(v.data,S))??R},set(S,T){let v=r.getRule(N)??e();Reflect.set(v.data,S,T),r.updateRule(v);}}}let c=document.createDocumentFragment();l||(s=e());let u=H("启用","enable",true);Reflect.set(u.props,F,a(s));let p=t.createSectionContainerItem_switch(u),h=J("规则名称","name","","",void 0,"必填");Reflect.set(h.props,F,a(s));let g=t.createSectionContainerItem_input(h),k=J("匹配网址","url","","",void 0,"必填，可正则");Reflect.set(k.props,F,a(s));let w=t.createSectionContainerItem_input(k),D=Xe("覆盖设置","","自定义",void 0,false,false,"primary",N=>{d.preventEvent(N);let S=te.getPanelContentConfig().concat(Ge.getRulePanelContent()),T=st(S);function v(R){R.forEach(_=>{if(typeof(_==null?void 0:_.props)=="object"&&Reflect.has(_.props,F)){let E=o(s.uuid);Reflect.set(_.props,F,E);}let $=_.forms;$&&Array.isArray($)&&v($);});}for(let R=0;R<T.length;R++){let _=T[R];if(!_.forms)continue;if(typeof _.afterRender=="function"&&(_!=null&&_.id.toString().startsWith("netdisk-panel-config-"))&&(_.afterRender=E=>{let B=E.asideConfig.attributes["data-key"],O=z.function.enable(B);E.$asideLiElement.setAttribute("data-function-enable",l?we.getRuleDataValue(s.uuid,O,true):s.data[O]??true);}),typeof _.attributes=="object"&&_.forms!=null&&pe in _.attributes){let E=_.attributes[pe],B=H("启用",Ee.features.customAccessCodeEnable(E),false,void 0,"启用后将允许执行下面的功能",void 0);Reflect.set(B.props,F,o(s.uuid));let O=J("自定义访问码",Ee.features.customAccessCode(E),"","让获取的到的链接的访问码都为自定义的访问码",void 0,"请输入自定义访问码",false,false);Reflect.set(O.props,F,o(s.uuid));let q={text:"额外功能",type:"forms",forms:[B,O]};_.forms.length?_.forms.splice(1,0,q):_.forms.push(q);}let $=_.forms;$&&Array.isArray($)&&v($);}P.panel({title:{text:"覆盖设置",position:"center"},content:T,btn:{close:{enable:true,callback(R){R.close();}}},mask:{clickCallBack(R){R();}},only:false,class:"whitesevPopSetting",style:`
											${it}
											
											${yt}
	
	
											/* 隐藏顶部的图标 */
											.netdisk-custom-rule-edit,
											.netdisk-custom-rule-delete,
											/* 隐藏快捷键设置菜单，因为这个是全局唯一的 */
											.netdisk-panel-forms-shortcut-keys-deepMenu{
												display: none !important;
											}
											`},x.popsStyle.settingView);},void 0),C=t.createSectionContainerItem_button(D);return c.appendChild(p),c.appendChild(g),c.appendChild(w),c.appendChild(C),c},onsubmit:(s,l,o)=>{let c=s.querySelectorAll(".rule-form-ulist > li"),u=e();if(l){u.uuid=o.uuid;let h=this.getAllRule().find(g=>g.uuid===u.uuid);h&&(u.data=h.data);}return c.forEach(p=>{let h=Reflect.get(p,"__formConfig__"),g=Reflect.get(h,"attributes"),k=Reflect.get(p,F),w=Reflect.get(g,pe);if(w==null)return;let D=Reflect.get(g,ge),C=k.get(w,D);Reflect.has(u,w)?Reflect.set(u,w,C):Reflect.has(u.data,w)?Reflect.set(u.data,w,C):f.error(`${w}不在数据中`);}),u.name==null||u.name.trim()===""?(m.error("规则名称不能为空"),{success:false,data:u}):u.url.trim()===""?(m.error("匹配网址不能为空"),{success:false,data:u}):l?{success:this.updateRule(u),data:u}:{success:this.addRule(u),data:u}}},ruleDelete:{enable:true,deleteCallBack:s=>r.deleteRule(s.uuid)}},data:()=>this.getAllRule(),getAddData:()=>e(),getData:s=>this.getAllRule().find(c=>c.uuid===s.uuid)??s,getDataItemName:s=>s.name??s.url,updateData:s=>this.updateRule(s),deleteData:s=>(r.$data.isShowEditView=false,this.deleteRule(s.uuid))}}},addRule(n){let r=this.getAllRule();return r.push(n),Se.set(this.$data.STORAGE_KEY,r),true},getRule(n){let r=this.getAllRule().find(e=>e.uuid===n);return r||Y.getAllSubscribeRule().find(e=>e.uuid===n)},getRuleData(n){return typeof n=="string"?this.getRule(n).data:n.data},getRuleDataValue(n,r,t){let e=this.getRuleData(n);return (e&&Reflect.get(e,r))??t},updateRule(n){let r=this.getAllRule(),t=false;for(let e=0;e<r.length;e++)if(r[e].uuid===n.uuid){r[e]=n,t=true;break}return t?Se.set(this.$data.STORAGE_KEY,r):Y.getAllSubscribeRule().find(a=>a.uuid===n.uuid)&&(t=Y.updateSubscribeRule(n.subscribeUUID,n)),t},deleteRule(n){let r=this.getAllRule(),t=false,e=typeof n=="string"?n:n.uuid;for(let a=0;a<r.length;a++)if(r[a].uuid===e){r.splice(a,1),t=true;break}if(t)Se.set(this.$data.STORAGE_KEY,r);else {let a=Y.getAllSubscribeRule().find(i=>i.uuid===e);a&&(t=Y.deleteSubscribeRule(a.subscribeUUID,a));}return t},deleteAllRule(){Se.delete(this.$data.STORAGE_KEY);},getAllRule(){return Se.get(this.$data.STORAGE_KEY,[])},getUrlMatchedRule(n=true,r=window.location.href){let t=this.getAllRule(),e=Y.getAllSubscribeRule(true);return t=t.concat(e),t.filter(i=>{if(n&&!i.enable)return  false;let s=new RegExp(i.url,"ig");return !!r.match(s)})},exportRule(n="rule.json",r="rule-subscribe.json"){let t=P.alert({title:{text:"请选择导出方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="only-export-rule-list">导出规则</div>
                    <div class="btn-control" data-mode="export-to-subscribe">导出订阅规则</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(s,l){s.close();}}},mask:{enable:true},drag:true,width:Z.info.width,height:Z.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),e=t.$shadowRoot.querySelector(".btn-control[data-mode='only-export-rule-list']"),a=t.$shadowRoot.querySelector(".btn-control[data-mode='export-to-subscribe']"),i=(s,l)=>{let o=new Blob([JSON.stringify(l,null,4)]),c=window.URL.createObjectURL(o),u=document.createElement("a");u.href=c,u.download=s,u.click(),setTimeout(()=>{window.URL.revokeObjectURL(c);},1500);};b.on(e,"click",s=>{d.preventEvent(s);try{let l=this.getAllRule();if(l.length===0){m.warning("规则为空，无需导出");return}i(n,l),t.close();}catch(l){m.error(l.toString(),{consoleLogContent:true});}}),b.on(a,"click",s=>{d.preventEvent(s);const l=this;t.close();try{if(this.getAllRule().length===0){m.warning("规则为空，无需导出");return}let c=K.config.panelHandleContentUtils(),u=function(v){return {get(R,_){return v[R]??_},set(R,_){v[R]=_,Se.set(l.$data.EXPORT_CONFIG_KEY,v);}}},p=()=>{let v=Se.get(this.$data.EXPORT_CONFIG_KEY,{});if((v==null?void 0:v.title)===""||v.title==null){m.error("订阅标题不能为空");return}if(v.version==null){m.error("版本号不能为空");return}else v.version=Number(v.version);v.homePage==null&&(v.homePage=void 0),v.lastModified=Date.now(),v.ruleData=this.getAllRule(),i(r,v),h.close();},h=P.alert({title:{text:"请填写导出配置",position:"center"},content:{text:`
							
						`,html:!0},btn:{ok:{enable:!0,text:"导出",callback(v,R){p();}},close:{enable:!0,callback(v,R){v.close();}}},mask:{enable:!0},drag:!0,width:Z.info.width,height:Z.info.height,style:`
						${K.config.cssText.panelCSS}

						.pops-alert-content li{
							list-style-type: none;
							display: flex;
							align-items: center;
							justify-content: space-between;
							margin: 10px;
						}
					`}),g=h.$shadowRoot.querySelector(".pops-alert-content"),k=Se.get(this.$data.EXPORT_CONFIG_KEY,{}),w=J("订阅标题","title","","",void 0,"");Reflect.set(w.props,F,u(k));let D=c.createSectionContainerItem_input(w),C=J("版本号","version","","",void 0,"",!0);Reflect.set(C.props,F,u(k));let N=c.createSectionContainerItem_input(C),S=J("主页地址","homePage","","",void 0,"选填");Reflect.set(S.props,F,u(k));let T=c.createSectionContainerItem_input(S);b.append(g,D),b.append(g,N),b.append(g,T);}catch(o){m.error(o.toString(),{consoleLogContent:true});}});},importRule(n){let r=P.alert({title:{text:"请选择导入方式",position:"center"},content:{text:`
                    <div class="btn-control" data-mode="local">本地导入</div>
                    <div class="btn-control" data-mode="network">网络导入</div>
                    <div class="btn-control" data-mode="clipboard">剪贴板导入</div>
                `,html:true},btn:{ok:{enable:false},close:{enable:true,callback(l,o){l.close();}}},mask:{enable:true},drag:true,width:Z.info.width,height:Z.info.height,style:`
                .btn-control{
                    display: inline-block;
                    margin: 10px;
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    cursor: pointer;
                }
				.btn-control:hover{
					color: #409eff;
					border-color: #c6e2ff;
					background-color: #ecf5ff;
				}
            `}),t=r.$shadowRoot.querySelector(".btn-control[data-mode='local']"),e=r.$shadowRoot.querySelector(".btn-control[data-mode='network']"),a=r.$shadowRoot.querySelector(".btn-control[data-mode='clipboard']"),i=l=>{let o=this.getAllRule(),c=[];for(let u=0;u<l.length;u++){const p=l[u];o.findIndex(g=>g.uuid===p.uuid)!==-1||c.push(p);}o=o.concat(c),Se.set(this.$data.STORAGE_KEY,o),m.success(`共 ${l.length} 条规则，新增 ${c.length} 条`),n==null||n();},s=l=>new Promise(o=>{let c=d.toJSON(l);if(!Array.isArray(c)){f.error(c),m.error("导入失败，格式不符合（不是数组）",{consoleLogContent:true}),o(false);return}if(!c.length){m.error("导入失败，解析出的数据为空",{consoleLogContent:true}),o(false);return}i(c),o(true);});b.on(t,"click",l=>{d.preventEvent(l),r.close();let o=b.createElement("input",{type:"file",accept:".json"});b.on(o,["propertychange","input"],c=>{var h;if(!((h=o.files)!=null&&h.length))return;let u=o.files[0],p=new FileReader;p.onload=()=>{s(p.result);},p.readAsText(u,"UTF-8");}),o.click();}),b.on(e,"click",l=>{d.preventEvent(l),r.close();let o=P.prompt({title:{text:"网络导入",position:"center"},content:{text:"",placeholder:"请填写URL",focus:true},btn:{close:{enable:true,callback(p,h){p.close();}},ok:{text:"导入",callback:async(p,h)=>{let g=p.text;if(d.isNull(g)){m.error("请填入完整的url");return}let k=m.loading("正在获取配置..."),w=await M.get(g,{allowInterceptConfig:false});if(k.close(),!w.status){f.error(w),m.error("获取配置失败",{consoleLogContent:true});return}await s(w.data.responseText)&&p.close();}},cancel:{enable:false}},mask:{enable:true},drag:true,width:Z.info.width,height:"auto"}),c=o.$shadowRoot.querySelector("input"),u=o.$shadowRoot.querySelector(".pops-prompt-btn-ok");b.on(c,["input","propertychange"],p=>{b.val(c)===""?b.attr(u,"disabled","true"):b.removeAttr(u,"disabled");}),b.listenKeyboard(c,"keydown",(p,h,g)=>{p==="Enter"&&g.length===0&&b.val(c)!==""&&d.dispatchEvent(u,"click");}),d.dispatchEvent(c,"input");}),b.on(a,"click",async l=>{d.preventEvent(l),r.close();let o=await d.getClipboardInfo();if(o.error!=null){m.error(o.error.toString());return}if(o.content.trim()===""){m.warning("获取到的剪贴板内容为空");return}await s(o.content);});}},lr=(n,r,t)=>{if(we.$data.isShowEditView)return r;let a=we.getUrlMatchedRule().find(i=>{let s=we.getRuleData(i);return Reflect.has(s,n)});return a?Reflect.get(we.getRuleData(a),n):r},cr=function(n,r,t){return {KEY:n,default:r,get value(){let e=ee(n,r);return typeof t=="function"?t(n,e,r):e},set value(e){ie(n,e);}}},L=function(n,r){return cr(n,r,lr)},y={toast:{position:L("qmsg-config-position","top"),maxnums:L("qmsg-config-maxnums",3),showreverse:L("qmsg-config-showreverse",true)},pops:{popsAnimation:L("popsAnimation","pops-anim-fadein-zoom"),clickMaskToCloseDialog:L("clickMaskToCloseDialog",true),pcDrag:L("pcDrag",true),pcDragLimit:L("pcDragLimit",true),popsAcrylic:L("popsAcrylic",false)},popsFolder:{"pops-folder-sort-name":L("pops-folder-sort-name","fileName"),"pops-folder-sort-is-desc":L("pops-folder-sort-is-desc",false)},smallIconNavgiator:{"pops-netdisk-icon-click-event-find-sharecode":L("pops-netdisk-icon-click-event-find-sharecode",true),"pops-netdisk-icon-click-event-find-sharecode-with-select":L("pops-netdisk-icon-click-event-find-sharecode-with-select",true),"pops-netdisk-icon-click-event-loop-find-sharecode":L("pops-netdisk-icon-click-event-loop-find-sharecode",true)},suspension:{size:L("size",50),opacity:L("opacity",1),"randbg-time":L("randbg-time",1500),"randbg-show-time":L("randbg-show-time",1200),"suspended-button-adsorption-edge":L("suspended-button-adsorption-edge",false),"suspended-z-index":L("suspended-z-index",-1)},smallWindow:{"netdisk-ui-small-window-width":L("netdisk-ui-small-window-width",250),"netdisk-ui-small-window-max-height":L("netdisk-ui-small-window-max-height",200),"netdisk-link-view-z-index":L("netdisk-link-view-z-index",-1)},historyMatch:{saveMatchNetDisk:L("saveMatchNetDisk",false),"netdisk-history-match-ordering-rule":L("netdisk-history-match-ordering-rule","按 更新时间 - 降序"),"netdisk-history-match-merge-same-link":L("netdisk-history-match-merge-same-link",true)},match:{pageMatchRange:L("pageMatchRange",["innerText","innerHTML"]),depthQueryWithShadowRoot:L("depthQueryWithShadowRoot",false),readClipboard:L("readClipboard",false),allowMatchLocationHref:L("allowMatchLocationHref",true),toBeMatchedWithInputElementValue:L("to-be-matched-inputElementValue",false),toBeMatchedTextAreaElementValue:L("to-be-matched-textAreaElementValue",false),delaytime:L("delaytime",.8),isAddedNodesToMatch:L("isAddedNodesToMatch",false),"mutationObserver-childList":L("mutationObserver-childList",true),"mutationObserver-characterData":L("mutationObserver-characterData",true),"mutationObserver-subtree":L("mutationObserver-subtree",true)},features:{"netdisk-match-mode":L("netdisk-match-mode","MutationObserver"),"netdisk-behavior-mode":L("netdisk-behavior-mode","suspension_smallwindow"),autoFillAccessCode:L("autoFillAccessCode",true)},shareCode:{excludeIdenticalSharedCodesCoefficient:L("excludeIdenticalSharedCodesCoefficient",1),excludeIdenticalSharedCodes:L("excludeIdenticalSharedCodes",false)},accessCode:{allowQueryHistoryMatchingAccessCode:L("allowQueryHistoryMatchingAccessCode",true)}};class ur{constructor(r){G(this,"CONFIG",{data:[],pageCount:5,pageStep:3,currentPage:1,pageChangeCallBack:function(r){},prevBtn:{enable:true,callBack:function(){}},nextBtn:{enable:true,callBack:function(){}},firstBtn:{enable:true,callBack:function(){}},lastBtn:{enable:true,callBack:function(){}}});G(this,"PAGE_CONFIG",{getCurrentPage:()=>this.DOM_CONFIG.getAttributeWithPageId(this.DOM_CONFIG.getAttributeWithCurrentPage()),maxPage:1});G(this,"DOM_CONFIG",{dataPagingNode:{localName:"div",id:"whitesev-datapaging",dom:null},firstBtnNode:{localName:"a",className:"pg-first",svgHTML:'<svg t="1694497357294" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4758" width="20"><path d="M730.639277 211.376748l60.943177 60.943176-301.698894 301.698893L428.940384 513.075641z" p-id="4759"></path><path d="M730.496772 814.924547l60.943176-60.943176-301.698893-301.698893L428.797879 513.225654z" p-id="4760"></path><path d="M298.666667 213.333333h85.333333v597.333334H298.666667z" p-id="4761"></path></svg>',get:()=>this.DOM_CONFIG.dataPagingNode.dom.querySelector(`${this.DOM_CONFIG.firstBtnNode.localName}.${this.DOM_CONFIG.firstBtnNode.className}`)},prevBtnNode:{localName:"a",className:"pg-prev",svgHTML:'<svg t="1694497840770" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5272" width="20"><path d="M620.322607 151.04875l60.943176 60.943176-362.038672 362.038672L258.283935 513.087422z" p-id="5273"></path><path d="M620.180101 875.252545l60.943177-60.943176-362.038672-362.038672L258.141429 513.213873z" p-id="5274"></path></svg>',get:()=>this.DOM_CONFIG.dataPagingNode.dom.querySelector(`${this.DOM_CONFIG.prevBtnNode.localName}.${this.DOM_CONFIG.prevBtnNode.className}`)},nextBtnNode:{localName:"a",className:"pg-next",svgHTML:'<svg t="1694497949481" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5465" width="20"><path d="M403.399239 151.02258l-60.943177 60.943177 362.038672 362.038672L765.437911 513.061252z" p-id="5466"></path><path d="M403.576858 875.263008l-60.943176-60.943176 362.038672-362.038672L765.61553 513.224336z" p-id="5467"></path></svg>',get:()=>this.DOM_CONFIG.dataPagingNode.dom.querySelector(`${this.DOM_CONFIG.nextBtnNode.localName}.${this.DOM_CONFIG.nextBtnNode.className}`)},lastBtnNode:{localName:"a",className:"pg-last",svgHTML:'<svg t="1694498035538" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2299" width="20"><path d="M516.266667 490.666667L256 230.4 315.733333 170.666667l320 320L315.733333 810.666667 256 750.933333l260.266667-260.266666zM678.4 170.666667h85.333333v640h-85.333333V170.666667z" p-id="2300"></path></svg>',get:()=>this.DOM_CONFIG.dataPagingNode.dom.querySelector(`${this.DOM_CONFIG.lastBtnNode.localName}.${this.DOM_CONFIG.lastBtnNode.className}`)},setAttributeWithPageId:(r,t)=>{r.setAttribute("page-id",t);},getAttributeWithPageId:r=>r!=null&&r.getAttribute("page-id")?parseInt(r.getAttribute("page-id")):null,hasAttributeWithPageId:r=>r.hasAttribute("page-id"),setAttributeWithCurrentPage:r=>{r.setAttribute("data-current-page","");},getAttributeWithCurrentPage:r=>(r||this.DOM_CONFIG.dataPagingNode.dom).querySelector("a[data-current-page]"),hasAttributeWithCurrentPage:r=>r.hasAttribute("data-current-page"),removeAttributeWithCurrentPage:r=>{r.removeAttribute("data-current-page");},setAttributeWithDisabled:r=>{r.setAttribute("disabled","true");},removeAllAttributeWithDisabled:r=>{(r||this.DOM_CONFIG.dataPagingNode.dom).querySelectorAll("a[class][disabled]").forEach(t=>{t.removeAttribute("disabled");});},getFirstPageNode:r=>(r||this.DOM_CONFIG.dataPagingNode.dom).querySelector("a[page-id='1']"),getLastPageNode:r=>(r||this.DOM_CONFIG.dataPagingNode.dom).querySelector(`a[page-id='${this.PAGE_CONFIG.maxPage}']`),getAllPageNode:r=>(r||this.DOM_CONFIG.dataPagingNode.dom).querySelectorAll("a[page-id]")});this.changeConfig(r);}addCSS(r=document.head){let t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=`@charset "utf-8";
		#${this.DOM_CONFIG.dataPagingNode.id} {
			text-align: center;
			display: inline-block;
		}
		#${this.DOM_CONFIG.dataPagingNode.id} .${this.DOM_CONFIG.firstBtnNode.className},
		#${this.DOM_CONFIG.dataPagingNode.id} .${this.DOM_CONFIG.prevBtnNode.className},
		#${this.DOM_CONFIG.dataPagingNode.id} .${this.DOM_CONFIG.nextBtnNode.className},
		#${this.DOM_CONFIG.dataPagingNode.id} .${this.DOM_CONFIG.lastBtnNode.className} {
			font-family: Arial, sans-serif;
			color: #333;
			font-size: 22px;
			fill: currentColor;
			display: inline-flex;
			justify-content: center;
			align-items: center;
			text-decoration: none;
		}
		#${this.DOM_CONFIG.dataPagingNode.id} a,
		#${this.DOM_CONFIG.dataPagingNode.id} span {
			width: 45px;
			height: 40px;
			border: 1px solid #ebebeb;
			margin-left: -1px;
			color: #000000;
			line-height: 40px;
			float: left;
			font-size: 15px;
			text-decoration: none;
			margin: 0 2px;
			border-radius: 6px;
		}
		#${this.DOM_CONFIG.dataPagingNode.id} a:hover,
		#${this.DOM_CONFIG.dataPagingNode.id} span:hover {
			border-color: #3897cd;
			color: #3897cd;
			position: relative;
			z-index: 1;
		}
		#${this.DOM_CONFIG.dataPagingNode.id} a {
			cursor: pointer;
			user-select: none;
		}
		#${this.DOM_CONFIG.dataPagingNode.id} a[data-current-page] {
			background-color: #222a35;
			color: #fff;
			border-color: #ebebeb;
			position: relative;
			z-index: 1;
		}
		#${this.DOM_CONFIG.dataPagingNode.id} a.${this.DOM_CONFIG.firstBtnNode.className}[disabled="true"],
		#${this.DOM_CONFIG.dataPagingNode.id} a.${this.DOM_CONFIG.prevBtnNode.className}[disabled="true"],
		#${this.DOM_CONFIG.dataPagingNode.id} a.${this.DOM_CONFIG.nextBtnNode.className}[disabled="true"],
		#${this.DOM_CONFIG.dataPagingNode.id} a.${this.DOM_CONFIG.lastBtnNode.className}[disabled="true"]{
			cursor: not-allowed;
			border: 1px solid transparent;
			color: #c9c9c9;
		}
		`,r.appendChild(t);}getDataPagingNode(){let r=this,t=document.createElement(r.DOM_CONFIG.dataPagingNode.localName);r.DOM_CONFIG.dataPagingNode.dom=t,t.id=r.DOM_CONFIG.dataPagingNode.id;let e=document.createElement(r.DOM_CONFIG.firstBtnNode.localName);e.innerHTML=r.DOM_CONFIG.firstBtnNode.svgHTML;let a=document.createElement(r.DOM_CONFIG.prevBtnNode.localName);a.innerHTML=r.DOM_CONFIG.prevBtnNode.svgHTML;let i=document.createElement(r.DOM_CONFIG.nextBtnNode.localName);i.innerHTML=r.DOM_CONFIG.nextBtnNode.svgHTML;let s=document.createElement(r.DOM_CONFIG.lastBtnNode.localName);if(s.innerHTML=r.DOM_CONFIG.lastBtnNode.svgHTML,e.className=r.DOM_CONFIG.firstBtnNode.className,a.className=r.DOM_CONFIG.prevBtnNode.className,i.className=r.DOM_CONFIG.nextBtnNode.className,s.className=r.DOM_CONFIG.lastBtnNode.className,r.PAGE_CONFIG.maxPage=Math.ceil(r.CONFIG.data.length/r.CONFIG.pageCount),r.CONFIG.currentPage<1?r.CONFIG.currentPage=1:r.CONFIG.currentPage>r.PAGE_CONFIG.maxPage&&(r.CONFIG.currentPage=r.PAGE_CONFIG.maxPage),r.PAGE_CONFIG.maxPage<2)return t;r.CONFIG.firstBtn.enable&&(this.setFirstBtnClickEvent(e,t),t.appendChild(e)),r.CONFIG.prevBtn.enable&&(this.setPrevBtnClickEvent(a,t),t.appendChild(a));let l=r.CONFIG.currentPage;if(r.CONFIG.pageStep>r.PAGE_CONFIG.maxPage)for(let o=l;o<=r.PAGE_CONFIG.maxPage;o++){let c=document.createElement("a");r.DOM_CONFIG.setAttributeWithPageId(c,o),c.innerText=o,r.CONFIG.currentPage===o&&r.DOM_CONFIG.setAttributeWithCurrentPage(c),this.setPageBtnClickEvent(c,t),t.appendChild(c);}else if(l+r.CONFIG.pageStep>r.PAGE_CONFIG.maxPage){l=r.PAGE_CONFIG.maxPage;let o=[];for(let c=0;c<r.CONFIG.pageStep;c++){let u=document.createElement("a");r.DOM_CONFIG.setAttributeWithPageId(u,l),u.innerText=l,r.CONFIG.currentPage===l&&r.DOM_CONFIG.setAttributeWithCurrentPage(u),this.setPageBtnClickEvent(u,t),o=[...o,u],l--;}o.reverse(),o.forEach(c=>{t.appendChild(c);});}else for(let o=0;o<r.CONFIG.pageStep;o++){let c=document.createElement("a");r.DOM_CONFIG.setAttributeWithPageId(c,l),c.innerText=l,r.CONFIG.currentPage===l&&r.DOM_CONFIG.setAttributeWithCurrentPage(c),this.setPageBtnClickEvent(c,t),t.appendChild(c),l++;}return r.CONFIG.nextBtn.enable&&(this.setNextBtnClickEvent(i,t),t.appendChild(i)),r.CONFIG.lastBtn.enable&&(this.setLastBtnClickEvent(s,t),t.appendChild(s)),r.CONFIG.currentPage===1?(r.DOM_CONFIG.setAttributeWithDisabled(r.DOM_CONFIG.firstBtnNode.get()),r.DOM_CONFIG.setAttributeWithDisabled(r.DOM_CONFIG.prevBtnNode.get())):r.CONFIG.currentPage===r.PAGE_CONFIG.maxPage&&(r.DOM_CONFIG.setAttributeWithDisabled(r.DOM_CONFIG.nextBtnNode.get()),r.DOM_CONFIG.setAttributeWithDisabled(r.DOM_CONFIG.lastBtnNode.get())),t}setFirstBtnClickEvent(r,t){let e=this;r.onclick=function(){let a=e.DOM_CONFIG.getAttributeWithCurrentPage();if(e.DOM_CONFIG.getAttributeWithPageId(a)===1)return;e.CONFIG.firstBtn.callBack();let i=e.DOM_CONFIG.getAllPageNode(t);for(let s=0;s<e.CONFIG.pageStep;s++){let l=i[s];s===0?e.DOM_CONFIG.setAttributeWithCurrentPage(l):e.DOM_CONFIG.removeAttributeWithCurrentPage(l),e.DOM_CONFIG.setAttributeWithPageId(l,s+1),l.innerText=s+1;}e.DOM_CONFIG.removeAllAttributeWithDisabled(t),e.DOM_CONFIG.getFirstPageNode(t)&&(e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.firstBtnNode.get()),e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.prevBtnNode.get())),e.CONFIG.pageChangeCallBack(1);};}setPrevBtnClickEvent(r,t){let e=this;r.onclick=function(){let a=e.DOM_CONFIG.getAttributeWithCurrentPage();e.DOM_CONFIG.getAttributeWithPageId(a)!==1&&(e.CONFIG.prevBtn.callBack(),e.DOM_CONFIG.hasAttributeWithPageId(a.previousElementSibling)?a.previousElementSibling.click():(e.DOM_CONFIG.getAllPageNode(t).forEach((s,l)=>{let o=e.DOM_CONFIG.getAttributeWithPageId(s);o--,e.DOM_CONFIG.setAttributeWithPageId(s,o),s.innerText=o;}),e.CONFIG.pageChangeCallBack(e.PAGE_CONFIG.getCurrentPage())),e.DOM_CONFIG.removeAllAttributeWithDisabled(t),e.DOM_CONFIG.getFirstPageNode(t)&&e.PAGE_CONFIG.getCurrentPage()==1&&(e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.firstBtnNode.get()),e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.prevBtnNode.get())));};}setNextBtnClickEvent(r,t){let e=this;r.onclick=function(){let a=e.DOM_CONFIG.getAttributeWithCurrentPage();e.DOM_CONFIG.getAttributeWithPageId(a)!==e.PAGE_CONFIG.maxPage&&(e.CONFIG.nextBtn.callBack(),e.DOM_CONFIG.hasAttributeWithPageId(a.nextElementSibling)?a.nextElementSibling.click():(e.DOM_CONFIG.getAllPageNode(t).forEach((s,l)=>{let o=e.DOM_CONFIG.getAttributeWithPageId(s);o++,!(o>e.PAGE_CONFIG.maxPage)&&(e.DOM_CONFIG.setAttributeWithPageId(s,o),s.innerText=o);}),e.CONFIG.pageChangeCallBack(e.PAGE_CONFIG.getCurrentPage())),e.DOM_CONFIG.removeAllAttributeWithDisabled(t),e.DOM_CONFIG.getLastPageNode()&&e.PAGE_CONFIG.getCurrentPage()==e.PAGE_CONFIG.maxPage&&(e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.nextBtnNode.get()),e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.lastBtnNode.get())));};}setLastBtnClickEvent(r,t){let e=this;r.onclick=function(){let a=e.DOM_CONFIG.getAttributeWithCurrentPage();if(e.DOM_CONFIG.getAttributeWithPageId(a)===e.PAGE_CONFIG.maxPage)return;e.CONFIG.lastBtn.callBack();let i=Array.from(e.DOM_CONFIG.getAllPageNode(t));i.reverse();let s=e.PAGE_CONFIG.maxPage,l=0;for(;!(e.PAGE_CONFIG.maxPage-s>3);){let o=i[l];if(o==null)break;l===0?e.DOM_CONFIG.setAttributeWithCurrentPage(o):e.DOM_CONFIG.removeAttributeWithCurrentPage(o),e.DOM_CONFIG.setAttributeWithPageId(o,s),o.innerText=s,s--,l++;}e.DOM_CONFIG.removeAllAttributeWithDisabled(t),e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.nextBtnNode.get()),e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.lastBtnNode.get()),e.CONFIG.pageChangeCallBack(e.PAGE_CONFIG.maxPage);};}setPageBtnClickEvent(r,t){let e=this;r.onclick=function(a){let i=a.target;e.DOM_CONFIG.getAllPageNode(t).forEach(s=>{s==i?e.DOM_CONFIG.hasAttributeWithCurrentPage(i)||(e.DOM_CONFIG.setAttributeWithCurrentPage(i),e.CONFIG.pageChangeCallBack(e.PAGE_CONFIG.getCurrentPage())):e.DOM_CONFIG.removeAttributeWithCurrentPage(s);}),e.DOM_CONFIG.removeAllAttributeWithDisabled(t),e.DOM_CONFIG.getFirstPageNode(t)&&e.PAGE_CONFIG.getCurrentPage()==1&&(e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.firstBtnNode.get()),e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.prevBtnNode.get())),e.DOM_CONFIG.getLastPageNode()&&e.PAGE_CONFIG.getCurrentPage()==e.PAGE_CONFIG.maxPage&&(e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.nextBtnNode.get()),e.DOM_CONFIG.setAttributeWithDisabled(e.DOM_CONFIG.lastBtnNode.get()));};}append(r){var e;let t=this;(e=t.DOM_CONFIG.dataPagingNode.dom)==null||e.remove(),t.DOM_CONFIG.dataPagingNode.dom=null,r.appendChild(t.getDataPagingNode());}changeConfig(r){Object.assign(this.CONFIG,r);}refresh(r){if(r.length===this.CONFIG.data.length)return;this.CONFIG.data=[],this.CONFIG.data=r;let t=this.PAGE_CONFIG.getCurrentPage(),e=Math.ceil(r.length/this.CONFIG.pageCount);t>e&&(t=e),this.CONFIG.currentPage=t;let a=this.DOM_CONFIG.dataPagingNode.dom.parentElement;this.append(a);}}var dr=ur;const pr="网盘链接识别",Tt=false,d=Le.noConflict(),b=W.noConflict(),K=lt,Ie=Et??window.CryptoJS??he.CryptoJS,hr=dr??window.DataPaging??he.DataPaging,f=new d.Log(Me,he.console||Pt.console);var xt;const ye=((xt=Me==null?void 0:Me.script)==null?void 0:xt.name)||pr,fr=lt.config.Utils.AnyTouch();f.config({debug:Tt,logMaxCount:1e3,autoClearConsole:true,tag:true});m.config(Object.defineProperties({html:true,autoClose:true,showClose:false,timeout:3500},{position:{get(){return y.toast.position.value}},maxNums:{get(){return y.toast.maxnums.value}},showReverse:{get(){return y.toast.showreverse.value}},zIndex:{get(){let n=Le.getMaxZIndex(10),r=lt.config.InstanceUtils.getPopsMaxZIndex(10).zIndex;return Le.getMaxValue(n,r)+100}}}));const Oe=new d.GM_Menu({GM_getValue:ee,GM_setValue:ie,GM_registerMenuCommand:Ft,GM_unregisterMenuCommand:Ot}),M=new d.Httpx({xmlHttpRequest:Ut,headers:{"User-Agent":d.getRandomPCUA()},logDetails:Tt});M.interceptors.request.use(n=>(Vt.handle(n),n));M.interceptors.response.use(void 0,n=>(f.error("拦截器-请求错误",n),n.type==="onabort"?m.warning("请求取消"):n.type==="onerror"?m.error("请求异常"):n.type==="ontimeout"?m.error("请求超时"):m.error("其它错误"),n));he.Object.defineProperty,he.Function.prototype.apply,he.Function.prototype.call,he.Element.prototype.appendChild,he.setTimeout;d.addStyle.bind(d);const ot=document.querySelector.bind(document),mr=document.querySelectorAll.bind(document),Ae=function(n,r,t,e,a,i="default",s){let l=a,o=()=>s.getShowText(t,l),c=Xe(n,r,o,"keyboard",false,false,i,async u=>{var g;d.preventEvent(u);let h=(g=u.target.closest(".pops-panel-button"))==null?void 0:g.querySelector("span");if(s.isWaitPress){m.warning("请先执行当前的录入操作");return}if(s.hasOptionValue(t))s.emptyOption(t),m.success("清空快捷键");else {let k=m.loading("请按下快捷键...",{showClose:true,onClose(){s.cancelEnterShortcutKeys();}}),{status:w,option:D,key:C}=await s.enterShortcutKeys(t);k.close(),w?(f.success(["成功录入快捷键",D]),m.success("成功录入")):m.error(`快捷键 ${s.translateKeyboardValueToButtonText(D)} 已被 ${C} 占用`);}b.html(h,o());});return c.attributes={},Reflect.set(c.attributes,vt,()=>false),c};class gr{constructor(r){G(this,"key","short-cut");G(this,"$data");G(this,"isWaitPress",false);G(this,"currentWaitEnterPressInstanceHandler",null);typeof r=="string"&&(this.key=r),this.$data={otherShortCutOptions:[]};}initConfig(r,t){this.hasOption(r)||this.setOption(r,t);}getStorageKey(){return this.key}getLocalAllOptions(){return ee(this.key,[])}hasOption(r){return !!this.getLocalAllOptions().find(a=>a.key===r)}hasOptionValue(r){if(this.hasOption(r)){let t=this.getOption(r);return (t==null?void 0:t.value)!=null}else return  false}getOption(r,t){return this.getLocalAllOptions().find(i=>i.key===r)??t}setOption(r,t){let e=this.getLocalAllOptions(),a=e.findIndex(i=>i.key===r);a==-1?e.push({key:r,value:t}):Reflect.set(e[a],"value",t),ie(this.key,e);}emptyOption(r){let t=false,e=this.getLocalAllOptions(),a=e.findIndex(i=>i.key===r);return a!==-1&&(e[a].value=null,t=true),ie(this.key,e),t}deleteOption(r){let t=false,e=this.getLocalAllOptions(),a=e.findIndex(i=>i.key===r);return a!==-1&&(e.splice(a,1),t=true),ie(this.key,e),t}translateKeyboardValueToButtonText(r){let t="";return r.ohterCodeList.forEach(e=>{t+=d.stringTitleToUpperCase(e,true)+" + ";}),t+=d.stringTitleToUpperCase(r.keyName),t}getShowText(r,t){if(this.hasOption(r)){let e=this.getOption(r);return e.value==null?t:this.translateKeyboardValueToButtonText(e.value)}else return t}async enterShortcutKeys(r){const t=this;return new Promise(e=>{this.isWaitPress=true;let a=b.listenKeyboard(window,"keyup",(i,s,l)=>{const o={keyName:i,keyValue:s,ohterCodeList:l};let c={};try{const u=JSON.stringify(o),p=this.getLocalAllOptions();Array.isArray(this.$data.otherShortCutOptions)&&p.push(...this.$data.otherShortCutOptions);for(let h=0;h<p.length;h++){let g=p[h];if(g.key===r)continue;const k=JSON.stringify(g.value);let w=!1;if(g.value!=null&&u===k&&(w=!0),w){c={status:!1,key:g.key,option:o};return}}this.setOption(r,o),c={status:!0,key:r,option:o};}catch(u){console.log(u),c={status:false,key:r,option:o};}finally{t.isWaitPress=false,a.removeListen(),t.currentWaitEnterPressInstanceHandler=null,e(c);}});t.currentWaitEnterPressInstanceHandler=null,t.currentWaitEnterPressInstanceHandler=()=>{t.isWaitPress=false,a.removeListen();};})}cancelEnterShortcutKeys(){typeof this.currentWaitEnterPressInstanceHandler=="function"&&this.currentWaitEnterPressInstanceHandler();}initGlobalKeyboardListener(r,t){let e=this.getLocalAllOptions();if(!e.length){f.warn("没有设置快捷键");return}const a=this;function i(o,c){b.listenKeyboard(o,"keydown",(u,p,h,g)=>{if(a.isWaitPress)return;t!=null&&t.isPrevent&&d.preventEvent(g),e=a.getLocalAllOptions();let k=e.findIndex(w=>{let D=w.value,C={keyName:u,keyValue:p,ohterCodeList:h};if(JSON.stringify(D)===JSON.stringify(C))return w});if(k!=-1){let w=e[k];w.key in c&&(f.info(["调用快捷键",w]),c[w.key].callback());}},{capture:!!(t!=null&&t.capture)});}let s={},l={};Object.keys(r).forEach(o=>{let c=r[o];(c.target==null||typeof c.target=="string"&&c.target==="")&&(c.target="window"),c.target==="window"?Reflect.set(s,o,c):Reflect.set(l,o,c);}),i(window,s),b.ready(()=>{Object.keys(l).forEach(async o=>{let c=l[o];if(typeof c.target=="string")d.waitNode(c.target,1e4).then(u=>{if(!u)return;let p={};Reflect.set(p,o,c),i(u,p);});else if(typeof c.target=="function"){let u=await c.target();if(u==null)return;let p={};Reflect.set(p,o,c),i(u,p);}else {let u={};Reflect.set(u,o,c),i(c.target,u);}});});}}const ve={shortCut:new gr("GM_shortcut"),init(){this.shortCut.initGlobalKeyboardListener(this.getShortCutMap());},getShortCutMap(){return {"netdisk-keyboard-open-setting":{target:"window",callback:()=>{f.info("快捷键 ==> 【打开】⚙ 设置"),at.show();}},"netdisk-keyboard-open-history-matching-records":{target:"window",callback:()=>{f.info("快捷键 ==> 【打开】⚙ 历史匹配记录"),x.netDiskHistoryMatch.show();}},"netdisk-keyboard-open-user-rule":{target:"window",callback:()=>{f.info("快捷键 ==> 【打开】⚙ 链接识别规则"),De.show(false);}},"netdisk-keyboard-open-proactively-recognize-text":{target:"window",callback:()=>{f.info("快捷键 ==> 【打开】⚙ 主动识别文本"),x.matchPasteText.show();}},"netdisk-keyboard-performPageTextMatchingManually":{target:"window",callback(){f.info("快捷键 ==> 执行文本匹配"),V.dispatchMonitorDOMChange=true;}},"netdisk-keyboard-character-mapping":{target:"window",callback(){f.info("快捷键 ==> 【打开】⚙ 字符映射规则"),He.showView(2);}},"netdisk-keyboard-identifyTheSelectedContent":{target:"window",callback(){f.info("快捷键 ==> 识别选中内容");const{text:n,html:r}=ze.getSelectContent();f.info("选中的内容信息：",[n,r]),V.postMessage({characterMapping:[],textList:[n,r],matchTextRange:y.match.pageMatchRange.value,matchedRuleOption:I.$rule.ruleOption,startTime:Date.now(),from:"ShortCut-Select-Content"});}}}}},br=function(n,r,t,e,a,i,s="请至少选择一个选项",l){let o=[];typeof e=="function"?o=e():o=e;let c={text:n,type:"select-multiple",description:i,placeholder:s,attributes:{},props:{},getValue(){return this.props[F].get(r,t)},selectConfirmDialogDetails:l,callback(u){let p=[];u.forEach(h=>{p.push(h.value);}),this.props[F].set(r,p),f.info("多选-选择：",p);},data:o};return Reflect.set(c.attributes,pe,r),Reflect.set(c.attributes,ge,t),Reflect.set(c.props,F,{get(u,p){return ee(u,p)},set(u,p){ie(u,p);}}),c},wr={id:"netdisk-panel-config-all-setting",title:"总设置",isDefault:true,forms:[{type:"forms",text:"",forms:[{type:"deepMenu",text:"Toast",forms:[{type:"forms",text:"",className:"netdisk-panel-forms-toast",forms:[Re("位置",y.toast.position.KEY,y.toast.position.default,[{value:"topleft",text:"左上角"},{value:"top",text:"顶部"},{value:"topright",text:"右上角"},{value:"left",text:"左边"},{value:"center",text:"中间"},{value:"right",text:"右边"},{value:"bottomleft",text:"左下角"},{value:"bottom",text:"底部"},{value:"bottomright",text:"右下角"}],void 0,`Toast显示在九宫格的位置，默认: ${y.toast.position.default}`),Re("同时最多显示的数量",y.toast.maxnums.KEY,y.toast.maxnums.default,[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"},{value:5,text:"5"}],void 0,`默认: ${y.toast.maxnums.default}`),H("逆序弹出",y.toast.showreverse.KEY,y.toast.showreverse.value,void 0,"默认是自上往下显示Toast，逆序则是自下往上显示Toast")]}]},{type:"deepMenu",text:"弹窗",forms:[{className:"netdisk-panel-forms-pops",type:"forms",text:"",forms:[Re("动画",y.pops.popsAnimation.KEY,y.pops.popsAnimation.default,[{value:"",text:"无"},{value:"pops-anim-spread",text:"spread"},{value:"pops-anim-shake",text:"shake"},{value:"pops-anim-rolling-left",text:"rolling-left"},{value:"pops-anim-rolling-right",text:"rolling-right"},{value:"pops-anim-slide-top",text:"slide-top"},{value:"pops-anim-slide-bottom",text:"slide-bottom"},{value:"pops-anim-slide-left",text:"slide-left"},{value:"pops-anim-slide-right",text:"slide-right"},{value:"pops-anim-fadein",text:"fadein"},{value:"pops-anim-fadein-zoom",text:"fadein-zoom"},{value:"pops-anim-fadein-alert",text:"fadein-alert"},{value:"pops-anim-don",text:"don"},{value:"pops-anim-roll",text:"roll"},{value:"pops-anim-sandra",text:"sandra"},{value:"pops-anim-gather",text:"gather"}],void 0,`显示/关闭的动画效果，默认: ${y.pops.popsAnimation.default}`),H("点击弹窗遮罩层关闭弹窗",y.pops.clickMaskToCloseDialog.KEY,y.pops.clickMaskToCloseDialog.default,void 0,"点击遮罩层触发关闭弹窗事件"),H("窗口拖拽",y.pops.pcDrag.KEY,y.pops.pcDrag.default,void 0,"长按标题栏可拖拽移动弹窗"),H("限制拖拽距离",y.pops.pcDragLimit.KEY,y.pops.pcDragLimit.default,void 0,"只能在浏览器的可视窗口内拖动"),H("亚克力效果",y.pops.popsAcrylic.KEY,y.pops.popsAcrylic.default,void 0,"")]}]},{type:"deepMenu",text:"文件弹窗",forms:[{type:"forms",text:"",className:"netdisk-panel-forms-pops-folder",forms:[Re("排序名",y.popsFolder["pops-folder-sort-name"].KEY,y.popsFolder["pops-folder-sort-name"].default,[{value:"fileName",text:"文件名"},{value:"latestTime",text:"修改时间"},{value:"fileSize",text:"大小"}],void 0,"当前的规则"),Re("排序规则",y.popsFolder["pops-folder-sort-is-desc"].KEY,y.popsFolder["pops-folder-sort-is-desc"].default,[{value:false,text:"升序"},{value:true,text:"降序"}],void 0,"当前的规则")]}]},{type:"deepMenu",text:"悬浮按钮",forms:[{type:"forms",text:"",forms:[be("大小",y.suspension.size.KEY,y.suspension.size.default,15,250,(n,r)=>{y.suspension.size.value=parseInt(r.toString()),x.suspension.isShow&&(W.css(x.suspension.suspensionNode,{width:y.suspension.size.value,height:y.suspension.size.value}),x.suspension.setSuspensionPosition());},n=>`${n}px`,"悬浮按钮的大小，默认: "+y.suspension.size.default),be("透明度",y.suspension.opacity.KEY,y.suspension.opacity.default,.1,1,(n,r)=>{y.suspension.opacity.value=parseFloat(r.toString()),x.suspension.isShow&&W.css(x.suspension.suspensionNode,{opacity:y.suspension.opacity.value});},void 0,"值越小越透明，默认: "+y.suspension.opacity.default,.1),be("背景轮播时间",y.suspension["randbg-time"].KEY,y.suspension["randbg-time"].default,0,1e4,void 0,n=>`${n}ms`,"淡入/淡出的时间，默认: "+y.suspension["randbg-time"].default+"ms",100),be("背景显示时间",y.suspension["randbg-show-time"].KEY,y.suspension["randbg-show-time"].default,0,1e4,void 0,n=>`${n}ms`,"图标显示的持续时间，默认: 1200",100),H("吸附边缘",y.suspension["suspended-button-adsorption-edge"].KEY,y.suspension["suspended-button-adsorption-edge"].default,void 0,"移动悬浮按钮松开后自动吸附边缘"),J("z-index",y.suspension["suspended-z-index"].KEY,y.suspension["suspended-z-index"].default,"值小于等于0则为动态获取z-index",(n,r,t)=>(y.suspension["suspended-z-index"].value=t,true),"",true)]}]},{type:"deepMenu",text:"大/小链接弹窗",forms:[{type:"forms",text:"小窗",className:"netdisk-panel-forms-small-window",forms:[be("宽度",y.smallWindow["netdisk-ui-small-window-width"].KEY,y.smallWindow["netdisk-ui-small-window-width"].default,50,W.width(window),void 0,n=>`${n}px`,"设置小窗宽度(px)，默认: 250",1),be("高度",y.smallWindow["netdisk-ui-small-window-max-height"].KEY,y.smallWindow["netdisk-ui-small-window-max-height"].default,50,W.height(window),void 0,n=>`${n}px`,"设置小窗最大高度(px)，默认: "+y.smallWindow["netdisk-ui-small-window-max-height"].default,1)]},{type:"forms",text:"",forms:[J("z-index",y.smallWindow["netdisk-link-view-z-index"].KEY,y.smallWindow["netdisk-link-view-z-index"].default,"值小于等于0则为动态获取z-index",(n,r,t)=>(y.smallWindow["netdisk-link-view-z-index"].value=t,true),"",true)]}]}]},{type:"forms",text:"",forms:[{type:"deepMenu",text:"功能",forms:[{type:"forms",text:"",className:"netdisk-panel-forms-function",forms:[Re("匹配模式",y.features["netdisk-match-mode"].KEY,y.features["netdisk-match-mode"].default,[{text:"MutationObserver",value:"MutationObserver"},{text:"Menu",value:"Menu"}],void 0,"MutationObserver是自动监听并识别链接<br>Menu是手动点击油猴菜单进行识别"),Re("行为模式",y.features["netdisk-behavior-mode"].KEY,y.features["netdisk-behavior-mode"].default,[{text:"悬浮按钮+小窗",value:"suspension_smallwindow"},{text:"悬浮按钮+大窗",value:"suspension_window"},{text:"小窗",value:"smallwindow"}],void 0,"匹配到链接时触发的UI执行"),H("自动填充访问码",y.features.autoFillAccessCode.KEY,y.features.autoFillAccessCode.default,void 0,"通过主动点击链接跳转时，会自动输入网盘访问码")]}]},{type:"deepMenu",text:"匹配设置",forms:[{type:"forms",text:"文本匹配范围",forms:[br("匹配规则类型",y.match.pageMatchRange.KEY,y.match.pageMatchRange.default,[{value:"innerText",text:"普通文本"},{value:"innerHTML",text:"超文本"}],void 0,"执行的文本匹配规则",void 0,{height:"auto"}),H("深入ShadowRoot获取匹配文本",y.match.depthQueryWithShadowRoot.KEY,y.match.depthQueryWithShadowRoot.default,void 0,"遍历ShadowRoot，获取匹配的内容"),H("匹配剪贴板",y.match.readClipboard.KEY,y.match.readClipboard.default,void 0,"Api兼容性查看：<a href='https://caniuse.com/mdn-api_permissions_permission_clipboard-read' target='_blank'>读取剪贴板权限申请</a>、<a href='https://caniuse.com/mdn-api_clipboard_readtext' target='_blank'>直接读取剪贴板</a>"),H("匹配当前URL",y.match.allowMatchLocationHref.KEY,y.match.allowMatchLocationHref.default,void 0,"提取window.location.href进行匹配"),H("匹配input标签的内容",y.match.toBeMatchedWithInputElementValue.KEY,y.match.toBeMatchedWithInputElementValue.default,void 0,"提取页面中的&lt;input&gt;的内容进行匹配"),H("匹配textarea标签的内容",y.match.toBeMatchedTextAreaElementValue.KEY,y.match.toBeMatchedTextAreaElementValue.default,void 0,"提取页面中的&lt;textarea&gt;的内容进行匹配")]},{type:"forms",text:"MutationObserver观察器",forms:[be("匹配间隔",y.match.delaytime.KEY,y.match.delaytime.default,0,5,void 0,n=>`${n}s`,"匹配文本完毕后的延迟xxx秒允许下一次匹配",.1),H("添加元素时进行匹配",y.match.isAddedNodesToMatch.KEY,y.match.isAddedNodesToMatch.default,void 0,"当监听到页面添加元素时才进行匹配文本"),H("观察器：childList",y.match["mutationObserver-childList"].KEY,y.match["mutationObserver-childList"].default,void 0,"子节点的变动（新增、删除或者更改）"),H("观察器：characterData",y.match["mutationObserver-characterData"].KEY,y.match["mutationObserver-characterData"].default,void 0,"节点内容或节点文本的变动"),H("观察器：subtree",y.match["mutationObserver-subtree"].KEY,y.match["mutationObserver-subtree"].default,void 0,"是否将观察器应用于该节点的所有后代节点")]}]},{type:"deepMenu",text:"网盘图标",forms:[{type:"forms",text:"",forms:[H("点击定位分享码",y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode"].KEY,y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode"].default,void 0,"自动滚动页面至包含分享码的元素"),H("选中分享码",y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode-with-select"].KEY,y.smallIconNavgiator["pops-netdisk-icon-click-event-find-sharecode-with-select"].default,void 0,"使用光标选中分享码/元素"),H("循环定位",y.smallIconNavgiator["pops-netdisk-icon-click-event-loop-find-sharecode"].KEY,y.smallIconNavgiator["pops-netdisk-icon-click-event-loop-find-sharecode"].default,void 0,"关闭则是每一个元素只定位一次")]}]},{type:"deepMenu",text:"历史匹配记录",forms:[{type:"forms",text:"",className:"netdisk-panel-history-match",forms:[H("保存匹配记录",y.historyMatch.saveMatchNetDisk.KEY,y.historyMatch.saveMatchNetDisk.default,void 0,"将匹配到的链接信息进行本地存储，可点击【油猴菜单-⚙ 历史匹配记录】进行查看"),H("合并相同链接",y.historyMatch["netdisk-history-match-merge-same-link"].KEY,y.historyMatch["netdisk-history-match-merge-same-link"].default,void 0,"将合并匹配到的相同链接，并更新它最后一次匹配到的更新时间、网址信息"),Re("排序规则",y.historyMatch["netdisk-history-match-ordering-rule"].KEY,y.historyMatch["netdisk-history-match-ordering-rule"].default,[{value:"按 记录时间 - 升序",text:"按 记录时间 - 升序"},{value:"按 记录时间 - 降序",text:"按 记录时间 - 降序"},{value:"按 更新时间 - 升序",text:"按 更新时间 - 升序"},{value:"按 更新时间 - 降序",text:"按 更新时间 - 降序"}]),Xe("修复存储记录","如果【匹配记录】弹窗打不开，可能是存储的数据缺失某些字段，可尝试点击此处进行修复","修复",void 0,void 0,false,"primary",n=>{d.preventEvent(n);try{const{count:r,repairCount:t}=x.netDiskHistoryMatch.checkAndRepairLocalData();t===0?m.info("不存在需要修复的数据"):m.success(`共计: ${r} 条，修复${t}条`);}catch(r){m.error("修复异常："+r.toString());}})]}]},{type:"deepMenu",text:"分享码",forms:[{type:"forms",text:"",className:"netdisk-panel-forms-share-code",forms:[H("排除分享码",y.shareCode.excludeIdenticalSharedCodes.KEY,y.shareCode.excludeIdenticalSharedCodes.default,void 0,"启用后会根据【相同系数】排除掉匹配到的分享码"),be("相同系数",y.shareCode.excludeIdenticalSharedCodesCoefficient.KEY,y.shareCode.excludeIdenticalSharedCodesCoefficient.default,0,1,void 0,n=>n.toString(),"例如分享码: aaaaaaaabb，它的相同系数是0.8，设置相同系数≥0.8时会被排除",.01)]}]},{type:"deepMenu",text:"访问码",forms:[{className:"netdisk-panel-forms-access-code",text:"",type:"forms",forms:[H("允许查询历史匹配记录",y.accessCode.allowQueryHistoryMatchingAccessCode.KEY,y.accessCode.allowQueryHistoryMatchingAccessCode.default,void 0,"当访问码为空时，访问码将从历史匹配记录中查询，优先级：页面匹配 < 历史匹配记录 < 网站规则 < 黑名单")]}]},{type:"deepMenu",className:"netdisk-panel-forms-shortcut-keys-deepMenu",text:"快捷键",forms:[{className:"netdisk-panel-forms-shortcut-keys",text:"",type:"forms",forms:[Ae("【打开】⚙ 设置","","netdisk-keyboard-open-setting",void 0,"暂无快捷键","default",ve.shortCut),Ae("【打开】⚙ 历史匹配记录","","netdisk-keyboard-open-history-matching-records",void 0,"暂无快捷键","default",ve.shortCut),Ae("【打开】⚙ 访问码规则","","netdisk-keyboard-open-accesscode-rule",void 0,"暂无快捷键","default",ve.shortCut),Ae("【打开】⚙ 添加链接识别规则","","netdisk-keyboard-open-user-rule",void 0,"暂无快捷键","default",ve.shortCut),Ae("【打开】⚙ 网站规则","","netdisk-keyboard-website-rule",void 0,"暂无快捷键","default",ve.shortCut),Ae("【打开】⚙ 字符映射规则","","netdisk-keyboard-character-mapping",void 0,"暂无快捷键","default",ve.shortCut),Ae("【打开】⚙ 识别文本","","netdisk-keyboard-open-proactively-recognize-text",void 0,"暂无快捷键","default",ve.shortCut),Ae("执行文本匹配","","netdisk-keyboard-performPageTextMatchingManually",void 0,"暂无快捷键","default",ve.shortCut),Ae("识别选中内容","","netdisk-keyboard-identifyTheSelectedContent",void 0,"暂无快捷键","default",ve.shortCut)]}]}]}]},te={$data:{__data:null,__oneSuccessExecMenu:null,__onceExec:null,__listenData:null,get data(){return te.$data.__data==null&&(te.$data.__data=new d.Dictionary),te.$data.__data},get oneSuccessExecMenu(){return te.$data.__oneSuccessExecMenu==null&&(te.$data.__oneSuccessExecMenu=new d.Dictionary),te.$data.__oneSuccessExecMenu},get onceExec(){return te.$data.__onceExec==null&&(te.$data.__onceExec=new d.Dictionary),te.$data.__onceExec},get scriptName(){return ye},key:Ne,attributeKeyName:pe,attributeDefaultValueName:ge},$listener:{get listenData(){return te.$data.__listenData==null&&(te.$data.__listenData=new d.Dictionary),te.$data.__listenData}},init(){this.initPanelDefaultValue(this.getPanelContentConfig().concat(Ge.getRulePanelContent())),this.initExtensionsMenu();},isTopWindow(){return he.top===he.self},initExtensionsMenu(){this.isTopWindow()&&Oe.add([{key:"show_pops_panel_setting",text:"⚙ 设置",autoReload:false,isStoreValue:false,showText(n){return n},callback:()=>{at.show();}},{key:"showNetDiskHistoryMatch",text:"⚙ 历史匹配记录",autoReload:false,isStoreValue:false,showText(n){return n},callback(){x.netDiskHistoryMatch.show();}},{key:"ruleManager",text:"⚙ 规则管理器",autoReload:false,isStoreValue:false,showText(n){return n},callback(){He.showView();}},{key:"showUserRule",text:"⚙ 添加链接识别规则",autoReload:false,isStoreValue:false,showText(n){return n},callback(){De.show(false);}},{key:"showMatchPasteText",text:"⚙ 识别文本",autoReload:false,isStoreValue:false,showText(n){return n},callback(){x.matchPasteText.show();}}]);},initPanelDefaultValue(n){function r(e){if(!e.attributes||e.type==="button")return;let a={},i=e.attributes[pe];i!=null&&(a[i]=e.attributes[ge]);let s=e.attributes[vt];if(typeof s=="function"){let c=s();if(typeof c=="boolean"&&!c)return}let l=e.attributes[zt];l&&typeof l=="object"&&Object.assign(a,l);let o=Object.keys(a);if(!o.length){f.warn("请先配置键",e);return}o.forEach(c=>{let u=a[c];ee(c)==null&&ie(c,u);});}function t(e){for(let a=0;a<e.length;a++){let i=e[a];r(i);let s=i.forms;s&&Array.isArray(s)&&t(s);}}for(let e=0;e<n.length;e++){let a=n[e];if(!a.forms)continue;let i=a.forms;i&&Array.isArray(i)&&t(i);}},setValue(n,r){let t=ee(Ne,{}),e=t[n];t[n]=r,ie(Ne,t),this.$listener.listenData.has(n)&&this.$listener.listenData.get(n).callback(n,e,r);},getValue(n,r){let e=ee(Ne,{})[n];return e??(this.$data.data.has(n)?this.$data.data.get(n):r)},deleteValue(n){let r=ee(Ne,{}),t=r[n];Reflect.deleteProperty(r,n),ie(Ne,r),this.$listener.listenData.has(n)&&this.$listener.listenData.get(n).callback(n,t,void 0);},addValueChangeListener(n,r,t){let e=Math.random();return this.$listener.listenData.set(n,{id:e,key:n,callback:r}),t&&t.immediate&&r(n,this.getValue(n),this.getValue(n)),e},removeValueChangeListener(n){let r=null;for(const[t,e]of this.$listener.listenData.entries())if(e.id===n){r=t;break}typeof r=="string"?this.$listener.listenData.delete(r):console.warn("没有找到对应的监听器");},triggerMenuValueChange(n,r,t){if(this.$listener.listenData.has(n)){let e=this.$listener.listenData.get(n);if(typeof e.callback=="function"){let a=this.getValue(n),i=a,s=a;typeof r<"u"&&arguments.length>1&&(i=r),typeof t<"u"&&arguments.length>2&&(s=t),e.callback(n,s,i);}}},hasKey(n){let r=ee(Ne,{});return n in r},execMenu(n,r,t=false){if(!(typeof n=="string"||typeof n=="object"&&Array.isArray(n)))throw new TypeError("key 必须是字符串或者字符串数组");let e=[];typeof n=="object"&&Array.isArray(n)?e=[...n]:e.push(n);let a;for(let i=0;i<e.length;i++){const s=e[i];if(!this.$data.data.has(s)){f.warn(`${n} 键不存在`);return}let l=te.getValue(s);if(t&&(l=!l),!l)break;a=l;}a&&r(a);},execMenuOnce(n,r,t,e){if(typeof n!="string")throw new TypeError("key 必须是字符串");if(!this.$data.data.has(n)){f.warn(`${n} 键不存在`);return}if(this.$data.oneSuccessExecMenu.has(n))return;this.$data.oneSuccessExecMenu.set(n,1);let a=()=>{let c=te.getValue(n);return typeof t=="function"?t(n,c):c},i=[],s=c=>{let u=a(),p=[];if(c instanceof HTMLStyleElement?p=[c]:Array.isArray(c)&&(p=[...c.filter(h=>h!=null&&h instanceof HTMLStyleElement)]),u)i=i.concat(p);else for(let h=0;h<p.length;h++)p[h].remove(),p.splice(h,1),h--;},l=c=>{let u=[];if(c){let p=r(c,s);p instanceof HTMLStyleElement?u=[p]:Array.isArray(p)&&(u=[...p.filter(h=>h!=null&&h instanceof HTMLStyleElement)]);}for(let p=0;p<i.length;p++)i[p].remove(),i.splice(p,1),p--;i=[...u];};this.addValueChangeListener(n,(c,u,p)=>{let h=p;typeof e=="function"&&(h=e(c,p,u)),l(h);});let o=a();o&&l(o);},execInheritMenuOnce(n,r,t,e){let a=this;const i=(s,l)=>{let o=a.getValue(s),c=a.getValue(l);if(typeof e=="function"){let u=e(o,c);if(u!==void 0)return u}return o};this.execMenuOnce(n,t,()=>i(n,r),()=>i(n,r)),this.execMenuOnce(r,()=>{},()=>false,()=>(this.triggerMenuValueChange(n),false));},onceExec(n,r){if(typeof n!="string")throw new TypeError("key 必须是字符串");this.$data.onceExec.has(n)||(r(),this.$data.onceExec.set(n,1));},getPanelContentConfig(){return [wr]}};Object.assign(x.src.icon,typeof RESOURCE_ICON>"u"?{}:RESOURCE_ICON);we.init();ue.init();Ge.init();te.init();I.init();ve.init();b.ready(()=>{Be.init(),dt.init(),V.init(),He.init();});

})(Qmsg, DOMUtils, Utils, pops, CryptoJS);