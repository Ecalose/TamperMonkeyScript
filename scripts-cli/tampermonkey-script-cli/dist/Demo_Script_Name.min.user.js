// ==UserScript==
// @name         Demo_Script_Name
// @namespace    https://github.com/WhiteSevs/TamperMonkeyScript
// @version      2025.3.8
// @author       WhiteSevs
// @description  Script-Cli
// @license      GPL-3.0-only
// @icon         https://favicon.yandex.net/favicon/v2/https://www.baidu.com/
// @supportURL   https://github.com/WhiteSevs/TamperMonkeyScript/issues
// @match        *://*/*
// @require      https://fastly.jsdelivr.net/gh/WhiteSevs/TamperMonkeyScript@86be74b83fca4fa47521cded28377b35e1d7d2ac/lib/CoverUMD/index.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/utils@2.6.1/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/domutils@1.5.1/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/pops@2.0.2/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/qmsg@1.3.0/dist/index.umd.js
// @connect      *
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-start
// ==/UserScript==

(function (C, O, v, k) {
	'use strict';

	var N=Object.defineProperty;var U=(e,t,n)=>t in e?N(e,t,{enumerable:true,configurable:true,writable:true,value:n}):e[t]=n;var R=(e,t,n)=>U(e,t+"",n);var b=typeof GM_getValue<"u"?GM_getValue:void 0,w=typeof GM_info<"u"?GM_info:void 0,W=typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0,$=typeof GM_setValue<"u"?GM_setValue:void 0,Z=typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0,j=typeof GM_xmlhttpRequest<"u"?GM_xmlhttpRequest:void 0,x=typeof unsafeWindow<"u"?unsafeWindow:void 0,H=window;const d={qmsg_config_position:{key:"qmsg-config-position",defaultValue:"bottom"},qmsg_config_maxnums:{key:"qmsg-config-maxnums",defaultValue:3},qmsg_config_showreverse:{key:"qmsg-config-showreverse",defaultValue:false},httpx_cookie_manager_enable:{key:"httpx-use-cookie-enable",defaultValue:false},httpx_cookie_manager_use_document_cookie:{key:"httpx-use-document-cookie",defaultValue:false}};class B{constructor(t){R(this,"$data",{get enable(){return u.getValue(d.httpx_cookie_manager_enable.key,d.httpx_cookie_manager_enable.defaultValue)},get useDocumentCookie(){return u.getValue(d.httpx_cookie_manager_use_document_cookie.key,d.httpx_cookie_manager_use_document_cookie.defaultValue)},cookieRule:[]});Array.isArray(t)&&(this.$data.cookieRule=t);}fixCookieSplit(t){return m.isNotNull(t)&&!t.trim().endsWith(";")&&(t+=";"),t}concatCookie(t,n){return m.isNull(t)?n:(t=t.trim(),n=n.trim(),t=this.fixCookieSplit(t),n.startsWith(";")&&(n=n.substring(1)),t.concat(n))}handle(t){if(t.fetch||!this.$data.enable)return;let n="",o=t.url;o.startsWith("//")&&(o=window.location.protocol+o);let i=new URL(o);this.$data.useDocumentCookie&&i.hostname.endsWith(window.location.hostname.split(".").slice(-2).join("."))&&(n=this.concatCookie(n,document.cookie.trim()));for(let l=0;l<this.$data.cookieRule.length;l++){let a=this.$data.cookieRule[l];if(i.hostname.match(a.hostname)){let s=u.getValue(a.key);if(m.isNull(s))break;n=this.concatCookie(n,s);}}m.isNotNull(n)&&(t.headers&&t.headers.Cookie?t.headers.Cookie=this.concatCookie(t.headers.Cookie,n):t.headers.Cookie=n,p.info(["Httpx => 设置cookie:",t])),t.headers&&t.headers.Cookie!=null&&m.isNull(t.headers.Cookie)&&delete t.headers.Cookie;}}const z=new B([]),K="Demo_Script_Name",m=v.noConflict();O.noConflict();const T=k,p=new m.Log(w,x.console||H.console);var P;const A=((P=w==null?void 0:w.script)==null?void 0:P.name)||K,L=false;p.config({debug:L,logMaxCount:1e3,autoClearConsole:true,tag:true});C.config(Object.defineProperties({html:true,autoClose:true,showClose:false},{position:{get(){return u.getValue(d.qmsg_config_position.key,d.qmsg_config_position.defaultValue)}},maxNums:{get(){return u.getValue(d.qmsg_config_maxnums.key,d.qmsg_config_maxnums.defaultValue)}},showReverse:{get(){return u.getValue(d.qmsg_config_showreverse.key,d.qmsg_config_showreverse.defaultValue)}},zIndex:{get(){let e=v.getMaxZIndex(),t=k.config.InstanceUtils.getPopsMaxZIndex().zIndex;return v.getMaxValue(e,t)+100}}}));T.GlobalConfig.setGlobalConfig({zIndex:()=>{let e=v.getMaxZIndex(void 0,void 0,n=>{var o;if((o=n==null?void 0:n.classList)!=null&&o.contains("qmsg-shadow-container")||n!=null&&n.closest("qmsg")&&n.getRootNode()instanceof ShadowRoot)return  false}),t=k.config.InstanceUtils.getPopsMaxZIndex().zIndex;return v.getMaxValue(e,t)+100},mask:{enable:true,clickEvent:{toClose:false,toHide:false}}});const F=new m.GM_Menu({GM_getValue:b,GM_setValue:$,GM_registerMenuCommand:W,GM_unregisterMenuCommand:Z}),S=new m.Httpx(j);S.interceptors.request.use(e=>(z.handle(e),e));S.interceptors.response.use(void 0,e=>(p.error("拦截器-请求错误",e),e.type==="onabort"?C.warning("请求取消",{consoleLogContent:true}):e.type==="onerror"?C.error("请求异常",{consoleLogContent:true}):e.type==="ontimeout"?C.error("请求超时",{consoleLogContent:true}):C.error("其它错误",{consoleLogContent:true}),e));S.config({logDetails:L});x.Object.defineProperty,x.Function.prototype.apply,x.Function.prototype.call,x.Element.prototype.appendChild,x.setTimeout;m.addStyle.bind(m);document.querySelector.bind(document);document.querySelectorAll.bind(document);const V="GM_Panel",Q="data-init",I="data-key",E="data-default-value",Y="data-init-more-value",y="data-storage-api",D=function(e,t,n,o,i,l){let a={text:e,type:"switch",description:i,attributes:{},props:{},getValue(){return !!this.props[y].get(t,n)},callback(s,r){let g=!!r;p.success(`${g?"开启":"关闭"} ${e}`),this.props[y].set(t,g);},afterAddToUListCallBack:l};return Reflect.set(a.attributes,I,t),Reflect.set(a.attributes,E,n),Reflect.set(a.props,y,{get(s,r){return u.getValue(s,r)},set(s,r){u.setValue(s,r);}}),a},G=function(e,t,n,o,i,l){let a=[];typeof o=="function"?a=o():a=o;let s={text:e,type:"select",description:l,attributes:{},props:{},getValue(){return this.props[y].get(t,n)},callback(r,g,_){let c=g;p.info(`选择：${_}`),this.props[y].set(t,c),typeof i=="function"&&i(r,c,_);},data:a};return Reflect.set(s.attributes,I,t),Reflect.set(s.attributes,E,n),Reflect.set(s.props,y,{get(r,g){return u.getValue(r,g)},set(r,g){u.setValue(r,g);}}),s},J={id:"view-general",title:"通用",forms:[{text:"Toast配置",type:"forms",forms:[G("Toast位置",d.qmsg_config_position.key,d.qmsg_config_position.defaultValue,[{value:"topleft",text:"左上角"},{value:"top",text:"顶部"},{value:"topright",text:"右上角"},{value:"left",text:"左边"},{value:"center",text:"中间"},{value:"right",text:"右边"},{value:"bottomleft",text:"左下角"},{value:"bottom",text:"底部"},{value:"bottomright",text:"右下角"}],(e,t,n)=>{p.info("设置当前Qmsg弹出位置"+n);},"Toast显示在页面九宫格的位置"),G("最多显示的数量",d.qmsg_config_maxnums.key,d.qmsg_config_maxnums.defaultValue,[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"},{value:5,text:"5"}],void 0,"限制Toast显示的数量"),D("逆序弹出",d.qmsg_config_showreverse.key,d.qmsg_config_showreverse.defaultValue,void 0,"修改Toast弹出的顺序")]},{text:"Cookie配置",type:"forms",forms:[D("启用",d.httpx_cookie_manager_enable.key,d.httpx_cookie_manager_enable.defaultValue,void 0,"Api请求时会自动使用下面的Cookie设置"),D("使用document.cookie",d.httpx_cookie_manager_use_document_cookie.key,d.httpx_cookie_manager_use_document_cookie.defaultValue,void 0,"会自动根据请求的域名来使用cookie")]}]},q={setting:{get width(){return window.innerWidth<550?"88vw":"550px"},get height(){return window.innerHeight<450?"70vh":"450px"}}},u={$data:{__data:null,__oneSuccessExecMenu:null,__onceExec:null,__listenData:null,get data(){return u.$data.__data==null&&(u.$data.__data=new m.Dictionary),u.$data.__data},get oneSuccessExecMenu(){return u.$data.__oneSuccessExecMenu==null&&(u.$data.__oneSuccessExecMenu=new m.Dictionary),u.$data.__oneSuccessExecMenu},get onceExec(){return u.$data.__onceExec==null&&(u.$data.__onceExec=new m.Dictionary),u.$data.__onceExec},get scriptName(){return A},key:V,attributeKeyName:I,attributeDefaultValueName:E},$listener:{get listenData(){return u.$data.__listenData==null&&(u.$data.__listenData=new m.Dictionary),u.$data.__listenData}},init(){let e=this.getPanelContentConfig();this.initPanelConfigDefaultValue([...e]),this.registerMenu();},isTopWindow(){return x.top===x.self},registerMenu(){this.isTopWindow()&&F.add([{key:"show_pops_panel_setting",text:"⚙ 设置",autoReload:false,isStoreValue:false,showText(e){return e},callback:()=>{this.showPanel();}}]);},initPanelConfigDefaultValue(e){let t=this;function n(i){if(!i.attributes)return;let l={},a=i.attributes[I];a!=null&&(l[a]=i.attributes[E]);let s=i.attributes[Q];if(typeof s=="function"){let _=s();if(typeof _=="boolean"&&!_)return}let r=i.attributes[Y];r&&typeof r=="object"&&Object.assign(l,r);let g=Object.keys(l);if(!g.length){i.type!=="button"&&p.warn("请先配置键",i);return}g.forEach(_=>{let c=l[_];t.$data.data.has(_)&&p.warn("请检查该key(已存在): "+_),t.$data.data.set(_,c);});}function o(i){for(let l=0;l<i.length;l++){let a=i[l];n(a);let s=a.forms;s&&Array.isArray(s)&&o(s);}}for(let i=0;i<e.length;i++){let l=e[i];if(!l.forms)continue;let a=l.forms;a&&Array.isArray(a)&&o(a);}},setValue(e,t){let n=b(V,{}),o=n[e];n[e]=t,$(V,n),this.$listener.listenData.has(e)&&this.$listener.listenData.get(e).callback(e,o,t);},getValue(e,t){let o=b(V,{})[e];return o??(this.$data.data.has(e)?this.$data.data.get(e):t)},deleteValue(e){let t=b(V,{}),n=t[e];Reflect.deleteProperty(t,e),$(V,t),this.$listener.listenData.has(e)&&this.$listener.listenData.get(e).callback(e,n,void 0);},addValueChangeListener(e,t,n){let o=Math.random();return this.$listener.listenData.set(e,{id:o,key:e,callback:t}),n&&n.immediate&&t(e,this.getValue(e),this.getValue(e)),o},removeValueChangeListener(e){let t=null;for(const[n,o]of this.$listener.listenData.entries())if(o.id===e){t=n;break}typeof t=="string"?this.$listener.listenData.delete(t):console.warn("没有找到对应的监听器");},triggerMenuValueChange(e,t,n){if(this.$listener.listenData.has(e)){let o=this.$listener.listenData.get(e);if(typeof o.callback=="function"){let i=this.getValue(e),l=i,a=i;typeof t<"u"&&arguments.length>1&&(l=t),typeof n<"u"&&arguments.length>2&&(a=n),o.callback(e,a,l);}}},hasKey(e){let t=b(V,{});return e in t},execMenu(e,t,n=false,o){if(!(typeof e=="string"||typeof e=="object"&&Array.isArray(e)))throw new TypeError("key 必须是字符串或者字符串数组");let i=[];typeof e=="object"&&Array.isArray(e)?i=[...e]:i.push(e);let l;for(let a=0;a<i.length;a++){const s=i[a];if(!this.$data.data.has(s)){p.warn(`${e} 键不存在`);return}let r=u.getValue(s);if(n&&(r=!r),typeof o=="function"){let g=o(s,r);typeof g=="boolean"&&(r=g);}if(!r)break;l=r;}l&&t(l);},execMenuOnce(e,t,n,o,i){if(typeof e!="string")throw new TypeError("key 必须是字符串");if(!this.$data.data.has(e)){p.warn(`${e} 键不存在`);return}if(this.$data.oneSuccessExecMenu.has(e))return;this.$data.oneSuccessExecMenu.set(e,1);let l=()=>{let c=u.getValue(e);return typeof n=="function"?n(e,c):c},a=[],s=c=>{let M=l(),f=[];if(c instanceof HTMLStyleElement?f=[c]:Array.isArray(c)&&(f=[...c.filter(h=>h!=null&&h instanceof HTMLStyleElement)]),M)a=a.concat(f);else for(let h=0;h<f.length;h++)f[h].remove(),f.splice(h,1),h--;},r=c=>typeof i=="function"?i(e,c):c,g=c=>{let M=[];if(r(c)){let f=t(c,s);f instanceof HTMLStyleElement?M=[f]:Array.isArray(f)&&(M=[...f.filter(h=>h!=null&&h instanceof HTMLStyleElement)]);}for(let f=0;f<a.length;f++)a[f].remove(),a.splice(f,1),f--;a=[...M];};this.addValueChangeListener(e,(c,M,f)=>{let h=f;typeof o=="function"&&(h=o(c,f,M)),g(h);});let _=l();_&&g(_);},execInheritMenuOnce(e,t,n,o){let i=this;const l=(a,s)=>{let r=i.getValue(a),g=i.getValue(s);if(typeof o=="function"){let _=o(r,g);if(_!=null)return _}return r};this.execMenuOnce(e,n,()=>l(e,t),()=>l(e,t)),this.execMenuOnce(t,()=>{},()=>false,()=>(this.triggerMenuValueChange(e),false));},onceExec(e,t){if(typeof e!="string")throw new TypeError("key 必须是字符串");this.$data.onceExec.has(e)||(t(),this.$data.onceExec.set(e,1));},showPanel(){T.panel({title:{text:`${A}-设置`,position:"center",html:false,style:""},content:this.getPanelContentConfig(),mask:{enable:true,clickEvent:{toClose:true,toHide:false}},zIndex(){let e=v.getMaxZIndex(),t=T.config.InstanceUtils.getPopsMaxZIndex().zIndex;return v.getMaxValue(e,t)+100},width:q.setting.width,height:q.setting.height,drag:true,only:true});},getPanelContentConfig(){return [J]}},X={init(){p.info("demo site init");}};u.init();X.init();

})(Qmsg, DOMUtils, Utils, pops);