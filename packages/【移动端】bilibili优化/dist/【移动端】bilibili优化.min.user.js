// ==UserScript==
// @name         【移动端】bilibili优化
// @namespace    https://github.com/WhiteSevs/TamperMonkeyScript
// @version      2024.6.1.18
// @author       WhiteSevs
// @description  bilibili(哔哩哔哩)优化，免登录等
// @license      GPL-3.0-only
// @icon         https://i0.hdslb.com/bfs/static/jinkela/long/images/512.png
// @supportURL   https://github.com/WhiteSevs/TamperMonkeyScript/issues
// @match        *://m.bilibili.com/*
// @match        *://live.bilibili.com/*
// @require      https://update.greasyfork.org/scripts/494167/1376186/CoverUMD.js
// @require      https://update.greasyfork.org/scripts/456485/1384984/pops.js
// @require      https://cdn.jsdelivr.net/npm/qmsg@1.1.0/dist/index.umd.js
// @require      https://cdn.jsdelivr.net/npm/@whitesev/utils@1.3.1/dist/index.umd.js
// @require      https://cdn.jsdelivr.net/npm/@whitesev/domutils@1.1.0/dist/index.umd.js
// @connect      *
// @connect      m.bilibili.com
// @connect      www.bilibili.com
// @connect      api.bilibili.com
// @grant        GM_addStyle
// @grant        GM_deleteValue
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-start
// ==/UserScript==

(a=>{function e(n){if(typeof n!="string")throw new TypeError("cssText must be a string");let p=document.createElement("style");return p.setAttribute("type","text/css"),p.innerHTML=n,document.head?document.head.appendChild(p):document.body?document.body.appendChild(p):document.documentElement.childNodes.length===0?document.documentElement.appendChild(p):document.documentElement.insertBefore(p,document.documentElement.childNodes[0]),p}if(typeof GM_addStyle=="function"){GM_addStyle(a);return}e(a)})(" .m-video2-awaken-btn,.m-head .launch-app-btn.m-nav-openapp,.m-head .launch-app-btn.home-float-openapp,.m-home .launch-app-btn.home-float-openapp,.m-space .launch-app-btn.m-space-float-openapp,.m-space .launch-app-btn.m-nav-openapp{display:none!important}#app .video .openapp-dialog,#app .video .launch-app-btn.m-video-main-launchapp:has([class^=m-video2-awaken]),#app .video .launch-app-btn.m-nav-openapp,#app .video .mplayer-widescreen-callapp,#app .video .launch-app-btn.m-float-openapp{display:none!important}#app.LIVE .open-app-btn.bili-btn-warp,#app .m-dynamic .launch-app-btn.m-nav-openapp,#app .m-dynamic .dynamic-float-openapp.dynamic-float-btn,#app .m-opus .float-openapp.opus-float-btn,#app .m-opus .v-switcher .launch-app-btn.list-more,#app .m-opus .opus-nav .launch-app-btn.m-nav-openapp,#app .topic-detail .launch-app-btn.m-nav-openapp,#app .topic-detail .launch-app-btn.m-topic-float-openapp{display:none!important} ");

(function (u, L, I) {
	'use strict';

	var M=typeof GM_addStyle<"u"?GM_addStyle:void 0,k=typeof GM_getValue<"u"?GM_getValue:void 0,V=typeof GM_info<"u"?GM_info:void 0,G=typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0,O=typeof GM_setValue<"u"?GM_setValue:void 0,W=typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0,J=typeof GM_xmlhttpRequest<"u"?GM_xmlhttpRequest:void 0,g=typeof unsafeWindow<"u"?unsafeWindow:void 0,P=window;const j="【移动端】bilibili优化",r=L.noConflict(),m=I.noConflict(),H=P.pops||g.pops,o=new r.Log(V,g.console||P.console);var N;const E=((N=V==null?void 0:V.script)==null?void 0:N.name)||j,S=!1;o.config({debug:S,logMaxCount:2e4,autoClearConsole:!0,tag:!0});u.config({position:"bottom",html:!0,maxNums:5,autoClose:!0,showClose:!1,showReverse:!0});const q=new r.GM_Menu({GM_getValue:k,GM_setValue:O,GM_registerMenuCommand:G,GM_unregisterMenuCommand:W}),F=new r.Httpx(J);F.config({logDetails:S,onabort(){u.warning("请求取消");},ontimeout(){u.error("请求超时");},onerror(e){u.error("请求异常"),o.error(["httpx-onerror 请求异常",e]);}});const T={Object:{defineProperty:g.Object.defineProperty},Function:{apply:g.Function.prototype.apply,call:g.Function.prototype.call},Element:{appendChild:g.Element.prototype.appendChild},setTimeout:g.setTimeout},w="GM_Panel",B="data-key",$="data-default-value",c=function(e,i,t,n,l){let s={text:e,type:"switch",description:l,attributes:{},getValue(){return !!a.getValue(i,t)},callback(f,h){o.success(`${h?"开启":"关闭"} ${e}`),a.setValue(i,!!h);},afterAddToUListCallBack:void 0};return s.attributes&&(s.attributes[B]=i,s.attributes[$]=!!t),s},K={id:"panel-common",title:"通用",forms:[{text:"功能",type:"forms",forms:[c("监听路由改变","bili-listenRouterChange",!0,void 0,"用于处理页面跳转时功能不生效问题"),c("新标签页打开","bili-go-to-url-blank",!1,void 0,"通过开启【覆盖点击事件】相关的设置，通过新标签页打开链接")]},{text:"变量设置",type:"forms",forms:[c("isLogin","bili-setLogin",!0,void 0,"设置isLogin为true"),c("isClient","bili-setIsClient",!0,void 0,"设置isClient为true"),c("tinyApp","bili-setTinyApp",!0,void 0,"设置tinyApp为true")]},{text:"劫持/拦截",type:"forms",forms:[c("覆盖.launch-app-btn openApp","bili-overrideLaunchAppBtn_Vue_openApp",!0,void 0,"覆盖.launch-app-btn元素上的openApp函数，可阻止点击唤醒/下载App"),c("劫持setTimeout-autoOpenApp","bili-hookSetTimeout_autoOpenApp",!0,void 0,"阻止自动调用App")]}]},b={isVideo(){return window.location.pathname.startsWith("/video/")},isBangumi(){return window.location.pathname.startsWith("/bangumi/")},isSearch(){return window.location.pathname.startsWith("/search")},isLive(){return window.location.hostname==="live.bilibili.com"},isOpus(){return window.location.pathname.startsWith("/opus")},isTopicDetail(){return window.location.pathname.startsWith("/topic-detail")},isDynamic(){return window.location.pathname.startsWith("/dynamic")}},Y={id:"panel-video",title:"视频",isDefault(){return b.isVideo()},forms:[{text:"功能",type:"forms",forms:[c("修复视频底部区域高度","bili-video-repairVideoBottomAreaHeight",!0,void 0,"添加margin-top"),c("自动点击【继续在网页观看】","bili-video-autoClickContinueToWatchOnTheWebpage",!0,void 0,"可避免弹窗出现且自动点击后播放视频")]},{text:"变量设置",type:"forms",forms:[c("playBtnNoOpenApp","bili-video-setVideoPlayer",!0,void 0,"设置playBtnNoOpenApp为true,playBtnOpenApp为false,coverOpenApp为false")]},{text:"覆盖点击事件",type:"forms",forms:[c("相关视频","bili-video-cover-bottomRecommendVideo",!0,void 0,"点击下面的相关视频可正确跳转至该视频")]},{text:"劫持/拦截",type:"forms",forms:[c("阻止调用App","bili-video-hook-callApp",!0,void 0,"处理函数: PlayerAgent")]}]},Q={id:"panel-bangumi",title:"番剧",isDefault(){return b.isBangumi()},forms:[{text:"变量设置",type:"forms",forms:[c("pay","bili-bangumi-setPay",!0,void 0,"设置pay为1")]},{text:"覆盖点击事件",type:"forms",forms:[c("【选集】","bili-bangumi-cover-clicl-event-chooseEp",!0,void 0,"让【选集】的视频列表可点击跳转"),c("【其它】","bili-bangumi-cover-clicl-event-other",!0,void 0,"让【PV&其他】、【预告】、【主题曲】、【香境剧场】等的视频列表可点击跳转"),c("【更多推荐】","bili-bangumi-cover-clicl-event-recommend",!0,void 0,"让【更多推荐】的视频列表可点击跳转")]},{text:"劫持/拦截",type:"forms",forms:[c("阻止调用App","bili-bangumi-hook-callApp",!0,void 0,"")]}]},z={id:"panel-search",title:"搜索",isDefault(){return b.isSearch()},forms:[{text:"功能",type:"forms",forms:[c("修复点击UP主正确进入空间","bili-search-repair-enter-user-home",!0,void 0,"可以修复点击UP主进入个人空间但是是404问题")]}]},X={id:"panel-live",title:"直播",isDefault(){return b.isLive()},forms:[{text:"屏蔽",type:"forms",forms:[c("【屏蔽】聊天室","bili-live-block-chatRoom",!1,void 0,"直接不显示底部的聊天室"),c("【屏蔽】xxx进入直播间","bili-live-block-brush-prompt",!1,void 0,"直接不显示底部的xxx进入直播间"),c("【屏蔽】控制面板","bili-live-block-control-panel",!1,void 0,"屏蔽底部的发个弹幕、送礼")]},{text:"劫持/拦截",type:"forms",forms:[c("阻止open-app-btn元素点击事件触发","bili-live-prevent-openAppBtn",!0,void 0,"开启后可不跳转至唤醒App页面")]}]},Z={id:"panel-opus",title:"专栏",isDefault(){return b.isOpus()},forms:[{text:"覆盖点击事件",type:"forms",forms:[c("话题","bili-opus-cover-topicJump",!0,void 0,"点击话题正确跳转")]}]},_={id:"panel-dynamic",title:"动态",isDefault(){return b.isDynamic()},forms:[{text:"覆盖点击事件",type:"forms",forms:[c("话题","bili-dynamic-cover-topicJump",!0,void 0,"点击话题正确跳转"),c("header用户","bili-dynamic-cover-header",!0,void 0,"点击内容上的发布本动态的用户正确跳转个人空间"),c("@用户","bili-dynamic-cover-atJump",!0,void 0,"点击@用户正确跳转个人空间"),c("引用","bili-dynamic-cover-referenceJump",!0,void 0,"点击引用的视频|用户正确跳转")]}]},ee={id:"panel-topic-detail",title:"话题",isDefault(){return b.isTopicDetail()},forms:[]},a={$data:{data:new r.Dictionary,oneSuccessExecMenu:new r.Dictionary,onceExec:new r.Dictionary,scriptName:E,key:w,attributeKeyName:B,attributeDefaultValueName:$},$listener:{listenData:new r.Dictionary},init(){this.initPanelDefaultValue(),this.initExtensionsMenu();},initExtensionsMenu(){g.top===g.self&&q.add([{key:"show_pops_panel_setting",text:"⚙ 设置",autoReload:!1,isStoreValue:!1,showText(e){return e},callback:()=>{this.showPanel();}}]);},initPanelDefaultValue(){let e=this;function i(n){if(!n.attributes)return;let l=n.attributes[B],s=n.attributes[$];if(l==null){o.warn(["请先配置键",n]);return}e.$data.data.has(l)&&o.warn("请检查该key(已存在): "+l),e.$data.data.set(l,s);}let t=this.getPanelContentConfig();for(let n=0;n<t.length;n++){let l=t[n];if(!l.forms)continue;let s=l.forms;for(let f=0;f<s.length;f++){let h=s[f];if(h.forms){let v=h.forms;for(let y=0;y<v.length;y++)i(v[y]);}else i(h);}}},setValue(e,i){let t=k(w,{}),n=t[e];t[e]=i,O(w,t),this.$listener.listenData.has(e)&&this.$listener.listenData.get(e).callback(e,n,i);},getValue(e,i){let n=k(w,{})[e];return n??(this.$data.data.has(e)?this.$data.data.get(e):i)},deleteValue(e){let i=k(w,{}),t=i[e];Reflect.deleteProperty(i,e),O(w,i),this.$listener.listenData.has(e)&&this.$listener.listenData.get(e).callback(e,t,void 0);},addValueChangeListener(e,i){let t=Math.random();return this.$listener.listenData.set(e,{id:t,key:e,callback:i}),t},removeValueChangeListener(e){let i=null;for(const[t,n]of this.$listener.listenData.entries())if(n.id===e){i=t;break}this.$listener.listenData.delete(i);},hasKey(e){let i=k(w,{});return e in i},execMenu(e,i){if(typeof e!="string")throw new TypeError("key 必须是字符串");if(!this.$data.data.has(e)){o.warn(`${e} 键不存在`);return}let t=a.getValue(e);t&&i(t);},execMenuOnce(e,i){if(typeof e!="string")throw new TypeError("key 必须是字符串");if(!this.$data.data.has(e)){o.warn(`${e} 键不存在`);return}let t=a.getValue(e);if(t){if(this.$data.oneSuccessExecMenu.has(e))return;i(t),this.$data.oneSuccessExecMenu.set(e,1);}},onceExec(e,i){if(typeof e!="string")throw new TypeError("key 必须是字符串");this.$data.onceExec.has(e)||(i(),this.$data.onceExec.set(e,1));},showPanel(){H.panel({title:{text:`${E}-设置`,position:"center",html:!1,style:""},content:this.getPanelContentConfig(),mask:{enable:!0,clickEvent:{toClose:!0,toHide:!1}},isMobile:this.isMobile(),width:this.getWidth(),height:this.getHeight(),drag:!0,only:!0});},isMobile(){return window.outerWidth<550},getWidth(){return window.outerWidth<550?"92dvw":"550px"},getHeight(){return window.outerHeight>450?"80dvh":"450px"},getPanelContentConfig(){return [K,Y,Z,_,Q,ee,z,X]}},d={getVue(e){return e.__vue__},goToUrl(e){let i=document.querySelector("#app");if(i==null){u.error("跳转Url: 获取根元素#app失败");return}let n=d.getVue(i).$router,l=a.getValue("bili-go-to-url-blank");o.info("即将跳转URL："+e),l?window.open(e,"_blank"):e.startsWith("http")||e.startsWith("//")?window.location.href=e:n.push(e);}},U={$isHook:{windowPlayerAgent:!1,hookWebpackJsonp_openApp:!1,overRideLaunchAppBtn_Vue_openApp:!1},$data:{setTimeout:[]},windowWebPack(e="webpackJsonp",i,t){let n;T.Object.defineProperty(g,e,{get(){return n},set(l){o.success("成功劫持webpack，当前webpack名："+e),n=l;const s=n.push;n.push=function(...f){let h=f[0][0];return (i==h||Array.isArray(i)&&Array.isArray(h)&&JSON.stringify(i)===JSON.stringify(h))&&Object.keys(f[0][1]).forEach(v=>{let y=f[0][1][v];f[0][1][v]=function(...A){let C=y.call(this,...A);return A[0]=t(A[0]),C};}),s.call(this,...f)};}});},windowPlayerAgent(){if(this.$isHook.windowPlayerAgent)return;this.$isHook.windowPlayerAgent=!0;let e;T.Object.defineProperty(g,"PlayerAgent",{get(){return new Proxy({},{get(i,t){return t==="openApp"?function(...n){let l=n[0];o.info(["调用PlayerAgent.openApp",l]);}:e[t]}})},set(i){e=i;}});},setTimeout(e){if(this.$data.setTimeout.push(e),this.$data.setTimeout.length>1){o.info("window.setTimeout hook新增劫持判断参数："+e);return}g.setTimeout=function(...i){let t=i[0].toString();if(t.match(e)){o.success(["劫持setTimeout的函数",t]);return}return T.setTimeout.apply(this,i)};},overRideLaunchAppBtn_Vue_openApp(){if(this.$isHook.overRideLaunchAppBtn_Vue_openApp)return;this.$isHook.overRideLaunchAppBtn_Vue_openApp=!0;function e(i){typeof i.openApp!="function"||i.openApp.toString().includes("阻止唤醒App")||(i.openApp=function(...n){o.success(["openApp：阻止唤醒App",n]);});}r.mutationObserver(document,{config:{subtree:!0,childList:!0,attributes:!0},callback(){document.querySelectorAll(".launch-app-btn").forEach(i=>{let t=d.getVue(i);t&&(e(t),t.$children&&t.$children.length&&t.$children.forEach(n=>{e(n);}));});}});}},te={init(){a.execMenuOnce("bili-video-hook-callApp",()=>{o.info("hook window.PlayerAgent"),U.windowPlayerAgent();});}},D={getUserSpaceUrl(e){return `https://space.bilibili.com/${e}`},getUserSpaceDynamicUrl(e){return this.getUserSpaceUrl(e)+"/dynamic"},getVideoUrl(e){return `https://www.bilibili.com/video/${e}`}},p={className:{bangumi:"#app.main-container",dynamic:"#app .m-dynamic",opus:"#app .m-opus",search:"#app .m-search","topic-detail":"#app .topic-detail",video:"#app .video"}},ie={init(){te.init(),a.execMenu("bili-video-setVideoPlayer",()=>{this.setVideoPlayer();}),a.execMenuOnce("bili-video-repairVideoBottomAreaHeight",()=>{this.repairVideoBottomAreaHeight();}),a.execMenuOnce("bili-video-autoClickContinueToWatchOnTheWebpage",()=>{this.autoClickContinueToWatchOnTheWebpage();}),a.execMenuOnce("bili-video-cover-bottomRecommendVideo",()=>{this.coverBottomRecommendVideo();});},setVideoPlayer(){r.waitNode(p.className.video+" .m-video-player").then(e=>{let i=function(t){return t!=null&&typeof t.playBtnNoOpenApp=="boolean"&&typeof t.playBtnOpenApp=="boolean"&&typeof t.coverOpenApp=="boolean"};r.waitVueByInterval(()=>document.querySelector(".m-video-player"),i,250,1e4).then(()=>{e=document.querySelector(".m-video-player"),i(e.__vue__)&&(o.success("成功设置参数 playBtnNoOpenApp、playBtnOpenApp、coverOpenApp"),e.__vue__.playBtnNoOpenApp=!0,e.__vue__.playBtnOpenApp=!1,e.__vue__.coverOpenApp=!1);});});},repairVideoBottomAreaHeight(){o.info("修复视频底部区域高度"),M(`
		${p.className.video} {
			/* 修复视频区域底部的高度 */
			.natural-module .fixed-module-margin {
				margin-top: 55.13333vmin;
			}
			/* 点击播放视频后的 */
			.m-video-new:has(> div > .m-video-player) {
				margin-top: 75vmin;
			}
			/* 未播放视频状态下的 */
			.m-video-new:has(> div[style*="display:none"] > .m-video-player) {
				margin-top: unset;
			}
		}
		html.tiny-app{
			${p.className.video}{
				.m-video-info-new{
					margin-top: 72vmin;
				}
			}
		}
		`);},autoClickContinueToWatchOnTheWebpage(){m.on(document,"click",p.className.video+" .main-info .btn",function(){o.info("触发点击【立即播放】，自动等待弹窗出现"),r.waitNode(".to-see",1e4).then(e=>{if(!e){o.error("弹窗按钮【继续在网页观看】10秒内未出现，取消等待");return}o.success("自动点击 继续在网页观看"),e.click();});});},coverBottomRecommendVideo(){o.info("覆盖 相关视频 点击事件"),m.on(document,"click",p.className.video+" .list-view .card-box .launch-app-btn",function(e){let i=e.target,t=d.getVue(i);if(!t){u.error("获取相关视频的__vue__失败");return}let n=t.bvid;if(r.isNull(n))if(t.$children&&t.$children[0]&&r.isNotNull(t.$children[0].bvid))n=t.$children[0].bvid;else {u.error("获取相关视频的bvid失败");return}o.info("相关视频的bvid: "+n),d.goToUrl(D.getVideoUrl(n)),r.preventEvent(e);},{capture:!0});}},x={getUrl(e){if(e!=null)return e.getAttribute("universallink")},jumpToUrl(e){let t=e.target.querySelector("bili-open-app");if(t){let n=x.getUrl(t);n?d.goToUrl(n):(u.error("获取bili-open-app的Url失败"),o.error("获取bili-open-app的Url失败"));}else u.error("未获取到<bili-open-app>元素"),o.error("未获取到<bili-open-app>元素");}},ne={init(){a.execMenuOnce("bili-bangumi-hook-callApp",()=>{this.hookCallApp();}),a.execMenu("bili-bangumi-setPay",()=>{this.setPay();}),a.execMenu("bili-bangumi-cover-clicl-event-chooseEp",()=>{this.setChooseEpClickEvent();}),a.execMenu("bili-bangumi-cover-clicl-event-other",()=>{this.setClickOtherVideo();}),a.execMenu("bili-bangumi-cover-clicl-event-recommend",()=>{this.setRecommendClickEvent();});},hookCallApp(){let e=g.setTimeout;g.setTimeout=function(...i){if(i[0].toString().includes("autoOpenApp")){o.success(["阻止唤醒App",i]);return}return e.apply(this,i)};},setPay(){r.waitNode("#app").then(e=>{let i=function(t){var n,l,s;return t!=null&&typeof((s=(l=(n=t==null?void 0:t.$store)==null?void 0:n.state)==null?void 0:l.userStat)==null?void 0:s.pay)=="number"};r.waitVueByInterval(e,i,250,1e4).then(()=>{let t=d.getVue(e);i(t)&&(o.success("成功设置参数 pay"),t.$store.state.userStat.pay=1);});});},setChooseEpClickEvent(){r.waitNode(p.className.bangumi+" .ep-list-pre-wrapper ul.ep-list-pre-container").then(e=>{o.info("覆盖【选集】的点击事件"),m.on(e,"click","li.episode-item",function(i){r.preventEvent(i),x.jumpToUrl(i);},{capture:!0});}),r.waitNode(p.className.bangumi+" .ep-list-pre-wrapper ul.season-list-wrapper").then(e=>{o.info("覆盖【xx季】的点击事件"),m.on(e,"click","li",function(i){r.preventEvent(i),x.jumpToUrl(i);},{capture:!0});}),r.waitNode(p.className.bangumi+" .ep-list-pre-header").then(e=>{o.info("覆盖【选集】右上角的【全xx话】Arrow的点击事件"),m.on(e,"click",function(i){r.preventEvent(i);},{capture:!0});});},setClickOtherVideo(){r.waitNode(p.className.bangumi+" .section-preview-wrapper ul.ep-list-pre-container").then(e=>{o.info("覆盖【PV&其他】、【预告】、【主题曲】的点击事件"),m.on(e,"click","li.section-preview-item",function(i){r.preventEvent(i),x.jumpToUrl(i);},{capture:!0});}),r.waitNode(p.className.bangumi+" .section-preview-header").then(e=>{o.info("覆盖【PV&其他】、【预告】、【主题曲】右上角的Arrow的点击事件"),m.on(e,"click",function(i){r.preventEvent(i);},{capture:!0});});},setRecommendClickEvent(){r.waitNode(p.className.bangumi+" .recom-wrapper ul.recom-list").then(e=>{o.info("覆盖【更多推荐】番剧的点击事件"),m.on(e,"click","li.recom-item-v2",function(i){r.preventEvent(i),x.jumpToUrl(i);},{capture:!0});});}},oe={init(){a.execMenuOnce("bili-search-repair-enter-user-home",()=>{this.repairEnterUserHome();});},repairEnterUserHome(){r.waitNode(p.className.search+" .result-panel").then(e=>{o.info("修复点击UP主正确进入空间"),m.on(e,"click","a.m-search-user-item[href]",function(i){r.preventEvent(i);let n=i.target.href;o.success("链接跳转: "+n),window.location.href=n;},{capture:!0});});}},re={init(){a.execMenuOnce("bili-live-prevent-openAppBtn",()=>{this.preventOpenAppBtn();}),a.execMenuOnce("bili-live-block-chatRoom",()=>{this.blockChatRoom();}),a.execMenuOnce("bili-live-block-brush-prompt",()=>{this.blockBrushPrompt();}),a.execMenuOnce("bili-live-block-control-panel",()=>{this.blockControlPanel();});},preventOpenAppBtn(){r.waitNode("body").then(e=>{o.info("阻止.open-app-btn元素触发点击事件"),m.on(e,"click",".open-app-btn",function(i){r.preventEvent(i);},{capture:!0}),m.on(e,"click","#web-player-controller-wrap-el",function(i){r.preventEvent(i);},{capture:!0});});},blockChatRoom(){o.info("屏蔽聊天室"),M(`
        #chat-items{
            display: none !important;
        }
        `);},blockBrushPrompt(){o.info("屏蔽xxx进入直播间"),M(`
        #brush-prompt{
            display: none !important;
        }
        `);},blockControlPanel(){o.info("屏蔽底部工具栏"),M(`
        .control-panel{
            display: none !important;
        }`);}},le={init(){a.execMenuOnce("bili-opus-cover-topicJump",()=>{this.coverTopicJump();});},coverTopicJump(){o.info("覆盖话题跳转点击事件"),m.on(document,"click",p.className.opus+" .launch-app-btn.opus-module-topic",function(e){var s;let i=e.target,t=d.getVue(i);if(!t){u.error("获取话题的__vue__失败");return}let n=(s=t==null?void 0:t.$props)==null?void 0:s.data,l=n==null?void 0:n.jump_url;if(r.isNull(l)){u.error("获取话题的jump_url失败");return}o.info(["话题的跳转信息: ",n]),d.goToUrl(l);},{capture:!0});}},ae={init(){a.execMenuOnce("bili-dynamic-cover-topicJump",()=>{this.coverTopicJump();}),a.execMenuOnce("bili-dynamic-cover-atJump",()=>{this.coverAtJump();}),a.execMenuOnce("bili-dynamic-cover-referenceJump",()=>{this.coverReferenceJump();}),a.execMenuOnce("bili-dynamic-cover-header",()=>{this.coverHeaderJump();});},coverHeaderJump(){o.info("覆盖header点击事件"),m.on(document,"click",p.className.dynamic+" .launch-app-btn .dyn-header",function(e){r.preventEvent(e);let i=e.target,t=d.getVue(i);if(!t){u.error("获取vue属性失败");return}let n=t.url;if(!n){u.error("获取url失败");return}d.goToUrl(n);},{capture:!0});},coverTopicJump(){o.info("覆盖话题跳转点击事件"),m.on(document,"click",p.className.dynamic+" .launch-app-btn .bili-dyn-topic",function(e){var s;r.preventEvent(e);let i=e.target,t=d.getVue(i);if(!t){u.error("获取vue属性失败");return}let n=(s=t==null?void 0:t.$props)==null?void 0:s.data,l=n==null?void 0:n.jump_url;if(r.isNull(l)){u.error("获取jump_url失败");return}o.info(["话题的跳转信息: ",n]),d.goToUrl(l);},{capture:!0});},coverAtJump(){o.info("覆盖@ 跳转"),m.on(document,"click",p.className.dynamic+" .at",function(e){var n,l;r.preventEvent(e);let i=e.target,t=i.getAttribute("data-oid")||((l=(n=d.getVue(i))==null?void 0:n.$props)==null?void 0:l.rid);if(r.isNull(t)){u.error("获取data-oid或rid失败");return}o.info("用户的oid: "+t),d.goToUrl(D.getUserSpaceDynamicUrl(t));},{capture:!0});},coverReferenceJump(){o.info("覆盖引用的点击事件"),m.on(document,"click",p.className.dynamic+" .dyn-content .reference .dyn-orig-author",function(e){r.preventEvent(e);let t=e.target.getAttribute("data-url");if(!t){u.error("获取data-url失败");return}d.goToUrl(t);},{capture:!0}),m.on(document,"click",p.className.dynamic+" .dyn-content .reference .dyn-archive",function(e){var l;r.preventEvent(e);let i=e.target,t=d.getVue(i);if(!t){u.error("获取vue属性失败");return}let n=(l=t==null?void 0:t.data)==null?void 0:l.jump_url;if(r.isNull(n)){u.error("获取jump_url失败");return}d.goToUrl(n);},{capture:!0});}},R={init(){a.execMenu("bili-setLogin",()=>{this.setLogin();}),a.execMenu("bili-setIsClient",()=>{this.setIsClient();}),a.execMenu("bili-setTinyApp",()=>{this.setTinyApp();}),a.execMenuOnce("bili-listenRouterChange",()=>{this.listenRouterChange();}),a.execMenuOnce("bili-hookSetTimeout_autoOpenApp",()=>{o.info("hook  window.setTimeout autoOpenApp"),U.setTimeout("autoOpenApp");}),a.execMenuOnce("bili-overrideLaunchAppBtn_Vue_openApp",()=>{o.info("覆盖元素.launch-app-btn上的openApp"),U.overRideLaunchAppBtn_Vue_openApp();}),b.isVideo()?(o.info("Router: 视频稿件"),ie.init()):b.isOpus()?(o.info("Router: 专栏稿件"),le.init()):b.isDynamic()?(o.info("Router: 动态"),ae.init()):b.isBangumi()?(o.info("Router: 番剧"),ne.init()):b.isSearch()?(o.info("Router: 搜索"),oe.init()):b.isLive()?(o.info("Router: 直播"),re.init()):b.isTopicDetail()?o.info("Router: 话题"):o.error("该Router暂未适配");},setLogin(){r.waitNode("#app").then(e=>{let i=function(t){var n,l,s,f,h,v,y;return t!=null&&typeof((s=(l=(n=t==null?void 0:t.$store)==null?void 0:n.state)==null?void 0:l.common)==null?void 0:s.noCallApp)=="boolean"&&typeof((y=(v=(h=(f=t==null?void 0:t.$store)==null?void 0:f.state)==null?void 0:h.common)==null?void 0:v.userInfo)==null?void 0:y.isLogin)=="boolean"};r.waitVueByInterval(e,i,250,1e4).then(()=>{i(e.__vue__)&&(o.success("成功设置参数 noCallApp isLogin"),e.__vue__.$store.state.common.noCallApp=!0,e.__vue__.$store.state.common.userInfo.isLogin=!0);});});},setIsClient(){r.waitNode("#app").then(e=>{let i=function(t){var n,l,s,f,h,v,y,A,C;return t!=null&&typeof((s=(l=(n=t==null?void 0:t.$store)==null?void 0:n.state)==null?void 0:l.video)==null?void 0:s.isClient)=="boolean"&&typeof((v=(h=(f=t==null?void 0:t.$store)==null?void 0:f.state)==null?void 0:h.opus)==null?void 0:v.isClient)=="boolean"&&typeof((C=(A=(y=t==null?void 0:t.$store)==null?void 0:y.state)==null?void 0:A.playlist)==null?void 0:C.isClient)=="boolean"};r.waitVueByInterval(e,i,250,1e4).then(()=>{i(e.__vue__)&&(e.__vue__.$store.state.video.isClient=!0,e.__vue__.$store.state.opus.isClient=!0,e.__vue__.$store.state.playlist.isClient=!0);});});},setTinyApp(){r.waitNode("#app").then(e=>{let i=function(t){var n,l,s;return typeof((s=(l=(n=t==null?void 0:t.$store)==null?void 0:n.state)==null?void 0:l.common)==null?void 0:s.tinyApp)=="boolean"};r.waitVueByInterval(e,i,250,1e4).then(()=>{i(e.__vue__)&&(e.__vue__.$store.state.common.tinyApp=!0,o.success("成功设置参数 tinyApp"),setTimeout(()=>{if(!document.querySelector("#bilibiliPlayer video")){let t=function(n){return typeof(n==null?void 0:n.initPlayer)=="function"};r.waitNode(".m-video-player").then(n=>{r.waitVueByInterval(n,t,250,1e4).then(()=>{t(n.__vue__)&&(o.success("成功调用函数 initPlayer()"),n.__vue__.initPlayer());});});}},2e3));});});},listenRouterChange(){r.waitNode("#app").then(e=>{let i=function(t){var n;return typeof((n=t==null?void 0:t.$router)==null?void 0:n.afterEach)=="function"};r.waitVueByInterval(e,i).then(()=>{i(e.__vue__)&&(o.success("成功设置监听路由变化"),e.__vue__.$router.afterEach((t,n)=>{o.success(["路由变化",[t,n]]),R.init();}));});});}};a.init();R.init();

})(Qmsg, Utils, DOMUtils);