// ==UserScript==
// @name         抖音优化
// @namespace    https://github.com/WhiteSevs/TamperMonkeyScript
// @version      2024.5.14.11
// @author       WhiteSevs
// @description  过滤广告、过滤直播、可自定义过滤视频的屏蔽关键字、伪装登录、直播屏蔽弹幕、礼物特效等
// @license      GPL-3.0-only
// @icon         data:image/png;base64,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
// @supportURL   https://github.com/WhiteSevs/TamperMonkeyScript/issues
// @match        *://*.douyin.com/*
// @require      https://update.greasyfork.org/scripts/462234/1322684/Message.js
// @require      https://update.greasyfork.org/scripts/456485/1371568/pops.js
// @require      https://update.greasyfork.org/scripts/455186/1375312/WhiteSevsUtils.js
// @require      https://update.greasyfork.org/scripts/465772/1360574/DOMUtils.js
// @grant        GM_addStyle
// @grant        GM_deleteValue
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-start
// ==/UserScript==

(function () {
  'use strict';

  var ce=(e,i,t)=>{if(!i.has(e))throw TypeError("Cannot "+t)};var b=(e,i,t)=>(ce(e,i,"read from private field"),t?t.call(e):i.get(e)),$=(e,i,t)=>{if(i.has(e))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(e):i.set(e,t);},I=(e,i,t,a)=>(ce(e,i,"write to private field"),i.set(e,t),t);var w=typeof GM_addStyle<"u"?GM_addStyle:void 0,_=typeof GM_getValue<"u"?GM_getValue:void 0,L=typeof GM_info<"u"?GM_info:void 0,Se=typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0,k=typeof GM_setValue<"u"?GM_setValue:void 0,xe=typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0,y=typeof unsafeWindow<"u"?unsafeWindow:void 0,D=window;const Ce="抖音优化",f=(D.Utils||y.Utils).noConflict(),x=(D.DOMUtils||y.DOMUtils).noConflict(),ye=D.pops||y.pops,V=D.Qmsg||y.Qmsg,_e=y.console||D.console,h=new f.Log(L,_e);var ve;const he=((ve=L==null?void 0:L.script)==null?void 0:ve.name)||Ce;h.config({debug:!1,logMaxCount:100,autoClearConsole:!0,tag:!0});V.config({position:"bottom",html:!0,maxNums:5,autoClose:!0,showClose:!1,showReverse:!0});const we=new f.GM_Menu({GM_getValue:_,GM_setValue:k,GM_registerMenuCommand:Se,GM_unregisterMenuCommand:xe}),T="GM_Panel",A="data-key",P="data-default-value",u=function(e,i,t,a,l){let o={text:e,type:"switch",description:i,attributes:{},getValue(){return !!s.getValue(t,a)},callback(d,r){h.success(`${r?"开启":"关闭"} ${e}`),s.setValue(t,!!r);},afterAddToUListCallBack:void 0};return o.attributes&&(o.attributes[A]=t,o.attributes[P]=!!a),o},be={id:"panel-config-common",title:"通用",forms:[{text:"功能",type:"forms",forms:[u("debug模式","移除抖音的开发者模式检测","debug",!1),u("伪装登录","使用随机UID进行伪装","disguiseLogin",!1)]},{text:"Url重定向",type:"forms",forms:[u("重定向/home","/home => /","douyin-redirect-url-home-to-root",!1)]},{text:"屏蔽",type:"forms",forms:[u("【屏蔽】登录弹窗","屏蔽元素且自动等待元素出现并关闭登录弹窗","watchLoginDialogToClose",!0)]},{text:"主框架-屏蔽",type:"forms",forms:[u("【屏蔽】客户端提示","屏蔽元素","shieldClientTip",!0),u("【屏蔽】充砖石","屏蔽元素","shieldFillingBricksAndStones",!1),u("【屏蔽】客户端","屏蔽元素","shieldClient",!1),u("【屏蔽】快捷访问","屏蔽元素","shieldQuickAccess",!1),u("【屏蔽】通知","屏蔽元素","shieldNotifitation",!1),u("【屏蔽】私信","屏蔽元素","shieldPrivateMessage",!1),u("【屏蔽】投稿","屏蔽元素","shieldSubmission",!1),u("【屏蔽】左侧导航栏","屏蔽元素","douyin-shieldLeftNavigator",!1),u("【屏蔽】顶部导航栏","屏蔽元素","douyin-shieldTopNavigator",!1)]},{text:"搜索-屏蔽",type:"forms",forms:[u("【屏蔽】搜索框","屏蔽元素","shieldSearch",!1),u("【屏蔽】搜索框的提示","屏蔽元素","shieldSearchPlaceholder",!1),u("【屏蔽】猜你想搜","屏蔽元素","shieldSearchGuessYouWantToSearch",!1),u("【屏蔽】抖音热点","屏蔽元素","shieldSearchTiktokHotspot",!1)]}]},c={watchVideDataListChange(e){x.ready(()=>{f.waitAnyNode("#slidelist").then(i=>{let t=this.getOSElement();f.mutationObserver(i,{config:{childList:!0,subtree:!0,attributes:!0},callback:()=>{e(t);}});});});},getOSElement(){return document.querySelector("#root div[class*='-os']")||document.querySelector("#douyin-right-container")},addShieldStyle(...e){let i=[];if(arguments.length===0){console.log(arguments);return}if(arguments.length>1){this.addShieldStyle(Array.from(arguments));return}if(typeof e=="string"){this.addShieldStyle([e]);return}e.forEach(t=>{Array.isArray(t)?i=[...i,...t]:i.push(t);}),w(`${i.join(",")}{
          display: none !important;
          }`);}},N={key:"douyin-live-danmu-rule",$data:{rule:[],isFilterAttrName:"data-is-filter"},init(){this.parseRule();},parseRule(){this.get().trim().split(`
`).forEach(t=>{if(t.trim()=="")return;t=t.trim();let a=new RegExp(t.trim());this.$data.rule.push(a);});},change(){var i,t,a,l,o,d,r;let e=Array.from(document.querySelectorAll("xg-danmu.xgplayer-danmu > div > div"));if(e.length)for(let n=0;n<e.length;n++){let m=e[n];if(m.hasAttribute(this.$data.isFilterAttrName))continue;let p=(l=(a=(t=(i=f.getReactObj(m))==null?void 0:i.reactFiber)==null?void 0:t.return)==null?void 0:a.memoizedProps)==null?void 0:l.message,g=((o=p==null?void 0:p.payload)==null?void 0:o.content)||((r=(d=p==null?void 0:p.payload)==null?void 0:d.common)==null?void 0:r.describe);for(let v=0;v<this.$data.rule.length;v++){const B=this.$data.rule[v];if(typeof g=="string"&&B.test(g)){h.info("过滤弹幕: "+g),m.setAttribute(this.$data.isFilterAttrName,"true"),x.hide(m);break}}}},set(e){k(this.key,e);},get(){return _(this.key,"")}},fe={shieldDanmu(){h.success("屏蔽弹幕"),c.addShieldStyle("xg-danmu.xgplayer-danmu");},filterDanmu(){f.waitNodeWithInterval("xg-danmu.xgplayer-danmu",1e5).then(e=>{h.success("弹幕过滤"),N.init(),f.mutationObserver(e,{config:{childList:!0,subtree:!0},callback:()=>{N.change();}});});}},R={isLive(){return window.location.hostname==="live.douyin.com"},isVideo(){return window.location.hostname==="www.douyin.com"}},Me={id:"panel-config-live",title:"直播",isDefault(){return R.isLive()},forms:[{text:"功能",type:"forms",forms:[u("自动进入网页全屏","网页加载完毕后自动点击网页全屏按钮进入全屏","live-autoEnterElementFullScreen",!1),u("解锁画质选择","未登录的情况下选择原画实际上是未登录的情况下最高选择的画质","live-unlockImageQuality",!0)]},{text:"视频区域内-屏蔽",type:"forms",forms:[u("【屏蔽】顶栏信息","屏蔽元素，包括直播作者、右侧的礼物展馆","live-shieldTopToolBarInfo",!1),u("【屏蔽】底部？按钮","屏蔽元素","live-shieldBottomQuestionButton",!0),u("【屏蔽】底部的礼物栏","屏蔽元素","live-shieldGiftColumn",!1),u("【屏蔽】礼物特效","屏蔽元素","live-shieldGiftEffects",!1),u("【屏蔽】弹幕","屏蔽元素","live-shieldDanmuku",!1)]},{text:"聊天室-屏蔽",type:"forms",forms:[u("【屏蔽】聊天室","屏蔽元素","live-shieldChatRoom",!1),u("【屏蔽】贵宾席","屏蔽元素","live-shielChatRoomVipSeats",!1)]},{text:"弹幕屏蔽规则(可正则)",type:"forms",forms:[u("启用","启用弹幕屏蔽规则","live-danmu-shield-rule-enable",!1),{type:"own",getLiElementCallBack(e){let i=x.createElement("div",{className:"pops-panel-textarea",innerHTML:'<textarea placeholder="请输入屏蔽规则，每行一个" style="height:350px;"></textarea>'},{style:"width: 100%;"}),t=i.querySelector("textarea");return t.value=N.get(),x.on(t,["input","propertychange"],f.debounce(function(){N.set(t.value);},200)),e.appendChild(i),e}}]}]},Ve=function(e,i,t,a,l,o){let d=[];typeof a=="function"?d=a():d=a;let r={text:e,type:"select",description:o,attributes:{},getValue(){return s.getValue(i,t)},callback(n,m,p){s.setValue(i,m);},data:d};return r.attributes&&(r.attributes[A]=i,r.attributes[P]=!!t),r},G={key:"douyin-shield-rule",$data:{rule:new f.Dictionary},init(){this.parseRule(),h.info(["当前自定义视频拦截规则: ",this.$data.rule.getItems()]),c.watchVideDataListChange(e=>{var l;let i=document.querySelector('#slidelist div[data-e2e="slideList"]');if(!i){h.error("未获取到视频列表元素");return}let t=(l=f.getReactObj(i))==null?void 0:l.reactFiber;if(t==null){h.error(["元素上不存在reactFiber属性",i]);return}let a=t==null?void 0:t.return.memoizedProps.data;for(let o=0;o<a.length;o++){let d=a[o],r=this.getVideoInfoTagMap(d),n=!1;if(n||typeof d.cellRoom=="object"&&s.getValue("shieldVideo-live")&&(h.success(["屏蔽直播",d.cellRoom]),n=!0),n||d.isAds&&s.getValue("shieldVideo-ads")&&(h.success(["屏蔽广告",d.isAds]),n=!0),!n)for(const[m,p]of this.$data.rule.entries()){if(!(m in r))continue;let g=r[m];if(g!=null){if(typeof g=="string"){if(n=!!g.match(p),n){h.success(["自定义屏蔽: "+m+"  "+p,r]);break}}else if(typeof g=="object"&&Array.isArray(g)&&g.find(B=>!!B.match(p))){n=!0,h.success(["自定义屏蔽: "+m+"  "+p,r]);break}}}n&&(a.splice(o,1),o--);}});},getVideoInfoTagMap(e){var d,r,n,m,p,g;let i=(r=(d=e==null?void 0:e.authorInfo)==null?void 0:d.nickname)==null?void 0:r.toString(),t=(m=(n=e==null?void 0:e.authorInfo)==null?void 0:n.uid)==null?void 0:m.toString(),a=(p=e==null?void 0:e.desc)==null?void 0:p.toString(),l=[];typeof(e==null?void 0:e.textExtra)=="object"&&Array.isArray(e==null?void 0:e.textExtra)&&((g=e==null?void 0:e.textExtra)==null||g.forEach(v=>{l.push(v.hashtagName);}));let o=[];return typeof(e==null?void 0:e.videoTag)=="object"&&Array.isArray(e==null?void 0:e.videoTag)&&(e==null||e.videoTag.forEach(v=>{o.push(v.tagName);})),{nickname:i,uid:t,desc:a,textExtra:l,videoTag:o}},parseRule(){this.get().trim().split(`
`).forEach(t=>{if(f.isNull(t))return;let l=t.trim().split("##");if(l.length<2)return;let o=l[0];l.shift();let d=l.join("");try{let r=new RegExp(d,"g");this.$data.rule.set(o,r);}catch(r){h.error(["自定义视频过滤规则-正则解析错误："+r]),h.error("错误的规则："+t);}});},set(e){k(this.key,e);},get(){return _(this.key,"")}},me=function(e,i,t,a,l,o,d,r){return {text:e,type:"button",description:i,buttonIcon:a,buttonIsRightIcon:l,buttonIconIsLoading:o,buttonType:d,buttonText:t,callback(m){typeof r=="function"&&r(m);},afterAddToUListCallBack:void 0}};var C,M;class ke{constructor(i){$(this,C,"short-cut");$(this,M,!1);typeof i=="string"&&I(this,C,i);}getValue(i,t){let a=_(b(this,C),[]);return i?a.find(o=>o.key===i)??t:a}setValue(i,t,a,l){let o=_(b(this,C),[]);o.push({key:i,value:{keyName:t,keyValue:a,ohterCodeList:l}}),k(b(this,C),o);}deleteValue(i){let t=!1,a=_(b(this,C),[]),l=a.findIndex(o=>o.key===i);return l!==-1&&(a.splice(l,1),t=!0),k(b(this,C),a),t}getShowText(i,t){let a=this.getValue(i);if(a){let l="";return a.value.ohterCodeList.forEach(o=>{a.key===i&&(l+=f.stringTitleToUpperCase(o,!0)+" + ");}),l+=a.value.keyName,l}else return t}inputShortCut(i,t,a){if((this.getValue(i)??t)===t){let o=V.loading("请按下快捷键...",{showClose:!0,onClose(){d.removeListen();}});I(this,M,!0);let d=f.listenKeyboard(window,"keyup",(r,n,m)=>{let p=JSON.stringify({keyName:r,keyValue:n,ohterCodeList:m}),g=this.getValue();for(let v=0;v<g.length;v++)if(p===JSON.stringify(g[v].value)){V.error(`快捷键 ${this.getShowText(g[v].key,r)} 已被占用`),I(this,M,!1),o.close();return}this.setValue(i,r,n,m),typeof a=="function"&&a(this.getShowText(i,t)),I(this,M,!1),o.close();});}else this.deleteValue(i);typeof a=="function"&&a(this.getShowText(i,t));}initGlobalKeyboardListener(i){let t=this.getValue();t.length&&f.listenKeyboard(window,"keydown",(a,l,o)=>{if(b(this,M))return;t=this.getValue();let d=t.findIndex(r=>{let n=r.value,m={keyName:a,keyValue:l,ohterCodeList:o};if(JSON.stringify(n)===JSON.stringify(m))return r});if(d!=-1){let r=t[d];h.info(["调用快捷键",r]),r.key in i&&i[r.key].callback();}});}}C=new WeakMap,M=new WeakMap;const pe={init(){s.execMenu("shieldRightExpandCommentButton",()=>{this.shieldRightExpandCommentButton();}),s.execMenu("shieldSearchFloatingBar",()=>{this.shieldSearchFloatingBar();}),s.execMenu("shieldCloseFullScreenButton",()=>{this.shieldCloseFullScreenButton();}),s.execMenu("shieldPlaySwitchButton",()=>{this.shieldPlaySwitchButton();}),s.execMenu("shieldAuthorAvatar",()=>{this.shieldAuthorAvatar();}),s.execMenu("shieldLikeButton",()=>{this.shieldLikeButton();}),s.execMenu("shieldCommentButton",()=>{this.shieldCommentButton();}),s.execMenu("shieldCollectionButton",()=>{this.shieldCollectionButton();}),s.execMenu("shieldSharenButton",()=>{this.shieldSharenButton();}),s.execMenu("shieldRelatedRecommendationsButton",()=>{this.shieldRelatedRecommendationsButton();}),s.execMenu("shieldMoreButton",()=>{this.shieldMoreButton();}),s.execMenu("shieldBottomVideoToolBar",()=>{this.shieldBottomVideoToolBar();}),s.execMenu("douyin-shieldLeftNavigator",()=>{this.shieldLeftNavigator();}),s.execMenu("douyin-shieldTopNavigator",()=>{this.shieldTopNavigator();});},shieldRightExpandCommentButton(){c.addShieldStyle('#sliderVideo[data-e2e="feed-active-video"] > div > div > button[type="button"]','.playerContainer button[type=button] svg > g[filter] > path[d="M21.316 29.73a1.393 1.393 0 01-1.97 0l-5.056-5.055a1.393 1.393 0 010-1.97l.012-.011 5.044-5.045a1.393 1.393 0 011.97 1.97l-4.07 4.071 4.07 4.071a1.393 1.393 0 010 1.97z"]'),w(`
		.basePlayerContainer .positionBox{
			padding-right: 20px !important;
		}
    	`);},shieldSearchFloatingBar(){c.addShieldStyle('.slider-video div:has([data-e2e="searchbar-button"])','div:has(>div > svg[class] >  defs [d="M0 0h24v24H0z"]','div[data-e2e="feed-active-video"] + div:has(>div>div>div > input[data-e2e="searchbar-input"])',"#slideMode + div");},shieldCloseFullScreenButton(){c.addShieldStyle('#sliderVideo[data-e2e="feed-active-video"] div.slider-video > div:has(path[d="M17.448 17.448a1.886 1.886 0 01-2.668 0L9 11.668l-5.78 5.78A1.886 1.886 0 11.552 14.78L6.332 9 .552 3.22A1.886 1.886 0 113.22.552L9 6.332l5.78-5.78a1.886 1.886 0 112.668 2.668L11.668 9l5.78 5.78a1.886 1.886 0 010 2.668z"])');},shieldPlaySwitchButton(){c.addShieldStyle('.positionBox  .xgplayer-playswitch[data-state="normal"]',"div.xgplayer-playswitch");},shieldAuthorAvatar(){c.addShieldStyle('div.dy-tip-container:has([data-e2e="video-avatar"])');},shieldLikeButton(){c.addShieldStyle('div.dy-tip-container:has([data-e2e="video-player-digg"])');},shieldCommentButton(){c.addShieldStyle('div.dy-tip-container:has([data-e2e="feed-comment-icon"])');},shieldCollectionButton(){c.addShieldStyle('div.dy-tip-container:has([data-e2e="video-player-collect"])');},shieldSharenButton(){c.addShieldStyle('div.dy-tip-container:has([data-e2e="video-player-share"])');},shieldRelatedRecommendationsButton(){c.addShieldStyle('div.dy-tip-container:has(path[d="M14 8a8 8 0 00-8 8v4a8 8 0 008 8h8a8 8 0 008-8v-4a8 8 0 00-8-8h-8zm8.5 10.866a1 1 0 000-1.732l-6-3.464a1 1 0 00-1.5.866v6.928a1 1 0 001.5.866l6-3.464z"])','div.dy-tip-container:has(path[d=" M-4,-10 C-4,-10 4,-10 4,-10 C8.418000221252441,-10 12,-6.418000221252441 12,-2 C12,-2 12,2 12,2 C12,6.418000221252441 8.418000221252441,10 4,10 C4,10 -4,10 -4,10 C-8.418000221252441,10 -12,6.418000221252441 -12,2 C-12,2 -12,-2 -12,-2 C-12,-6.418000221252441 -8.418000221252441,-10 -4,-10z M4.5,0.8659999966621399 C5.166999816894531,0.48100000619888306 5.166999816894531,-0.48100000619888306 4.5,-0.8659999966621399 C4.5,-0.8659999966621399 -1.5,-4.329999923706055 -1.5,-4.329999923706055 C-2.1670000553131104,-4.715000152587891 -3,-4.234000205993652 -3,-3.4639999866485596 C-3,-3.4639999866485596 -3,3.4639999866485596 -3,3.4639999866485596 C-3,4.234000205993652 -2.1670000553131104,4.715000152587891 -1.5,4.329999923706055 C-1.5,4.329999923706055 4.5,0.8659999966621399 4.5,0.8659999966621399z"])');},shieldMoreButton(){c.addShieldStyle('div.dy-tip-container:has([data-e2e="video-play-more"])');},shieldBottomVideoToolBar(){c.addShieldStyle("xg-controls.xgplayer-controls"),w(`
		div:has( > div > pace-island > #video-info-wrap ),
		xg-video-container.xg-video-container{
			bottom: 0 !important;
		}
  		`);},shieldLeftNavigator(){c.addShieldStyle("#douyin-navigation");},shieldTopNavigator(){c.addShieldStyle("#douyin-header");}},E={init(){pe.init(),S.init(),s.execMenu("shieldVideo",()=>{G.init();}),s.execMenu("changeCommentToBottom",()=>{E.changeCommentToBottom();}),s.execMenu("fullScreen",()=>{this.fullScreen();}),s.execMenu("parseVideo",()=>{E.parseVideo();}),s.execMenu("autoEnterElementFullScreen",()=>{this.autoEnterElementFullScreen();}),x.ready(()=>{E.chooseVideoDefinition(s.getValue("chooseVideoDefinition")),s.execMenu("mobileMode",()=>{this.mobileMode();});});},fullScreen(){c.addShieldStyle(".slider-video .positionBox","#video-info-wrap","xg-controls.xgplayer-controls"),pe.shieldSearchFloatingBar(),w(`
        /* 视频全屏 */
        xg-video-container.xg-video-container{
            bottom: 0px !important;
        }
        `);},autoEnterElementFullScreen(){f.waitNode('xg-icon[data-e2e="xgplayer-page-full-screen"] .xgplayer-icon:has([d="M9.75 8.5a2 2 0 00-2 2v11a2 2 0 002 2h12.5a2 2 0 002-2v-11a2 2 0 00-2-2H9.75zM15 11.25h-3.75a1 1 0 00-1 1V16h2v-2.75H15v-2zm5.75 9.5H17v-2h2.75V16h2v3.75a1 1 0 01-1 1z"])').then(e=>{e.click();});},changeCommentToBottom(){if(s.getValue("douyin-video-autoCheckChangeCommentToBottom")&&window.outerWidth>window.outerHeight){h.info("由于网页宽度大于高度，取消【评论区修改为底部】");return}c.addShieldStyle('#sliderVideo[data-e2e="feed-video"] #videoSideBar #relatedVideoCard'),w(`
        #sliderVideo[data-e2e] .playerContainer,
        #slideMode[data-e2e] .playerContainer{
            width: 100% !important;
        }
        #sliderVideo[data-e2e="feed-active-video"] #videoSideBar:has(#relatedVideoCard),
        #slideMode[data-e2e="feed-active-video"] #videoSideBar:has(#relatedVideoCard){
            width: 100%;
            height: 75%;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            transition: height .15s linear !important;
            position: absolute;
        }
        `);},chooseVideoDefinition(e=0){let i="MANUAL_SWITCH",a=[{clarityReal:["normal_1080_0","normal_720_0","low_720_0","normal_540_0","low_540_0","adapt_low_540_0","lower_540_0"],done:1,gearClarity:"5",gearName:"高清",gearType:1,qualityType:1},{clarityReal:["normal_1080_0","low_540_0","low_720_0","normal_720_0","normal_540_0","adapt_low_540_0","lower_540_0","adapt_lowest_720_1","adapt_540_1","adapt_lower_540_1"],done:1,gearClarity:"4",gearName:"清晰",gearType:2,qualityType:15},{clarityReal:["normal_1080_0","low_540_0","low_720_0","normal_720_0","normal_540_0","adapt_low_540_0","lower_540_0","adapt_lowest_720_1","adapt_540_1","adapt_lower_540_1"],done:1,gearClarity:"3",gearName:"流畅",gearType:3,qualityType:28},{clarityReal:["normal_1080_0","low_540_0","low_720_0","normal_720_0","normal_540_0","adapt_low_540_0","lower_540_0","adapt_lowest_720_1","adapt_540_1","adapt_lower_540_1"],done:1,gearClarity:"2",gearName:"极速",gearType:4,qualityType:21},{clarityReal:["normal_1080_0","low_540_0","low_720_0","normal_720_0","normal_540_0","adapt_low_540_0","lower_540_0","adapt_lowest_720_1","adapt_540_1","adapt_lower_540_1"],done:1,gearClarity:"0",gearName:"智能",gearType:0}].find(o=>o.gearType===e);function l(o){y.sessionStorage.setItem(i,o);}if(a){let o=0,d=JSON.stringify(a),r=setInterval(()=>{l(d),o++,o>=20&&clearInterval(r);},500);h.success("设置当前视频的清晰度: "+e);}else h.error("该清晰度不存在: "+e);},chooseVideoRate(e="1"){let i="player_playbackratio";function t(a="1"){y.sessionStorage.setItem(i,a),document.querySelectorAll("xg-icon.xgplayer-playback-setting").forEach(l=>{var d,r,n,m;let o=f.getReactObj(l).reactContainer;(m=(n=(r=(d=o==null?void 0:o.memoizedState)==null?void 0:d.element)==null?void 0:r.props)==null?void 0:n.xgCase)==null||m.updatePlayBackRatio();});}t(e);},parseVideo(){function e(i){let t="";i.forEach(a=>{t+=`
          <div class="douyin-video-link-item"><a href="${a}" target="_blank">${a}</a></div>
            `;}),t=`<div class="douyin-video-link-container">${t}</div>`,ye.alert({title:{text:"视频解析",position:"center"},content:{text:t,html:!0},mask:{enable:!0,clickEvent:{toClose:!0}},width:"50dvw",height:"50dvh",drag:!0,dragLimit:!0,style:`
                .douyin-video-link-container{

                }
                .douyin-video-link-item{
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    margin: 10px;
                }
                .douyin-video-link-item a{

                }
                `});}x.on(document,"click",'div[data-e2e="video-share-container"] div[data-inuser="false"] button + div',function(i){var l;let t=i.target,a=(l=f.getReactObj(t.parentElement))==null?void 0:l.reactFiber;if(!a){V.error("获取rectFiber属性失败");return}try{let o=[],d=a.return.memoizedProps.awemeInfo.video.playAddr,r=a.return.memoizedProps.awemeInfo.video.playAddrH265;if(d!=null&&Array.isArray(d)&&(o=o.concat(d)),r!=null&&Array.isArray(r)&&(o=o.concat(r)),!o.length){V.error("未获取到视频的有效链接信息");return}let n=o.map(m=>m.src);e(n);}catch{V.error("解析视频失败");}},{capture:!0});},mobileMode(){h.success("启用手机模式");let e=x.createElement("meta",{},{name:"viewport",content:"width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover"});document.querySelectorAll("meta[name='viewport']").forEach(i=>i.remove()),document.head.appendChild(e),c.addShieldStyle("img#douyin-temp-sidebar"),w(`
        /* 右侧工具栏放大 */
        .basePlayerContainer .positionBox{
            scale: unset !important;
            bottom: 80px !important;
            padding-right: 5px !important;
            transform: scale(1.12) !important;
        }
        /* 图标再放大 */
        .basePlayerContainer .positionBox svg{
            transform: scale(1.12);
        }
        /* 重置关注按钮的scale */
        .basePlayerContainer .positionBox .dy-tip-container div[data-e2e="feed-follow-icon"] svg{
            scale: unset;
        }
        /* 设备处于横向方向，即宽度大于高度。 */
        @media screen and (orientation: landscape) {
            /* 右侧工具栏放大 */
            .basePlayerContainer .positionBox{
                // transform: scale(0.95) !important;
                // bottom: 42px !important;
                padding-right: 10px !important;
            }
        }
        /* 该设备是纵向的，即高度大于或等于宽度 */
        @media screen and (orientation: portrait) {
            
        }
        `);}},S={shortCut:new ke("video-short-cut"),$data:{rateMap:["0.75","1","1.25","1.5","1.75","2","3"]},init(){this.shortCut.initGlobalKeyboardListener(this.getShortCutMap());},getShortCutMap(){return {"dy-video-rate-low":{callback(){h.info("调用倍速 => 小");let e=y.sessionStorage.getItem("player_playbackratio")??"1",i=S.$data.rateMap.findIndex(a=>a===e);if(i===0){h.warn("已是最小倍速: "+e);return}let t=S.$data.rateMap[i-1];h.info("设置倍速: "+t),E.chooseVideoRate(t);}},"dy-video-rate-up":{callback(){h.info("调用倍速 => 大");let e=y.sessionStorage.getItem("player_playbackratio")??"1",i=S.$data.rateMap.findIndex(a=>a===e);if(i===S.$data.rateMap.length-1){h.warn("已是最大倍速: "+e);return}let t=S.$data.rateMap[i+1];h.info("设置倍速: "+t),E.chooseVideoRate(t);}}}}},Be={id:"panel-config-video",title:"视频",isDefault(){return R.isVideo()},forms:[{text:"功能",type:"forms",forms:[Ve("清晰度","chooseVideoDefinition",1,[{text:"智能",value:0},{text:"极速",value:4},{text:"流畅",value:3},{text:"清晰",value:2},{text:"高清",value:1}],void 0,"自行选择清晰度"),u("视频解析","分享->下载(灰色的也可点击)","parseVideo",!1),u("自动进入网页全屏","网页加载完毕后自动点击网页全屏按钮进入全屏","autoEnterElementFullScreen",!1),u("沉浸模式","移除右侧工具栏、底部信息栏等","fullScreen",!1)]},{text:"手机模式",type:"forms",forms:[u("启用","放大各种文字和图标","mobileMode",!1),u("评论区移到中间","修改评论区为中间弹出而非右侧区域","changeCommentToBottom",!0),u("↑自适应评论区位置","根据屏幕宽度自动判断是否开启【评论区移到中间】","douyin-video-autoCheckChangeCommentToBottom",!1)]},{text:"快捷键",type:"forms",forms:[me("倍速 -> 小","视频倍速变小",()=>S.shortCut.getShowText("dy-video-rate-low","暂无快捷键"),"keyboard",!1,!1,"default",e=>{var a;let t=(a=e.target.closest(".pops-panel-button"))==null?void 0:a.querySelector("span");S.shortCut.inputShortCut("dy-video-rate-low","暂无快捷键",l=>{t.innerHTML=l;});}),me("倍速 -> 大","视频倍速变大",()=>S.shortCut.getShowText("dy-video-rate-up","暂无快捷键"),"keyboard",!1,!1,"default",e=>{var a;let t=(a=e.target.closest(".pops-panel-button"))==null?void 0:a.querySelector("span");S.shortCut.inputShortCut("dy-video-rate-up","暂无快捷键",l=>{t.innerHTML=l;});})]},{text:"视频区域内-屏蔽",type:"forms",forms:[u("【屏蔽】右侧的展开评论按钮","屏蔽元素","shieldRightExpandCommentButton",!0),u("【屏蔽】搜索悬浮栏","屏蔽元素，一般出现在左上角","shieldSearchFloatingBar",!0),u("【屏蔽】网页全屏关闭按钮","屏蔽元素，一般开启网页全屏后出现在左上角","shieldCloseFullScreenButton",!0),u("【屏蔽】切换播放","屏蔽元素，在右侧作者头像上方","shieldPlaySwitchButton",!1),u("【屏蔽】作者头像","屏蔽元素","shieldAuthorAvatar",!1),u("【屏蔽】点赞","屏蔽元素","shieldLikeButton",!1),u("【屏蔽】评论","屏蔽元素","shieldCommentButton",!1),u("【屏蔽】收藏","屏蔽元素","shieldCollectionButton",!1),u("【屏蔽】分享","屏蔽元素","shieldSharenButton",!1),u("【屏蔽】看相关","屏蔽元素","shieldRelatedRecommendationsButton",!1),u("【屏蔽】更多","屏蔽元素","shieldMoreButton",!1),u("【屏蔽】底部视频工具栏","屏蔽元素","shieldBottomVideoToolBar",!1)]},{text:"视频过滤规则(可正则)",type:"forms",forms:[u("启用","开启后可启用下面的屏蔽功能","shieldVideo",!0),u("【屏蔽】直播","过滤掉直播","shieldVideo-live",!0),u("【屏蔽】广告","过滤掉广告","shieldVideo-ads",!0),{type:"own",getLiElementCallBack(e){let i=x.createElement("div",{className:"pops-panel-textarea",innerHTML:'<textarea placeholder="请输入屏蔽规则，每行一个" style="height:350px;"></textarea>'},{style:"width: 100%;"}),t=i.querySelector("textarea");return t.value=G.get(),x.on(t,["input","propertychange"],f.debounce(function(){G.set(t.value);},200)),e.appendChild(i),e}}]}]},s={$data:{data:new f.Dictionary,oneSuccessExecMenu:new f.Dictionary,onceExec:new f.Dictionary,scriptName:he,key:T,attributeKeyName:A,attributeDefaultValueName:P},$listener:{listenData:new f.Dictionary},init(){this.initPanelDefaultValue(),this.initExtensionsMenu();},initExtensionsMenu(){y.top===y.self&&we.add([{key:"show_pops_panel_setting",text:"⚙ 设置",autoReload:!1,isStoreValue:!1,showText(e){return e},callback:()=>{this.showPanel();}}]);},initPanelDefaultValue(){let e=this;function i(a){if(!a.attributes)return;let l=a.attributes[A],o=a.attributes[P];if(l==null){console.warn("请先配置键",a);return}e.$data.data.has(l)&&console.warn("请检查该key(已存在): "+l),e.$data.data.set(l,o);}let t=this.getPanelContentConfig();for(let a=0;a<t.length;a++){let l=t[a];if(!l.forms)continue;let o=l.forms;for(let d=0;d<o.length;d++){let r=o[d];if(r.forms){let n=r.forms;for(let m=0;m<n.length;m++)i(n[m]);}else i(r);}}},setValue(e,i){let t=_(T,{}),a=t[e];t[e]=i,k(T,t),this.$listener.listenData.has(e)&&this.$listener.listenData.get(e).callback(e,a,i);},getValue(e,i){let a=_(T,{})[e];return a??(this.$data.data.has(e)?this.$data.data.get(e):i)},deleteValue(e){let i=_(T,{}),t=i[e];Reflect.deleteProperty(i,e),k(T,i),this.$listener.listenData.has(e)&&this.$listener.listenData.get(e).callback(e,t,void 0);},addValueChangeListener(e,i){let t=Math.random();return this.$listener.listenData.set(e,{id:t,key:e,callback:i}),t},removeValueChangeListener(e){let i=null;for(const[t,a]of this.$listener.listenData.entries())if(a.id===e){i=t;break}typeof i=="string"?this.$listener.listenData.delete(i):console.warn("没有找到对应的监听器");},execMenu(e,i){if(typeof e!="string")throw new TypeError("key 必须是字符串");let t=s.getValue(e);t&&i(t);},execMenuOnce(e,i){if(typeof e!="string")throw new TypeError("key 必须是字符串");let t=s.getValue(e);if(t){if(this.$data.oneSuccessExecMenu.has(e))return;i(t),this.$data.oneSuccessExecMenu.set(e,1);}},onceExec(e,i){if(typeof e!="string")throw new TypeError("key 必须是字符串");this.$data.onceExec.has(e)||(i(),this.$data.onceExec.set(e,1));},showPanel(){ye.panel({title:{text:`${he}-设置`,position:"center",html:!1,style:""},content:this.getPanelContentConfig(),mask:{enable:!0,clickEvent:{toClose:!0,toHide:!1}},isMobile:!0,width:this.getWidth(),height:this.getHeight(),drag:!0,only:!0});},getWidth(){return window.outerWidth<550?"92dvw":"550px"},getHeight(){return window.outerHeight<450?"80dvh":"450px"},getPanelContentConfig(){return [be,Be,Me]}},Te={init(){s.execMenu("shieldClientTip",()=>{this.shieldClientTip();}),s.execMenu("shieldFillingBricksAndStones",()=>{this.shieldFillingBricksAndStones();}),s.execMenu("shieldClient",()=>{this.shieldClient();}),s.execMenu("shieldQuickAccess",()=>{this.shieldQuickAccess();}),s.execMenu("shieldNotifitation",()=>{this.shieldNotifitation();}),s.execMenu("shieldPrivateMessage",()=>{this.shieldPrivateMessage();}),s.execMenu("shieldSubmission",()=>{this.shieldSubmission();});},shieldFillingBricksAndStones(){c.addShieldStyle('pace-island[id^="island"] > div[class]:has(div[data-e2e="something-button"]) > :has(path[d="M5.757 12.268a6.397 6.397 0 1112.793 0 6.397 6.397 0 01-12.793 0zm6.396-7.897a7.897 7.897 0 100 15.793 7.897 7.897 0 000-15.793zm2.127 3.52v-.497h-1.5v6.462h.001c0 .854-.685 1.536-1.517 1.536a1.527 1.527 0 01-1.517-1.536c0-.854.685-1.536 1.517-1.536v-1.5c-1.672 0-3.017 1.365-3.017 3.036 0 1.67 1.345 3.036 3.017 3.036s3.017-1.365 3.017-3.036h-.001v-3.228a3.184 3.184 0 001.715.498v-1.5a1.725 1.725 0 01-1.715-1.735z"])');},shieldClient(){c.addShieldStyle('pace-island[id^="island"] > div[class]:has(div[data-e2e="something-button"]) .dy-tip-container');},shieldQuickAccess(){c.addShieldStyle('pace-island[id^="island"] > div[class]:has(div[data-e2e="something-button"]) > :has(.quick-access-nav-icon)');},shieldNotifitation(){c.addShieldStyle('pace-island[id^="island"] > div[class]:has(div[data-e2e="something-button"]) > :has(path[d="M9.905 19.407h4.5v-1.5h-4.5v1.5z"])');},shieldPrivateMessage(){c.addShieldStyle('pace-island[id^="island"] > div[class]:has(div[data-e2e="something-button"]) > ul:has(div[data-e2e="im-entry"])');},shieldSubmission(){c.addShieldStyle('pace-island[id^="island"] > div[class]:has(div[data-e2e="something-button"]) > :has(ul[data-e2e="cooperate-list"])');},shieldClientTip(){c.addShieldStyle('#douyin-header div[data-e2e="im-entry"] div.popShadowAnimation:first-child',"#douyin-header ul div.userMenuPanelShadowAnimation:first-child");}},Ee={init(){s.execMenu("shieldSearch",()=>{this.shieldSearch();}),s.execMenu("shieldSearchPlaceholder",()=>{this.shieldSearchPlaceholder();}),s.execMenu("shieldSearchGuessYouWantToSearch",()=>{this.shieldSearchGuessYouWantToSearch();}),s.execMenu("shieldSearchTiktokHotspot",()=>{this.shieldSearchTiktokHotspot();});},shieldSearch(){c.addShieldStyle('#douyin-header div[data-click="doubleClick"] > div[data-click="doubleClick"] > div:has(input[data-e2e="searchbar-input"])');},shieldSearchPlaceholder(){c.addShieldStyle('#douyin-header div[data-click="doubleClick"] > div[data-click="doubleClick"] > div div:has( + input[data-e2e="searchbar-input"])'),w(`
#douyin-header div[data-click="doubleClick"] > div[data-click="doubleClick"] > div input[data-e2e="searchbar-input"]::placeholder{
  color: transparent;
}
`);},shieldSearchGuessYouWantToSearch(){c.addShieldStyle('button[data-e2e="searchbar-button"] + div div:has( + div[data-e2e="search-guess-container"])','button[data-e2e="searchbar-button"] + div div[data-e2e="search-guess-container"]');},shieldSearchTiktokHotspot(){c.addShieldStyle('button[data-e2e="searchbar-button"] + div div:has( + div[data-e2e="search-hot-container"])','button[data-e2e="searchbar-button"] + div div[data-e2e="search-hot-container"]');}},Ie={removeEnvCheck(){h.info("移除环境检测");let e=y.setInterval;y.setInterval=function(i,t){let a=i.toString().trim();if(a.includes("debugger")){h.success(["拦截→",[a]]);return}if(a.includes("checkEXp")){h.success(["拦截→",[a]]);return}return e.call(this,i,t)};}},ge={disguiseLogin(){let i=parseInt((Math.random()*1e6).toString()),t=Object.defineProperty({},"uid",{value:i,writable:!1});function a(o){var m,p,g,v,B,z,H,O,U,W,Y,F,Q,q,K,j,J,X,Z,ee,te,ie,ae,oe,le,ne,re,se,de,ue;let d=[],r=f.getReactObj(o),n=r==null?void 0:r.reactFiber;return (g=(p=(m=n==null?void 0:n.alternate)==null?void 0:m.return)==null?void 0:p.memoizedProps)!=null&&g.userInfo&&d.push((z=(B=(v=n==null?void 0:n.alternate)==null?void 0:v.return)==null?void 0:B.memoizedProps)==null?void 0:z.userInfo),(W=(U=(O=(H=n==null?void 0:n.alternate)==null?void 0:H.return)==null?void 0:O.memoizedProps)==null?void 0:U.userInfo)!=null&&W.userInfo&&d.push((Q=(F=(Y=n==null?void 0:n.alternate)==null?void 0:Y.return)==null?void 0:F.memoizedProps)==null?void 0:Q.userInfo.userInfo),(J=(j=(K=(q=n==null?void 0:n.alternate)==null?void 0:q.return)==null?void 0:K.return)==null?void 0:j.memoizedProps)!=null&&J.userInfo&&d.push((te=(ee=(Z=(X=n==null?void 0:n.alternate)==null?void 0:X.return)==null?void 0:Z.return)==null?void 0:ee.memoizedProps)==null?void 0:te.userInfo),(ne=(le=(oe=(ae=(ie=n==null?void 0:n.alternate)==null?void 0:ie.return)==null?void 0:ae.return)==null?void 0:oe.memoizedProps)==null?void 0:le.userInfo)!=null&&ne.userInfo&&d.push((ue=(de=(se=(re=n==null?void 0:n.alternate)==null?void 0:re.return)==null?void 0:se.return)==null?void 0:de.memoizedProps)==null?void 0:ue.userInfo.userInfo),d}function l(o){a(o).forEach(d=>{Object.defineProperties(d,{info:{value:t,writable:!1},isLogin:{value:!0,writable:!1}});});}c.watchVideDataListChange(()=>{l(c.getOSElement());}),f.waitNodeWithInterval("#root div[class*='-os']",2e4).then(()=>{f.mutationObserver(document.body,{config:{subtree:!0,childList:!0},callback:f.debounce(()=>{l(c.getOSElement());},70)});}),R.isLive()&&f.waitNodeWithInterval("#douyin-header div:has(.dy-tip-container)",2e4).then(()=>{f.mutationObserver(document.body,{config:{subtree:!0,childList:!0},callback:f.debounce(()=>{l(document.querySelector("#douyin-header"));},70)});});},watchLoginDialogToClose(){c.addShieldStyle('div[id^="login-full-panel-"]'),f.waitNode("body").then(()=>{f.mutationObserver(document.body,{config:{subtree:!0,childList:!0},callback(){var i,t;let e=document.querySelector('body > div[id^="login-full-panel-"] .dy-account-close');e&&((t=(i=f.getReactObj(e))==null?void 0:i.reactProps)==null||t.onClick(new Event("click")));}});});}},Re={init(){s.execMenu("live-shieldChatRoom",()=>{this.shieldChatRoom();}),s.execMenu("live-shielChatRoomVipSeats",()=>{this.shielChatRoomVipSeats();});},shieldChatRoom(){c.addShieldStyle("#chatroom"),w(`
    div[data-e2e="living-container"],
    div[data-e2e="living-container"] > div{
      margin-bottom: 0px !important;
    }`);},shielChatRoomVipSeats(){c.addShieldStyle("#chatroom > div > div:has(#audiencePanelScrollId)");}},De={init(){s.execMenu("live-autoEnterElementFullScreen",()=>{this.autoEnterElementFullScreen();}),s.execMenu("live-shieldGiftColumn",()=>{this.shieldGiftColumn();}),s.execMenu("live-shieldTopToolBarInfo",()=>{this.shieldTopToolBarInfo();}),s.execMenu("live-shieldGiftEffects",()=>{this.shieldGiftEffects();}),s.execMenu("live-shieldDanmuku",()=>{fe.shieldDanmu();}),s.execMenu("live-danmu-shield-rule-enable",()=>{fe.filterDanmu();}),s.execMenu("live-unlockImageQuality",()=>{this.unlockImageQuality();}),s.execMenu("live-shieldBottomQuestionButton",()=>{this.shieldBottomQuestionButton();}),Re.init();},autoEnterElementFullScreen(){h.success("自动进入网页全屏"),f.waitNode('xg-icon[classname] > div > div:has(path[d="M9.75 8.5a2 2 0 00-2 2v11a2 2 0 002 2h12.5a2 2 0 002-2v-11a2 2 0 00-2-2H9.75zM15 11.25h-3.75a1 1 0 00-1 1V16h2v-2.75H15v-2zm5.75 9.5H17v-2h2.75V16h2v3.75a1 1 0 01-1 1z"])').then(e=>{e.click();});},shieldGiftColumn(){h.success("屏蔽底部的礼物栏"),c.addShieldStyle('div[data-e2e="living-container"] >div> :last-child');},shieldTopToolBarInfo(){h.success("【屏蔽】顶栏信息"),c.addShieldStyle('div[data-e2e="living-container"] > div > pace-island[id^="island_"]');},shieldGiftEffects(){h.success("【屏蔽】礼物特效"),c.addShieldStyle('.basicPlayer[data-e2e="basicPlayer"]  pace-island[id^="island_"]:has(>div>div>div)');},unlockImageQuality(){h.success("解锁画质选择"),x.on(document,"click",'div[data-e2e="quality-selector"] > div',function(e){var t,a;f.preventEvent(e);let i=e.target;try{let l=f.getReactObj(i),o=(t=l==null?void 0:l.reactFiber)==null?void 0:t.key,d=i.closest("div[data-index]"),r=f.getReactObj(d),n=(a=r==null?void 0:r.reactProps)==null?void 0:a.children.ref.current;h.info("当前选择的画质: "+o),h.info(["所有的画质: ",n.getCurrentQualityList()]),n.setCurrentQuality(o);}catch(l){h.error(l),V.error("切换画质失败");}},{capture:!0});},shieldBottomQuestionButton(){h.success("屏蔽底部问题按钮"),c.addShieldStyle("#douyin-sidebar");}},Le={init(){s.execMenu("douyin-redirect-url-home-to-root",()=>{this.redirectUrlHomeToRoot();});},redirectUrlHomeToRoot(){window.location.pathname==="/home"&&(window.location.href=window.location.origin);}},Ae={init(){Le.init(),s.execMenu("debug",()=>{Ie.removeEnvCheck();}),s.execMenu("disguiseLogin",()=>{ge.disguiseLogin();}),s.execMenu("watchLoginDialogToClose",()=>{ge.watchLoginDialogToClose();}),Te.init(),Ee.init(),R.isLive()?(h.info("Router: 直播"),De.init()):R.isVideo()?(h.info("Router: 推荐视频"),E.init()):h.error("未知router: "+window.location.hostname);}};s.init();Ae.init();

})();